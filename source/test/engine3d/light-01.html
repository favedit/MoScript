<HTML>
<HEAD>
<TITLE>Stage3d Example</TITLE>
<META http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK rel="stylesheet" href='../../acs/lang_cn.css' type="text/css" media="all"/>
<SCRIPT language='javascript' src='../../ajs/me.js'></SCRIPT>
<SCRIPT language='javascript' src='../../ajs/context_cn.js'></SCRIPT>
</HEAD>

<SCRIPT>
var canvas = null;
var stage = null;
var layer = null;
var bitmaps = null;
var tick = 0;
//----------------------------------------------------------
function onLoadImage(event){
   if(!imageAlpha.testReady()){
      return;
   }
   if(!imageColor.testReady()){
      return;
   }
   if(!imageSky.testReady()){
      return;
   }
   var context = application.canvas().graphicContext();
   var stage = application.canvas().stage();
   var renderable = MO.Class.create(MO.FE3dRectangle);
   renderable.linkGraphicContext(context);
   renderable.setup(context);
   renderable._material = MO.Class.create(MO.FE3dMaterial);
   renderable.material().info().effectCode = 'flood';
   renderable._textures = new MO.TDictionary();
   renderable._textures.set('alpha', imageAlpha);
   renderable._textures.set('color', imageColor);
   renderable._textures.set('sky', imageSky);
   stage.spriteLayer().pushRenderable(renderable);
   //var context = application.canvas().graphicContext();
   //effect = MO.Class.create(MO.FE3dFloodLightEffect);
   //effect.linkGraphicContext(context);
   //effect.load();
}
//----------------------------------------------------------
function onEnterFrame(event){
   //if(effect){
      //var program = effect.program();
      //effect.draw();
   //}
}
//----------------------------------------------------------
function _load(){
   // 环境设置
   MO.initialize();
   MO.Runtime.setProcessCd(MO.EProcess.Debug);
   MO.Window.Browser.setContentPath('../..');
   //MO.Application.initialize();
   // 设置环境
   MO.Console.find(MO.FE3sVendorConsole).setup('net');
   application = MO.Desktop.initialize(MO.FCanvas3dApplication);
   application.addEnterFrameListener(null, onEnterFrame);
   application.setup(document.body);

   var imageConsole = MO.Console.find(MO.FImageConsole);
   imageAlpha = imageConsole.load('../../ars/picture/city/alpha.jpg');
   imageAlpha.addLoadListener(null, onLoadImage);
   imageColor = imageConsole.load('../../ars/picture/city/color.png');
   imageColor.addLoadListener(null, onLoadImage);
   imageSky = imageConsole.load('../../ars/picture/city/sky.jpg');
   imageSky.addLoadListener(null, onLoadImage);
}
</SCRIPT>

<BODY scroll='auto' onload='_load()'>
</BODY>

</HTML>
