var MO=new function(){return this},ELogger=new function(){this.Debug="D";this.Info="I";this.Warn="W";this.Error="E";this.Fatal="F";return this},EProcess=new function(){this.Debug=1;this.Release=2;return this},EScope=new function(){this.Local=1;this.Session=2;this.Global=4;return this},RRuntime=new function(){this._processCd=EProcess.Release;this.isDebug=RRuntime_isDebug;this.isRelease=RRuntime_isRelease;this.setProcessCd=RRuntime_setProcessCd;this.nvl=RRuntime_nvl;this.subString=RRuntime_subString;
this.className=RRuntime_className;return this};function RRuntime_isDebug(){return this._processCd==EProcess.Debug}function RRuntime_isRelease(){return this._processCd==EProcess.Release}function RRuntime_setProcessCd(a){this._processCd=a}function RRuntime_nvl(a,b){return null!=a?a:b}function RRuntime_subString(a,b,e){if(null==a)return a;var f=0;if(null!=b){var h=a.indexOf(b);-1!=h&&(f=h+b.length)}b=a.length;null!=e&&(h=a.indexOf(e,f),-1!=h&&(b=h));return a.substring(f,b)}
function RRuntime_className(a){return a&&("function"==typeof a||(a=a.constructor))?this.subString(a.toString(),"function ","("):null}function SLooperEntry(){this.value=this.next=this.prior=null;this.dispose=SLooperEntry_dispose;return this}function SLooperEntry_dispose(){this.value=this.next=this.prior=null}
function TArray(){this._length=0;this._memory=[];this.isEmpty=TArray_isEmpty;this.length=TArray_length;this.contains=TArray_contains;this.indexOf=TArray_indexOf;this.get=TArray_get;this.set=TArray_set;this.push=TArray_push;this.swap=TArray_swap;this.sort=TArray_sort;this.erase=TArray_erase;this.remove=TArray_remove;this.compress=TArray_compress;this.clear=TArray_clear;this.dispose=TArray_dispose;this.dump=TArray_dump;return this}function TArray_isEmpty(){return 0==this._length}
function TArray_length(){return this._length}function TArray_contains(a){return-1!=this.indexOf(a)}function TArray_indexOf(a){for(var b=this._length,e=0;e<b;e++)if(this._memory[e]==a)return e;return-1}function TArray_get(a){return 0<=a&&a<this._length?this._memory[a]:null}function TArray_set(a,b){0<=a&&a<this._length&&(this._memory[a]=b)}function TArray_push(a){this._memory[this._length++]=a}
function TArray_swap(a,b){if(0<=a&&a<this._length&&0<=b&&b<this._length&&a!=b){var e=this._memory[a];this._memory[a]=this._memory[b];this._memory[b]=e}}function TArray_sort(){this._memory.sort()}function TArray_erase(a){var b=null;if(0<=a&&a<c)for(this._length--,b=this._memory[a];a<c;a++)this._memory[a]=this._memory[a+1];return b}function TArray_remove(a){if(null!=a){for(var b=0,e=this._length,f=b;f<e;f++)this._memory[f]!=a&&(this._memory[b++]=this._memory[f]);this._length=b}return a}
function TArray_compress(){for(var a=this._length,b=0,e=0;e<a;e++){var f=this._memory[e];null!=f&&(this._memory[b++]=f)}this._length=b}function TArray_clear(){this._length=0}function TArray_dispose(){this._length=0;this._memory=null}function TArray_dump(){var a=new TString,b=this._length;a.append(RRuntime.className(this),":",b);if(0<b)for(var e=0;e<b;e++)a.append(" [",this._memory[e],"]");return a.flush()}
function TAttributes(){TDictionary.call(this);this.join=TAttributes_join;this.split=TAttributes_split;this.pack=TAttributes_pack;this.unpack=TAttributes_unpack;this.dump=TAttributes_dump;return this}function TAttributes_join(a,b){var e=new TString;a||(a="=");b||(b=",");for(var f=this.count,h=0;h<f;h++)0<h&&e.append(b),e.append(this.names[h]),e.append(a),e.append(this.values[h]);return e.toString()}
function TAttributes_split(a,b,e){a=a.split(e);e=a.length;for(var f=0;f<e;f++){var h=a[f];if(h.length){var k=h.split(b);2==k.length?this.set(k[0],k[1]):this.set(h,"")}}}function TAttributes_pack(){for(var a=new TString,b=this.count,e=0;e<b;e++){var f=this.names[e].length;a.append(f.toString().length,f,this.names[e]);if(null!=this.values[e]){var h=this.values[e]+"",f=h.length;a.append(f.toString().length,f,h)}else a.append("0")}return a.toString()}
function TAttributes_unpack(a){if(a&&a.length){var b=null,e=null,f=0;this.count=0;for(var h=a.length;f<h;){var k=parseInt(a.substr(f++,1)),q=parseInt(a.substr(f,k)),b=a.substr(f+k,q),f=f+(k+q),k=parseInt(a.substr(f++,1));0==k?e=null:(q=parseInt(a.substr(f,k)),e=a.substr(f+k,q),f+=k+q);this.set(b,e)}}}
function TAttributes_dump(){var a=new TString,b=this._count;a.append(RRuntime.className(this)," : ",b);if(0<b){a.append(" (");for(var e=0;e<b;e++)0<e&&a.append(", "),a.append(this._names[e],"=",this._values[e]);a.append(")")}return a.flush()}function TDictionary(){TMap.call(this);this.dump=TDictionary_dump;return this}
function TDictionary_dump(){var a=new TString,b=this._count;a.append(RRuntime.className(this),": ",b);if(0<b){a.append(" {\n");for(var e=0;e<b;e++)a.append("   ",this._names[e],"=[",this._values[e],"]\n");a.append("}")}return a.flush()}
function TList(){this._count=0;this._memory=[];this.isEmpty=TList_isEmpty;this.contains=TList_contains;this.indexOf=TList_indexOf;this.first=TList_first;this.last=TList_last;this.get=TList_get;this.set=TList_set;this.append=TList_append;this.insert=TList_insert;this.push=TList_push;this.pushUnique=TList_pushUnique;this.pop=TList_pop;this.swap=TList_swap;this.sort=TList_sort;this.erase=TList_erase;this.remove=TList_remove;this.clear=TList_clear;this.compress=TList_compress;this.pack=TList_pack;this.dispose=
TList_dispose;this.dump=TList_dump;return this}function TList_isEmpty(){return 0==this._count}function TList_contains(a){return-1!=this.indexOf(a)}function TList_indexOf(a){for(var b=this._count,e=0;e<b;e++)if(this._memory[e]==a)return e;return-1}function TList_first(){return this._count?this._memory[0]:null}function TList_last(){return this._count?this._memory[this._count-1]:null}function TList_get(a){return 0<=a&&a<this._count?this._memory[a]:null}
function TList_set(a,b){0<=a&&a<this._count&&(this._memory[a]=b)}function TList_append(a){for(var b=a._count,e=0;e<b;e++)this.push(a.get(e))}function TList_insert(a,b){var e=this._count;if(0<=a&&a<=e){for(;e>a;e--)this._memory[e]=this._memory[e-1];this._memory[a]=b}}function TList_push(a){var b=this._count++;this._memory[b]=a;return b}function TList_pushUnique(a){for(var b=this._count-1;0<=b;b--)if(this._memory[b]==a)return b;b=this._count++;this._memory[b]=a;return b}
function TList_pop(){if(this._count)return this._memory[--this._count]}function TList_swap(a,b){if(0<=a&&a<this._count&&0<=b&&b<this._count&&a!=b){var e=this._memory[a];this._memory[a]=this._memory[b];this._memory[b]=e}}function TList_sort(){this._memory.sort()}function TList_erase(a){var b=null;if(0<=a&&a<this._count)for(var b=this._memory[a],e=--this._count;a<e;a++)this._memory[a]=this._memory[a+1];return b}
function TList_remove(a){if(null!=a){var b=this._count;if(0<b){for(var e=0,f=e;f<b;f++)this._memory[f]!=a&&(this._memory[e++]=this._memory[f]);this._count=e}}return a}function TList_clear(){this._count=0}function TList_compress(){var a=this._count;if(0<a){for(var b=0,e=0;e<a;e++){var f=this._memory[e];null!=f&&(this._memory[b++]=f)}this._count=b}}function TList_pack(){for(var a=new TStrings,b=0;b<this._count;b++)a.push(this.get(b).pack());return a.pack()}
function TList_dispose(){this._count=0;for(var a in this._memory)delete this._memory[a];this._memory=null}function TList_dump(){var a=this._count,b=new TString;b.append(RClass.name(this),":",a);if(0<a)for(var e=0;e<a;e++)b.append(" [",this._memory[e],"]");return b.toString()}
function TLooper(){this._recordCount=this._count=0;this._unused=this._current=null;this.innerCreate=TLooper_innerCreate;this.innerFree=TLooper_innerFree;this.innerPush=TLooper_innerPush;this.innerRemove=TLooper_innerRemove;this.innerRemoveCurrent=TLooper_innerRemoveCurrent;this.innerRemoveValue=TLooper_innerRemoveValue;this.isEmpty=TLooper_isEmpty;this.count=TLooper_count;this.record=TLooper_record;this.unrecord=TLooper_unrecord;this.contains=TLooper_contains;this.current=TLooper_current;this.next=
TLooper_next;this.push=TLooper_push;this.pushUnique=TLooper_pushUnique;this.removeCurrent=TLooper_removeCurrent;this.remove=TLooper_remove;this.clear=TLooper_clear;this.dispose=TLooper_dispose;this.dump=TLooper_dump;return this}function TLooper_innerCreate(){var a=this._unused;null==a?a=new SLooperEntry:this._unused=a.next;return a}function TLooper_innerFree(a){a.next=this._unused;this._unused=a}
function TLooper_innerPush(a){var b=this._current;if(b){var e=b.prior;a.prior=e;a.next=b;e.next=a;b.prior=a}else a.prior=a,this._current=a.next=a;this._count++}function TLooper_innerRemove(a){var b=a.prior,e=a.next;b.next=e;e.prior=b;this._count--;this._current=0<this._count?e:null;this.innerFree(a)}function TLooper_innerRemoveCurrent(){var a=null;0<this._count&&(a=this._current.value,this.innerRemove(this._current));return a}
function TLooper_innerRemoveValue(a){if(0<o._count)if(o._current.value==a)o.innerRemoveCurrent();else for(var b=o._current,e=b.next;e!=b;){if(e.value==a){o.innerRemove(e);o._current=b;break}e=e.next}}function TLooper_isEmpty(a){return 0==this._count}function TLooper_count(){return this._count}function TLooper_record(){this._recordCount=this._count}function TLooper_unrecord(a){this._recordCount=-1}
function TLooper_contains(a){if(this._current)for(var b=this._count,e=this._current,f=0;f<b;f++){if(e.value==a)return!0;e=e.next}return!1}function TLooper_current(){var a=this._current;return a?a.value:null}function TLooper_next(){this._current&&(this._current=this._current.next);var a=this._recordCount;if(0<a)this._recordCount--;else if(0==a)return null;return this._current?this._current.value:null}function TLooper_push(a){var b=this.innerCreate();b.value=a;this.innerPush(b)}
function TLooper_pushUnique(a){this.contains(a)||this.push(a)}function TLooper_removeCurrent(){return this.innerRemoveCurrent()}function TLooper_remove(a){this.innerRemoveValue(a)}function TLooper_clear(){var a=this._current;a&&(a.prior.next=null,a.prior=this._unused,this._unused=a,this._current=null);this._count=0}function TLooper_dispose(){this.clear();for(var a=this._unused;a;){var b=a.next;a.dispose();a=b}this._unused=null}
function TLooper_dump(){var a=this._count,b=new TString;b.append(RClass.name(this),": ",a);if(0<a)for(var e=this._current,f=0;f<a;f++)b.append(" [",e.value,"]"),e=e.next;return b.toString()}
function TMap(){this._count=0;this._table={};this._names=[];this._values=[];this.isEmpty=TMap_isEmpty;this.count=TMap_count;this.contains=TMap_contains;this.containsValue=TMap_containsValue;this.indexOf=TMap_indexOf;this.indexOfValue=TMap_indexOfValue;this.first=TMap_first;this.last=TMap_last;this.nameAt=TMap_nameAt;this.name=TMap_name;this.valueAt=TMap_valueAt;this.value=TMap_value;this.setValueAt=TMap_setValueAt;this.setValue=TMap_setValue;this.get=TMap_get;this.set=TMap_set;this.assign=TMap_assign;
this.append=TMap_append;this.insert=TMap_insert;this.remove=TMap_remove;this.removeName=TMap_removeName;this.removeValue=TMap_removeValue;this.rebuild=TMap_rebuild;this.clear=TMap_clear;this.toString=TMap_toString;this.dispose=TMap_dispose;this.dump=TMap_dump;return this}function TMap_isEmpty(){return 0==this._count}function TMap_count(){return this._count}function TMap_contains(a){return null!=a&&null!=this._table[a.toString().toLowerCase()]?!0:!1}
function TMap_containsValue(a){return-1!=this.indexOfValue(a)}function TMap_indexOf(a){return null!=a&&(a=this._table[a.toString().toLowerCase()],null!=a)?a:-1}function TMap_indexOfValue(a){for(var b=this._count,e=0;e<b;e++)if(this._values[e]==a)return e;return-1}function TMap_first(){return 0<this._count?this._values[0]:null}function TMap_last(){return 0<this._count?this._values[this._count-1]:null}function TMap_nameAt(a){return this._names[a]}
function TMap_name(a){return 0<=a&&a<this._count?this._names[a]:null}function TMap_valueAt(a){return this._values[a]}function TMap_value(a){return 0<=a&&a<this._count?this._values[a]:null}function TMap_setValueAt(a,b){this._values[a]=b}function TMap_setValue(a,b){0<=a&&a<this._count&&(this._values[a]=b)}function TMap_get(a,b){if(null!=a){var e=this._table[a.toString().toLowerCase()];if(null!=e)return this._values[e]}return b}
function TMap_set(a,b){if(null!=a){var e=a.toString().toLowerCase(),f=this._table[e];if(null==f||f>=this._count)f=this._count++,this._names[f]=a,this._table[e]=f;this._values[f]=b}}function TMap_assign(a){this.clear();this.append(a)}function TMap_append(a){if(a)for(var b=a._count,e=0;e<b;e++)this.set(a.name(e),a.value(e))}
function TMap_insert(a,b,e){var f=this._count;if(0<=a&&a<=f){for(;f>a;f--)this._names[f]=this._names[f-1],this._values[f]=this._values[f-1];this._names[a]=b;this._values[a]=e;this._count++;this.rebuild()}}function TMap_remove(a){var b=null,e=this._count;if(0<=a&&a<e){for(b=this._values[a];a<e;a++)this._names[a]=this._names[a+1],this._values[a]=this._values[a+1];this._count--;this.rebuild()}return b}function TMap_removeName(a){a=this.indexOf(a);return-1!=a?this.remove(a):null}
function TMap_removeValue(a){for(var b=0,e=this._count,f=0;f<e;f++){var h=this._values[f];a!=h&&(b!=f&&(this._names[b]=this._names[f],this._values[b]=h),b++)}this._count=b;this.rebuild()}function TMap_rebuild(){var a=this._table,b;for(b in a)delete a[b];var e=this._count;for(b=0;b<e;b++)a[this._names[b].toLowerCase()]=b}function TMap_clear(){this._count=0;for(var a in this._table)delete this._table[a]}function TMap_toString(){return this.dump().toString()}
function TMap_dispose(){this._count=0;var a=this._table;if(a){for(var b in a)a[b]=null;this._table=null}if(a=this._names){for(b=a.length-1;0<=b;b--)a[b]=null;this._names=null}if(a=this._values){for(b=a.length-1;0<=b;b--)a[b]=null;this._values=null}}function TMap_dump(){var a=new TString,b=this._count;a.appendLine(RRuntime.className(this),": ",b);if(0<b){a.append(" {");for(var e=0;e<b;e++)a.appendLine(this._names[e],"=[",this._values[e],"]");a.append("}")}return a.flush()}
function TObjects(){this._count=0;this._items=[];this.isEmpty=TObjects_isEmpty;this.count=TObjects_count;this.items=TObjects_items;this.contains=TObjects_contains;this.indexOf=TObjects_indexOf;this.first=TObjects_first;this.last=TObjects_last;this.getAt=TObjects_getAt;this.get=TObjects_get;this.setAt=TObjects_setAt;this.set=TObjects_set;this.assign=TObjects_assign;this.append=TObjects_append;this.insert=TObjects_insert;this.push=TObjects_push;this.pushUnique=TObjects_pushUnique;this.pop=TObjects_pop;
this.swap=TObjects_swap;this.sort=TObjects_sort;this.erase=TObjects_erase;this.remove=TObjects_remove;this.clear=TObjects_clear;this.dispose=TObjects_dispose;this.dump=TObjects_dump;return this}function TObjects_isEmpty(){return 0==this._count}function TObjects_count(){return this._count}function TObjects_items(){return this._items}function TObjects_contains(a){return-1!=this.indexOf(a)}function TObjects_indexOf(a){for(var b=this._count,e=this._items,f=0;f<b;f++)if(e[f]==a)return f;return-1}
function TObjects_first(){return this._count?this._items[0]:null}function TObjects_last(){return this._count?this._items[this._count-1]:null}function TObjects_getAt(a){return this._items[a]}function TObjects_get(a){return 0<=a&&a<this._count?this._items[a]:null}function TObjects_setAt(a,b){this._items[a]=b}function TObjects_set(a,b){0<=a&&a<this._count&&(this._items[a]=b)}function TObjects_assign(a){for(var b=this._count=a._count,e=0;e<b;e++)this._items[e]=a._items[e]}
function TObjects_append(a){for(var b=a._count,e=0;e<b;e++)this.push(a.get(e))}function TObjects_insert(a,b){var e=this._count;if(0<=a&&a<=e){for(;e>a;e--)this._items[e]=this._items[e-1];this._items[a]=b}}function TObjects_push(a){var b=this._count++;this._items[b]=a;return b}function TObjects_pushUnique(a){for(var b=this._count-1;0<=b;b--)if(this._items[b]==a)return b;b=this._count++;this._items[b]=a;return b}function TObjects_pop(){if(this._count)return this._items[--this._count]}
function TObjects_swap(a,b){if(0<=a&&a<this._count&&0<=b&&b<this._count&&a!=b){var e=this._items,f=e[a];e[a]=e[b];e[b]=f}}function TObjects_sort(a){var b=this._items;b.length!=this._count&&(b.length=this._count);b.sort(a)}function TObjects_erase(a){var b=null;if(0<=a&&a<this._count){for(var b=this._items[a],e=--this._count,f=this._items;a<e;a++)f[a]=f[a+1];f[e]=null}return b}
function TObjects_remove(a){var b=this._count;if(b){for(var e=0,f=this._items,h=e;h<b;h++)f[h]!=a&&(f[e++]=f[h]);for(h=e;h<b;h++)f[h]=null;this._count=e}return a}function TObjects_clear(){this._count=0}function TObjects_dispose(){for(var a in this._items)this._items[a]=null;this._count=0;this._items=null}function TObjects_dump(){var a=this._count,b=new TString;b.append(RRuntime.className(this),":",a);if(0<a)for(var e=0;e<a;e++)b.append(" [",this._items[e],"]");return b.flush()}
function TString(){this._count=0;this._memory=[];this.isEmpty=TString_isEmpty;this.assign=TString_assign;this.append=TString_append;this.appendIf=TString_appendIf;this.appendLine=TString_appendLine;this.appendRepeat=TString_appendRepeat;this.push=TString_push;this.clear=TString_clear;this.toString=TString_toString;this.flush=TString_flush;this.dispose=TString_dispose;this.dump=TString_dump;return this}function TString_isEmpty(){return 0==this._count}
function TString_assign(a){for(var b=arguments,e=b.length,f=this._count=0;f<e;f++)a=b[n],null!=a&&(this._memory[this._count++]=a)}function TString_append(a){for(var b=arguments,e=b.length,f=0;f<e;f++)a=b[f],null!=a&&(this._memory[this._count++]=a)}function TString_appendIf(a,b){if(a)for(var e=arguments,f=e.length,h=1;h<f;h++)b=e[h],null!=b&&(this._memory[this._count++]=b)}function TString_appendRepeat(a,b){for(var e=0;e<b;e++)this._memory[this._count++]=a}
function TString_appendLine(a){for(var b=arguments,e=b.length,f=0;f<e;f++)a=b[f],null!=a&&(this._memory[this._count++]=a);this._memory[this._count++]="\r\n"}function TString_push(a){for(var b=arguments,e=b.length,f=0;f<e;f++)a=b[f],null!=a&&(this._memory[this._count++]=a)}function TString_clear(){this._count=0}function TString_toString(){var a=this._memory;this._memory.length!=this._count&&(a=this._memory.slice(0,this._count));return a.join("")}
function TString_flush(){var a=this.toString();this.dispose();return a}function TString_dispose(){this._count=0;var a=this._memory;if(a){for(var b=a.length-1;0<=b;b--)a[b]=null;this._memory=null}}function TString_dump(){var a=this.toString();return RRuntime.className(this)+":"+a.length+"["+a+"]"}function TStrings(){TList(this);this.pack=TStrings_pack;this.unpack=TStrings_unpack;return this}
function TStrings_pack(){for(var a=new TString,b=this.count,e=0;e<b;e++){var f=this.get(e),h=f.length.toString();sa=h.length+h+f;a.append(sa)}return a.flush()}function TStrings_unpack(a){if(!RString.isEmpty(a))for(var b=a.length,e=0;e<b;){var f=parseInt(a.charAt(e++)),h=parseInt(a.substr(e,f)),e=e+f,f=a.substr(e,h),e=e+h;this.push(f)}}
var RGlobal=new function(){this.instances=new TDictionary;this.get=RGlobal_get;this.set=RGlobal_set;this.globalGet=RGlobal_globalGet;this.globalSet=RGlobal_globalSet;return this};function RGlobal_get(a){return this.instances.get(a)}function RGlobal_set(a,b){this.instances.set(a,b)}function RGlobal_globalGet(a){return top.RGlobal?top.RGlobal.get(a):this.instances.get(a)}function RGlobal_globalSet(a,b){top.RGlobal?top.RGlobal.set(a,b):this.instances.set(a,b)}
var RMemory=new function(){this.objects=[];this.instances={};this.isObject=RMemory_isObject;this.create=RMemory_create;this.register=RMemory_register;this.disposeObject=RMemory_disposeObject;this.dispose=RMemory_dispose;this.unlink=RMemory_unlink;this.free=RMemory_free;this.freeHtml=RMemory_freeHtml;this.release=RMemory_release;this.refresh=RMemory_refresh;return this};
function RMemory_isObject(a){var b=typeof a;return"boolean"!=b&&"number"!=b&&"string"!=b&&"date"!=b&&"function"!=b&&a instanceof Object}function RMemory_create(a){a=new a;this.objects.push(a);return a}function RMemory_register(a,b){this.isObject(b)&&(this.objects.push(b),this.instances[a]=b)}function RMemory_disposeObject(a){}function RMemory_dispose(a){null!=a&&this.isObject(a)&&!a._disposed&&(a._disposed=!0,a.dispose instanceof Function&&a.dispose(),this.disposeObject(a))}
function RMemory_unlink(a){for(var b in a){var e=a[b];a[b]=null;null!=e&&this.isObject(e)&&this.unlink(a)}}function RMemory_free(a){this.dispose(a);this.unlink(a)}function RMemory_freeHtml(a){a&&a.removeNode(!0)}function RMemory_release(){this.free(this.objects);this.free(this.instances);this.refresh()}function RMemory_refresh(){RContext.optionGarbage&&CollectGarbage()}
function AAnnotation(a){this._annotationCd=null;this._duplicate=this._inherit=!1;this._name=a;this.annotationCd=AAnnotation_annotationCd;this.name=AAnnotation_name;this.code=AAnnotation_code;this.value=AAnnotation_value;return this}function AAnnotation_annotationCd(){return this._annotationCd}function AAnnotation_name(){return this._name}function AAnnotation_code(){return this._name}function AAnnotation_value(){return null}
function AEnum(a,b){this.inherit=!0;this.annotation=EAnnotation.Enum;this.name=a;this.linker=b;return this}function ALinker(a,b){this.inherit=!0;this.annotation=EAnnotation.Linker;this.name=a;this.linker=b;return this}
function AProperty(a,b){AAnnotation.call(this,a);this._inherit=!0;this._annotationCd=EAnnotation.Property;this._linker=null;this._force=!1;this.code=AProperty_code;this.build=AProperty_build;this.load=AProperty_load;this.save=AProperty_save;this.toString=AProperty_toString;var e=null;null==b?(e=RString.startsWith(a,"_")?a.substring(1):a,e=RString.toUnderline(e)):e=b;this._linker=e;return this}function AProperty_code(){return this._linker}function AProperty_build(){}
function AProperty_load(a,b){a[this._name]=b.get(this._linker)}function AProperty_save(a,b){b.set(this._linker,a[this._name])}function AProperty_toString(){return"<"+this._annotationCd+",linker="+this._linker+">"}function APtyBoolean(a,b,e){AProperty.call(this,a,b);this._value=e?e:!1;this.build=APtyBoolean_build;this.load=APtyBoolean_load;this.save=APtyBoolean_save;this.toString=APtyBoolean_toString;return this}function APtyBoolean_build(a){null==a[this._name]&&(a[this._name]=this._value)}
function APtyBoolean_load(a,b){a[this._name]=RBoolean.parse(b.get(this._linker))}function APtyBoolean_save(a,b){var e=a[this._name];e&&b.set(this._linker,RBoolean.toString(e))}function APtyBoolean_toString(){return"linker="+this._linker+",value="+this._value}function APtyConfig(a,b){AProperty.call(this,a,b);this.force=!0;this.load=APtyConfig_load;this.save=RMethod.empty;return this}function APtyConfig_load(a,b){a[this.name]=b}
function APtyEnum(a,b,e,f){AProperty.call(this,a,b);this._enum=e;this._default=f;this.build=APtyEnum_build;this.load=APtyEnum_load;this.save=APtyEnum_save;this.toString=APtyEnum_toString;return this}function APtyEnum_build(a){null==a[this._name]&&(a[this._name]=this._default)}function APtyEnum_load(a,b){a[this._name]=b.get(this._linker)}function APtyEnum_save(a,b){b.set(this._linker,a[this._name])}
function APtyEnum_toString(){return"linker="+this._linker+",enum="+this._enum+",default="+this._default}function APtyInteger(a,b,e){AProperty.call(this,a,b);this._value=RInteger.nvl(e);this.build=APtyInteger_build;this.toString=APtyInteger_toString;return this}function APtyInteger_build(a){null==a[this._name]&&(a[this._name]=this._value)}function APtyInteger_toString(){return"linker="+this._linker+",value="+this._value}
function APtyNumber(a,b,e){AProperty.call(this,a,b);this._value=RInteger.nvl(e);this.build=APtyNumber_build;this.toString=APtyNumber_toString;return this}function APtyNumber_build(a){null==a[this._name]&&(a[this._name]=this._value)}function APtyNumber_toString(){return"linker="+this._linker+",value="+this._value}
function APtyPadding(a,b,e,f,h,k){AProperty.call(this,a,b);this._left=RInteger.nvl(e);this._top=RInteger.nvl(f);this._right=RInteger.nvl(h);this._bottom=RInteger.nvl(k);this.load=APtyPadding_load;this.save=APtyPadding_save;this.toString=APtyPadding_toString;return this}function APtyPadding_load(a,b){a[this._name].parse(b.get(this._linker))}function APtyPadding_save(a,b){var e=a[this._name];e.isEmpty()||b.set(this._linker,e.toString())}
function APtyPadding_toString(){return"linker="+this._linker+",value="+this._left+","+this._top+","+this._right+","+this._bottom}function APtyPoint2(a,b,e,f){AProperty.call(this,a,b);this._x=RInteger.nvl(e);this._y=RInteger.nvl(f);this.load=APtyPoint2_load;this.save=APtyPoint2_save;this.toString=APtyPoint2_toString;return this}function APtyPoint2_load(a,b){a[this._name].parse(b.get(this._linker))}function APtyPoint2_save(a,b){var e=a[this._name];e.isEmpty()||b.set(this._linker,e.toString())}
function APtyPoint2_toString(){return"linker="+this._linker+",value="+this._x+","+this._y}function APtySet(a,b,e,f){AProperty.call(this,a,b);this._search=e;this._value=f;this.build=APtySet_build;this.load=APtySet_load;this.save=APtySet_save;this.toString=APtySet_toString;return this}function APtySet_build(a){null==a[this.name]&&(a[this.name]=this._value)}function APtySet_load(a,b){a[this.name]=RSet.containsString(b.get(this.linker),this.search)}
function APtySet_save(a,b){var e=this.name,f=a[e],h=b.get(this.linker),h=RSet.containsString(h,this._search);f&&!h?b.set(e,f+this._search):!a&&h&&b.set(e,RString.remove(f,this._search))}function APtySet_toString(){return"linker="+this.linker+",value="+this._value+",search="+this._search}function APtySize2(a,b,e,f){AProperty.call(this,a,b);this._width=RInteger.nvl(e);this._height=RInteger.nvl(f);this.load=APtySize2_load;this.save=APtySize2_save;this.toString=APtySize2_toString;return this}
function APtySize2_load(a,b){a[this._name].parse(b.get(this._linker))}function APtySize2_save(a,b){var e=a[this._name];e.isEmpty()||b.set(this._linker,e.toString())}function APtySize2_toString(){return"linker="+this._linker+",value="+this._width+","+this._height}function APtyString(a,b,e){AProperty.call(this,a,b);this._value=e?e:null;this.build=APtyString_build;this.toString=APtyString_toString;return this}function APtyString_build(a){null==a[this._name]&&(a[this._name]=this._value)}
function APtyString_toString(){return"linker="+this._linker+",value="+this._value}
var EAnnotation=new function(){this.Property="property";this.Event="enum";this.Event="event";this.Linker="linker";this.Style="style";this.StyleIcon="icon";return this},EBoolean=new function(){this.True="Y";this.False="N";return this},ECharCase=function(){this.Upper="U";this.Lower="L";this.Word="W";return this},EEndian=new function(){this.Big=0;this.Little=1;return this},ENodeType=new function(){this.Node=1;this.Text=3;this.Data=4;return this},ENumber=new function(){this.Integer="I";this.PositiveInteger=
"PI";this.NegativeInteger="NI";this.Float="F";this.PositiveFloat="PF";this.NegativeFloat="NF";return this},ERegExp=new function(){this.I=/^-?[1-9]\d*|0$/;this.PI=/^[1-9]\d*$/;this.NI=/^-[1-9]\d*$/;this.F=/^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$/;this.PF=/^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$/;this.NF=/^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$/;this.U=/[1-9]{1}[0-9]/;this.E=/^\w{1,}[@]{1}[a-zA-Z]{1,}[.]{1}[a-zA-Z]{1,}$/;return this},EResult=new function(){this.Success=0;this.Continue=1;this.Skip=2;this.Finish=
3;this.Failure=-1;this.Cancel=-2;return this};function MInstance(a){a=RClass.inherits(this,a);a.__free=!1;a.instanceCreate=RMethod.empty;a.instanceAlloc=RMethod.empty;a.instanceFree=RMethod.empty;a.instanceRelease=RMethod.empty;return a}function SArguments(){this.owner=null;return this}function SEnumItem(){this.name=null;this.value=0;return this}
function TClass(){this.__disposed=!0;this._unused=null;this._annotations={};this._attributes={};this.instance=this.clazz=this.base=this.parent=this.name=null;this._abstract=!1;this.styles=[];this.instances=[];this.register=TClass_register;this.assign=TClass_assign;this.annotations=TClass_annotations;this.annotation=TClass_annotation;this.annotationFind=TClass_annotationFind;this.attributeFind=TClass_attributeFind;this.style=TClass_style;this.build=TClass_build;this.newInstance=TClass_newInstance;
this.free=TClass_free;this.alloc=TClass_alloc;return this}
function TClass_register(a){var b=a.annotationCd(),e=a.name(),f=a.code();if(!b||!f)throw new TError(this,"Unknown annotation. (class={1},annotation={2},name={3},code={4})",RClass.dump(this),b,e,f);var h=this._annotations[b];h||(h=this._annotations[b]={});if(!a._duplicate&&h[f])throw new TError(this,"Duplicate annotation. (class={1},annotation={2},name={3},code={4},value={5})",RClass.dump(this),b,e,f,a.toString());h[f]=a;this._attributes[e]=a}
function TClass_assign(a){for(var b in a._annotations){var e=this._annotations[b];e||(e=this._annotations[b]={});var f=a._annotations[b],h;for(h in f){var k=f[h];if(!k._duplicate&&e[h])throw new TError(this,"Duplicate annotation. (annotation={1}, {2}.{3}={4}.{5}, source={6})",b,this.name,h,a.name,h,k.toString());k._inherit&&(e[h]=k)}}for(h in a._attributes)k=a._attributes[h],k.construct!=Function&&(this._attributes[h]=a._attributes[h])}
function TClass_annotations(a){var b=this._annotations[a];b||RLogger.fatal(this,null,"Can't find annotations. (annotation={1}, class={2})",a,this.name);return b}function TClass_annotation(a,b){var e=null,f=this._annotations[a];f&&(e=f[b]);e||RLogger.fatal(this,null,"Can't find annotation. (annotation={1}, name={2}, class={3})",a,b,this.name);return e}
function TClass_annotationFind(a){for(var b in this._annotations){var e=this._annotations[b];if(e&&(e=e[a],null!=e&&e.constructor!=Function))return e}return null}function TClass_attributeFind(a){return(a=this._attributes[a])&&a.constructor!=Function?a:null}
function TClass_style(a){if(this.styles[a])return this.styles[a];for(var b=null,e=this;e;){var f=e._annotations[EAnnotation.Style];if(f&&(b=f[a]))break;e=e.parent}b||RLogger.fatal(this,null,"No register style annotation. (name={1}, linker={2}, class={3})",this.name+"_"+a,this.liner,this.name);b=e.name+"_"+b.style();return this.styles[a]=b}
function TClass_build(){for(var a in this.instance){var b=this.instance[a];if(null!=b&&b.constructor==Function&&b.__virtual){this._abstract=!0;break}}if(b=this._annotations[EAnnotation.Property])for(a in b)b[a].build(this.instance)}
function TClass_newInstance(){var a=this.alloc();if(!a){if(this._abstract){var a=new TString,b;for(b in this.instance){var e=this.instance[b];RMethod.isVirtual(e)&&(a.isEmpty()||a.append(","),a.append(e._name))}return RLogger.fatal(this,null,"Abstract Class can't be create.(name={1})\n[{2}]",this.name,a)}var f=this.instance;if(!f)return RLogger.fatal(this,null,"Class instance is empty. (name={1})",this.name);a=new f.constructor;for(b in f){e=f[b];if(null!=e){if("__base"==b||"__inherits"==b){a[b]=
f[b];continue}RClass.isBase(e)||(e=RObject.clone(e))}a[b]=e}a.__class=this;a.construct&&a.construct()}return a}function TClass_alloc(){var a=this._unused;a&&(this._unused=a.cnext,a.cnext=null,a._using=!0);return a}function TClass_free(a){if(a._using){a.cnext=this._unused;this._unused=a;a._using=!1;for(var b in a){var e=a[b];if(e&&!RClass.isBase(e))if(e._class)this.free(e);else if(this.isClass(e,Array))for(var f=0;f<e.length;f++){var h=e[f];h._class&&this.free(h)}}}}
function TClassBase(){this.__disposed=!0;return this}function TContext(a,b,e){this.name=a;this.code=b;this.text=e;return this}function TDataset(){this._rows=new TObjects;this.isEmpty=TDataset_isEmpty;this.createRow=TDataset_createRow;this.count=TDataset_count;this.row=TDataset_row;this.rows=TDataset_rows;this.find=TDataset_find;this.push=TDataset_push;this.loadConfig=TDataset_loadConfig;this.clear=TDataset_clear;return this}function TDataset_isEmpty(){return this._rows.isEmpty()}
function TDataset_createRow(){var a=new TRow;a._dataset=this;this._rows.push(a);return a}function TDataset_count(){return this._rows.count()}function TDataset_row(a){return this._rows.get(a)}function TDataset_rows(){return this._rows}
function TDataset_find(a){var b=arguments,e=b.length;if(0!=e%2)throw new TError(this,"Parameters must is pairs (length={1})",e);for(var f=this._rows,h=f.count(),k=0;k<h;k++){for(var q=f.get(k),t=!0,u=0;u<e;u+=2)if(q.get(b[k])!=b[k+1]){t=!1;break}if(t)return q}return null}function TDataset_push(a){this._rows.push(a)}
function TDataset_loadConfig(a){this._name=a.get("name");this._pageSize=RInteger.parse(a.get("page_size",1E3));this._pageIndex=RInteger.parse(a.get("page",0));this._pageCount=RInteger.parse(a.get("page_count",1));this._total=RInteger.parse(a.get("total"));if(a=a.nodes())for(var b=a.count(),e=0;e<b;e++){var f=a.get(e);f.isName("Row")&&this.createRow().loadConfig(f)}}function TDataset_clear(){this._pageSize=20;this._total=this._pageCount=this._pageIndex=0;this._rows.clear()}
function TDataset_findIndex(a){for(var b=this._rows,e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h._index=a)return h}return null}function TDataset_remove(a){return this._rows.remove(a)}function TDataset_removeRow(a){a=this.indexOf(a);-1!=a&&this._rows.remove(a)}function TDataset_saveViewer(a){a.datasetName=this._name;a.datasetId=this.id;a.position=0;a.start=0;a._count=this._rows._count;a._rows=this._rows;a.dataset=this}
function TDataset_pack(){for(var a=this._rows,b=new TStrings,e=0;e<a._count;e++)b.push(a.get(e).pack());return b.pack()}function TDataset_dump(){var a=new TString;a.append(RClass._name(this));a.append(" count=",this._count);a.append(" fields=",this.fieldCount);a.appendLine();if(this._rows)for(var b=this._count,e=0;e<b;e++)a.append("- "),this._rows.get(e).dump(s),e!=this._count-1&&a.appendLine();return a.toString()}
function TDate(a){this.date=a?a:new Date;this.ms=this.second=this.minute=this.hour=this.day=this.month=this.year=null;this.equals=TDate_equals;this.isBefore=TDate_isBefore;this.isAfter=TDate_isAfter;this.monthDays=TDate_monthDays;this.monthWeekDay=TDate_monthWeekDay;this.weekDay=TDate_weekDay;this.setYear=TDate_setYear;this.setMonth=TDate_setMonth;this.setDay=TDate_setDay;this.setHour=TDate_setHour;this.setMinute=TDate_setMinute;this.setSecond=TDate_setSecond;this.addYear=TDate_addYear;this.addMonth=
TDate_addMonth;this.addDay=TDate_addDay;this.addMseconds=TDate_addMseconds;this.refresh=TDate_refresh;this.setDate=TDate_setDate;this.now=TDate_now;this.clone=TDate_clone;this.dump=TDate_dump;this.refresh();return this}function TDate_clone(){var a=new Date;a.setTime(this.date.getTime());return new TDate(a)}function TDate_equals(a){return this.date.getTime()==a.date.getTime()}function TDate_isBefore(a){return this.date.getTime()<a.date.getTime()}
function TDate_isAfter(a){return this.date.getTime()>a.date.getTime()}function TDate_monthDays(){return RDate.monthDays(this.year,this.month)}function TDate_monthWeekDay(){return(8-(this.day-this.weekDay())%7)%7}function TDate_weekDay(){return this.date.getDay()}function TDate_setYear(a){this.date.setFullYear(a);this.refresh()}function TDate_setMonth(a){this.date.setMonth(parseInt(a,10)-1);this.refresh()}function TDate_setDay(a){this.date.setDate(a);this.refresh()}
function TDate_setHour(a){this.date.setHours(a);this.refresh()}function TDate_setMinute(a){this.date.setMinutes(a);this.refresh()}function TDate_setSecond(a){this.date.setSeconds(a);this.refresh()}function TDate_addYear(a){this.date.setFullYear(this.date.getFullYear()+parseInt(a));this.refresh()}function TDate_addMonth(a){this.date.setMonth(this.date.getMonth()+parseInt(a));this.refresh()}function TDate_addDay(a){this.date.setTime(this.date.getTime()+864E5*parseInt(a));this.refresh()}
function TDate_addMseconds(a){this.date.setTime(this.date.getTime()+parseInt(a));this.refresh()}function TDate_refresh(){var a=this.date;a&&(this.year=a.getFullYear(),this.month=a.getMonth()+1,this.day=a.getDate(),this.hour=a.getHours(),this.minute=a.getMinutes(),this.second=a.getSeconds(),this.ms=a.getMilliseconds())}function TDate_setDate(a){this.date=a;this.refresh()}function TDate_now(){this.date=new Date;this.refresh()}
function TDate_dump(){return RClass.dump(this)+" "+RDate.formatDate(this)}
function TError(a,b,e){for(var f=new TString,h=TError.caller,k=new TString,q=[];h&&!RArray.contains(q,h);)q.push(h),h=h.caller;for(var t=q.length,u=0;u<t;u++)h=q[u],0<u&&k.appendLine(),k.append("   "+(t-u)+": "+RMethod.name(h));h=arguments;t=h.length;for(u=2;u<t;u++){var q=h[u],x=null,x="function"==typeof q?RMethod.name(q):q;b=b.replace("{"+(u-1)+"}",x)}f.appendLine(b);f.appendLine("------------------------------------------------------------");f.append(k);throw Error(f);}
function TFatalError(a,b,e,f){for(var h=new TString,k=TFatalError.caller,q=new TString,t=[];k&&!RArray.contains(t,k);)t.push(k),k=k.caller;for(var u=t.length,x=0;x<u;x++)k=t[x],0<x&&q.appendLine(),q.append("   "+(u-x)+": "+RMethod.name(k));k=arguments;u=k.length;for(x=2;x<u;x++){var t=k[x],z=null,z="function"==typeof t?RMethod.name(t):t;e=e.replace("{"+(x-1)+"}",z)}h.appendLine(e);h.appendLine("------------------------------------------------------------");h.append(q);throw Error(h);}
function TInstancePool(){TObjects.call(this);this._instance=null;this.instance=TInstancePool_instance;this.alloc=TInstancePool_alloc;this.free=TInstancePool_free;return this}function TInstancePool_instance(a){var b=this._instance;null==b&&(b=this._instance=RClass.create(a),b.instanceCreate());b.instanceAlloc();return b}function TInstancePool_alloc(a){var b=null;0==this._count?(b=RClass.create(a),b.instanceCreate()):b=this.pop();b.instanceAlloc();return b}
function TInstancePool_free(a){a.instanceFree();return this.push(a)}function TInvoke(){this.callback=this.owner=null;this.invoke=TInvoke_invoke;return this}function TInvoke_invoke(a,b,e,f,h,k){if(this.callback){var q=this.owner?this.owner:this;try{this.callback.call(q,a,b,e,f,h,k)}catch(t){RLogger.fatal(this,t,"Call method failure. (owner={1}, callback={2})",q,this.callback)}}}
function TListener(){this._callback=this._owner=null;this.process=TListener_process;this.toString=TListener_toString;this.dispose=TListener_dispose;return this}function TListener_process(a,b,e,f,h,k){this._callback.call(this._owner?this._owner:this,a,b,e,f,h,k)}function TListener_toString(){return RClass.name(this)+"(owner="+RClass.name(this._owner)+", callback="+RMethod.name(this._callback)+")"}function TListener_dispose(){this._callback=this._owner=null;RObject.free(this)}
function TListeners(){this._listeners=null;this.isEmpty=TListeners_isEmpty;this.find=TListeners_find;this.register=TListeners_register;this.unregister=TListeners_unregister;this.push=TListeners_push;this.remove=TListeners_remove;this.process=TListeners_process;this.clear=TListeners_clear;this.dispose=TListeners_dispose;this.dump=TListeners_dump;return this}function TListeners_isEmpty(){var a=this._listeners;return a?a.isEmpty():!0}
function TListeners_find(a,b){var e=this._listeners;if(e)for(var f=e.count(),h=0;h<f;h++){var k=e.getAt(h);if(k._owner==a&&k._callback==b)return k}return null}function TListeners_register(a,b){var e=this.find(a,b);if(e)throw new TError(this,"Listener is already register. (owner={1}, process={2})",a,b);e=new TListener;e._owner=a;e._callback=b;this.push(e);return e}
function TListeners_unregister(a,b){var e=this.find(a,b);if(!e)throw new TError(this,"Listener is not register. (owner={1}, process={2})",a,b);this.remove(e);e.dispose()}function TListeners_push(a){if(!a)throw new TError(this,"Listener is null.");if(!a._callback)throw new TError(this,"Listener process is null.");var b=this._listeners;b||(b=this._listeners=new TObjects);b.push(a)}function TListeners_remove(a){if(!a)throw new TError(this,"Listener is null.");this._listeners.remove(a)}
function TListeners_process(a,b,e,f,h,k){var q=this._listeners;if(q)for(var t=q.count(),u=0;u<t;u++)q.getAt(u).process(a,b,e,f,h,k)}function TListeners_clear(){var a=this._listeners;a&&a.clear()}function TListeners_dispose(){var a=this._listeners;if(a){for(var b=a.count()-1;0<=b;b--)a.getAt(b).dispose();this._listeners=RObject.dispose(a)}RObject.free(this)}
function TListeners_dump(){var a=new TString;a.append(RClass.name(this));for(var b=this._listeners,e=b.count(),f=0;f<e;f++)a.append("\n   "+b.getAt(f));return a.flush()}function TLoaderListener(){this.invoke=null;this.ids=new TArray;this.check=TLoaderListener_check;return this}function TLoaderListener_check(a){var b=this.ids;if(!b.isEmpty())for(var e=b.length,f=0;f<e;f++)if(!a.contains(b.get(f)))return!1;return!0}
function TLocker(){this._lock=!1;this.enter=TLocker_enter;this.leave=TLocker_leave;return this}function TLocker_enter(){this._lock=!0}function TLocker_leave(){this._lock=!1}function TMessage(){this.typeCd=EMessage.None;this.redirect=this.description=this.message=this.attrType=null;this.loadConfig=TMessage_loadConfig;this.saveConfig=TMessage_saveConfig;this.icon=TMessage_icon;return this}
function TMessage_loadConfig(a){this.typeCd=RString.toLower(a.name);this.message=a.nvl("message");this.attrType=a.nvl("type");this.redirect=a.nvl("redirect");this.description=a.nvl("description").replace(/\\n/g,"\n")}function TMessage_saveConfig(a){a.name=this.typeCd;a.set("message",this.message);a.set("description",this.description)}function TMessage_icon(){return"sys.msg."+this.typeCd}
function TMessages(){this._items=new TObjects;this.hasMessage=TMessages_hasMessage;this.message=TMessages_message;this.messages=TMessages_messages;this.type=TMessages_type;this.push=TMessages_push;return this}function TMessages_hasMessage(a){for(var b=0;b<this._items.count;b++){var e=this._items.get(b);if(e&&e.type==a)return!0}return!1}function TMessages_message(a){for(var b=0;b<this._items.count;b++){var e=this._items.get(b);if(e&&e.type==a)return e}return null}
function TMessages_messages(a){for(var b=null,e=0;e<this._items.count;e++){var f=this._items.get(e);f&&f.type==a&&(b||(b=new TList),b.push(f))}return b}function TMessages_type(){return this.hasMessage(EMessage.Fatal)?EMessage.Fatal:this.hasMessage(EMessage.Error)?EMessage.Error:this.hasMessage(EMessage.Warn)?EMessage.Warn:this.hasMessage(EMessage.Valid)?EMessage.Valid:this.hasMessage(EMessage.Info)?EMessage.Info:EMessage.None}function TMessages_push(a){a&&this._items.push(a)}
function TNode(){this._name="Node";this._nodes=this._attributes=this._value=null;this.isName=TNode_isName;this.name=TNode_name;this.setName=TNode_setName;this.value=TNode_value;this.setValue=TNode_setValue;this.contains=TNode_contains;this.hasAttribute=TNode_hasAttribute;this.attributes=TNode_attributes;this.hasNode=TNode_hasNode;this.node=TNode_node;this.nodes=TNode_nodes;this.get=TNode_get;this.set=TNode_set;this.setBoolean=TNode_setBoolean;this.setFloat=TNode_setFloat;this.find=TNode_find;this.findNode=
TNode_findNode;this.searchNode=TNode_searchNode;this.push=TNode_push;this.toString=TNode_toString;this.innerDump=TNode_innerDump;this.dump=TNode_dump;return this}function TNode_isName(a){return RString.equals(this._name,a)}function TNode_name(){return this._name}function TNode_setName(a){this._name=a}function TNode_value(){return this._value}function TNode_setValue(a){this._value=a}function TNode_contains(a){var b=this._attributes;return b?b.contains(a):!1}
function TNode_hasAttribute(){var a=this._attributes;return a?!a.isEmpty():!1}function TNode_attributes(){var a=this._attributes;a||(a=this._attributes=new TAttributes);return a}function TNode_hasNode(){var a=this._nodes;return a?!a.isEmpty():!1}function TNode_node(a){var b=this._nodes;return b?b.get(a):null}function TNode_nodes(){var a=this._nodes;a||(a=this._nodes=new TObjects);return a}function TNode_get(a,b){return this._attributes?this._attributes.get(a,b):null}
function TNode_set(a,b){null!=b&&this.attributes().set(a,b)}function TNode_setBoolean(a,b){null!=b&&this.attributes().set(a,RBoolean.format(b))}function TNode_setFloat(a,b){null!=b&&this.attributes().set(a,RFloat.format(b))}function TNode_find(a){if(this.hasNode())for(var b=this._nodes,e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h.isName(a))return h}return null}
function TNode_findNode(a,b){if(this.hasNode()){var e=this._nodes,f=e.count(),h=arguments,k=h.length;if((k-1)%2)throw new TError("Attributes is not pair. (length={1})",k);for(var q=0;q<f;q++){var t=e.get(q);if(null==a||t.isName(a)){for(var u=!0,x=1;x<k;x+=2)if(t.get(h[x])!=h[x+1]){u=!1;break}if(u)return t}}}return null}
function TNode_searchNode(a,b){if(this.hasAttribute()&&this._attributes.get(a)==b)return this;if(this.hasNode())for(var e=this._nodes,f=e.count();0<f;ni++){var h=e.get(h).searchNode(a,b);if(null!=h)return h}return null}function TNode_push(a){this.nodes().push(a)}function TNode_toString(){return this.dump()}
function TNode_innerDump(a,b,e){null==e&&(e="");a.append(e,b._name,"(",RClass.name(b),")");if(b._attributes){var f=b._attributes.count;a.append(" [",f,":");for(var h=0;h<f;h++)0<h&&a.append(" "),a.append(b._attributes.name(h),"=",b._attributes.value(h)),h<f-1&&a.append(",");a.append("]")}b._value&&(f=b._value.toString(),RString.isEmpty(f)||a.append(" {",f.length,":",f,"}"));if(b._nodes)for(f=b._nodes.count,a.append("\n"),h=0;h<f;h++)b._nodes.get(h).dump(a,e+"   "),h<f-1&&a.append("\n");return a}
function TNode_dump(a,b){a=RString.nvlStr(a);return this.innerDump(a,this,b)}function TRow(){TAttributes.call(this);this._statusCd=this._uniqueId=this._index=this._dataset=null;this.loadConfig=TRow_loadConfig;this.saveConfig=TRow_saveConfig;return this}function TRow_loadConfig(a){this._index=a.get("_id");this._statusCd=a.get("_status");this._uniqueId=a.get("ouid");a.hasAttribute()&&this.append(a.attributes())}
function TRow_saveConfig(a){a.set("_id",this._index);a.set("_status",this._statusCd);for(var b=this.count(),e=0;e<b;e++)a.set(this._names[e],this._values[e])}function TRow_copy(){var a=new TRow;a._dataset=this._dataset;a._index=this._index;a._statusCd=this._statusCd;a._uniqueId=this._uniqueId;for(var b=this.count,e=0;e<b;e++)a.set(this.names[e],this.values[e]);return a}function TRow_toAttributes(a){a||(a=new TAttributes);a.set(RDataset.ROW_STATUS,this._statusCd);a.append(this);return a}
function TRow_dump(a){var b=this.count;a=RString.nvlStr(a);a.append(RClass.name(this)," [",this._statusCd,": ");for(var e=0;e<b;e++)0<e&&a.append(","),a.append(this.names[e],"=",this.values[e]);a.append("]");return a}
function TSpeed(){this.arguments=arguments;this._span=this._end=this._start=0;this._spanMin=Number.MAX_VALUE;this._spanMax=0;this.start=(new Date).getTime();this.callerName=RMethod.name(TSpeed.caller);this.reset=TSpeed_reset;this.begin=TSpeed_begin;this.end=TSpeed_end;this.record=TSpeed_record;this.toString=TSpeed_toString;return this}function TSpeed_reset(){this._span=this._end=this._start=0}function TSpeed_begin(){this._start=(new Date).getTime()}
function TSpeed_end(){this._end=(new Date).getTime();this._span+=this._end-this._start;this._span<this._spanMin&&(this._spanMin=this._span);this._span>this._spanMax&&(this._spanMax=this._span)}function TSpeed_record(){var a=(new Date).getTime()-this.start;RLogger.debug(this,"Speed test. (caller={1}, speed={2}, arguments={3})",this.callerName,a,this.arguments);this.record=this.callerName=this.start=this.arguments=null}
function TSpeed_toString(){return this._span+" ("+this._spanMin+" - "+this._spanMax+")"}function FConsole(a){a=RClass.inherits(this,a,FObject);a._scopeCd=EScope.Global;a.scopeCd=FConsole_scopeCd;return a}function FConsole_scopeCd(){return this._scopeCd}function FObject(a){a||(a=this);a.__class=null;a.__hash=0;a.__dispose=!1;a.construct=FObject_construct;a.hashCode=FObject_hashCode;a.toString=FObject_toString;a.dispose=FObject_dispose;a.innerDump=FObject_innerDump;a.dump=FObject_dump;return a}
function FObject_construct(){this.__dispose=!1}function FObject_hashCode(){var a=this.__hash;a||(a=this.__hash=RObject.nextId());return a}function FObject_toString(){return RClass.dump(this)}function FObject_dispose(){RObject.free(this);this.__dispose=!0}function FObject_innerDump(a,b){a.append(RClass.dump(this))}function FObject_dump(){var a=new TString;this.innerDump(a,0);return a.flush()}
function FObjectPool(a){a=RClass.inherits(this,a,FObject);a._items=null;a._frees=null;a.construct=FObjectPool_construct;a.hasFree=FObjectPool_hasFree;a.alloc=FObjectPool_alloc;a.free=FObjectPool_free;a.push=FObjectPool_push;a.dispose=FObjectPool_dispose;return a}function FObjectPool_construct(){this.__base.FObject.construct.call(this);this._items=new TObjects;this._frees=new TObjects}function FObjectPool_hasFree(){return!this._frees.isEmpty()}
function FObjectPool_alloc(a){a=null;this._frees.isEmpty()||(a=this._frees.pop());return a}function FObjectPool_free(a){this._frees.push(a)}function FObjectPool_push(a){this._items.push(a);this._frees.push(a)}function FObjectPool_dispose(){this._items&&(this._items.dispose(),this._items=null);this._frees&&(this._frees.dispose(),this._frees=null);this.__base.FObject.dispose.call(this)}
var RArray=new function(){this.array1=Array(1);this.array2=Array(2);this.array3=Array(3);this.array4=Array(4);this.array9=Array(9);this.array12=Array(12);this.array16=Array(16);this.equals=RArray_equals;this.count=RArray_count;this.contains=RArray_contains;this.find=RArray_find;this.search=RArray_search;this.reverse=RArray_reverse;this.copy=RArray_copy;this.move=RArray_move;this.remove=RArray_remove;this.sortPartition=RArray_sortPartition;this.sortArray=RArray_sortArray;this.sort=RArray_sort;this.nameMaxLength=
RArray_nameMaxLength;return this};function RArray_equals(a,b){if(a&&b&&a.length==b.length){for(var e=a.length,f=0;f<e;f++)if(a[f]!=b[f])return!1;return!0}return!1}function RArray_count(a){for(var b in a)b++;return 0}function RArray_contains(a,b){for(var e=a.length,f=0;f<e;f++)if(a[f]==b)return!0;return!1}function RArray_find(a,b){for(var e=a.length,f=0;f<e;f++)if(a[f]==b)return f;return-1}function RArray_search(a,b){for(var e in a)if(a[e]==b)return e;return null}
function RArray_reverse(a,b,e){for(var f=e+1-b>>1,h=0;h<f;h++){var k=a[b+h];a[b+h]=a[e-h];a[e-h]=k}}function RArray_copy(a,b){for(var e in a)b[e]=a[e]}function RArray_move(a,b,e,f){if(b>f)for(var h=0;h<e;h++)a[f-h]=a[b+h];else if(b<f)for(h=0;h<e;h++)a[f+e-h-1]=a[b+e-h-1]}function RArray_remove(a,b){return a.slice(0,b).concat(a.slice(b+1))}
function RArray_sortPartition(a,b,e){var f=b;e+=1;for(var h=a[f];;){for(;a[++f]<h;);for(;a[--e]>h;);if(f>e)break;var k=a[f];a[f]=a[e];a[e]=k}a[b]=a[e];a[e]=h;return e}function RArray_sortArray(a,b,e){if(b<e){var f=this.sortPartition(a,b,e);this.sortArray(a,b,f-1);this.sortArray(a,f+1,e)}}function RArray_sort(a,b){var e=a.length-1;this.sortArray(a,0,e);b&&this.reverse(a,0,e);return a}function RArray_nameMaxLength(a){for(var b in a)a=b.length,a>b&&(b=a);return 0}
var RBoolean=new function(){this.format=RBoolean_format;this.parse=RBoolean_parse;this.toString=RBoolean_toString;return this};function RBoolean_format(a){return a?EBoolean.True:EBoolean.False}function RBoolean_parse(a){if(null!=a){if(a.constructor==Boolean)return a;if(a.constructor==String)return a==EBoolean.True;if(a.constructor==Number)return 0<a;throw new TError(this,"Unknown type.");}return!1}function RBoolean_toString(a){return a?EBoolean.True:EBoolean.False}
var RByte=new function(){this.copy=RByte_copy;return this};function RByte_copy(a,b,e,f,h){for(var k=0;k<h;k++)a[b++]=e[f++]}var RChar=new function(){this.parse=RChar_parse;this.toString=RChar_toString;return this};function RChar_parse(a){return String.fromCharCode(a)}function RChar_toString(a){return a}
var RClass=new function(){this.codes=[];this.classes={};this.isBase=RClass_isBase;this.isBaseName=RClass_isBaseName;this.isBaseDataName=RClass_isBaseDataName;this.isBaseType=RClass_isBaseType;this.isBaseDataType=RClass_isBaseDataType;this.isName=RClass_isName;this.isClass=RClass_isClass;this.typeOf=RClass_typeOf;this.safeTypeOf=RClass_safeTypeOf;this.checkClass=RClass_checkClass;this.code=RClass_code;this.name=RClass_name;this.inherits=RClass_inherits;this.forName=RClass_forName;this.find=RClass_find;
this.register=RClass_register;this.createBase=RClass_createBase;this.createClass=RClass_createClass;this.create=RClass_create;this.createByName=RClass_createByName;this.innerCopy=RClass_innerCopy;this.build=RClass_build;this.free=RClass_free;this.dump=RClass_dump;return this};function RClass_isBase(a){return null!=a?RClass.isBaseName(typeof a):!1}function RClass_isBaseName(a){return null==a||"boolean"!=a&&"number"!=a&&"date"!=a&&"string"!=a&&"function"!=a?!1:!0}
function RClass_isBaseDataName(a){return null==a||"boolean"!=a&&"number"!=a&&"date"!=a&&"string"!=a?!1:!0}function RClass_isBaseType(a){return null==a||a!=Boolean&&a!=Number&&a!=Date&&a!=String&&a!=Function?!1:!0}function RClass_isBaseDataType(a){return null==a||a!=Boolean&&a!=Number&&a!=Date&&a!=String?!1:!0}function RClass_isName(a,b){return this.name(a)==b}function RClass_isClass(a,b){if(a&&b){var e=this.name(b);return a.__base?null!=a.__base[e]:this.name(a)==e}return!1}
function RClass_typeOf(a){return a&&a.constructor?RString.mid(a.constructor.toString(),"function ","("):"Null"}function RClass_safeTypeOf(a,b){if(null==a)return"Null";try{var e=a.constructor;if(e==Boolean)return"Boolean";if(e==Number)return"Number";if(e==String)return"String";if(e==Function||e.constructor==Function)return RString.mid(e.toString(),"function ","(");if(a.__class)return a.__class.name;if(a.tagName)return"Html";for(var f in a)return"Object"}catch(h){}return"Unknown"}
function RClass_checkClass(a,b){if(!this.isClass(a,b))throw Error("Invalid class "+o.name(o)+"<>"+o.name(b));}function RClass_code(a){for(var b=this.codes,e=b.length,f=0;f<e;f++)if(b[f]==a)return f;b[e]=a;return e}function RClass_name(a){if(a){if(a.__name)return a.__name;if(a.__class)return a.__class.name;if("function"==typeof a)return RMethod.name(a);if(a=a.constructor)return RString.mid(a.toString(),"function ","(")}return null}
function RClass_inherits(a,b){var e=RRuntime.nvl(b,a);e.__inherits=[];for(var f=arguments,h=f.length,k=2;k<h;k++)e.__inherits.push(RMethod.name(f[k]));return e}function RClass_forName(a){var b=null;null!=a&&(b=this.classes[a],b||(b=this.createClass(a),this.build(b)));return b}function RClass_find(a){var b=null;null!=a&&(a.__class?b=a.__class.name:a.constructor==Function?b=RMethod.name(a):a.constructor!=String&&RLogger.fatal(this,null,"Find class failure. (value={1})",a));return this.classes[b]}
function RClass_register(a,b,e){a=RMethod.name(a.constructor);this.classes[a].register(b);a=b.value();return null!=a?a:e}function RClass_createBase(a){return a?eval("function "+a+"(){return this;} new "+a+"();"):null}function RClass_createClass(a){var b=this.classes[a]=new TClass;b.name=a;b.base=this.createBase(a);b.clazz=new b.base.constructor;eval(a)(b.clazz);return b}
function RClass_create(a){var b=typeof a;"function"==b?a=RMethod.name(a):"string"!=b&&RLogger.fatal(this,null,"Param is invlid (name={1})",a);return this.createByName(a)}function RClass_createByName(a){(a=this.forName(a))||RLogger.fatal(this,null,"Cant find class. (name={1})",a);return a.newInstance()}
function RClass_innerCopy(a,b){if(null!=a&&null!=b)for(var e in a){var f=a[e];if(null!=f){var h=typeof f;if("function"==h){h=b[e];null==h?b[e]=f:RMethod.isVirtual(h)?b[e]=f:!RMethod.isVirtual(f)&&RMethod.isEmpty(h)?b[e]=f:RMethod.isVirtual(f)||RMethod.isEmpty(f)||(b[e]=f);continue}else if(!RClass.isBaseName(h)){null==b[e]&&(b[e]=new f.constructor);this.innerCopy(f,b[e]);continue}}b[e]=f}}
function RClass_build(a){var b=a.clazz.__inherits;if(b&&b.constructor==Array)for(var e=!1,f=b.length,h=0;h<f;h++){var k=b[h];RString.startsWith(k,"F")&&(e&&RLogger.fatal(this,null,"Parent class is too many. (name={1})",k),a.parent=RClass.forName(k),e=!0)}e=a.instance=new a.base.constructor;if(b&&b.constructor==Array)for(f=b.length,h=0;h<f;h++)if(k=b[h],!RString.startsWith(k,"F")){var q=RClass.forName(k);null==q&&RLogger.fatal(this,null,"Parent class is not exists. (name={1})",k);RClass.innerCopy(q.instance,
e);a.assign(q)}a.parent&&(this.innerCopy(a.parent.instance,e),a.assign(a.parent));e.__base||(e.__base=new TClassBase);e.__base[a.name]=new a.base.constructor;var q=a.clazz,t;for(t in q)"__base"!=t&&(null==q[t]&&null==e[t]?e[t]=null:null!=q[t]&&(null==e[t]||null!=e[t]&&q[t]!=e[t])&&(e[t]=q[t]));if(b&&b.constructor==Array)for(f=b.length,h=0;h<f;h++)for(t in k=b[h],q=RClass.forName(k),k=e.__base[k]=new q.base.constructor,q=q.instance,q)if("__base"!=t){var u=q[t],x=e[t];null!=u&&null!=x&&u!=x&&u.constructor==
Function&&x.constructor==Function&&(k[t]=q[t])}a.build();if(RRuntime.isRelease())for(t in a.instance)null==a.instance[t]&&delete a.instance[t]}function RClass_free(a){var b=a.__class;b&&b.free(a)}
function RClass_dump(a){if(null==a)return"@null";var b=this.safeTypeOf(a);switch(b){case "Boolean":return"Boolean:"+a;case "Number":return"Number:"+a;case "String":return b+"<"+a.length+">:"+a;case "Function":return b+"<"+RMethod.name(a)+">@"+this.code(a);case "Html":return b+"<"+a.tagName+">@"+this.code(a);default:if(a.__name)return b+"<"+a.__name+">@"+this.code(a)}return b+"@"+this.code(a)}
var RConsole=new function(){this.ConsolePreFix="console:";this._registers=new TObjects;this._consoles=new TDictionary;this._localConsoles=new TDictionary;this.initialize=RConsole_initialize;this.register=RConsole_register;this.create=RConsole_create;this.createByName=RConsole_createByName;this.get=RConsole_get;this.find=RConsole_find;this.release=RConsole_release;return this};function RConsole_initialize(){for(var a=this._registers,b=0;b<a;b++){var e=a.get(b);e.force&&this.find(e.clazz)}}
function RConsole_register(a){this._registers.push(a)}function RConsole_create(a){var b=null;if(a){var b=RClass.create(a),e;for(e in b)if(RString.startsWith(e,"lnk")){var f=b[e];if("string"==typeof f&&RString.startsWith(f,"&")){var h=this.find(f.substr(1));if(!h)return RMessage.fatal(this,null,"Can't link console. (name={0}, property={1}:{2})",a,e,f);b[e]=h}}}return b}
function RConsole_createByName(a){var b=null;if(a){var b=RClass.createByName(a),e;for(e in b)if(RString.startsWith(e,"lnk")){var f=b[e];if("string"==typeof f&&RString.startsWith(f,"&")){var h=this.find(f.substr(1));if(!h)return RMessage.fatal(this,null,"Can't link console. (name={0}, property={1}:{2})",a,e,f);b[e]=h}}}return b}function RConsole_get(a){a=RClass.name(a);return this._consoles.get(a)}
function RConsole_find(a){var b=null;if(a.constructor=String)b=RClass.name(a);else if(a.constructor==Function)b=a;else return RLogger.fatal(this,null,"Parameter type is invalid. (console={1})",a);if((a=RGlobal.get(this.ConsolePreFix+b))||(a=this._consoles.get(b)))return a;var e=RClass.forName(b).instance.scopeCd();switch(e){case EScope.Global:a=top.RConsole.createByName(b);RGlobal.set(this.ConsolePreFix+b,a);this._consoles.set(b,a);break;case EScope.Local:a=this.createByName(b);this._localConsoles.set(b,
a);this._consoles.set(b,a);break;default:return RLogger.fatal(this,"Unknown scope code. (name={1})",b)}RLogger.info(this,"Create console. (name={1}, scope={2})",b,REnum.decode(EScope,e));return a}function RConsole_release(){this._registers&&(this._registers.dispose(),this._registers=null);var a=this._localConsoles;if(a){for(var b=a.count(),e=0;e<b;e++)a.value(e).dispose();a.dispose()}this._localConsoles=null;this._consoles&&this._consoles.dispose();this._consoles=null}
var RDate=new function(){this.MinYear=1800;this.MaxYear=2400;this.Pattern="n-: /";this.Chars="0123456789-:/";this.DisplayFormat="yyyy-mm-dd hh24:mi:ss";this.DataFormat="yyyymmddhh24miss";this.MonthDays=[0,31,28,31,30,31,30,31,31,30,31,30,31];this.DaySeconds=1E3;this.Parts="YYYY MM DD HH24 MI SS".split(" ");this.PartsDefine={YYYY:["Year",4],MM:["Month",2],DD:["Day",2],HH24:["Hour",2],MI:["Minute",2],SS:["Second",2]};this.nvl=RDate_nvl;this.make=RDate_make;this.format=RDate_format;this.formatDate=RDate_formatDate;
this.formatText=RDate_formatText;this.monthDays=RDate_monthDays;this.splitFormat=RDate_splitFormat;this.makeDate=RDate_makeDate;this.checkItems=RDate_checkItems;this.check=RDate_check;this.parse=RDate_parse;this.splitDate=RDate_splitDate;this.splitTime=RDate_splitTime;this.autoParse=RDate_autoParse;this.getFormat=RDate_getFormat;return this};function RDate_nvl(a){return a?a:new TDate}function RDate_make(a,b,e,f,h,k){return new TDate(new Date(a,b,e))}
function RDate_format(a){return this.formatDate(new TDate,a)}function RDate_formatText(a,b){if(!a)return!1;b=b.toLowerCase();b=b.replace(/yyyy/g,a.substring(0,4));a=a.substring(4);b=b.replace(/mm/g,a.substring(0,2));a=a.substring(2);b=b.replace(/dd/g,a.substring(0,2));a=a.substring(2);b=b.replace(/hh24/g,a.substring(0,4));a=a.substring(4);b=b.replace(/mi/g,a.substring(0,2));a=a.substring(2);b=b.replace(/ss/g,a.substring(0,2));a.substring(2);return b}
function RDate_formatDate(a,b){if(!a)return"";b=b?b.toLowerCase():this.DataFormat;b=b.replace(/yyyy/g,RInteger.format(a.year,4));b=b.replace(/yy/g,RInteger.format(a.year%100,2));b=b.replace(/mm/g,RInteger.format(a.month,2));b=b.replace(/dd/g,RInteger.format(a.day,2));b=b.replace(/hh24/g,RInteger.format(a.hour,2));b=b.replace(/mi/g,RInteger.format(a.minute,2));b=b.replace(/ss/g,RInteger.format(a.second,2));return b=b.replace(/ms/g,RInteger.format(a.ms,3))}
function RDate_monthDays(a,b){if(!a||!b)return 0;a=parseInt(a);b=parseInt(b);this.MonthDays[2]=0!=a%4&&0!=a%400||0==a%100?28:29;return this.MonthDays[b]}
function RDate_splitFormat(a,b){if(!a)return!1;b=b.toLowerCase();for(var e=[];0<b.length;)0==b.indexOf("yyyy")?(e.year=a.substring(0,4),b=b.substring(4),a=a.substring(4)):0==b.indexOf("mm")?(e.month=a.substring(0,2),b=b.substring(2),a=a.substring(2)):0==b.indexOf("dd")?(e.day=a.substring(0,2),b=b.substring(2),a=a.substring(2)):0==b.indexOf("hh24")?(e.hour=a.substring(0,2),b=b.substring(4),a=a.substring(2)):0==b.indexOf("mi")?(e.minute=a.substring(0,2),b=b.substring(2),a=a.substring(2)):0==b.indexOf("ss")?
(e.second=a.substring(0,2),b=b.substring(2),a=a.substring(2)):0==b.indexOf("ms")?(e.ms=a.substring(0,2),b=b.substring(2),a=a.substring(3)):(b=b.substring(1),a=a.substring(1));return e}
function RDate_checkItems(a){if(!a)return!1;var b=RInteger.parse(a.year);if(b<this.MinYear||b>this.MaxYear)return!1;var e=RInteger.parse(a.month);if(1>e||12<e)return!1;var f=RInteger.parse(a.day);if(1>f||f>this.monthDays(b,e))return!1;b=RInteger.parse(a.hour);if(0>b||23<b)return!1;b=RInteger.parse(a.second);if(0>b||59<b)return!1;a=RInteger.parse(a.ms);return 0>a||99<a?!1:!0}function RDate_check(a,b){return this.checkItems(this.splitFormat(a,b))}
function RDate_makeDate(a,b){var e=new Date(RInteger.parse(b.year),RInteger.parse(b.month)-1,RInteger.parse(b.day),RInteger.parse(b.hour),RInteger.parse(b.minute),RInteger.parse(b.second),RInteger.parse(b.ms));return a?(a.setDate(e),a):new TDate(e)}function RDate_parse(a,b,e){e||(e=this.DataFormat);b=this.splitFormat(b,e);return this.checkItems(b)?this.makeDate(a,b):null}
function RDate_splitDate(a,b){if(b){var e=null;-1!=b.indexOf("-")||-1!=b.indexOf("/")?(-1!=b.indexOf("-")?e=b.split("-"):-1!=b.indexOf("/")&&(e=b.split("/")),1<=e.length&&(a.year=RInteger.parse(e[0])),2<=e.length&&(a.month=RInteger.parse(e[1])),3<=e.length&&(a.day=RInteger.parse(e[2]))):-1!=b.indexOf(":")?this.splitTime(a,b):14==b.length?(a.year=RInteger.parse(b.substr(0,4)),a.month=RInteger.parse(b.substr(4,2)),a.day=RInteger.parse(b.substr(6,2)),a.hour=RInteger.parse(b.substr(8,2)),a.minute=RInteger.parse(b.substr(10,
2)),a.second=RInteger.parse(b.substr(12,2))):8==b.length?(a.year=RInteger.parse(b.substr(0,4)),a.month=RInteger.parse(b.substr(4,2)),a.day=RInteger.parse(b.substr(6,2))):6==b.length?(a.year=RInteger.parse(b.substr(0,4)),a.month=RInteger.parse(b.substr(4,2))):4==b.length&&(a.year=RInteger.parse(b))}}
function RDate_splitTime(a,b){if(b)if(-1!=b.indexOf(":")){var e=b.split(":");1<=e.length&&(a.hour=RInteger.parse(e[0]));2<=e.length&&(a.minute=RInteger.parse(e[1]));3<=e.length&&(a.second=RInteger.parse(e[2]))}else 6==b.length?(a.hour=RInteger.parse(b.substr(0,2)),a.minute=RInteger.parse(b.substr(2,2)),a.second=RInteger.parse(b.substr(4,2))):4==b.length?(a.hour=RInteger.parse(b.substr(0,2)),a.minute=RInteger.parse(b.substr(2,2))):2==b.length&&(a.hour=RInteger.parse(b.substr(0,2)))}
function RDate_autoParse(a,b){if(!b)return null;a=this.nvl(a);var e=[];e.year=2E3;e.month=1;e.day=1;e.hour=0;e.minute=0;e.second=0;b=RString.trim(b);if(-1==b.indexOf(" "))this.splitDate(e,b);else{var f=b.split(" ");2==f.length&&(this.splitDate(e,f[0]),this.splitTime(e,f[1]))}return this.checkItems(e)?this.makeDate(a,e):null}
function RDate_getFormat(a){var b="",e="";if(a){if(-1!=a.indexOf(":"))if(a=RString.split(a," "),1==a.length)a=RString.split(a[0],":"),1==a.length?(b+="HH24",e=1==a[0].length?e+("0"+a[0]):e+a[0]):2==a.length?(b+="HH24MI",1==a[0].length?e+="0"+a[0]:2==a[0].length&&(e+=a[0]),1==a[1].length?e+="0"+a[1]:2==a[1].length&&(e+=a[1])):3==a.length&&(b+="HH24MISS",1==a[0].length?e+="0"+a[0]:2==a[0].length&&(e+=a[0]),1==a[1].length?e+="0"+a[1]:2==a[1].length&&(e+=a[1]),1==a[2].length?e+="0"+a[2]:2==a[2].length&&
(e+=a[2]));else{if(2==a.length){var f=RString.split(a[0],"-");3==f.length?(b+="YYYYMMDD",4==f[0].length&&(e+=f[0]),1==f[1].length?e+="0"+f[1]:2==f[1].length&&(e+=f[1]),1==f[2].length?e+="0"+f[2]:2==f[2].length&&(e+=f[2])):2==f.length?(b+="YYYYMM",1==f[0].length&&(e+=f[0]),1==f[1].length?e+="0"+f[1]:2==f[1].length&&(e+=f[1])):1==f.length&&(b+="YYYY",4==f[0].length&&(e+=f[0]));a=RString.split(a[1],":");1==a.length?(b+="HH24",e=1==a[0].length?e+("0"+a[0]):e+a[0]):2==a.length?(b+="HH24MI",1==a[0].length?
e+="0"+a[0]:2==a[0].length&&(e+=a[0]),1==a[1].length?e+="0"+a[1]:2==a[1].length&&(e+=a[1])):3==a.length&&(b+=" HH24MISS",1==a[0].length?e+="0"+a[0]:2==a[0].length&&(e+=a[0]),1==a[1].length?e+="0"+a[1]:2==a[1].length&&(e+=a[1]),1==a[2].length?e+="0"+a[2]:2==a[2].length&&(e+=a[2]))}}else a=RString.split(a,"-"),3==a.length?(b+="YYYYMMDD",4==a[0].length&&(e+=a[0]),1==a[1].length?e+="0"+a[1]:2==a[1].length&&(e+=a[1]),1==a[2].length?e+="0"+a[2]:2==a[2].length&&(e+=a[2])):2==a.length?(b="YYYYMM",4==a[0].length&&
(e+=a[0]),1==a[1].length?e+="0"+a[1]:2==a[1].length&&(e+=a[1])):1==a.length&&(b+="YYYY",4==a[0].length&&(e+=a[0]));a=Array(2);a[0]=b;a[1]=e;return a}}var REnum=new function(){this.contains=REnum_contains;this.tryEncode=REnum_tryEncode;this.encode=REnum_encode;this.tryDecode=REnum_tryDecode;this.decode=REnum_decode;this.parse=REnum_encode;this.format=REnum_decode;return this};function REnum_contains(){}
function REnum_tryEncode(a,b,e){if(null!=a)for(var f in a)if(f.toLowerCase()==b.toLowerCase())return a[f];return e}function REnum_encode(a,b){var e=this.tryEncode(a,b);if(null==e)throw new TError(this,"Invalid value (enum={1}, value={2})",RClass.dump(a),b);return e}function REnum_tryDecode(a,b,e){if(null!=a)for(var f in a)if(a[f]==b)return f;return e}
function REnum_decode(a,b){var e=this.tryDecode(a,b);if(null==e)throw new TError(this,"Invalid value (enum={1}, value={2})",RClass.dump(a),b);return e}var RFile=new function(){this.pictures=["jpg","png","gif","bmp"];this.knowns="jpg png gif bmp doc docx vsd xls xlsx".split(" ");this.inPicture=RFile_inPicture;this.isPicture=RFile_isPicture;this.isKnown=RFile_isKnown;this.extend=RFile_extend;RMemory.register("RFile",this);return this};
function RFile_inPicture(a){if(a){a=a.toLowerCase();for(var b in this.pictures)if(this.pictures[b]==a)return!0}}function RFile_isPicture(a){return this.inPicture(this.extend(a))}function RFile_isKnown(a){a=this.extend(a).toLowerCase();for(var b in this.knowns)if(this.knowns[b]==a)return!0;return!1}function RFile_extend(a){if(a){a=a.replace(/\\/g,"/");var b=a.lastIndexOf("/");-1!=b&&(a=a.substring(b+1));b=a.lastIndexOf(".");return-1!=b?a.substring(b+1):a}return""}
var RFloat=new function(){this.NUMBER=this.Chars="0123456789-.%";this.LEFT_CHAR="0";this.isFloat=RFloat_isFloat;this.parse=RFloat_parse;this.format=RFloat_format;this.nvl=RFloat_nvl;this.toRange=RFloat_toRange;this.sum=RFloat_sum;this.calculate=RFloat_calculate;this.fill=RFloat_fill;this.copy=RFloat_copy;return this};function RFloat_isFloat(a){return RString.isPattern(a,"n")}
function RFloat_parse(a){if(null==a||""==a)return 0;for(a=RString.trim(a.toString());"0"==a.charAt(0);)a=a.substr(1);var b=0<a.length?parseFloat(a):0;-1!=RString.findChars(a,"%")&&(b/=100);return isNaN(b)?0:b}function RFloat_format(a,b,e,f,h){null==b&&(b=0);null==e&&(e=this.LEFT_CHAR);null==f&&(f=7);null==h&&(h=this.LEFT_CHAR);var k=a.toString(),q=k.indexOf(".");-1==q?(a=k,k=""):(a=k.substring(0,q),k=k.substring(q+1,q+f+1));b=RString.lpad(a,b,e);f=RString.rpad(k,f,h);return b+"."+f}
function RFloat_nvl(a,b){return a?a:b?b:0}function RFloat_toRange(a,b,e){null==a&&(a=0);return Math.min(Math.max(a,b),e)}function RFloat_sum(){for(var a=arguments,b=0,e=a.length-1;0<=e;e--){var f=a[n];null!=f&&(b+=parseFloat(f))}return b}function RFloat_calculate(a,b,e){b=RFloat.nvl(b);e=RFloat.nvl(e);b=parseFloat(b);e=parseFloat(e);return a?(b+e).toString():(b-e).toString()}function RFloat_fill(a,b,e,f){for(var h=0;h<e;h++)a[b++]=f}
function RFloat_copy(a,b,e,f,h){for(var k=0;k<h;k++)a[b++]=e[f++]}var RHex=new function(){this.NUMBER="0x123456789ABCDEF";this.PAD="0";this.isValid=RHex_isValid;this.parse=RHex_parse;this.format=RHex_format;return this};function RHex_isValid(a){return RString.isPattern(a,this.NUMBER)}function RHex_parse(a){return a?parseInt("0x"+a):"0"}function RHex_format(a,b){var e=null,e=a?a.toString(16):"0";return b?RString.lpad(e,b,this.PAD):e}
var RInstance=new function(){this._pools=new TDictionary;this.pool=RInstance_pool;this.get=RInstance_get;this.alloc=RInstance_alloc;this.free=RInstance_free;return this};function RInstance_pool(a){a=RClass.name(a);var b=this._pools.get(a);null==b&&(b=new TInstancePool,this._pools.set(a,b));return b}function RInstance_get(a){return this.pool(a).instance(a)}function RInstance_alloc(a){return this.pool(p).alloc(p)}function RInstance_free(a){this.pool(p).free(p)}
var RInteger=new function(){this.NUMBER=this.Chars="0123456789-%";this.LEFT_CHAR="0";this.MAX_UINT16=65535;this.MAX_UINT32=4294967295;this.isInt=RInteger_isInt;this.nvl=RInteger_nvl;this.parse=RInteger_parse;this.format=RInteger_format;this.toRange=RInteger_toRange;this.sum=RInteger_sum;this.calculate=RInteger_calculate;return this};function RInteger_isInt(a){return RString.isPattern(a,"n")}function RInteger_nvl(a,b){return a?a:b?b:0}
function RInteger_parse(a,b){null==b&&(b=0);if(null==a||""==a)return b;for(a=RString.trim(a.toString());"0"==a.charAt(0);)a=a.substr(1);var e=0<a.length?parseInt(a):b;return isNaN(e)?b:e}function RInteger_format(a,b,e){e||(e=this.LEFT_CHAR);a=a.toString();for(b=parseInt(b)-a.length-1;0<=b;b--)a=e+a;return a}function RInteger_toRange(a,b,e){null==a&&(a=0);isNaN(a)&&(a=0);a<b&&(a=b);a>e&&(a=e);return a}
function RInteger_sum(){for(var a=0,b=arguments,e=b.length,f=0;f<e;f++)null!=b[f]&&(a+=parseInt(b[f]));return a}function RInteger_calculate(a,b,e){b=RInteger.parse(b);e=RInteger.parse(e);var f="";"+"==a?f=b+e:"-"==a?f=b-e:"x"==a?f=b*e:"/"==a&&(f=b/e);return f.toString()}
var RLogger=new function(){this._statusError=!1;this._labelLength=40;this.lsnsOutput=new TListeners;this.output=RLogger_output;this.debug=RLogger_debug;this.info=RLogger_info;this.warn=RLogger_warn;this.error=RLogger_error;this.fatal=RLogger_fatal;return this};function RLogger_output(a,b){this.lsnsOutput.process(a,b)}
function RLogger_debug(a,b,e){var f=RMethod.name(RLogger_debug.caller),f=f.replace("_","."),h=new TString;h.append(RDate.format("yymmdd-hh24miss.ms"));h.append("|D ["+RString.rpad(f,this._labelLength)+"] ");for(var k=arguments,q=k.length,f=2;f<q;f++){var t=k[f],u="";null!=t&&(u="function"==typeof t?RMethod.name(t):t.toString());b=b.replace("{"+(f-1)+"}",u)}h.append(b);this.output(a,h.flush())}
function RLogger_info(a,b,e){var f=RMethod.name(RLogger_info.caller),f=f.replace("_","."),h=new TString;h.append(RDate.format("yymmdd-hh24miss.ms"));h.append("|I ["+RString.rpad(f,this._labelLength)+"] ");for(var k=arguments,q=k.length,f=2;f<q;f++){var t=k[f],u="";null!=t&&(u="function"==typeof t?RMethod.name(t):t.toString());b=b.replace("{"+(f-1)+"}",u)}h.append(b);this.output(a,h.flush())}
function RLogger_warn(a,b,e){var f=RMethod.name(RLogger_warn.caller),f=f.replace("_","."),h=new TString;h.append(RDate.format("yymmdd-hh24miss.ms"));h.append("|W ["+RString.rpad(f,this._labelLength)+"] ");for(var k=arguments,q=k.length,f=2;f<q;f++){var t=k[f],u="";null!=t&&(u="function"==typeof t?RMethod.name(t):t.toString());b=b.replace("{"+(f-1)+"}",u)}h.append(b);this.output(a,h.flush())}function RLogger_error(a,b,e,f){if(!this._statusError)throw this._statusError=!0,Error(e);}
function RLogger_fatal(a,b,e,f){if(!this._statusError){this._statusError=!0;for(var h=new TString,k=[],q=RLogger_fatal.caller;q&&!RArray.contains(k,q);)k.push(q),q=q.caller;for(var t=k.length,u=0;u<t;u++)q=k[u],0<u&&h.appendLine(),h.append("   "+(t-u)+": "+RMethod.name(q));k=new TString;k.appendLine(RContext.get("RMessage:fatal"));k.appendLine(RString.repeat("-",60));k.append(RClass.dump(a),": ");if(e)for(q=arguments,t=q.length,u=3;u<t;u++){var x=q[u];"function"==typeof x&&(x=RMethod.name(x));e=e.replace("{"+
(u-2)+"}",x)}k.appendLine(e);k.appendLine(RString.repeat("-",60));k.appendLine("Stack:");k.append(h);alert(k)}}
var RMethod=new function(){this._virtuals={};this.isFunction=RMethod_isFunction;this.isEmpty=RMethod_isEmpty;this.isVirtual=RMethod_isVirtual;this.name=RMethod_name;this.fullName=RMethod_fullName;this.empty=RMethod_empty;this.emptyTrue=RMethod_emptyTrue;this.emptyFalse=RMethod_emptyFalse;this.emptyCall=RMethod_emptyCall;this.virtual=RMethod_virtual;this.empty.__empty=!0;this.emptyTrue.__empty=!0;this.emptyFalse.__empty=!0;return this};function RMethod_isFunction(a){return"function"==typeof a}
function RMethod_isEmpty(a){return a&&a.__empty}function RMethod_isVirtual(a){return a&&a.__virtual}function RMethod_name(a){return a&&"function"==typeof a?a.__name?a.__name:a.__name=RString.mid(a.toString(),"function ","("):null}function RMethod_fullName(a){return a&&a.constructor==Function?a.__fullname?a.__fullname:a.__fullname=RString.mid(a.toString(),"function ",")")+")":null}function RMethod_empty(){}function RMethod_emptyTrue(){return!0}function RMethod_emptyFalse(){return!1}
function RMethod_emptyCall(){}function RMethod_virtual(a,b){var e=RClass.name(a)+"."+b;if(this._virtuals[e])return this._virtuals[e];var f=function(){throw Error("Virtual method be called.("+e+")");};f.__virtual=!0;f.__name=e;return this._virtuals[e]=f}var RObject=new function(){this._hash=1;this.nextId=RObject_nextId;this.nvl=RObject_nvl;this.clone=RObject_clone;this.copy=RObject_copy;this.free=RObject_free;this.dispose=RObject_dispose;this.release=RObject_release;return this};
function RObject_nextId(a){return this._hash++}function RObject_nvl(a){for(var b=arguments,e=b.length,f=0;f<e;f++)if(null!=b[f])return b[f];return null}function RObject_clone(a){var b=new a.constructor,e;for(e in a){var f=a[e];null!=f&&(RClass.isBaseType(f.constructor)||(f=RObject.clone(f)));b[e]=f}return b}function RObject_copy(a,b){if(null!=a&&null!=b)for(var e in a){var f=a[e];null==f||RClass.isBaseType(f.constructor)||(null==b[e]&&(b[e]=new c),RObject.copy(f,b[e]));b[e]=f}}
function RObject_free(a){if(a)if(RRuntime.isDebug())for(var b in a)if("__base"==b||"__inherits"==b||"__class"==b)a[b]=null;else{var e=a[b];if(null!=e){if(!RClass.isBaseType(e.constructor))throw new TError(RObject,"Free object is not base object.");a[b]=null}}else for(b in a)a[b]=null}function RObject_dispose(a){a&&a.dispose();return null}function RObject_release(a){if(a)for(var b in a){var e=a[b];"Object"==typeof e&&RObject.release(e);a[b]=null}}
var RRandom=new function(){this._seed=(new Date).getTime();this.get=RRandom_get;this.rand=RRandom_rand;RMemory.register("RRandom",this);return this};function RRandom_get(){this._seed=(9301*this._seed+49297)%233280;return this._seed/233280}function RRandom_rand(a){return Math.ceil(this.get()*a)}var RRect=new function(){this.nvl=RRect_nvl;this.pack=RRect_pack;this.unpack=RRect_unpack;return this};function RRect_nvl(a){return a?a:new TRect}
function RRect_pack(a){var b=null;a&&(b=a.left+","+a.top+","+a.right+","+a.bottom);return b}function RRect_unpack(a,b){b=this.nvl(b);if(a){var e=a.split(",");4==e.length&&(b.left=RInt.parse(e[0]),b.top=RInt.parse(e[1]),b.right=RInt.parse(e[2]),b.bottom=RInt.parse(e[3]))}return b}var RRegExp=new function(){this.test=RRegExp_test;this.testRgexp=RRegExp_testRgexp;return this};function RRegExp_test(a,b){return a&&null!=b?a.test(b):!1}function RRegExp_testRgexp(a,b){return a&&b?(new R,a.test(b)):!1}
var RSet=new function(){this.contains=RSet_contains;this.containsString=RSet_containsString;return this};function RSet_contains(a,b){return(a&b)==b}function RSet_containsString(a,b){return null!=a&&null!=s?-1!=a.indexOf(s):!1}
var RString=new function(){this.EMPTY="";this.SPACE="   ";this.PAD=" ";this.TRIM=" \t\r\n";this.LOWER="abcdefghijklmnopqrstuvwxyz";this.UPPER="ABCDEFGHIJKLMNOPQRSTUVWXYZ";this.CodeLowerA=97;this.CodeLowerZ=122;this.CodeUpperA=65;this.CodeUpperZ=90;this.isEmpty=RString_isEmpty;this.isBlank=RString_isBlank;this.isAnsi=RString_isAnsi;this.isDbcs=RString_isDbcs;this.isPattern=RString_isPattern;this.inChars=RString_inChars;this.contains=RString_contains;this.equals=RString_equals;this.startsWith=RString_startsWith;
this.endsWith=RString_endsWith;this.findChars=RString_findChars;this.inRange=RString_inRange;this.nvl=RString_nvl;this.empty=RString_empty;this.firstUpper=RString_firstUpper;this.firstLower=RString_firstLower;this.firstLine=RString_firstLine;this.format=RString_format;this.formatLines=RString_formatLines;this.repeat=RString_repeat;this.pad=RString_pad;this.lpad=RString_lpad;this.rpad=RString_rpad;this.trim=RString_trim;this.ltrim=RString_ltrim;this.rtrim=RString_rtrim;this.mid=RString_mid;this.toLine=
RString_toLine;this.toUnderline=RString_toUnderline;this.toLower=RString_toLower;this.toUpper=RString_toUpper;this.split=RString_split;this.splitTwo=RString_splitTwo;this.splitParts=RString_splitParts;this.splitPattern=RString_splitPattern;this.replace=RString_replace;this.replaceChar=RString_replaceChar;this.remove=RString_remove;this.removeChars=RString_removeChars;return this};function RString_isEmpty(a){return null!=a?0==a.length:!0}
function RString_isBlank(a){return null!=a?0==a.trim().length:!0}function RString_isAnsi(a){if(null!=a){for(var b=a.length,e=0;e<b;e++)if(255<a.charCodeAt(e))return!1;return!0}return!1}function RString_isDbcs(a){if(null==a){a=a.length;for(var b=0;b<a;b++)if(256>value.charCodeAt(b))return!1;return!0}return!1}
function RString_isPattern(a,b){if(null!=a){null==b&&(b="$a$A$f");b=b.replace(/\a/g,this.LOWER);b=b.replace(/\A/g,this.UPPER);b=b.replace(/\f/g,RFloat.NUMBER);b=b.replace(/\n/g,RInt.NUMBER);for(var e=a.length,f=0;f<e;f++)if(-1==b.indexOf(a.charAt(f)))return!1;return!0}return!1}function RString_inChars(a,b){return-1!=this.findChars(b,a)?!0:!1}function RString_contains(a,b){return null!=a&&null!=b?-1!=a.toString().indexOf(b):!1}
function RString_equals(a,b,e){null==a?a="":a.constructor!=String&&(a=a.toString());null==b?b="":b.constructor!=String&&(b=b.toString());return e?a==b:a.toLowerCase()==b.toLowerCase()}function RString_startsWith(a,b){return null==b?!0:null!=a?0==a.indexOf(b):!1}function RString_endsWith(a,b){if(null==b)return!0;var e=null!=a?a.indexOf(b):-1;return-1!=e?e==a.length-b.length:!1}
function RString_findChars(a,b){if(null!=a&&null!=b)for(var e=a.length,f=0;f<e;f++)if(-1!=b.indexOf(a.charAt(f)))return f;return-1}function RString_inRange(a,b,e){if(a&&b){e||(a=a.toLowerCase());for(var f=b.length,h=0;h<f;h++){var k=b[h];if(null!=k)if(e){if(a==k)return!0}else if(a==k.toLowerCase())return!0}}return!1}function RString_nvl(a,b){if(null!=a){var e=null,e=a.constructor!=String?a.toString():a;if(0<e.length)return e}return null!=b?b:this.EMPTY}
function RString_empty(a){if(null!=a){var b=null,b=a.constructor!=String?a.toString():a;if(0<b.length)return b}return null}function RString_firstUpper(a){return null!=a?a.charAt(0).toUpperCase()+a.substr(1):a}function RString_firstLower(){return null!=v?v.charAt(0).toLowerCase()+v.substr(1):v}function RString_firstLine(a){if(a){var b=Math.min(a.indexOf("\r"),a.indexOf("\n"));return-1!=b?a.substr(0,b):a}return""}
function RString_format(a,b){for(var e=arguments,f=e.length,h=1;h<f;h++)b=e[h],"function"==typeof b?b=RMethod.name(b):null==b&&(b=""),a=a.replace("{"+(h-1)+"}",b);return a}function RString_formatLines(a){a=a.replace(/\\r/g,"");a=a.split("\n");for(var b=a.length,e=new TString,f=0;f<b;f++){var h=a[f],h=this.trim(h);this.isEmpty(h)||this.startsWith(h,"//")||e.appendLine(h)}return e.toString()}function RString_repeat(a,b){return Array(b+1).join(a)}
function RString_pad(a,b,e){a=null!=a?a.toString():this.EMPTY;b-=a.length;if(0<b){null==e&&(e=this.PAD);var f=0==b%2?b/2:(b-1)/2;return Array(f+1).join(e)+a+Array(b-f+1).join(e)}return a}function RString_lpad(a,b,e){a=null!=a?a.toString():this.EMPTY;b-=a.length;return 0<b?(null==e&&(e=this.PAD),b=Array(b),b[b.length]=a,b.join(e)):a}function RString_rpad(a,b,e){a=null!=a?a.toString():this.EMPTY;b-=a.length;return 0<b?(null==e&&(e=this.PAD),a+Array(b+1).join(e)):a}
function RString_trim(a,b){a=this.nvl(a);b=this.nvl(b,this.TRIM);for(var e=0,f=a.length-1;e<f&&-1!=b.indexOf(a.charAt(e));e++);for(;f>=e&&-1!=b.indexOf(a.charAt(f));f--);return e==f+1?null:0!=e||f!=a.length-1?a.substring(e,f+1):a}function RString_ltrim(a,b){a=this.nvl(value);b=this.nvl(trims,this.TRIM);for(var e=0,f=a.length-1;e<f&&-1!=b.indexOf(a.charAt(e));e++);return 0!=e?a.substring(e,f+1):a}
function RString_rtrim(a,b){a=this.nvl(a);b=this.nvl(b,this.TRIM);for(var e=a.length-1;0<=e&&-1!=b.indexOf(a.charAt(e));e--);return e!=a.length-1?a.substring(0,e+1):a}function RString_mid(a,b,e){if(null==a)return a;var f=0;if(null!=b){var h=a.indexOf(b);-1!=h&&(f=h+b.length)}b=a.length;null!=e&&(h=a.indexOf(e,f),-1!=h&&(b=h));return a.substring(f,b)}function RString_toLine(a){return a.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}
function RString_toUnderline(a){var b=null;if(a){for(var b=new TString,e=a.length,f=0;f<e;f++){var h=a.charAt(f);h.toUpperCase()==h?(0<f&&b.append("_"),b.append(h.toLowerCase())):b.append(h)}b=b.toString()}return b}function RString_toLower(a){return null!=a?a.toLowerCase():this.EMPTY}function RString_toUpper(a){return null!=a?a.toUpperCase():this.EMPTY}function RString_split(a,b){return a&&b?a.split(b):null}
function RString_splitTwo(a,b){if(a&&b){var e=[],f=a.indexOf(b);-1==f?e.push(a):(e.push(a.substring(0,f)),e.push(a.substring(f+b.length)));return e}return null}function RString_splitParts(a,b){for(var e=[],f=0,h=a.length,k=0;k<h;k++)for(var q in b)if(this.startsWith(b[q],a.charAt(k))&&this.equals(a.substr(k,b[q].length),b[q])){e[f++]=b[q];k=k+b[q].length-1;break}return e}
function RString_splitPattern(a,b){var e=[];if(a)for(var f=a.length,h=b.length,k="",q=0;q<f;q++){for(var t=!1,u=0;u<h;u++){var x=b[u];if(-1==a.indexOf(x)){k.length&&(e[e.length]=k,k="");e[e.length]=x;a=a.substring(x.length);t=!0;break}}t||(k+=a.charAt(0),a=a.substring(1))}return e}function RString_replace(a,b,e){return a.replace(new RegExp(b,"g"),e)}
function RString_replaceChar(a,b,e){if(null!=a){for(var f=a.length,h=[],k=0;k<f;k++){var q=a.charAt(k);h[h.length]=q==b?e:q}return h.join("")}return a}function RString_remove(a,b){return a.replace(b,"")}function RString_removeChars(a,b){if(null!=a){for(var e=a.length,f=[],h=0;h<e;h++){var k=a.charAt(h);-1==b.indexOf(k)&&(f[f.length]=k)}return f.join("")}return a}
var RTimer=new function(){this._count=this._lastTime=this._startTime=0;this.setup=RTimer_setup;this.current=RTimer_current;this.rate=RTimer_rate;this.update=RTimer_update;return this};function RTimer_setup(){var a=(new Date).getTime();this._lastTime=this._startTime=a}function RTimer_current(){return this._lastTime}function RTimer_rate(){return 0==this._count?0:parseInt(1E3*this._count/(this._lastTime-this._startTime))}function RTimer_update(){this._count++;this._lastTime=(new Date).getTime()}
var EFrustumPlane=new function(){this.Near=0;this.Far=1;this.Left=2;this.Right=3;this.Top=4;this.Bottom=5;this.Count=6;return this};
function SColor4(){this.blue=this.green=this.red=0;this.alpha=1;this.assign=SColor4_assign;this.assignPower=SColor4_assignPower;this.set=SColor4_set;this.serialize=SColor4_serialize;this.unserialize=SColor4_unserialize;this.unserialize3=SColor4_unserialize3;this.saveConfig=SColor4_saveConfig;this.savePower=SColor4_savePower;this.copyArray=SColor4_copyArray;this.toString=SColor4_toString;return this}function SColor4_assign(a){this.red=a.red;this.green=a.green;this.blue=a.blue;this.alpha=a.alpha}
function SColor4_assignPower(a){this.red=a.red*a.alpha;this.green=a.green*a.alpha;this.blue=a.blue*a.alpha;this.alpha=a.alpha}function SColor4_set(a,b,e,f){this.red=a;this.green=b;this.blue=e;this.alpha=f}function SColor4_serialize(a){a.writeFloat(this.red);a.writeFloat(this.green);a.writeFloat(this.blue);a.writeFloat(this.alpha)}function SColor4_unserialize(a){this.red=a.readFloat();this.green=a.readFloat();this.blue=a.readFloat();this.alpha=a.readFloat()}
function SColor4_unserialize3(a){this.red=a.readFloat();this.green=a.readFloat();this.blue=a.readFloat();this.alpha=1}function SColor4_saveConfig(a){a.setFloat("r",this.red);a.setFloat("g",this.green);a.setFloat("b",this.blue);a.setFloat("a",this.alpha)}function SColor4_savePower(a){a.setFloat("r",this.red);a.setFloat("g",this.green);a.setFloat("b",this.blue);a.setFloat("power",this.alpha)}
function SColor4_copyArray(a,b){a[b++]=this.red;a[b++]=this.green;a[b++]=this.blue;a[b++]=this.alpha;return 4}function SColor4_toString(){return this.red+","+this.green+","+this.blue+","+this.alpha}function SFrustum(){this.center=new SPoint3;this.maxZ=this.minZ=this.maxY=this.minY=this.maxX=this.minX=this.radius=null;this.points=Array(24);this.coners=Array(24);this.updateCenter=SFrustum_updateCenter;this.update=SFrustum_update;this.updateFlat=SFrustum_updateFlat;return this}
function SFrustum_updateCenter(){var a=this.coners;this.minX=this.minY=this.minZ=Number.MAX_VALUE;this.maxX=this.maxY=this.maxZ=-Number.MAX_VALUE;for(var b=0;24>b;){var e=a[b++];e<this.minX&&(this.minX=e);e>this.maxX&&(this.maxX=e);e=a[b++];e<this.minY&&(this.minY=e);e>this.maxY&&(this.maxY=e);e=a[b++];e<this.minZ&&(this.minZ=e);e>this.maxZ&&(this.maxZ=e)}this.center.x=.5*(this.minX+this.maxX);this.center.y=.5*(this.minY+this.maxY);this.center.z=.5*(this.minZ+this.maxZ);this.radius=.5*Math.sqrt((this.minX-
this.minY)*(this.minX-this.minY)+(this.minZ-this.maxX)*(this.minZ-this.maxX)+(this.maxY-this.maxZ)*(this.maxY-this.maxZ))}
function SFrustum_update(a,b,e,f,h,k,q,t){e=b/e;k=Math.tan(RMath.DEGREE_RATE*a*.5);a=f*k;b=a*e;k*=h;q=k*e;e=this.points;e[0]=-b;e[1]=a;e[2]=f;e[3]=b;e[4]=a;e[5]=f;e[6]=b;e[7]=-a;e[8]=f;e[9]=-b;e[10]=-a;e[11]=f;e[12]=-q;e[13]=k;e[14]=h;e[15]=q;e[16]=k;e[17]=h;e[18]=q;e[19]=-k;e[20]=h;e[21]=-q;e[22]=-k;e[23]=h;f=RMath.matrix;f.assign(t);f.invert();f.transform(this.coners,e,8);this.updateCenter()}
function SFrustum_updateFlat(a,b,e,f,h,k,q,t){b/=e;f*=q;h*=k;q=Math.tan(RMath.DEGREE_RATE*a*.5);a=f*q;k=a*b;q*=h;e=q*b;b=this.points;b[0]=-k;b[1]=a;b[2]=f;b[3]=k;b[4]=a;b[5]=f;b[6]=k;b[7]=-a;b[8]=f;b[9]=-k;b[10]=-a;b[11]=f;b[12]=-e;b[13]=q;b[14]=h;b[15]=e;b[16]=q;b[17]=h;b[18]=e;b[19]=-q;b[20]=h;b[21]=-e;b[22]=-q;b[23]=h;f=RMath.matrix;f.assign(t);f.invert();f.transform(this.coners,b,8);this.coners[1]=0;this.coners[4]=0;this.coners[7]=0;this.coners[10]=0;this.coners[13]=0;this.coners[16]=0;this.coners[19]=
0;this.coners[22]=0;this.updateCenter()}function SFrustumPlanes(){this.planes=[];this.containsPoint=SFrustumPlanes_containsPoint;this.containsCube=SFrustumPlanes_containsCube;this.containsRectangle=SFrustumPlanes_containsRectangle;this.containsCorners=SFrustumPlanes_containsCorners;this.containsSphere=SFrustumPlanes_containsSphere;this.updateVision=SFrustumPlanes_updateVision;for(var a=0;a<EFrustumPlane.Count;a++)this.planes.push(new SPlane);return this}
function SFrustumPlanes_containsPoint(a,b,e){for(var f=this.planes,h=0;h<EFrustumPlane.Count;h++)if(0>f[n].dot(a,b,e))return!1;return!0}function SFrustumPlanes_containsCube(a,b,e,f){f=this.planes;for(var h=0;h<EFrustumPlane.Count;h++){var k=f[n];if(!(0<=k.dot(a-l,b-l,e-l)||0<=k.dot(a+l,b-l,e-l)||0<=k.dot(a-l,b+l,e-l)||0<=k.dot(a+l,b+l,e-l)||0<=k.dot(a-l,b-l,e+l)||0<=k.dot(a+l,b-l,e+l)||0<=k.dot(a-l,b+l,e+l)||0<=k.dot(a+l,b+l,e+l)))return!1}return!0}
function SFrustumPlanes_containsRectangle(a,b,e,f,h,k){for(var q=this.planes,t=0;t<EFrustumPlane.Count;t++){var u=q[n];if(!(0<=u.dot(a-f,b-h,e-k)||0<=u.dot(a+f,b-h,e-k)||0<=u.dot(a-f,b+h,e-k)||0<=u.dot(a+f,b+h,e-k)||0<=u.dot(a-f,b-h,e+k)||0<=u.dot(a+f,b-h,e+k)||0<=u.dot(a-f,b+h,e+k)||0<=u.dot(a+f,b+h,e+k)))return!1}return!0}
function SFrustumPlanes_containsCorners(a){for(var b=this.planes,e=0;e<EFrustumPlane.Count;e++)if(a=b[n],!(0<=a.dot(a[0],a[1],a[2])||0<=a.dot(a[3],a[4],a[5])||0<=a.dot(a[6],a[7],a[8])||0<=a.dot(a[9],a[10],a[11])||0<=a.dot(a[12],a[13],a[14])||0<=a.dot(a[15],a[16],a[17])||0<=a.dot(a[18],a[19],a[20])||0<=a.dot(a[21],a[22],a[23])))return!1;return!0}function SFrustumPlanes_containsSphere(a,b,e,f){for(var h=this.planes,k=0;k<EFrustumPlane.Count;k++)if(h[n].dot(a,b,e)<-f)return!1;return!0}
function SFrustumPlanes_updateVision(a){var b=this.planes,e=b[EFrustumPlane.Near];e.a=a[2];e.b=a[6];e.c=a[10];e.d=a[14];e.normalize();e=b[EFrustumPlane.Far];e.a=a[3]-a[2];e.b=a[7]-a[6];e.c=a[11]-a[10];e.d=a[15]-a[14];e.normalize();e=b[EFrustumPlane.Left];e.a=a[3]+a[0];e.b=a[7]+a[4];e.c=a[11]+a[8];e.d=a[15]+a[12];e.normalize();e=b[EFrustumPlane.Right];e.a=a[3]-a[0];e.b=a[7]-a[4];e.c=a[11]-a[8];e.d=a[15]-a[12];e.normalize();e=b[EFrustumPlane.Top];e.a=a[3]-a[1];e.b=a[7]-a[5];e.c=a[11]-a[9];e.d=a[15]-
a[13];e.normalize();b=b[EFrustumPlane.Bottom];b.a=a[3]+a[1];b.b=a[7]+a[5];b.c=a[11]+a[9];b.d=a[15]+a[13];b.normalize()}
function SMatrix3d(){SMatrix4x4.call(this);this._dirty=!1;this.rz=this.ry=this.rx=this.tz=this.ty=this.tx=0;this.sz=this.sy=this.sx=1;this.isIdentity=SMatrix3d_isIdentity;this.identity=SMatrix3d_identity;this.setTranslate=SMatrix3d_setTranslate;this.setRotation=SMatrix3d_setRotation;this.setScale=SMatrix3d_setScale;this.setScaleAll=SMatrix3d_setScaleAll;this.set=SMatrix3d_set;this.setAll=SMatrix3d_setAll;this.equals=SMatrix3d_equals;this.assign=SMatrix3d_assign;this.attach=SMatrix3d_attach;this.append=
SMatrix3d_append;this.updateForce=SMatrix3d_updateForce;this.update=SMatrix3d_update;this.merge=SMatrix3d_merge;this.serialize=SMatrix3d_serialize;this.unserialize=SMatrix3d_unserialize;this.saveConfig=SMatrix3d_saveConfig;this.identity();return this}function SMatrix3d_isIdentity(){return 0!=this.tx||0!=this.ty||0!=this.tz||0!=this.rx||0!=this.ry||0!=this.rz||1!=this.sx||1!=this.sy||1!=this.sz?!1:this.isIdentityData()}
function SMatrix3d_identity(){this.rx=this.ry=this.rz=this.tx=this.ty=this.tz=0;this.sx=this.sy=this.sz=1;return this.identityData()}function SMatrix3d_setTranslate(a,b,e){this.tx=a;this.ty=b;this.tz=e;this._dirty=!0}function SMatrix3d_setRotation(a,b,e){this.rx=a;this.ry=b;this.rz=e;this._dirty=!0}function SMatrix3d_setScale(a,b,e){this.sx=a;this.sy=b;this.sz=e;this._dirty=!0}function SMatrix3d_setScaleAll(a){this.sz=this.sy=this.sx=a;this._dirty=!0}
function SMatrix3d_set(a,b,e){this.tx=a.x;this.ty=a.y;this.tz=a.z;this.rx=b.x;this.ry=b.y;this.rz=b.z;this.sx=e.x;this.sy=e.y;this.sz=e.z;this._dirty=!0}function SMatrix3d_setAll(a,b,e,f,h,k,q,t,u){this.tx=a;this.ty=b;this.tz=e;this.rx=f;this.ry=h;this.rz=k;this.sx=q;this.sy=t;this.sz=u;this._dirty=!0}function SMatrix3d_equals(a){return this.equalsData(a._data)}
function SMatrix3d_assign(a){this.tx=a.tx;this.ty=a.ty;this.tz=a.tz;this.rx=a.rx;this.ry=a.ry;this.rz=a.rz;this.sx=a.sx;this.sy=a.sy;this.sz=a.sz;this.assignData(a._data)}function SMatrix3d_attach(a){this.tx=a.tx;this.ty=a.ty;this.tz=a.tz;this.rx=a.rx;this.ry=a.ry;this.rz=a.rz;this.sx=a.sx;this.sy=a.sy;this.sz=a.sz;return this.attachData(a._data)}function SMatrix3d_append(a){this.appendData(a._data)}
function SMatrix3d_updateForce(){var a=this._data,b=Math.sin(this.rx),e=Math.cos(this.rx),f=Math.sin(this.ry),h=Math.cos(this.ry),k=Math.sin(this.rz),q=Math.cos(this.rz);a[0]=h*q*this.sx;a[1]=h*k*this.sx;a[2]=-f*this.sx;a[3]=0;a[4]=(b*f*q-e*k)*this.sy;a[5]=(b*f*k+e*q)*this.sy;a[6]=b*h*this.sy;a[7]=0;a[8]=(e*f*q+b*k)*this.sz;a[9]=(e*f*k-b*q)*this.sz;a[10]=e*h*this.sz;a[11]=0;a[12]=this.tx;a[13]=this.ty;a[14]=this.tz;a[15]=1}
function SMatrix3d_update(){this._dirty&&(this.updateForce(),this._dirty=!1)}function SMatrix3d_merge(a,b){this.tx=a.tx+b.tx;this.ty=a.ty+b.ty;this.tz=a.tz+b.tz;this.rx=a.rx+b.rx;this.ry=a.ry+b.ry;this.rz=a.rz+b.rz;this.sx=a.sx*b.sx;this.sy=a.sy*b.sy;this.sz=a.sz*b.sz;this.updateForce()}
function SMatrix3d_serialize(a){a.writeFloat(this.tx);a.writeFloat(this.ty);a.writeFloat(this.tz);a.writeFloat(this.rx);a.writeFloat(this.ry);a.writeFloat(this.rz);a.writeFloat(this.sx);a.writeFloat(this.sy);a.writeFloat(this.sz)}function SMatrix3d_unserialize(a){this.tx=a.readFloat();this.ty=a.readFloat();this.tz=a.readFloat();this.rx=a.readFloat();this.ry=a.readFloat();this.rz=a.readFloat();this.sx=a.readFloat();this.sy=a.readFloat();this.sz=a.readFloat();this.updateForce()}
function SMatrix3d_saveConfig(a){a.set("tx",RFloat.format(this.tx));a.set("ty",RFloat.format(this.ty));a.set("tz",RFloat.format(this.tz));a.set("rx",RFloat.format(this.rx));a.set("ry",RFloat.format(this.ry));a.set("rz",RFloat.format(this.rz));a.set("sx",RFloat.format(this.sx));a.set("sy",RFloat.format(this.sy));a.set("sz",RFloat.format(this.sz))}
function SMatrix3x3(){this._data=Array(9);this.data=SMatrix3x3_data;this.equalsData=SMatrix3x3_equalsData;this.assignData=SMatrix3x3_assignData;this.appendData=SMatrix3x3_appendData;this.rotationX=SMatrix3x3_rotationX;this.rotationY=SMatrix3x3_rotationY;this.rotationZ=SMatrix3x3_rotationZ;this.rotation=SMatrix3x3_rotation;this.invert=SMatrix3x3_invert;this.transform=SMatrix3x3_transform;this.transformPoint3=SMatrix3x3_transformPoint3;this.build=SMatrix3x3_build;this.writeData=SMatrix3x3_writeData;
this.toString=SMatrix3x3_toString;return this}function SMatrix3x3_data(){return this._data}function SMatrix3x3_equalsData(a){for(var b=this._data,e=0;9>e;e++)if(b[e]!=a[e])return!1;return!0}function SMatrix3x3_assignData(a){for(var b=this._data,e=0;9>e;e++)b[e]=a[e]}
function SMatrix3x3_appendData(a){var b=this._data,e=b[0]*a[1]+b[1]*a[4]+b[2]*a[7],f=b[0]*a[2]+b[1]*a[5]+b[2]*a[8],h=b[3]*a[0]+b[4]*a[3]+b[5]*a[6],k=b[3]*a[1]+b[4]*a[4]+b[5]*a[7],q=b[3]*a[2]+b[4]*a[5]+b[5]*a[8],t=b[6]*a[0]+b[7]*a[3]+b[8]*a[6],u=b[6]*a[1]+b[7]*a[4]+b[8]*a[7],x=b[6]*a[2]+b[7]*a[5]+b[8]*a[8];b[0]=b[0]*a[0]+b[1]*a[3]+b[2]*a[6];b[1]=e;b[2]=f;b[3]=h;b[4]=k;b[5]=q;b[6]=t;b[7]=u;b[8]=x}
function SMatrix3x3_rotationX(a){var b=Math.sin(a);a=Math.cos(a);var e=RMath.float9;e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=a;e[5]=b;e[6]=0;e[7]=-b;e[8]=a;this.appendData(e)}function SMatrix3x3_rotationY(a){var b=Math.sin(a);a=Math.cos(a);var e=RMath.float9;e[0]=a;e[1]=0;e[2]=b;e[3]=0;e[4]=1;e[5]=0;e[6]=-b;e[7]=0;e[8]=a;this.appendData(e)}
function SMatrix3x3_rotationZ(a){var b=Math.sin(a);a=Math.cos(a);var e=RMath.float9;e[0]=a;e[1]=b;e[2]=0;e[3]=-b;e[4]=a;e[5]=1;e[6]=0;e[7]=0;e[8]=1;this.appendData(e)}function SMatrix3x3_rotation(a,b,e){var f=Math.sin(a);a=Math.cos(a);var h=Math.sin(b);b=Math.cos(b);var k=Math.sin(e);e=Math.cos(e);var q=RMath.float9;q[0]=b*e;q[1]=b*k;q[2]=-h;q[3]=f*h*e-a*k;q[4]=f*h*k+a*e;q[5]=f*b;q[6]=a*h*e+f*k;q[7]=a*h*k-f*a;q[8]=a*b;this.appendData(q)}
function SMatrix3x3_invert(){var a=this._data,b=RValue.float9;b[0]=a[4]*a[8]-a[5]*a[7];b[1]=a[2]*a[7]-a[1]*a[8];b[2]=a[1]*a[5]-a[2]*a[4];b[3]=a[5]*a[6]-a[3]*a[8];b[4]=a[0]*a[8]-a[2]*a[6];b[5]=a[2]*a[3]-a[0]*a[5];b[6]=a[3]*a[7]-a[4]*a[6];b[7]=a[1]*a[6]-a[0]*a[7];b[8]=a[0]*a[4]-a[1]*a[3];var e=a[0]*b[0]+a[1]*b[3]+a[2]*b[6];if(0==e)return!1;for(var e=1/e,f=0;9>f;f++)a[f]=b[f]*e;return!0}
function SMatrix3x3_transform(a,b,e){for(var f=this._data,h=0;h<e;h++){var k=(h<<1)+h;a[k]=b[k]*f[0]+b[k+1]*f[3]+b[k+2]*f[6];a[k+1]=b[k]*f[1]+b[k+1]*f[4]+b[k+2]*f[7];a[k+2]=b[k]*f[2]+b[k+1]*f[5]+b[k+2]*f[8]}}function SMatrix3x3_transformPoint3(a,b){var e=this._data,f=a.x*e[0]+a.y*e[3]+a.z*e[6],h=a.x*e[1]+a.y*e[4]+a.z*e[7],e=a.x*e[2]+a.y*e[5]+a.z*e[8],k=null,k=b?b:new SPoint3;k.set(f,h,e);return k}
function SMatrix3x3_build(a){var b=this._data,e=a.x*a.x,f=a.y*a.y,h=a.z*a.z,k=a.x*a.y,q=a.x*a.z,t=a.y*a.z,u=a.w*a.x,x=a.w*a.y;a=a.w*a.z;b[0]=1-2*(f+h);b[1]=2*(k-a);b[2]=2*(q+x);b[3]=2*(k+a);b[4]=1-2*(e+h);b[5]=2*(t-u);b[6]=2*(q-x);b[7]=2*(t+u);b[8]=1-2*(e+f)}function SMatrix3x3_writeData(a,b){var e=this._data;a[b++]=e[0];a[b++]=e[3];a[b++]=e[6];a[b++]=e[1];a[b++]=e[4];a[b++]=e[7];a[b++]=e[2];a[b++]=e[5];a[b++]=e[8]}
function SMatrix3x3_toString(){for(var a=this._data,b=new TString,e=0;3>e;e++){0<e&&b.append("|");for(var f=0;3>f;f++){var h=a[3*e+f];0<f&&b.append(",");b.append(RFloat.format(h,0,null,3,null))}}return b.flush()}
function SMatrix4x4(){this._data=Array(16);this.data=SMatrix4x4_data;this.isIdentityData=SMatrix4x4_isIdentityData;this.identityData=SMatrix4x4_identityData;this.equalsData=SMatrix4x4_equalsData;this.assignData=SMatrix4x4_assignData;this.attachData=SMatrix4x4_attachData;this.appendData=SMatrix4x4_appendData;this.translate=SMatrix4x4_translate;this.rotationX=SMatrix4x4_rotationX;this.rotationY=SMatrix4x4_rotationY;this.rotationZ=SMatrix4x4_rotationZ;this.rotation=SMatrix4x4_rotation;this.scale=SMatrix4x4_scale;
this.invert=SMatrix4x4_invert;this.transform=SMatrix4x4_transform;this.transformPoint3=SMatrix4x4_transformPoint3;this.buildQuaternion=SMatrix4x4_buildQuaternion;this.build=SMatrix4x4_build;this.writeData=SMatrix4x4_writeData;this.toString=SMatrix4x4_toString;return this}function SMatrix4x4_data(){return this._data}function SMatrix4x4_isIdentityData(){for(var a=this._data,b=RMath.identity4x4,e=0;16>e;e++)if(a[e]!=b[e])return!1;return!0}
function SMatrix4x4_identityData(){for(var a=this._data,b=RMath.identity4x4,e=0;16>e;e++)a[e]=b[e];return this}function SMatrix4x4_equalsData(a){for(var b=this._data,e=0;16>e;e++)if(b[e]!=a[e])return!1;return!0}function SMatrix4x4_assignData(a){for(var b=this._data,e=0;16>e;e++)b[e]=a[e]}function SMatrix4x4_attachData(a){for(var b=!1,e=this._data,f=0;16>f;f++){var h=a[f];b||e[f]!=h&&(b=!0);e[f]=h}return b}
function SMatrix4x4_appendData(a){var b=this._data,e=b[0]*a[1]+b[1]*a[5]+b[2]*a[9]+b[3]*a[13],f=b[0]*a[2]+b[1]*a[6]+b[2]*a[10]+b[3]*a[14],h=b[0]*a[3]+b[1]*a[7]+b[2]*a[11]+b[3]*a[15],k=b[4]*a[0]+b[5]*a[4]+b[6]*a[8]+b[7]*a[12],q=b[4]*a[1]+b[5]*a[5]+b[6]*a[9]+b[7]*a[13],t=b[4]*a[2]+b[5]*a[6]+b[6]*a[10]+b[7]*a[14],u=b[4]*a[3]+b[5]*a[7]+b[6]*a[11]+b[7]*a[15],x=b[8]*a[0]+b[9]*a[4]+b[10]*a[8]+b[11]*a[12],z=b[8]*a[1]+b[9]*a[5]+b[10]*a[9]+b[11]*a[13],y=b[8]*a[2]+b[9]*a[6]+b[10]*a[10]+b[11]*a[14],A=b[8]*a[3]+
b[9]*a[7]+b[10]*a[11]+b[11]*a[15],E=b[12]*a[0]+b[13]*a[4]+b[14]*a[8]+b[15]*a[12],B=b[12]*a[1]+b[13]*a[5]+b[14]*a[9]+b[15]*a[13],D=b[12]*a[2]+b[13]*a[6]+b[14]*a[10]+b[15]*a[14],C=b[12]*a[3]+b[13]*a[7]+b[14]*a[11]+b[15]*a[15];b[0]=b[0]*a[0]+b[1]*a[4]+b[2]*a[8]+b[3]*a[12];b[1]=e;b[2]=f;b[3]=h;b[4]=k;b[5]=q;b[6]=t;b[7]=u;b[8]=x;b[9]=z;b[10]=y;b[11]=A;b[12]=E;b[13]=B;b[14]=D;b[15]=C}
function SMatrix4x4_translate(a,b,e){var f=RArray.array16;f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=a;f[13]=b;f[14]=e;f[15]=1;this.appendData(f)}function SMatrix4x4_rotationX(a){var b=Math.sin(a);a=Math.cos(a);var e=RArray.array16;e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a;e[6]=b;e[7]=0;e[8]=0;e[9]=-b;e[10]=a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;this.appendData(e)}
function SMatrix4x4_rotationY(a){var b=Math.sin(a);a=Math.cos(a);var e=RArray.array16;e[0]=a;e[1]=0;e[2]=b;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=-b;e[9]=0;e[10]=a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;this.appendData(e)}function SMatrix4x4_rotationZ(a){var b=Math.sin(a);a=Math.cos(a);var e=RArray.array16;e[0]=a;e[1]=b;e[2]=0;e[3]=0;e[4]=-b;e[5]=a;e[6]=1;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;this.appendData(e)}
function SMatrix4x4_rotation(a,b,e){var f=Math.sin(a);a=Math.cos(a);var h=Math.sin(b);b=Math.cos(b);var k=Math.sin(e);e=Math.cos(e);var q=RArray.array16;q[0]=b*e;q[1]=b*k;q[2]=-h;q[3]=0;q[4]=f*h*e-a*k;q[5]=f*h*k+a*e;q[6]=f*b;q[7]=0;q[8]=a*h*e+f*k;q[9]=a*h*k-f*a;q[10]=a*b;q[11]=0;q[12]=0;q[13]=0;q[14]=0;q[15]=1;this.appendData(q)}
function SMatrix4x4_scale(a,b,e){var f=RArray.array16;f[0]=a;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=b;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=e;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;this.appendData(f)}
function SMatrix4x4_invert(){var a=this._data,b=RArray.array16;b[0]=a[5]*a[10]*a[15]-a[5]*a[11]*a[14]-a[9]*a[6]*a[15]+a[9]*a[7]*a[14]+a[13]*a[6]*a[11]-a[13]*a[7]*a[10];b[4]=-(a[4]*a[10]*a[15])+a[4]*a[11]*a[14]+a[8]*a[6]*a[15]-a[8]*a[7]*a[14]-a[12]*a[6]*a[11]+a[12]*a[7]*a[10];b[8]=a[4]*a[9]*a[15]-a[4]*a[11]*a[13]-a[8]*a[5]*a[15]+a[8]*a[7]*a[13]+a[12]*a[5]*a[11]-a[12]*a[7]*a[9];b[12]=-(a[4]*a[9]*a[14])+a[4]*a[10]*a[13]+a[8]*a[5]*a[14]-a[8]*a[6]*a[13]-a[12]*a[5]*a[10]+a[12]*a[6]*a[9];b[1]=-(a[1]*a[10]*
a[15])+a[1]*a[11]*a[14]+a[9]*a[2]*a[15]-a[9]*a[3]*a[14]-a[13]*a[2]*a[11]+a[13]*a[3]*a[10];b[5]=a[0]*a[10]*a[15]-a[0]*a[11]*a[14]-a[8]*a[2]*a[15]+a[8]*a[3]*a[14]+a[12]*a[2]*a[11]-a[12]*a[3]*a[10];b[9]=-(a[0]*a[9]*a[15])+a[0]*a[11]*a[13]+a[8]*a[1]*a[15]-a[8]*a[3]*a[13]-a[12]*a[1]*a[11]+a[12]*a[3]*a[9];b[13]=a[0]*a[9]*a[14]-a[0]*a[10]*a[13]-a[8]*a[1]*a[14]+a[8]*a[2]*a[13]+a[12]*a[1]*a[10]-a[12]*a[2]*a[9];b[2]=a[1]*a[6]*a[15]-a[1]*a[7]*a[14]-a[5]*a[2]*a[15]+a[5]*a[3]*a[14]+a[13]*a[2]*a[7]-a[13]*a[3]*
a[6];b[6]=-(a[0]*a[6]*a[15])+a[0]*a[7]*a[14]+a[4]*a[2]*a[15]-a[4]*a[3]*a[14]-a[12]*a[2]*a[7]+a[12]*a[3]*a[6];b[10]=a[0]*a[5]*a[15]-a[0]*a[7]*a[13]-a[4]*a[1]*a[15]+a[4]*a[3]*a[13]+a[12]*a[1]*a[7]-a[12]*a[3]*a[5];b[14]=-(a[0]*a[5]*a[14])+a[0]*a[6]*a[13]+a[4]*a[1]*a[14]-a[4]*a[2]*a[13]-a[12]*a[1]*a[6]+a[12]*a[2]*a[5];b[3]=-(a[1]*a[6]*a[11])+a[1]*a[7]*a[10]+a[5]*a[2]*a[11]-a[5]*a[3]*a[10]-a[9]*a[2]*a[7]+a[9]*a[3]*a[6];b[7]=a[0]*a[6]*a[11]-a[0]*a[7]*a[10]-a[4]*a[2]*a[11]+a[4]*a[3]*a[10]+a[8]*a[2]*a[7]-
a[8]*a[3]*a[6];b[11]=-(a[0]*a[5]*a[11])+a[0]*a[7]*a[9]+a[4]*a[1]*a[11]-a[4]*a[3]*a[9]-a[8]*a[1]*a[7]+a[8]*a[3]*a[5];b[15]=a[0]*a[5]*a[10]-a[0]*a[6]*a[9]-a[4]*a[1]*a[10]+a[4]*a[2]*a[9]+a[8]*a[1]*a[6]-a[8]*a[2]*a[5];var e=a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12];if(0==e)return!1;for(var e=1/e,f=0;16>f;f++)a[f]=b[f]*e;return!0}
function SMatrix4x4_transform(a,b,e,f,h){for(var k=this._data,q=0;q<h;q++){var t=e[f++],u=e[f++],x=e[f++];a[b++]=t*k[0]+u*k[4]+x*k[8]+k[12];a[b++]=t*k[1]+u*k[5]+x*k[9]+k[13];a[b++]=t*k[2]+u*k[6]+x*k[10]+k[14]}}function SMatrix4x4_transformPoint3(a,b){var e=this._data,f=a.x*e[0]+a.y*e[4]+a.z*e[8]+e[12],h=a.x*e[1]+a.y*e[5]+a.z*e[9]+e[13],e=a.x*e[2]+a.y*e[6]+a.z*e[10]+e[14],k=null,k=b?b:new SPoint3;k.set(f,h,e);return k}
function SMatrix4x4_build(a,b,e){var f=this._data,h=b.x*b.x,k=b.y*b.y,q=b.z*b.z,t=b.x*b.y,u=b.x*b.z,x=b.y*b.z,z=b.w*b.x,y=b.w*b.y;b=b.w*b.z;f[0]=(1-2*(k+q))*e.x;f[1]=2*(t-b)*e.x;f[2]=2*(u+y)*e.x;f[3]=0;f[4]=2*(t+b)*e.y;f[5]=(1-2*(h+q))*e.y;f[6]=2*(x-z)*e.y;f[7]=0;f[8]=2*(u-y)*e.z;f[9]=2*(x+z)*e.z;f[10]=(1-2*(h+k))*e.z;f[11]=0;f[12]=a.x;f[13]=a.y;f[14]=a.z;f[15]=1}
function SMatrix4x4_buildQuaternion(a){var b=this._data,e=a.x*a.x,f=a.y*a.y,h=a.z*a.z,k=a.x*a.y,q=a.x*a.z,t=a.y*a.z,u=a.w*a.x,x=a.w*a.y;a=a.w*a.z;b[0]=1-2*(f+h);b[1]=2*(k-a);b[2]=2*(q+x);b[3]=0;b[4]=2*(k+a);b[5]=1-2*(e+h);b[6]=2*(t-u);b[7]=0;b[8]=2*(q-x);b[9]=2*(t+u);b[10]=1-2*(e+f);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1}
function SMatrix4x4_writeData(a,b){var e=this._data;a[b++]=e[0];a[b++]=e[4];a[b++]=e[8];a[b++]=e[12];a[b++]=e[1];a[b++]=e[5];a[b++]=e[9];a[b++]=e[13];a[b++]=e[2];a[b++]=e[6];a[b++]=e[10];a[b++]=e[14];a[b++]=e[3];a[b++]=e[7];a[b++]=e[11];a[b++]=e[15]}function SMatrix4x4_toString(){for(var a=this._data,b=new TString,e=0;4>e;e++){0<e&&b.append("|");for(var f=0;4>f;f++){var h=a[4*e+f];0<f&&b.append(",");b.append(RFloat.format(h,0,null,3,null))}}return b.flush()}
function SOrthoMatrix3d(){SMatrix3d.call(this);this.perspectiveLH=SOrthoMatrix3d_perspectiveLH;this.perspectiveRH=SOrthoMatrix3d_perspectiveRH;this.perspectiveFieldOfViewLH=SOrthoMatrix3d_perspectiveFieldOfViewLH;this.perspectiveFieldOfViewRH=SOrthoMatrix3d_perspectiveFieldOfViewRH;return this}function SOrthoMatrix3d_perspectiveLH(a,b,e,f){var h=this._data;h[0]=2*e/a;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*e/b;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=f/(f-e);h[11]=1;h[12]=0;h[13]=0;h[14]=e*f/(e-f);h[15]=0}
function SOrthoMatrix3d_perspectiveRH(a,b,e,f){var h=this._data;h[0]=2*e/a;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*e/b;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=f/(e-f);h[11]=1;h[12]=0;h[13]=0;h[14]=e*f/(e-f);h[15]=0}function SOrthoMatrix3d_perspectiveFieldOfViewLH(a,b,e,f){var h=this._data;a=1/Math.tan(.5*a);h[0]=a/b;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=f/(f-e);h[11]=1;h[12]=0;h[13]=0;h[14]=e*f/(e-f);h[15]=0}
function SOrthoMatrix3d_perspectiveFieldOfViewRH(a,b,e,f){var h=this._data;a=1/Math.tan(.5*a);h[0]=a/b;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=f/(e-f);h[11]=1;h[12]=0;h[13]=0;h[14]=e*f/(f-e);h[15]=0}function SOutline3(){this.min=new SPoint3;this.max=new SPoint3;this.assign=SOutline3_assign;this.serialize=SOutline3_serialize;this.unserialize=SOutline3_unserialize;this.toString=SOutline3_toString;return this}
function SOutline3_assign(a){this.min.assign(a.min);this.max.assign(a.max)}function SOutline3_serialize(a){this.min.serialize(a);this.max.serialize(a)}function SOutline3_unserialize(a){this.min.unserialize(a);this.max.unserialize(a)}function SOutline3_toString(){return"("+this.min+")-("+this.max+")"}
function SPadding(a,b,e,f){this.left=RInteger.nvl(a);this.top=RInteger.nvl(b);this.right=RInteger.nvl(e);this.bottom=RInteger.nvl(f);this.isEmpty=SPadding_isEmpty;this.reset=SPadding_reset;this.assign=SPadding_assign;this.set=SPadding_set;this.parse=SPadding_parse;this.toString=SPadding_toString;this.dispose=SPadding_dispose;this.dump=SPadding_dump;return this}function SPadding_isEmpty(){return 0==this.left&&0==this.top&&0==this.right&&0==this.bottom}
function SPadding_reset(){this.bottom=this.right=this.top=this.left=0}function SPadding_assign(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom}function SPadding_set(a,b,e,f){this.left=a;this.top=b;this.right=e;this.bottom=f}function SPadding_parse(a){var b=a.split(",");if(4==b.length)this.left=parseInt(b[0]),this.top=parseInt(b[1]),this.right=parseInt(b[2]),this.bottom=parseInt(b[3]);else throw new TError(this,"Parse value failure. (value={1})",a);}
function SPadding_toString(){return this.left+","+this.top+","+this.right+","+this.bottom}function SPadding_dispose(){this.bottom=this.right=this.top=this.left=null}function SPadding_dump(a){return RClass.dump(this)+" ["+this.left+","+this.top+","+this.right+","+this.bottom+"]"}
function SPerspectiveMatrix3d(){SMatrix3d.call(this);this.perspectiveLH=SPerspectiveMatrix3d_perspectiveLH;this.perspectiveRH=SPerspectiveMatrix3d_perspectiveRH;this.perspectiveFieldOfViewLH=SPerspectiveMatrix3d_perspectiveFieldOfViewLH;this.perspectiveFieldOfViewRH=SPerspectiveMatrix3d_perspectiveFieldOfViewRH;return this}
function SPerspectiveMatrix3d_perspectiveLH(a,b,e,f){var h=this._data;h[0]=2*e/a;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*e/b;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=f/(f-e);h[11]=1;h[12]=0;h[13]=0;h[14]=e*f/(e-f);h[15]=0}function SPerspectiveMatrix3d_perspectiveRH(a,b,e,f){var h=this._data;h[0]=2*e/a;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*e/b;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=f/(e-f);h[11]=1;h[12]=0;h[13]=0;h[14]=e*f/(e-f);h[15]=0}
function SPerspectiveMatrix3d_perspectiveFieldOfViewLH(a,b,e,f){var h=this._data;a=1/Math.tan(.5*a);h[0]=a/b;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=f/(f-e);h[11]=1;h[12]=0;h[13]=0;h[14]=e*f/(e-f);h[15]=0}function SPerspectiveMatrix3d_perspectiveFieldOfViewRH(a,b,e,f){var h=this._data;a=1/Math.tan(.5*a);h[0]=a/b;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=f/(e-f);h[11]=1;h[12]=0;h[13]=0;h[14]=e*f/(f-e);h[15]=0}
function SPlane(a){a||(a=this);a.a=0;a.b=0;a.c=0;a.d=0;a.assign=SPlane_assign;a.set=SPlane_set;a.normalize=SPlane_normalize;a.dot=SPlane_dot;a.toString=SPlane_toString;a.dump=SPlane_dump;return a}function SPlane_assign(a){this.a=a.a;this.b=a.b;this.c=a.c;this.d=a.d}function SPlane_set(a,b,e,f){this.a=a;this.b=b;this.c=e;this.d=f}function SPlane_normalize(){var a=1/Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);this.a*=a;this.b*=a;this.c*=a;this.d*=a}
function SPlane_dot(a,b,e){return a*this.a+b*this.b+e*this.c+d}function SPlane_toString(){return this.a+","+this.b+","+this.c+","+this.d}function SPlane_dump(){return RClass.dump(this)+" ["+this.toString()+"]"}
function SPoint2(a,b){this.x=RInteger.nvl(a);this.y=RInteger.nvl(b);this.isEmpty=SPoint2_isEmpty;this.equals=SPoint2_equals;this.assign=SPoint2_assign;this.set=SPoint2_set;this.serialize=SPoint2_serialize;this.unserialize=SPoint2_unserialize;this.toString=SPoint2_toString;this.dispose=SPoint2_dispose;this.dump=SPoint2_dump;return this}function SPoint2_isEmpty(){return 0==this.x&&0==this.y}function SPoint2_equals(a){return a?this.x==a.x&&this.y==a.y:!1}
function SPoint2_assign(a){this.x=a.x;this.y=a.y}function SPoint2_set(a,b){this.x=a;this.y=b}function SPoint2_serialize(a){a.writeFloat(this.x);a.writeFloat(this.y)}function SPoint2_unserialize(a){this.x=a.readFloat();this.y=a.readFloat()}function SPoint2_toString(){return this.x+","+this.y}function SPoint2_dispose(){this.y=this.x=null}function SPoint2_dump(){return RClass.dump(this)+" ["+this.x+","+this.y+"]"}
function SPoint3(a,b,e){SValue3.call(this,a,b,e);this.conjugate=SPoint3_conjugate;this.resize=SPoint3_resize;this.slerp=SPoint3_slerp;return this}function SPoint3_conjugate(a){var b=null,b=a?a:new SPoint3;b.x=-this.x;b.y=-this.y;b.z=-this.z;return b}function SPoint3_resize(a,b,e){null!=a&&(this.x+=a);null!=b&&(this.y+=b);null!=e&&(this.z+=e)}function SPoint3_slerp(a,b,e){this.x=(b.x-a.x)*e+a.x;this.y=(b.y-a.y)*e+a.y;this.z=(b.z-a.z)*e+a.z}
function SPoint4(a,b,e,f){SValue4.call(this,a,b,e,f);this.serialize3=SPoint4_serialize3;this.unserialize3=SPoint4_unserialize3;return this}function SPoint4_serialize3(a){a.writeFloat(this.x);a.writeFloat(this.y);a.writeFloat(this.z)}function SPoint4_unserialize3(a){this.x=a.readFloat();this.y=a.readFloat();this.z=a.readFloat()}
function SQuaternion(a){a||(a=this);a.x=0;a.y=0;a.z=0;a.w=1;a.identity=SQuaternion_identity;a.assign=SQuaternion_assign;a.set=SQuaternion_set;a.absolute=SQuaternion_absolute;a.normalize=SQuaternion_normalize;a.conjugate=SQuaternion_conjugate;a.mul=SQuaternion_mul;a.mul2=SQuaternion_mul2;a.translate=SQuaternion_translate;a.slerp=SQuaternion_slerp;a.fromAxisAngle=SQuaternion_fromAxisAngle;a.fromEuler=SQuaternion_fromEuler;a.parseEuler=SQuaternion_parseEuler;a.serialize=SQuaternion_serialize;a.unserialize=
SQuaternion_unserialize;a.clone=SQuaternion_clone;a.toString=SQuaternion_toString;return a}function SQuaternion_identity(){this.x=this.y=this.z=0;this.w=1;return this}function SQuaternion_assign(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w}function SQuaternion_set(a,b,e,f){this.x=a;this.y=b;this.z=e;this.w=f}function SQuaternion_absolute(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}
function SQuaternion_normalize(){var a=this.absolute();0!=a&&(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a)}function SQuaternion_conjugate(a){var b=null,b=a?a:new SQuaternion;b.x=-this.x;b.y=-this.y;b.z=-this.z;b.w=this.w;return b}function SQuaternion_mul(a){var b=this.x,e=this.y,f=this.z,h=this.w;this.x=h*a.x+b*a.w+e*a.z-f*a.y;this.y=h*a.y+e*a.w+f*a.x-b*a.z;this.z=h*a.z+f*a.w+b*a.y-e*a.x;this.w=h*a.w-b*a.x-e*a.y-f*a.z}
function SQuaternion_mul2(a,b){this.x=a.w*b.x+a.x*b.w+a.y*b.z-a.z*b.y;this.y=a.w*b.y+a.y*b.w+a.z*b.x-a.x*b.z;this.z=a.w*b.z+a.z*b.w+a.x*b.y-a.y*b.x;this.w=a.w*b.w-a.x*b.x-a.y*b.y-a.z*b.z}function SQuaternion_translate(a,b){var e=new SQuaternion;e.set(a.x,a.y,a.z,0);e.normalize();var f=this.conjugate();e.mul(f);f=this.clone();f.mul(e);e=null;e=b?b:new SVector3;e.set(f.x,f.y,f.z);return e}
function SQuaternion_slerp(a,b,e){var f=a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w,h=!1;0>f&&(h=!0,f=-f);var k=0,q=0;.999999<f?(k=1-e,q=h?-e:e):(f=Math.acos(f),q=1/Math.sin(f),k=Math.sin((1-e)*f)*q,q=h?-Math.sin(e*f)*q:Math.sin(e*f)*q);this.x=k*a.x+q*b.x;this.y=k*a.y+q*b.y;this.z=k*a.z+q*b.z;this.w=k*a.w+q*b.w}function SQuaternion_fromAxisAngle(a,b){var e=.5*b,f=Math.sin(e);this.x=a.x*f;this.y=a.y*f;this.z=a.z*f;this.w=Math.cos(e)}
function SQuaternion_fromEuler(a,b,e){var f=Math.sin(.5*e);e=Math.cos(.5*e);var h=Math.sin(.5*a);a=Math.cos(.5*a);var k=Math.sin(.5*b);b=Math.cos(.5*b);this.x=e*h*b+f*a*k;this.y=e*a*k-f*h*b;this.z=f*a*b-e*h*k;this.w=e*a*b+f*h*k}
function SQuaternion_parseEuler(a){var b=this.x*this.x,e=this.y*this.y,f=this.z*this.z,h=null,h=a?a:new SVector3;h.x=Math.asin(RFloat.toRange(2*(this.w*this.x-this.y*this.z),-1,1));h.y=Math.atan2(2*(this.w*this.y+this.z*this.x),1-2*(b+e));h.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(f+b));return h}function SQuaternion_serialize(a){a.writeFloat(this.x);a.writeFloat(this.y);a.writeFloat(this.z);a.writeFloat(this.w)}
function SQuaternion_unserialize(a){this.x=a.readFloat();this.y=a.readFloat();this.z=a.readFloat();this.w=a.readFloat()}function SQuaternion_clone(){var a=new SQuaternion;a.x=this.x;a.y=this.y;a.z=this.z;a.w=this.w;return a}function SQuaternion_toString(){return this.x+","+this.y+","+this.z+","+this.w}function SRange(a,b,e,f){this.x=a;this.y=b;this.width=e;this.height=f;this.dump=SRange_dump;return this}function SRange_reset(){this.bottom=this.right=this.top=this.left=0}
function SRange_assign(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom}function SRange_set(a,b,e,f){this.left=a;this.top=b;this.right=e;this.bottom=f}function SRange_setBounds(a,b,e,f){this.left=a;this.top=b;this.right=this.left+e-1;this.bottom=this.top+f-1}function SRange_width(){return this.right-this.left+1}function SRange_setWidth(a){a&&(this.right=this.left+a-1)}function SRange_height(){return this.bottom-this.top+1}
function SRange_setHeight(a){a&&(this.bottom=this.top+a-1)}function SRange_move(a,b){this.left+=a;this.top+=b;this.right+=a;this.bottom+=b}function SRange_inc(a){a=RInt.nvl(a,1);this.left-=a;this.top-=a;this.right+=a;this.bottom+=a}function SRange_dec(a){a=RInt.nvl(a,1);this.left+=a;this.top+=a;this.right-=a;this.bottom-=a}function SRange_dump(a){a=RString.nvlStr(a);a.append(RClass.name(this));a.append(" [",this.x,",",this.y,"-",this.width,",",this.height,"] ");return a}
function SRectangle(){this.position=new SPoint2;this.size=new SSize2;this.left=SRectangle_left;this.top=SRectangle_top;this.right=SRectangle_right;this.bottom=SRectangle_bottom;this.width=SRectangle_width;this.height=SRectangle_height;this.assign=SRectangle_assign;this.setPosition=SRectangle_setPosition;this.setSize=SRectangle_setSize;this.set=SRectangle_set;this.toString=SRectangle_toString;this.dispose=SRectangle_dispose;this.dump=SRectangle_dump;return this}
function SRectangle_left(){return this.position.x}function SRectangle_top(){return this.position.y}function SRectangle_right(){return this.position.x+this.size.width}function SRectangle_bottom(){return this.position.y+this.size.height}function SRectangle_width(){return this.size.width}function SRectangle_height(){return this.size.height}function SRectangle_assign(a){this.position.assign(a.position);this.size.assign(a.size)}function SRectangle_setPosition(a,b,e,f){this.position.set(a,b)}
function SRectangle_setSize(a,b){this.size.set(a,b)}function SRectangle_set(a,b,e,f){this.position.set(a,b);this.size.set(e,f)}function SRectangle_toString(){return this.position.x+","+this.position.y+","+this.size.width+","+this.size.height}function SRectangle_dispose(){this.position=this.position.dispose();this.size=this.size.dispose()}function SRectangle_dump(){return RClass.dump(this)+" ["+this.position.x+","+this.position.y+"-"+this.size.width+","+this.size.height+"]"}
function SSize2(a,b){this.width=RInteger.nvl(a);this.height=RInteger.nvl(b);this.isEmpty=SSize2_isEmpty;this.square=SSize2_square;this.assign=SSize2_assign;this.set=SSize2_set;this.parse=SSize2_parse;this.toString=SSize2_toString;this.dispose=SSize2_dispose;this.dump=SSize2_dump;return this}function SSize2_isEmpty(){return 0==this.width&&0==this.height}function SSize2_square(){return this.width*this.height}function SSize2_assign(a){this.width=a.width;this.height=a.height}
function SSize2_set(a,b){this.width=a;this.height=b}function SSize2_parse(a){var b=a.split(",");if(2==b.length)this.width=parseInt(b[0]),this.height=parseInt(b[1]);else throw new TError(this,"Parse value failure. (value={1})",a);}function SSize2_toString(){return this.width+","+this.height}function SSize2_dispose(){this.height=this.width=null}function SSize2_dump(){return RClass.dump(this)+" ["+this.width+","+this.height+"]"}
function SSize3(a,b,e){this.width=RInteger.nvl(a);this.height=RInteger.nvl(b);this.deep=RInteger.nvl(e);this.assign=SSize3_assign;this.set=SSize3_set;this.parse=SSize3_parse;this.toString=SSize3_toString;this.dump=SSize3_dump;return this}function SSize3_assign(a){this.width=a.width;this.height=a.height;this.deep=a.deep}function SSize3_set(a,b,e){this.width=a;this.height=b;this.deep=e}
function SSize3_parse(a){var b=a.split(",");if(3==b.length)this.width=parseInt(b[0]),this.height=parseInt(b[1]),this.deep=parseInt(b[2]);else throw new TError(this,"Parse value failure. (value={1})",a);}function SSize3_toString(){return this.width+","+this.height+","+this.deep}function SSize3_dump(){return RClass.dump(this)+" ["+this.width+","+this.height+","+this.deep+"]"}
function SSquare(a,b,e,f){this.left=RInteger.nvl(left);this.top=RInteger.nvl(top);this.right=RInteger.nvl(right);this.bottom=RInteger.nvl(bottom);this.reset=SSquare_reset;this.assign=SSquare_assign;this.set=SSquare_set;this.setBounds=SSquare_setBounds;this.width=SSquare_width;this.setWidth=SSquare_setWidth;this.height=SSquare_height;this.setHeight=SSquare_setHeight;this.move=SSquare_move;this.inc=SSquare_inc;this.dec=SSquare_dec;this.dump=this.unpack=this.pack=SSquare_dump;return this}
function SSquare_reset(){this.bottom=this.right=this.top=this.left=0}function SSquare_assign(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom}function SSquare_set(a,b,e,f){this.left=a;this.top=b;this.right=e;this.bottom=f}function SSquare_setBounds(a,b,e,f){this.left=a;this.top=b;this.right=this.left+e-1;this.bottom=this.top+f-1}function SSquare_width(){return this.right-this.left+1}function SSquare_setWidth(a){a&&(this.right=this.left+a-1)}
function SSquare_height(){return this.bottom-this.top+1}function SSquare_setHeight(a){a&&(this.bottom=this.top+a-1)}function SSquare_move(a,b){this.left+=a;this.top+=b;this.right+=a;this.bottom+=b}function SSquare_inc(a){a=RInt.nvl(a,1);this.left-=a;this.top-=a;this.right+=a;this.bottom+=a}function SSquare_dec(a){a=RInt.nvl(a,1);this.left+=a;this.top+=a;this.right-=a;this.bottom-=a}
function SSquare_dump(a){a=RString.nvlStr(a);a.append(RClass.name(this));a.append(" [",this.left,",",this.top,"-",this.right,",",this.bottom,"] ");a.append("(",this.width(),"-",this.height(),")");return a}
function SValue3(a,b,e){this.x=RRuntime.nvl(a,0);this.y=RRuntime.nvl(b,0);this.z=RRuntime.nvl(e,0);this.assign=SValue3_assign;this.set=SValue3_set;this.absolute=SValue3_absolute;this.normalize=SValue3_normalize;this.negative=SValue3_negative;this.serialize=SValue3_serialize;this.unserialize=SValue3_unserialize;this.parse=SValue3_parse;this.toString=SValue3_toString;return this}function SValue3_assign(a){this.x=a.x;this.y=a.y;this.z=a.z}function SValue3_set(a,b,e){this.x=a;this.y=b;this.z=e}
function SValue3_normalize(){var a=this.absolute();0!=a&&(this.x/=a,this.y/=a,this.z/=a)}function SValue3_absolute(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}function SValue3_negative(a){var b=null,b=a?a:new this.constructor;b.x=-this.x;b.y=-this.y;b.z=-this.z;return b}function SValue3_serialize(a){a.writeFloat(this.x);a.writeFloat(this.y);a.writeFloat(this.z)}function SValue3_unserialize(a){this.x=a.readFloat();this.y=a.readFloat();this.z=a.readFloat()}
function SValue3_parse(a){var b=a.split(",");if(3==b.length)this.x=parseFloat(b[0]),this.y=parseFloat(b[1]),this.z=parseFloat(b[2]);else throw new TError(this,"Parse value failure. (value={1})",a);}function SValue3_toString(){return this.x+","+this.y+","+this.z}
function SValue4(a,b,e,f){this.x=RRuntime.nvl(a,0);this.y=RRuntime.nvl(b,0);this.z=RRuntime.nvl(e,0);this.w=RRuntime.nvl(f,1);this.assign=SValue4_assign;this.set=SValue4_set;this.absolute=SValue4_absolute;this.normalize=SValue4_normalize;this.negative=SValue4_negative;this.serialize=SValue4_serialize;this.unserialize=SValue4_unserialize;this.parse=SValue4_parse;this.toString=SValue4_toString;return this}function SValue4_assign(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w}
function SValue4_set(a,b,e,f){this.x=a;this.y=b;this.z=e;this.w=f}function SValue4_absolute(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}function SValue4_normalize(){var a=this.absolute();0!=a&&(this.x/=a,this.y/=a,this.z/=a,this.w/=w)}function SValue4_negative(a){var b=null,b=a?a:new this.constructor;b.x=-this.x;b.y=-this.y;b.z=-this.z;b.w=-this.w;return b}
function SValue4_serialize(a){a.writeFloat(this.x);a.writeFloat(this.y);a.writeFloat(this.z);a.writeFloat(this.w)}function SValue4_unserialize(a){this.x=a.readFloat();this.y=a.readFloat();this.z=a.readFloat();this.w=a.readFloat()}function SValue4_parse(a){var b=a.split(",");if(4==b.length)this.x=parseFloat(b[0]),this.y=parseFloat(b[1]),this.z=parseFloat(b[2]),this.w=parseFloat(b[3]);else throw new TError(this,"Parse value failure. (value={1})",a);}
function SValue4_toString(){return this.x+","+this.y+","+this.z+","+this.w}function SVector3(a,b,e){SValue3.call(this,a,b,e);this.conjugate=SVector3_conjugate;this.dotPoint3=SVector3_dotPoint3;this.cross=SVector3_cross;this.cross2=SVector3_cross2;this.slerp=SVector3_slerp;this.clone=SVector3_clone;return this}function SVector3_conjugate(a){var b=null,b=a?a:new SVector3;b.x=-this.x;b.y=-this.y;b.z=-this.z;return b}function SVector3_dotPoint3(a){return this.x*a.x+this.y*a.y+this.z*a.z}
function SVector3_cross(a){var b=this.z*a.x-this.x*a.z,e=this.x*a.y-this.y*a.x;this.x=this.y*a.z-this.z*a.y;this.y=b;this.z=e}function SVector3_cross2(a,b){a.x=this.y*b.z-this.z*b.y;a.y=this.z*b.x-this.x*b.z;a.z=this.x*b.y-this.y*b.x}function SVector3_slerp(a,b,e){this.x=(b.x-a.x)*e+a.x;this.y=(b.y-a.y)*e+a.y;this.z=(b.z-a.z)*e+a.z}function SVector3_clone(){var a=new SVector3;a.x=this.x;a.y=this.y;a.z=this.z;return a}
function SVector4(a,b,e,f){SValue4.call(this,a,b,e,f);this.serialize3=SVector4_serialize3;this.unserialize3=SVector4_unserialize3;return this}function SVector4_serialize3(a){a.writeFloat(this.x);a.writeFloat(this.y);a.writeFloat(this.z)}function SVector4_unserialize3(a){this.x=a.readFloat();this.y=a.readFloat();this.z=a.readFloat()}
var RMath=new function(){this.PI=Math.PI;this.PI2=2*Math.PI;this.RADIAN_RATE=180/Math.PI;this.DEGREE_RATE=Math.PI/180;this.PERCENT_10=.1;this.PERCENT_100=.01;this.PERCENT_1000=.001;this.identity4x4=this.vectorBackward=this.vectorForward=this.vectorScale=this.vectorAxisZ=this.vectorAxisY=this.vectorAxisX=null;this.construct=RMath_construct;this.construct();return this};
function RMath_construct(){this.vectorAxisX=new SVector3(1,0,0);this.vectorAxisY=new SVector3(0,1,0);this.vectorAxisZ=new SVector3(0,0,1);this.vectorScale=new SVector3(1,1,1);this.vectorForward=new SVector3(0,0,1);this.vectorBackward=new SVector3(0,0,-1);this.identity4x4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}
function AEvent(a,b,e){AAnnotation.call(this,a);this._annotationCd=EAnnotation.Event;this._logger=this._inherit=!0;this._linker=b;this._handle=e;this._process=null;this.linker=AEvent_linker;this.handle=AEvent_handle;this.value=AEvent_value;this.create=AEvent_create;this.attach=RMethod.empty;this.bind=AEvent_bind;this.toString=AEvent_toString;return this}function AEvent_linker(){return this._linker}function AEvent_handle(){return this._handle}function AEvent_value(){return this._process}
function AEvent_create(){return new SEvent}function AEvent_bind(a,b){b?a.addEventListener(this._linker,REvent.ohEvent,!0):a[this._handle]=REvent.ohEvent}function AEvent_toString(){return"linker="+this._linker+",handle="+this._handle}function AEventBlur(a,b){AEvent.call(this,a,"blur","onblur");this.attach=AEventBlur_attach;return this}function AEventBlur_attach(a,b){}function AEventChange(a){AEvent.call(this,a,"change","onchange");this.attach=AEventChange_attach;return this}
function AEventChange_attach(a,b){}function AEventClick(a){AEvent.call(this,a,"click","onclick");this.attach=AEventClick_attach;return this}function AEventClick_attach(a,b){a.altKey=b.altKey;a.ctrlKey=b.ctrlKey;a.shiftKey=b.shiftKey}function AEventDoubleClick(a){AEvent.call(this,a,"dblclick","ondblclick");this.attach=AEventDoubleClick_attach;return this}function AEventDoubleClick_attach(a,b){a.altKey=b.altKey;a.ctrlKey=b.ctrlKey;a.shiftKey=b.shiftKey}
function AEventFocus(a){AEvent.call(this,a,"focus","onfocus");this.attach=AEventFocus_attach;return this}function AEventFocus_attach(a,b){}function AEventInputChanged(a){AEvent.call(this,a,"input","oninput");this.attach=AEventInputChanged_attach;this.bind=AEventInputChanged_bind;return this}function AEventInputChanged_attach(a,b){}function AEventInputChanged_bind(a,b){RBrowser.isBrowser(EBrowser.Explorer)?a.onpropertychange=REvent.ohEvent:a.addEventListener("input",REvent.ohEvent)}
function AEventKeyDown(a){AEvent.call(this,a,"keydown","onkeydown");this.attach=AEventKeyDown_attach;return this}function AEventKeyDown_attach(a,b){a.altKey=b.altKey;a.shiftKey=b.shiftKey;a.ctrlKey=b.ctrlKey;a.keyCode=b.keyCode}function AEventKeyPress(a){AEvent.call(this,a,"keypress","onkeypress");this.create=AEventKeyPress_create;this.attach=AEventKeyPress_attach;return this}function AEventKeyPress_create(){return new SKeyboardEvent}
function AEventKeyPress_attach(a,b){a.hEvent=b;a.attachEvent(b)}function AEventKeyUp(a){AEvent.call(this,a,"keyup","onkeyup");this.attach=AEventKeyUp_attach;return this}function AEventKeyUp_attach(a,b){a.altKey=b.altKey;a.shiftKey=b.shiftKey;a.ctrlKey=b.ctrlKey;a.keyCode=b.keyCode}function AEventLoad(a){AEvent.call(this,a,"load","onload");this.attach=AEventLoad_attach;return this}function AEventLoad_attach(a,b){}
function AEventMouse(a,b,e){AEvent.call(this,a,b,e);this.attach=AEventMouse_attach;return this}
function AEventMouse_attach(a,b){a.button=b.button;a.mouseLeft=b.button==EMouseButton.Left;a.mouseMiddle=b.button==EMouseButton.Middle;a.mouseRight=b.button==EMouseButton.Right;a.altKey=b.altKey;a.ctrlKey=b.ctrlKey;RBrowser.isBrowser(EBrowser.FireFox)?(a.x=b.pageX,a.y=b.pageY,a.offsetX=b.layerX,a.offsetY=b.layerY):(a.x=b.x,a.y=b.y,a.offsetX=b.offsetX,a.offsetY=b.offsetY);a.clientX=b.clientX;a.clientY=b.clientY}
function AEventMouseDown(a){AEventMouse.call(this,a,"mousedown","onmousedown");return this}function AEventMouseEnter(a){AEvent.call(this,a,"mouseenter","onmouseenter");this._logger=!1;this.attach=AEventMouseEnter_attach;return this}function AEventMouseEnter_attach(a,b){}function AEventMouseLeave(a){AEvent.call(this,a,"mouseleave","onmouseleave");this._logger=!1;this.attach=AEventMouseLeave_attach;return this}function AEventMouseLeave_attach(a,b){}
function AEventMouseMove(a){AEventMouse.call(this,a,"mousemove","onmousemove");this._logger=!1;return this}function AEventMouseOut(a){AEvent.call(this,a,"mouseout","onmouseout");this._y=this._x=this._ctrlKey=this._altKey=this._hSource=null;this.attach=AEventMouseOut_attach;return this}function AEventMouseOut_attach(a){this._hSource=a.srcElement;this._altKey=a.altKey;this._ctrlKey=a.ctrlKey;RBrowser.isBrowser(EBrowser.FireFox)?(this._x=a.pageX,this._y=a.pageY):(this._x=a.x,this._y=a.y)}
function AEventMouseOver(a){AEvent.call(this,a,"mouseover","onmouseover");this._y=this._x=this._ctrlKey=this._altKey=this._hSource=null;this.attach=AEventMouseOver_attach;return this}function AEventMouseOver_attach(a){this._hSource=a.srcElement;this._altKey=a.altKey;this._ctrlKey=a.ctrlKey;RBrowser.isBrowser(EBrowser.FireFox)?(this._x=a.pageX,this._y=a.pageY):(this._x=a.x,this._y=a.y)}function AEventMouseUp(a){AEventMouse.call(this,a,"mouseup","onmouseup");return this}
function AEventMouseWheel(a){AEvent.call(this,a,"mousewheel","onmousewheel");this.attach=AEventMouseWheel_attach;return this}function AEventMouseWheel_attach(a,b){a.altKey=b.altKey;a.ctrlKey=b.ctrlKey;a.delta=b.wheelDelta;RBrowser.isBrowser(EBrowser.FireFox)?(a.x=b.pageX,a.y=b.pageY):(a.x=b.x,a.y=b.y)}function AEventReadyStateChange(a){AEvent.call(this,a,"readystatechange","onreadystatechange");this.attach=AEventReadyStateChange_attach;return this}function AEventReadyStateChange_attach(a,b){}
function AEventResize(a){AEvent.call(this,a,"resize","onresize");this.attach=AEventResize_attach;return this}function AEventResize_attach(a,b){a.x=b.x;a.y=b.y}function AEventScroll(a){AEvent.call(this,a,"scroll","onscroll");this.attach=AEventScroll_attach;return this}function AEventScroll_attach(a,b){}function AEventTouchEnd(a){AEvent.call(this,a,"touchstart","ontouchstart");this.attach=AEventTouchEnd_attach;return this}function AEventTouchEnd_attach(a,b){}
function AEventTouchMove(a){AEvent.call(this,a,"touchstart","ontouchstart");this.attach=AEventTouchMove_attach;return this}function AEventTouchMove_attach(a,b){}function AEventTouchStart(a){AEvent.call(this,a,"touchstart","ontouchstart");this.attach=AEventTouchStart_attach;return this}function AEventTouchStart_attach(a,b){}
function AStyle(a,b){AAnnotation.call(this,a);this._annotationCd=EAnnotation.Style;this._duplicate=!0;this._style=b;this.code=AStyle_code;this.style=AStyle_style;this.build=AStyle_build;this.toString=AStyle_toString;if(null==b){var e=null;RString.startsWith(a,"_style")?e=a.substring(6):RString.startsWith(a,"style")&&(e=a.substring(5));if(null==e)throw new TError("Style name is empty.");this._style=e}return this}function AStyle_code(){return this._style}function AStyle_style(){return this._style}
function AStyle_build(a){a[this._name]=null}function AStyle_toString(){return"style="+this._style}
function AStyleIcon(a,b){AAnnotation.call(this,a);this._annotationCd=EAnnotation.Style;this._style=b;this.code=AStyleIcon_code;this.style=AStyleIcon_style;this.build=AStyleIcon_build;this.toString=AStyleIcon_toString;if(null==b){var e=null;RString.startsWith(a,"_style")?e=a.substring(6):RString.startsWith(a,"style")&&(e=a.substring(5));if(null==e)throw new TError("Style name is empty.");this._style=e}return this}function AStyleIcon_code(){return this._style}
function AStyleIcon_style(){return this._style}function AStyleIcon_build(a){a[this._name]=null}function AStyleIcon_toString(){return"style="+this._style}
var EBrowser=new function(){this.Unknown=0;this.Explorer=1;this.FireFox=2;this.Chrome=3;this.Safari=4;return this},EDataType=new function(){this.Unknown=0;this.Boolean=1;this.Int8=2;this.Int16=3;this.Int32=4;this.Int64=5;this.Uint8=6;this.Uint16=7;this.Uint32=8;this.Uint64=9;this.Float=10;this.Double=11;this.String=12;return this},EDevice=new function(){this.Unknown=0;this.Pc=1;this.Mobile=2;return this},EEvent=new function(){this.Unknown=0;this.Load=1;this.Process=2;this.EnterFrame=3;this.LeaveFrame=
4;this.Enter=5;this.Leave=6;this.Focus=7;this.Blur=8;this.Click=9;this.DoubleClick=10;this.ItemClick=11;this.Selected=12;this.DataChanged=13;return this},EHttpContent=new function(){this.Binary=1;this.Text=2;return this},EHttpMethod=new function(){this.Get="GET";this.Post="POST";return this},EHttpStatus=new function(){this.Begin=0;this.Build=1;this.Send=2;this.Receive=3;this.Finish=4;return this},EKeyCode=new function(){this.None=0;this.Esc=27;this.Tab=9;this.Enter=13;this.Shift=16;this.Alt=18;this.Ctrl=
17;this.BackSpace=8;this.Space=32;this.Left=37;this.Up=38;this.Right=39;this.Down=40;this.Insert=45;this.Delete=46;this.Home=36;this.End=35;this.PageUp=33;this.PageDown=34;this.F1=112;this.F2=113;this.F3=114;this.F4=115;this.F5=116;this.F6=117;this.F7=118;this.F8=119;this.F9=120;this.F10=121;this.F11=122;this.F12=123;this.N0=48;this.N1=49;this.N2=50;this.N3=51;this.N4=52;this.N5=53;this.N6=54;this.N7=55;this.N8=56;this.N9=57;this.A=65;this.B=66;this.C=67;this.D=68;this.E=69;this.F=70;this.G=71;this.H=
72;this.I=73;this.J=74;this.K=75;this.L=76;this.M=77;this.N=78;this.O=79;this.P=80;this.Q=81;this.R=82;this.S=83;this.T=84;this.U=85;this.V=86;this.W=87;this.X=88;this.Y=89;this.Z=90;this.ControlKeys=[this.Tab,this.Enter,this.BackSpace,this.Left,this.Up,this.Right,this.Down,this.Insert,this.Delete,this.Home,this.End,this.PageUp,this.PageDown,this.F1,this.F2,this.F3,this.F4,this.F5,this.F6,this.F7,this.F8,this.F9,this.F10,this.F11,this.F12];var a=this.integerCodes={};a[45]=!0;a[190]=!0;for(var b=this.N0;b<=
this.N9;b++)a[b]=!0;a=this.floatCodes={};a[45]=!0;a[190]=!0;a[46]=!0;a[189]=!0;for(b=this.N0;b<=this.N9;b++)a[b]=!0;return this},EKeyStatus=new function(){this.Normal=0;this.Press=1;return this},EMouseButton=new function(){this.Left=0;this.Right=2;this.Middle=3;return this},EMouseCursor=new function(){this.HSize="E-resize";this.VSize="N-resize";return this},EOrientation=new function(){this.Unknown=0;this.Horizontal="H";this.Vertical="V";return this},ESoftware=new function(){this.Unknown=0;this.Window=
1;this.Linux=2;this.Android=3;this.Apple=4;return this};function MClone(a){a=RClass.inherits(this,a);a.clone=MClone_clone;return a}function MClone_clone(){var a=RClass.create(this.constructor),b;for(b in this)v=this[b],null!=v&&(RClass.isBaseDataType(v.constructor)||(a[b]=v.clone())),a[b]=v;return a}
function MDataStream(a){a=RClass.inherits(this,a);a._viewer=null;a._endianCd=!1;a._position=0;a.readBoolean=FByteStream_readBoolean;a.readInt8=FByteStream_readInt8;a.readInt16=FByteStream_readInt16;a.readInt32=FByteStream_readInt32;a.readInt64=FByteStream_readInt64;a.readUint8=FByteStream_readUint8;a.readUint16=FByteStream_readUint16;a.readUint32=FByteStream_readUint32;a.readUint64=FByteStream_readUint64;a.readFloat=FByteStream_readFloat;a.readDouble=FByteStream_readDouble;a.readString=FByteStream_readString;
a.readBytes=FByteStream_readBytes;a.writeBoolean=FByteStream_writeBoolean;a.writeInt8=FByteStream_writeInt8;a.writeInt16=FByteStream_writeInt16;a.writeInt32=FByteStream_writeInt32;a.writeInt64=FByteStream_writeInt64;a.writeUint8=FByteStream_writeUint8;a.writeUint16=FByteStream_writeUint16;a.writeUint32=FByteStream_writeUint32;a.writeUint64=FByteStream_writeUint64;a.writeFloat=FByteStream_writeFloat;a.writeDouble=FByteStream_writeDouble;a.writeString=FByteStream_writeString;return a}
function FByteStream_readBoolean(){var a=this._viewer.getInt8(this._position,this._endianCd);this._position++;return 0<a}function FByteStream_readInt8(){var a=this._viewer.getInt8(this._position,this._endianCd);this._position++;return a}function FByteStream_readInt16(){var a=this._viewer.getInt16(this._position,this._endianCd);this._position+=2;return a}function FByteStream_readInt32(){var a=this._viewer.getInt32(this._position,this._endianCd);this._position+=4;return a}
function FByteStream_readInt64(){var a=this._viewer.getInt64(this._position,this._endianCd);this._position+=8;return a}function FByteStream_readUint8(){var a=this._viewer.getUint8(this._position,this._endianCd);this._position+=1;return a}function FByteStream_readUint16(){var a=this._viewer.getUint16(this._position,this._endianCd);this._position+=2;return a}function FByteStream_readUint32(){var a=this._viewer.getUint32(this._position,this._endianCd);this._position+=4;return a}
function FByteStream_readUint64(){var a=this._viewer.getUint64(this._position,this._endianCd);this._position+=8;return a}function FByteStream_readFloat(){var a=this._viewer.getFloat32(this._position,this._endianCd);this._position+=4;return a}function FByteStream_readDouble(){var a=this._viewer.getFloat64(this._position,this._endianCd);this._position+=8;return a}
function FByteStream_readString(){var a=this._viewer.getUint16(this._position,this._endianCd);this._position+=2;for(var b=new TString,e=0;e<a;e++){var f=this._viewer.getUint16(this._position,this._endianCd);this._position+=2;b.push(String.fromCharCode(f))}return b.toString()}
function FByteStream_readBytes(a,b,e){if(!(0>=e)){if(0!=b)throw new TError("Unsupport.");if(0==e%8)for(a=new Float64Array(a),e>>=3,b=0;b<e;b++)a[b]=this._viewer.getFloat64(this._position,this._endianCd),this._position+=8;else if(0==e%4)for(e>>=2,a=new Uint32Array(a),b=0;b<e;b++)a[b]=this._viewer.getUint32(this._position,this._endianCd),this._position+=4;else if(0==e%2)for(e>>=1,a=new Uint16Array(a),b=0;b<e;b++)a[b]=this._viewer.getUint16(this._position,this._endianCd),this._position+=2;else for(a=
new Uint8Array(a),b=0;b<e;b++)a[b]=this._viewer.getUint8(this._position++,this._endianCd)}}function FByteStream_writeBoolean(a){a=this._viewer.setInt8(this._position,0<a?1:0,this._endianCd);this._position++;return a}function FByteStream_writeInt8(a){a=this._viewer.setInt8(this._position,a,this._endianCd);this._position++;return a}function FByteStream_writeInt16(a){a=this._viewer.setInt16(this._position,a,this._endianCd);this._position+=2;return a}
function FByteStream_writeInt32(a){a=this._viewer.setInt32(this._position,a,this._endianCd);this._position+=4;return a}function FByteStream_writeInt64(a){a=this._viewer.setInt64(this._position,a,this._endianCd);this._position+=8;return a}function FByteStream_writeUint8(a){a=this._viewer.setUint8(this._position,a,this._endianCd);this._position+=1;return a}function FByteStream_writeUint16(a){a=this._viewer.setUint16(this._position,a,this._endianCd);this._position+=2;return a}
function FByteStream_writeUint32(a){a=this._viewer.setUint32(this._position,a,this._endianCd);this._position+=4;return a}function FByteStream_writeUint64(a){a=this._viewer.setUint64(this._position,a,this._endianCd);this._position+=8;return a}function FByteStream_writeFloat(a){a=this._viewer.setFloat32(this._position,a,this._endianCd);this._position+=4;return a}function FByteStream_writeDouble(a){a=this._viewer.setDouble(this._position,a,this._endianCd);this._position+=8;return a}
function FByteStream_writeString(a){var b=a.length;this._viewer.setUint16(this._position,b,this._endianCd);this._position+=2;for(var e=0;e<b;e++)this._viewer.setUint16(this._position,a.charCodeAt(e),this._endianCd),this._position+=2}
function MDataView(a){a=RClass.inherits(this,a);a._viewer=null;a._endianCd=0;a.endianCd=MDataView_endianCd;a.setEndianCd=MDataView_setEndianCd;a.getInt8=MDataView_getInt8;a.getInt16=MDataView_getInt16;a.getInt32=MDataView_getInt32;a.getInt64=MDataView_getInt64;a.getUint8=MDataView_getUint8;a.getUint16=MDataView_getUint16;a.getUint32=MDataView_getUint32;a.getUint64=MDataView_getUint64;a.getFloat=MDataView_getFloat;a.getDouble=MDataView_getDouble;a.setInt8=MDataView_setInt8;a.setInt16=MDataView_setInt16;
a.setInt32=MDataView_setInt32;a.setInt64=MDataView_setInt64;a.setUint8=MDataView_setUint8;a.setUint16=MDataView_setUint16;a.setUint32=MDataView_setUint32;a.setUint64=MDataView_setUint64;a.setFloat=MDataView_setFloat;a.setDouble=MDataView_setDouble;return a}function MDataView_endianCd(a){return this._endianCd}function MDataView_setEndianCd(a){this._endianCd=a}function MDataView_getInt8(a){return this._viewer.getInt8(a,this._endianCd)}
function MDataView_getInt16(a){return this._viewer.getInt16(a,this._endianCd)}function MDataView_getInt32(a){return this._viewer.getInt32(a,this._endianCd)}function MDataView_getInt64(a){return this._viewer.getInt64(a,this._endianCd)}function MDataView_getUint8(a){return this._viewer.getUint8(a,this._endianCd)}function MDataView_getUint16(a){return this._viewer.getUint16(a,this._endianCd)}function MDataView_getUint32(a){return this._viewer.getUint32(a,this._endianCd)}
function MDataView_getUint64(a){return this._viewer.getUint64(a,this._endianCd)}function MDataView_getFloat(a){return this._viewer.getFloat32(a,this._endianCd)}function MDataView_getDouble(a){return this._viewer.getFloat64(a,this._endianCd)}function MDataView_setInt8(a,b){this._viewer.setInt8(a,b,this._endianCd)}function MDataView_setInt16(a,b){this._viewer.setInt16(a,b,this._endianCd)}function MDataView_setInt32(a,b){this._viewer.setInt32(a,b,this._endianCd)}
function MDataView_setInt64(a,b){this._viewer.setInt64(a,b,this._endianCd)}function MDataView_setUint8(a,b){this._viewer.setUint8(a,b,this._endianCd)}function MDataView_setUint16(a,b){this._viewer.setUint16(a,b,this._endianCd)}function MDataView_setUint32(a,b){this._viewer.setUint32(a,b,this._endianCd)}function MDataView_setUint64(a,b){this._viewer.setUint64(a,b,this._endianCd)}function MDataView_setFloat(a,b){this._viewer.setFloat32(a,b,this._endianCd)}
function MDataView_setDouble(a,b){this._viewer.setDouble(a,b,this._endianCd)}function MListener(a){a=RClass.inherits(this,a);a._listeners=null;a.addListener=MListener_addListener;a.removeListener=MListener_removeListener;a.processListener=MListener_processListener;a.dispose=MListener_dispose;return a}function MListener_addListener(a,b,e){var f=this._listeners;f||(f=this._listeners=new TDictionary);var h=f.get(a);h||(h=new TListeners,f.set(a,h));return h.register(b,e)}
function MListener_removeListener(a,b,e){return this._listeners.get(a).unregister(b,e)}function MListener_processListener(a,b,e,f,h,k){var q=this._listeners;q&&(a=q.get(a))&&a.process(b,e,f,h,k)}function MListener_dispose(){var a=this._listeners;if(a){for(var b=a.count()-1;0<=b;b--)a.valueAt(b).dispose();this._listeners=RObject.dispose(a)}}
function MListenerLoad(a){a=RClass.inherits(this,a,MListener);a.addLoadListener=MListenerLoad_addLoadListener;a.removeLoadListener=MListenerLoad_removeLoadListener;a.processLoadListener=MListenerLoad_processLoadListener;return a}function MListenerLoad_addLoadListener(a,b){return this.addListener(EEvent.Load,a,b)}function MListenerLoad_removeLoadListener(a,b){this.removeListener(EEvent.Load,a,b)}function MListenerLoad_processLoadListener(a,b,e,f,h){this.processListener(EEvent.Load,a,b,e,f,h)}
function MListenerProcess(a){a=RClass.inherits(this,a,MListener);a.addProcessListener=MListenerProcess_addProcessListener;a.removeProcessListener=MListenerProcess_removeProcessListener;a.processProcessListener=MListenerProcess_processProcessListener;return a}function MListenerProcess_addProcessListener(a,b){return this.addListener(EEvent.Process,a,b)}function MListenerProcess_removeProcessListener(a,b){this.removeListener(EEvent.Process,a,b)}
function MListenerProcess_processProcessListener(a,b,e,f,h){this.processListener(EEvent.Process,a,b,e,f,h)}function MMouseCapture(a){a=RClass.inherits(this,a);a.onMouseCaptureStart=RMethod.virtual(a,"onMouseCaptureStart");a.onMouseCapture=RMethod.virtual(a,"onMouseCapture");a.onMouseCaptureStop=RMethod.virtual(a,"onMouseCaptureStop");a.testMouseCapture=RMethod.emptyTrue;return a}
function MMouseWheel(a){a=RClass.inherits(this,a);a.onMouseWheel=RClass.register(a,new AEventMouseWheel("onMouseWheel"),RMethod.empty);return a}function MProperty(a){a=RClass.inherits(this,a);a.propertyAssign=MProperty_propertyAssign;a.propertyLoad=MProperty_propertyLoad;a.propertySave=MProperty_propertySave;return a}
function MProperty_propertyAssign(a){var b=RClass.find(this.constructor).annotations(EAnnotation.Property),e;for(e in b){var f=b[e];f.constructor!=Function&&(this[f._name]=a[f._name])}}function MProperty_propertyLoad(a){var b=RClass.find(this.constructor).annotations(EAnnotation.Property),e;for(e in b){var f=b[e];f.constructor!=Function&&(f._force?f.load(this,a):a.contains(f._linker)?f.load(this,a):null==this[f._name]&&(this[f._name]=f._value))}}
function MProperty_propertySave(a){var b=RClass.find(this.constructor).annotations(EAnnotation.Property),e;for(e in b){var f=b[e];f.constructor!=Function&&f.save(this,a)}}function SEvent(){this.process=this.onProcess=this.ohProcess=this.hSource=this.hSender=this.hEvent=this.source=this.annotation=null;this.dispose=SEvent_dispose;return this}function SEvent_dispose(){for(var a in this)this[a]=null}
function SKeyboardEvent(){SEvent.call(this);this.ctrlKey=this.shiftKey=this.altKey=!1;this.keyCode=0;this.attachEvent=SKeyboardEvent_attachEvent;this.cancel=SKeyboardEvent_cancel;return this}function SKeyboardEvent_attachEvent(a){this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.ctrlKey=a.ctrlKey;this.keyCode=a.keyCode}function SKeyboardEvent_cancel(){this.hEvent.returnValue=!1}
function SMouseEvent(){SEvent.call(this);this.button=null;this.ctrlKey=this.altKey=this.mouseRight=this.mouseMiddle=this.mouseLeft=!1;this.clientY=this.clientX=this.offsetY=this.offsetX=this.y=this.x=0;this.attachEvent=SMouseEvent_attachEvent;return this}
function SMouseEvent_attachEvent(a){var b=this.hSource=RHtml.eventSource(a);b&&(this.source=b.__linker);this.button=a.button;this.mouseLeft=a.button==EMouseButton.Left;this.mouseMiddle=a.button==EMouseButton.Middle;this.mouseRight=a.button==EMouseButton.Right;this.altKey=a.altKey;this.ctrlKey=a.ctrlKey;RBrowser.isBrowser(EBrowser.FireFox)?(this.x=a.pageX,this.y=a.pageY,this.offsetX=a.layerX,this.offsetY=a.layerY):(this.x=a.x,this.y=a.y,this.offsetX=a.offsetX,this.offsetY=a.offsetY);this.clientX=a.clientX;
this.clientY=a.clientY}function SResizeEvent(){SEvent.call(this);this.height=this.width=null;this.attachEvent=SResizeEvent_attachEvent;return this}function SResizeEvent_attachEvent(a){if(a=this.hSource=RHtml.eventSource(a))this.source=a.__linker}function SServiceInfo(){this.url=this.action=this.service=null;return this}function SXmlEvent(){SEvent.call(this);this.root=this.document=this.connection=null;return this}
function TDumpItem(){this.link=this.hRow=this.hText=this.hTable=this.hDocument=this.hPanel=this.hParent=null;this.level=0;this.caption=null;this.children=[];this.items=[];this.display=this.innerDisplay=this.loaded=!1;this.create=TDumpItem_create;this.push=TDumpItem_push;this.innerShow=TDumpItem_innerShow;this.show=TDumpItem_show;return this}function TDumpItem_create(){return this.children[this.children.length]=new TDumpItem}function TDumpItem_push(a){this.items[this.items.length]=a}
function TDumpItem_innerShow(a){for(var b=this.items.length,e=0;e<b;e++)RHtml.visibleSet(this.items[e],a);b=this.children.length;for(e=0;e<b;e++){var f=this.children[e];RHtml.visibleSet(f.hRow,a);a?f.show(f.innerDisplay):(f.innerDisplay=f.display,f.show(!1))}}function TDumpItem_show(a){this.display=a;var b=RString.repeat("   ",this.level-1)+(a?" -":" +")+" "+this.caption;this.hText.innerHTML=RHtml.toHtml(b);this.innerShow(a)}
function THtmlItem(){this._link=null;this._links={};this.get=THtmlItem_get;this.set=THtmlItem_set;return this}function THtmlItem_get(a){return this._links[a]}function THtmlItem_set(a,b){this._links[a]=b}function TXmlDocument(){this._root=null;this.create=TXmlDocument_create;this.root=TXmlDocument_root;this.setRoot=TXmlDocument_setRoot;this.xml=TXmlDocument_xml;this.dump=TXmlDocument_dump;return this}
function TXmlDocument_create(a,b,e){var f=new TXmlNode;f._name=a;f._attributes=b;f._value=e;return f}function TXmlDocument_root(){var a=this._root;a||(a=this._root=new TXmlNode,a._name="Configuration");return a}function TXmlDocument_setRoot(a){if(this._root)throw new TError(this,"Root node is already exists.");this._root=a}function TXmlDocument_xml(){var a=new TString;a.append("<?xml version='1.0' encoding='UTF-8'?>");this.root().innerXml(a,0);return a.flush()}
function TXmlDocument_dump(){var a=new TString;a.appendLine(RClass.name(this));this.root().innerDump(a);return a.flush()}function TXmlNode(){TNode.call(this);this.create=TXmlNode_create;this.innerXml=TXmlNode_innerXml;this.xml=TXmlNode_xml;this.toString=TXmlNode_toString;return this}function TXmlNode_create(a,b){var e=new TXmlNode;e._name=a;e._attributes=b;if(!RClass.isClass(b,TAttributes)){b=arguments;var f=b.length;for(a=1;a<f;a+=2)a+1<f?e.set(b[a],b[a+1]):e._value=b[a]}this.push(e);return e}
function TXmlNode_innerXml(a,b){a.appendRepeat("   ",b);a.append("<",this._name);var e=this._attributes;if(e)for(var f=e.count(),h=0;h<f;h++)a.append(" ",e.name(h),'="'),RXml.buildText(a,e.value(h)),a.append('"');this._nodes||null!=this._value||a.append("/");a.append(">\n");if(e=this._nodes)for(f=e.count(),h=0;h<f;h++)e.get(h).innerXml(a,b+1);RXml.buildText(a,this._value);if(this._nodes||null!=this._value)a.appendRepeat("   ",b),a.append("</",this._name,">"),a.append("\n");return a}
function TXmlNode_xml(){var a=new TString;this.innerXml(a,0);return a.flush()}function TXmlNode_toString(){return this.xml().toString()}function FBytes(a){a=RClass.inherits(this,a,FObject,MDataView);a._memory=null;a.construct=FBytes_construct;a.dispose=FBytes_dispose;return a}function FBytes_construct(){this.__base.FObject.construct.call(this);this._memory=new ArrayBuffer;this._viewer=new DataView(this._memory)}
function FBytes_dispose(){this._viewer=this._memory=null;this.__base.FObject.dispose.call(this)}function FClassFactory(a){a=RClass.inherits(this,a,FObject);a._classes=null;a.construct=FClassFactory_construct;a.register=FClassFactory_register;a.unregister=FClassFactory_unregister;a.create=FClassFactory_create;a.dispose=FClassFactory_dispose;return a}function FClassFactory_construct(){this.__base.FObject.construct.call(this);this._classes=new TDictionary}
function FClassFactory_register(a,b){this._classes.set(a,b)}function FClassFactory_unregister(a){this._classes.set(a,null)}function FClassFactory_create(a){var b=this._classes.get(a);if(!b)throw new TError("Create unregister class. (name={1})",a);return RClass.create(b)}function FClassFactory_dispose(){this._classes=RObject.dispose(this._classes);this.__base.FObject.dispose.call(this)}
function FDataStream(a){a=RClass.inherits(this,a,FObject,MDataView,MDataStream);a._length=0;a._memory=null;a._viewer=null;a.construct=FDataStream_construct;a.length=FDataStream_length;a.setLength=FDataStream_setLength;a.memory=FDataStream_memory;a.dispose=FDataStream_dispose;return a}function FDataStream_construct(){this.__base.FObject.construct.call(this)}function FDataStream_length(){return this._length}
function FDataStream_setLength(a){this._length=a;this._memory=new ArrayBuffer(a);this._viewer=new DataView(this._memory)}function FDataStream_memory(){return this._memory}function FDataStream_dispose(){this._memory=this._viewer=null;this.__base.FObject.dispose.call(this)}function FDataView(a){a=RClass.inherits(this,a,FObject,MDataView,MDataStream);a.link=FDataView_link;a.dispose=FDataView_dispose;return a}function FDataView_link(a){this._memory=a;this._viewer=new DataView(a)}
function FDataView_dispose(){this._memory=this._viewer=null;this.__base.FObject.dispose.call(this)}
function FHttpConnection(a){a=RClass.inherits(this,a,FObject);a._asynchronous=!1;a._methodCd=EHttpMethod.Get;a._contentCd=EHttpContent.Binary;a._url=null;a._input=null;a._inputData=null;a._output=null;a._outputData=null;a._connection=null;a._contentLength=0;a._statusFree=!0;a.lsnsLoad=null;a.onConnectionSend=FHttpConnection_onConnectionSend;a.onConnectionReady=FHttpConnection_onConnectionReady;a.onConnectionComplete=FHttpConnection_onConnectionComplete;a.construct=FHttpConnection_construct;a.setHeaders=
FHttpConnection_setHeaders;a.inputData=FHttpConnection_inputData;a.setInputData=FHttpConnection_setInputData;a.outputData=FHttpConnection_outputData;a.setOutputData=FHttpConnection_setOutputData;a.content=FHttpConnection_content;a.sendSync=FHttpConnection_sendSync;a.sendAsync=FHttpConnection_sendAsync;a.send=FHttpConnection_send;return a}function FHttpConnection_onConnectionSend(){this._inputData&&(this._contentLength=this._inputData.length)}
function FHttpConnection_onConnectionReady(){var a=this._linker;if(a._asynchronous){var b=a._connection;if(b.readyState==EHttpStatus.Finish)if(200==b.status)a.setOutputData(),a.onConnectionComplete();else throw new TError(a,"Connection failure. (url={1})",a._url);}}function FHttpConnection_onConnectionComplete(){this._statusFree=!0;this.lsnsLoad.process(this)}
function FHttpConnection_construct(){this.lsnsLoad=new TListeners;var a=this._connection=RXml.createConnection();a._linker=this;a.onreadystatechange=this.onConnectionReady}
function FHttpConnection_setHeaders(){var a=this._connection;this._contentCd==EHttpContent.Binary?RBrowser.isBrowser(EBrowser.Explorer)?(a.setRequestHeader("Accept-Charset","x-user-defined"),a.responseType="arraybuffer"):(a.overrideMimeType("text/plain; charset=x-user-defined"),this._asynchronous&&(a.responseType="arraybuffer")):a.setRequestHeader("content-type","application/x-www-form-urlencoded");RBrowser.isBrowser(EBrowser.Chrome)||0<this._contentLength&&a.setRequestHeader("content-length",this._contentLength)}
function FHttpConnection_inputData(){return this._inputData}function FHttpConnection_setInputData(a){this._inputData=a}function FHttpConnection_outputData(){return this._outputData}function FHttpConnection_setOutputData(){var a=this._connection;this._contentCd==EHttpContent.Binary?(RBrowser.isBrowser(EBrowser.Chrome),this._outputData=a.response):this._outputData=a.responseText}function FHttpConnection_content(){return this._outputData}
function FHttpConnection_sendSync(){var a=this._connection;a.open(this._methodCd,this._url,!1);this.setHeaders(a,0);a.send(this._inputData);this.setOutputData();this.onConnectionComplete();RLogger.info(this,"Send http sync request. (method={1}, url={2})",this._methodCd,this._url)}
function FHttpConnection_sendAsync(){var a=this._connection;a.open(this._methodCd,this._url,!0);this.setHeaders(a,0);a.send(this._inputData);RLogger.info(this,"Send http asynchronous request. (method={1}, url={2})",this._methodCd,this._url)}function FHttpConnection_send(a,b){this._url=a;this._input=b;this._methodCd=null!=b?EHttpMethod.Post:EHttpMethod.Get;this._statusFree=!1;this.onConnectionSend();this._asynchronous?this.sendAsync():this.sendSync();return this.content()}
function FImage(a){a=RClass.inherits(this,a,FObject,MListenerLoad);a._optionAlpha=!0;a._ready=!1;a._size=null;a._url=null;a._hImage=null;a.ohLoad=FImage_ohLoad;a.ohError=FImage_ohError;a.construct=FImage_construct;a.optionAlpha=FImage_optionAlpha;a.setOptionAlpha=FImage_setOptionAlpha;a.size=FImage_size;a.image=FImage_image;a.url=FImage_url;a.testReady=FImage_testReady;a.loadUrl=FImage_loadUrl;a.dispose=FImage_dispose;return a}
function FImage_ohLoad(){var a=this.__linker,b=a._hImage;a._size.set(b.naturalWidth,b.naturalHeight);a._ready=!0;a.processLoadListener(a)}function FImage_ohError(a){debugger}function FImage_construct(){this.__base.FObject.construct.call(this);this._size=new SSize2}function FImage_optionAlpha(){return this._optionAlpha}function FImage_setOptionAlpha(a){this._optionAlpha=a}function FImage_size(){return this._size}function FImage_image(){return this._hImage}function FImage_url(){return this._url}
function FImage_testReady(){return this._ready}function FImage_loadUrl(a){this._url=a;var b=this._hImage;b||(b=this._hImage=new Image,b.__linker=this,b.onload=this.ohLoad,b.onerror=this.ohError);b.src=a}function FImage_dispose(){this._size=RObject.dispose(this._size);this._hImage=RHtml.free(this._hImage);this.__base.MListenerLoad.dispose.call(this);this.__base.FObject.dispose.call(this)}
function FXmlConnection(a){a=RClass.inherits(this,a,FHttpConnection);a._contentCd=EHttpContent.Text;a._inputNode=null;a._outputNode=null;a.onConnectionSend=FXmlConnection_onConnectionSend;a.onConnectionComplete=FXmlConnection_onConnectionComplete;a.content=FXmlConnection_content;return a}
function FXmlConnection_onConnectionSend(){var a=this._input;if(a){var b=null;if(a.constructor==String)b=a,this._inputNode=null;else if(a.constructor==TXmlNode)b=new TXmlDocument,b.setRoot(a),b=b.xml(),this._inputNode=a;else if(a.constructor==TXmlDocument)b=a.xml(),this._inputNode=a.root();else throw new TError("Unknown send data type.");this._inputData=b;this._contentLength=b.length}}
function FXmlConnection_onConnectionComplete(){var a=this._connection,b=null;if(a.responseXML)b=a.responseXML.documentElement;else if(a.responseXml)b=a.responseXml.documentElement;else throw new TError(this,"Fetch xml data failure.");if(!b)return RMessage.fatal(this,null,"Read xml error. (url={1})\n{2}",this._url,a._outputText);a=new TXmlDocument;RXml.buildNode(a,null,b);var e=this._outputNode=a.root();this._statusFree=!0;b=new SXmlEvent;b.connection=this;b.document=a;b.root=e;b.parameters=this._parameters;
this.lsnsLoad.process(b);b.dispose();this._asynchronous&&(this._parameters=this._outputNode=this._output=this._inputNode=this._input=null)}function FXmlConnection_content(){return this._outputNode}
var RDump=new function(){this.LINE_SINGLE="------------------------------";this.LINE_DOUBLE="==============================";this.LINE_DOT="..............................";this.LINE_STAR="******************************";this.onclick=RDump_onclick;this.nameInfo=RDump_nameInfo;this.typeInfo=RDump_typeInfo;this.dumpInner=RDump_dumpInner;this.dump=RDump_dump;this.appendLevel=RDump_appendLevel;this.stack=RDump_stack;return this};
function RDump_onclick(){var a=this.link;this.link&&(a.loaded?a.show(!a.display):(RDump.dumpInner(this.link),a.loaded=!0,a.show(!0)))}function RDump_nameInfo(a){switch(RClass.typeOf(a)){case "Unknown":return"@unknown";case "Function":return RMethod.name(a)+"@Function";case "Array":return"@<Array>"}return a}
function RDump_typeInfo(a,b){if(null==a)return"null";switch(b){case "Unknown":return"unknown";case "Undefined":return"undefined";case "Boolean":case "Number":return a.toString();case "String":return a.length+":'"+RString.toLine(a)+"'";case "Function":return a.__virtual?"virtual":RMethod.name(a,!0);case "Array":return"@<Array@"+RClass.code(a)+"> length="+a.length;case "Html":return"@<"+a.tagName+">";default:if(a.constructor==TClass)return"@<"+a.name+"@"+RClass.code(a)+">";if(a.constructor==Function)return"@"+
a.toString();try{for(var e in a)return"@<Object@"+RClass.code(a)+">"}catch(f){}return"<Object@"+RClass.code(a)+">"}}
function RDump_dumpInner(a){var b=a.hTable,e=a.hRow,f=a.level,h=a.link,k=RClass.typeOf(h,!0),q=h.__class,t=[],u;for(u in h)t[t.length]=u;RString.endsWith(k,"Array")?RArray.reverse(t,0,t.length-1):RArray.sort(t,!0);var x=t.length;2E3<x&&(x=2E3);for(var z=0;z<x;z++){u=t[z];var y=h[u];RClass.safeTypeOf(y,!0);var k=RClass.safeTypeOf(y,!0),A=null,E=!0;if(q){var B=q.attributeFind(u);B&&(k="Annotation<"+RMethod.name(B.constructor)+">",A=y&&y.constructor==Function?"<FONT color='green'>"+RMethod.name(y)+"</FONT>":
y+"<FONT color='green'> - ("+RHtml.toHtml(B.toString())+")</FONT>",E=!1)}null==A&&(A=this.typeInfo(y,k));var B=null,D=RBuilder.appendTableRow(b,null,e?e.rowIndex+1:0);D.bgColor="#FFFFFF";RString.startsWith(A,"@")?(D.style.cursor="pointer",D.onclick=this.onclick,D.bgColor="#FFF0E0",B=D.link=a.create(),B.link=y,B.level=f,B.caption=u,B.hTable=b,B.level=f+1,B.hRow=D):a.push(D);"Function"==k&&"virtual"==A&&(D.bgColor="#E0F0FF");var y=RBuilder.appendTableCell(D),C=RString.startsWith(A,"@")?" +":"  ";u=
RString.repeat("   ",f)+C+" "+u;y.innerHTML=RHtml.toHtml(u);y.style.borderBottom="1px solid #F0F0F0";y.width="240px";B&&(B.hText=y);y=RBuilder.appendTableCell(D);y.innerHTML=RHtml.toHtml(k);y.style.borderBottom="1px solid #F0F0F0";y.style.color="Function"==k?"#3333FF":"#FF3333";y.width="200px";y=RBuilder.appendTableCell(D);RString.startsWith(A,"@")&&(A=A.substr(1));y.innerHTML=E?RHtml.toHtml(A):A;y.style.borderBottom="1px solid #F0F0F0"}b.width="100%"}
function RDump_dump(a,b){b||(b=RBuilder.append(null,"DIV"));var e=new TString;e.append("<",RClass.safeTypeOf(a));a&&a.tagName&&e.append(" - ",a.tagName);e.appendLine("@"+RClass.code(a)+">");var f=RBuilder.append(b,"DIV");f.style.border="1px solid #BBBBBB";f.style.backgroundColor="#E0E0EB";var h=RBuilder.appendTable(f,null,null,0,1,0),k=RBuilder.appendTableRow(h),k=RBuilder.appendTableCell(k);h.width="100%";k.style.padding=2;k.style.borderBottom="1px solid gray";k.style.backgroundColor="#E0E0EB";RHtml.textSet(k,
e.toString());e=RBuilder.appendTable(f,null,null,0,1,0);e.style.width="100%";f=new TDumpItem;f.hTable=e;f.hRow=null;f.hParent=b;f.link=a;f.level=0;this.dumpInner(f)}function RDump_appendLevel(a,b){for(var e=0;e<b;e++)a.append("   ")}function RDump_stack(){for(var a=RDump_stack.caller,b=new TString;a;)b.append(RMethod.name(a)),(a=a.caller)&&b.appendLine();RLogger.debug(this,b)}
var REngine=new function(){this._spaces={};this.Global={};this.Top={};this.Local={};this.onRelease=REngine_onRelease;this.register=REngine_register;this.initialize=REngine_initialize;this.connect=REngine_connect;this.buildSpace=REngine_buildSpace;this.find=REngine_find;this.findGlobal=REngine_findGlobal;this.findTop=REngine_findTop;this.findLocal=REngine_findLocal;return this};function REngine_onRelease(){RConsole.release();REvent.release();CollectGarbage()}
function REngine_register(a){var b=this._spaces[a.space];b||(b=this._spaces[a.space]={});b[a.name]=a}function REngine_initialize(){RConsole.initialize()}function REngine_connect(){RConsole.initialize()}function REngine_buildSpace(a,b){for(var e in b)RString.startsWith(e,"R")&&(a[e.substring(1)]=b[e].instance)}function REngine_find(a,b){var e=null;if(a=this._spaces[a])if(e=a[b])return e.instance;return null}function REngine_findGlobal(a){return this.find(ESpace.Global,a)}
function REngine_findTop(a){return top.REngine.find(ESpace.Top,a)}function REngine_findLocal(a){return this.find(ESpace.Local,a)}
var RHtml=new function(){this._nextUid=1;this._links={};this._clientPosition=new SPoint2;this.uid=RHtml_uid;this.fullscreen=RHtml_fullscreen;this.displayGet=RHtml_displayGet;this.displaySet=RHtml_displaySet;this.visibleGet=RHtml_visibleGet;this.visibleSet=RHtml_visibleSet;this.textGet=RHtml_textGet;this.textSet=RHtml_textSet;this.checkGet=RHtml_checkGet;this.checkSet=RHtml_checkSet;this.radioGet=RHtml_radioGet;this.radioSet=RHtml_radioSet;this.linkGet=RHtml_linkGet;this.linkSet=RHtml_linkSet;this.clientPosition=
RHtml_clientPosition;this.clientX=RHtml_clientX;this.clientY=RHtml_clientY;this.setSize=RHtml_setSize;this.toText=RHtml_toText;this.toHtml=RHtml_toHtml;this.eventSource=RHtml_eventSource;this.searchLinker=RHtml_searchLinker;this.searchObject=RHtml_searchObject;this.free=RHtml_free;this.offsetPosition=RHtml_offsetPosition;this.offsetX=RHtml_offsetX;this.offsetY=RHtml_offsetY;this.scrollWidth=RHtml_scrollWidth;this.scrollHeight=RHtml_scrollHeight;this.radioSet=RHtml_radioSet;this.point=RHtml_point;
this.toPoint=RHtml_toPoint;this.rect=RHtml_rect;this.toRect=RHtml_toRect;this.top=RHtml_top;this.clientRect=RHtml_clientRect;this.offsetRect=RHtml_offsetRect;this.changeWidth=RHtml_changeWidth;this.clear=RHtml_clear;this.setRect=RHtml_setRect;this.setBounds=RHtml_setBounds;this.setPixelRect=RHtml_setPixelRect;this.setPixelBounds=RHtml_setPixelBounds;this.showNodes=RHtml_showNodes;this.hideNodes=RHtml_hideNodes;this.showChildren=RHtml_showChildren;this.hideChildren=RHtml_hideChildren;this.get=RHtml_get;
this.parent=RHtml_parent;this.posParent=RHtml_posParent;this.form=RHtml_form;this.popup=RHtml_popup;this.bodyWidth=RHtml_bodyWidth;this.bodyHeight=RHtml_bodyHeight;this.frameHeight=RHtml_frameHeight;this.selectText=RHtml_selectText;this.currentStyle=RHtml_currentStyle;this.tableMoveRow=RHtml_tableMoveRow;this.clone=RHtml_clone;return this};function RHtml_uid(a){var b=a.__puuid;null==b&&(b=a.__puuid=RHtml._nextUid++);return b}
function RHtml_fullscreen(a,b){b?a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen():a.exitFullscreen?a.exitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitCancelFullScreen&&a.webkitCancelFullScreen()}function RHtml_displayGet(a){var b=null;a=a.style.display;return b=RBrowser.isBrowser(EBrowser.Explorer)?"inline"==a:"none"!=a}
function RHtml_displaySet(a,b){var e=null,e=RBrowser.isBrowser(EBrowser.Explorer)?b?"inline":"none":b?null:"none";a.style.display=e}function RHtml_visibleGet(a){var b=null;a=a.style.display;return b=RBrowser.isBrowser(EBrowser.Explorer)?"block"==a:"none"!=a}function RHtml_visibleSet(a,b){var e=null,e=RBrowser.isBrowser(EBrowser.Explorer)?b?"":"none":b?null:"none";a.style.display=e}function RHtml_textGet(a,b){var e=null;return e=RBrowser.isBrowser(EBrowser.FireFox)?a.textContent:a.innerText}
function RHtml_textSet(a,b){RBrowser.isBrowser(EBrowser.FireFox)?a.textContent=b:a.innerText=b}function RHtml_checkGet(a){return RBool.toString(a.checked)}function RHtml_checkSet(a,b){a.checked=RBool.isTrue(b)}function RHtml_radioGet(a){if(a)for(var b=a.length,e=0;e<b;e++){var f=a[e];if(f.checked)return f.value}return null}function RHtml_radioSet(a,b){if(a)for(var e=a.length,f=0;f<e;f++){var h=a[f];if(h.value==b){h.checked=!0;break}}}
function RHtml_linkGet(a,b){var e=this.uid(a);return(e=this._links[e])?e.get(b):null}function RHtml_linkSet(a,b,e){var f=this._links,h=this.uid(a),k=f[h];k||(k=f[h]=new THtmlItem,k._link=a);k.set(b,e)}function RHtml_clientPosition(a,b){var e=this._clientPosition;for(e.set(0,0);a!=b;)e.x+=a.offsetLeft+a.clientLeft-a.scrollLeft,e.y+=a.offsetTop+a.clientTop-a.scrollTop,a=a.offsetParent;return e}function RHtml_clientX(a,b){for(var e=0;a!=b;)e+=a.offsetLeft-a.scrollLeft,a=a.offsetParent;return e}
function RHtml_clientY(a,b){for(var e=0;a!=b;)e+=a.offsetTop-a.scrollTop,a=a.offsetParent;return e}function RHtml_setSize(a,b){b.width&&(a.style.width=b.width+"px");b.height&&(a.style.height=b.height+"px")}function RHtml_toText(a){null!=a&&(a=a.toString(),a=a.replace(/&lt;/,"<"),a=a.replace(/&gt;/g,">"),a=a.replace(/&nbsp;/g," "),a=a.replace(/<BR>/g,"\n"));return a}
function RHtml_toHtml(a){null!=a&&(a=a.toString(),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/ /g,"&nbsp;"),a=a.replace(/\n/g,"<BR>"),a=a.replace(/\\n/g,"<BR>"),a=a.replace(/\r/g,""),a=a.replace(/\\r/g,""));return a}function RHtml_eventSource(a){return a.srcElement?a.srcElement:a.target}function RHtml_searchLinker(a,b){for(;a;){var e=a.__linker;if(e&&RClass.isClass(e,b))return e;a=a.parentElement}return null}
function RHtml_searchObject(a,b){for(;a;){var e=a[b];if(e)return e;a=a.parentElement}return null}function RHtml_free(a){return null}function RHtml_clone(a,b,e){e||(e=b.cloneNode(!0));b._pname&&(a[b._pname]=e);b._ptyName&&(a[b._ptyName]=e);var f=REvent.find(b).events;e._psource=b;for(var h in f)e[f[h].handle]=b[f[h].handle],e[f[h].handle]&&RHtml.link(e,"_plink",a);b=b.children;for(h=b.length;0<=--h;)RHtml_clone(a,b[h],e.children[h]);return e}
function RHtml_offsetPosition(a,b){for(var e=new TPoint;a!=b;)e.x+=a.offsetLeft-a.scrollLeft,e.y+=a.offsetTop-a.scrollTop,RHtml.currentStyle(a),e.x+=a.clientLeft,e.y+=a.clientTop,a=a.offsetParent;return e}function RHtml_offsetX(a){for(var b=0;a;)b+=a.offsetLeft,a=a.offsetParent;return b}function RHtml_offsetY(a){for(var b=0;a;)b+=a.offsetTop,a=a.offsetParent;return b}function RHtml_bodyWidth(a){return a.all?a.body.scrollWidth:a.documentElement.scrollWidth}
function RHtml_bodyHeight(a){return a.all?a.body.scrollHeight:a.documentElement.scrollHeight}function RHtml_frameHeight(a){a=a.contentWindow.document;return Math.max(a.body.scrollHeight,a.documentElement.scrollHeight)}function RHtml_scrollWidth(a){var b=0;a.offsetWidth&&(b+=a.offsetWidth);a.borderTopWidth&&(b-=parseInt(a.borderLeftWidth));a.borderBottomWidth&&(b-=parseInt(a.borderRightWidth));a.clientWidth&&(b-=a.clientWidth);return b}
function RHtml_scrollHeight(a){var b=0;a.offsetHeight&&(b+=a.offsetHeight);a.borderTopWidth&&(b-=parseInt(a.borderTopWidth));a.borderBottomWidth&&(b-=parseInt(a.borderBottomWidth));a.clientHeight&&(b-=a.clientHeight);return b}function RHtml_currentStyle(a){return a.currentStyle?a.currentStyle:window.getComputedStyle(a,null)}function RHtml_point(a,b){return this.toPoint(new TPoint,a,b)}
function RHtml_toPoint(a,b,e){if(a&&b){e=RObject.nvl(e,window.document.body);var f=RHtml.currentStyle(b);a.x=-RInt.parse(f.borderLeftWidth);for(a.y=-RInt.parse(f.borderTopWidth);b&&b!=e;)a.x+=b.offsetLeft-b.scrollLeft,a.y+=b.offsetTop-b.scrollTop,"absolute"!=RHtml.currentStyle(b).position&&(a.x+=b.clientLeft,a.y+=b.clientTop),b=b.offsetParent}return a}function RHtml_rect(a,b){return this.toRect(new TRect,a,b)}
function RHtml_toRect(a,b,e){if(a&&b){e=RObject.nvl(e,window.document.body);var f=RHtml.currentStyle(b);a.left=-RInt.parse(f.borderLeftWidth);a.top=-RInt.parse(f.borderTopWidth);for(var f=b.offsetWidth,f=b.offsetWidth-1,h=b.offsetHeight,h=b.offsetHeight-1;b&&b!=e;)a.left+=b.offsetLeft-b.scrollLeft,a.top+=b.offsetTop-b.scrollTop,"absolute"!=RHtml.currentStyle(b).position&&(a.left+=b.clientLeft,a.top+=b.clientTop),b=b.offsetParent;a.right=a.left+f;a.bottom=a.top+h}return a}
function RHtml_top(a){var b=0;if(a)for(b=RHtml.currentStyle(o),b=-RInteger.parse(b.borderTopWidth);a;)b+=a.offsetTop-a.scrollTop,"absolute"!=RHtml.currentStyle(o).position&&(b+=a.clientTop),a=a.offsetParent;return b}function RHtml_clientRect(a){if(a){for(var b=0,e=0,f=a.offsetWidth-1,h=a.offsetHeight-1;a;)b+=a.offsetLeft,e+=a.offsetTop,a=a.offsetParent;return new TRect(b,e,b+f,e+h)}return null}
function RHtml_offsetRect(a){if(a){for(var b=0,e=0,f=a.offsetWidth-1,h=a.offsetHeight-1;a;)b+=a.offsetLeft+a.clientLeft,e+=a.offsetTop+a.clientTop,a=a.offsetParent;return new TRect(b,e,b+f,e+h)}return null}function RHtml_clear(a){if(a){var b=a.children;if(b&&b.length)for(var e=b.length-1;0<=e;e--){var f=b[e];f.children&&f.children.length&&this.clear(f);a.removeChild(f)}}}function RHtml_setRect(a,b){if(a&&a.style){var e=a.style;e.left=b.left;e.top=b.top;e.width=b.width();e.height=b.height()}}
function RHtml_setBounds(a,b,e,f,h){a&&a.style&&(a=a.style,null!=b&&(a.left=b),null!=e&&(a.top=e),null!=f&&(a.width=f),null!=h&&(a.height=h))}function RHtml_setPixelRect(a,b){if(a&&a.style){var e=a.style;e.pixelLeft=b.left;e.pixelTop=b.top;e.pixelWidth=b.width();e.pixelHeight=b.height()}}function RHtml_setPixelBounds(a,b,e,f,h){a&&a.style&&(a=a.style,null!=b&&(a.pixelLeft=b),null!=e&&(a.pixelTop=e),null!=f&&(a.pixelWidth=f),null!=h&&(a.pixelHeight=h))}
function RHtml_changeWidth(a,b){if(a&&b){var e=RHtml.currentStyle(b),e=parseInt(e.paddingLeft)+parseInt(e.paddingRight);b.style.pixelWidth=a.offsetWidth-e}}function RHtml_showNodes(a,b){if(a&&a.childNodes)for(var e=0;e<a.childNodes.length;e++){var f=a.childNodes(e);f.tagName&&f.style?f.style.display="block":"#text"==f.nodeName&&(f.nodeValue=b[e])}}
function RHtml_hideNodes(a,b){if(a&&a.childNodes)for(var e=0;e<a.childNodes.length;e++){var f=a.childNodes(e);f.tagName&&f.style?f.style.display="none":"#text"==f.nodeName&&(b[e]=f.nodeValue,f.nodeValue="")}}function RHtml_showChildren(a){if(a&&a.children)for(var b=0;b<a.children.length;b++){var e=a.children(b);e.tagName&&e.style&&(e.style.display="block")}}
function RHtml_hideChildren(a){if(a&&a.children)for(var b=0;b<a.children.length;b++){var e=a.children(b);e.tagName&&e.style&&(e.style.display="none")}}function RHtml_get(a){return document.getElementById(a)}function RHtml_parent(a,b){if(a&&b)for(b=b.toLowerCase();a;){if(a.tagName.toLowerCase()==b)return a;a=a.parentElement}return null}function RHtml_posParent(a){for(;a;){if("visible"!=a.currentStyle.overflow)return a;a=a.offsetParent}return null}
function RHtml_form(a){if(a){var b=this.parent(a,"FORM");return b?b:a.ownerDocument.forms[0]}return window.document.forms[0]}function RHtml_popup(a,b,e){b=RString.format("left={0},top={1},width={2},height={3},toolbar=no,location=no,directories=no,status=no,menubar=no,resizable=yes,scrollbars=yes,dependent=yes",(screen.width-b)/2,(screen.height-e)/2-20,b,e);window.open(a,"_blank",b)}function RHtml_selectText(){document.getElementById(id).select();return document.selection.createRange().text}
function getTRNode(a,b){for(;(a=a[b])&&"TR"!=a.tagName;);return a}function RHtml_tableMoveRow(a,b,e){if("TABLE"!=a.tagName||b==e)return!1;if(a.moveRow)a.moveRow(b,e);else{a=a.getElementsByTagName("tbody")[0];var f=a.rows[b],h=a.rows[e];if(null==f||null==h)return!1;var k=null;if(b<=e)for(k=h;(k=k.nextSibling)&&"TR"!=k.tagName;);null==k?a.insertBefore(f,h):null==k?a.appendChild(f):a.insertBefore(f,k)}return!0}
var RKeyboard=new function(){this._status=[];this.onKeyDown=RKeyboard_onKeyDown;this.onKeyUp=RKeyboard_onKeyUp;this.construct=RKeyboard_construct;this.isControlKey=RKeyboard_isControlKey;this.isIntegerKey=RKeyboard_isIntegerKey;this.isFloatKey=RKeyboard_isFloatKey;this.isNumKey=RKeyboard_isNumKey;this.isPress=RKeyboard_isPress;this.fixCase=RKeyboard_fixCase;this.fixPattern=RKeyboard_fixPattern;this.fixChars=RKeyboard_fixChars;return this};
function RKeyboard_onKeyDown(a){this._status[a.keyCode]=EKeyStatus.Press}function RKeyboard_onKeyUp(a){this._status[a.keyCode]=EKeyStatus.Normal}function RKeyboard_construct(){for(var a=this._status,b=0;256>b;b++)a[b]=EKeyStatus.Normal;RWindow.lsnsKeyDown.register(this,this.onKeyDown);RWindow.lsnsKeyUp.register(this,this.onKeyUp)}function RKeyboard_isControlKey(a){for(var b=EKeyCode.ControlKeys,e=b.length-1;0<=e;e--)if(b[e]==a)return!0;return!1}
function RKeyboard_isIntegerKey(a){return EKeyCode.integerCodes[a]}function RKeyboard_isFloatKey(a){return EKeyCode.floatCodes[a]}function RKeyboard_isNumKey(a){return 96<=p&&105>=p?!0:!1}function RKeyboard_isPress(a){return this._status[a]==EKeyStatus.Press}function RKeyboard_fixCase(a,b){if(a&&b){var e=a.keyCode;ECase.Upper==b?e=String.fromCharCode(e).toUpperCase().charCodeAt(0):ECase.Lower==b&&(e=String.fromCharCode(e).toLowerCase().charCodeAt(0));a.keyCode=e}}
function RKeyboard_fixPattern(a,b){if(b){var e=a.keyCode;if(!this.isControlKeyPress(e)&&!RString.isPattern(String.fromCharCode(e),b))return a.keyCode=0,!1}return!0}function RKeyboard_fixChars(a,b){if(b){var e=a.keyCode;this.isNumKey(e)&&(e=a.keyCode-=48);if(!this.isControlKeyPress(e)&&!RString.inChars(String.fromCharCode(e),b))return a.keyCode=0,a.returnValue=!1}return!0}
var RLoader=new function(){this._loading=new TArray;this._loaded=new TArray;this._waits=new TArray;this.hWindow=this._intervalId=null;this.onInterval=RLoader_onInterval;this.intervalStart=RLoader_intervalStart;this.intervalStop=RLoader_intervalStop;this.loadJsFile=RLoader_loadJsFile;this.loadJs=RLoader_loadJs;this.loaded=RLoader_loaded;this.wait=RLoader_wait;this.waitJs=RLoader_waitJs;this.dispose=RLoader_dispose;return this};function RLoader_dispose(){this.intervalStop();this.hWindow=null}
function RLoader_onInterval(){for(var a=this._waits,b=a.length,e=0;e<b;e++){var f=a.get(e);f&&f.check(this._loaded)&&(f.invoke.invoke(),a.set(e,null))}a.compress();a.isEmpty()&&this.intervalStop()}function RLoader_intervalStart(){var a=this;a._intervalId||(a.hWindow=window,a._intervalId=window.setInterval(function(){a.onInterval()},10))}function RLoader_intervalStop(){var a=this.hWindow;a&&this._intervalId&&(a.clearInterval(this._intervalId),this._intervalId=this.hWindow=null)}
function RLoader_loadJsFile(a,b){var e=this,f=RWindow.hDocument,h=f.getElementsByTagName("head")[0];if(null==document.getElementById(a)){var k=top.RContext.location(b),q=RWindow.createElement("SCRIPT");q.id=a;q.type="text/javascript";q.src=k;f.attachEvent?q.onreadystatechange=function(){var b=q.readyState;if("loaded"==b||"complete"==b)q.onreadystatechange=null,e._loading.extract(a),e._loaded.push(a)}:q.onload=function(){"complete"==f.readyState&&(q.onload=null,e._loading.extract(a),e._loaded.push(a))};
h.appendChild(q)}}function RLoader_loadJs(a){for(var b=arguments,e=b.length,f=0;f<e;f++){var h=b[f];this.loadJsFile("js:"+h,"/ajs/"+h.replace(/\./g,"/")+".js")}}function RLoader_loaded(a){this._loading.extract(a);this._loaded.push(a)}function RLoader_wait(a,b){var e=new TLoaderListener;e.invoke=a;for(var f=arguments.length,h=1;h<f;h++)e.ids.push(arguments[h]);this._waits.push(e);this.intervalStart()}
function RLoader_waitJs(a,b){var e=new TLoaderListener;e.invoke=a;for(var f=arguments,h=f.length,k=1;k<h;k++)e.ids.push("js:"+f[k]);this._waits.push(e);this.intervalStart()}var RMessage=new function(){this._hasError=!1;this._messages=null;this.push=RMessage_push;this.fatal=RMessage_fatal;this.confirmResult=!1;this.error=RMessage_error;this.warn=RMessage_warn;this.onWindowClose=RMessage_onWindowClose;this.confirm=RMessage_confirm;this.info=RMessage_info;return this};
function RMessage_push(a){this._messages||(this._messages=new FLoopList);this._messages.push(a)}
function RMessage_fatal(a,b,e,f){if(!this._hasError){this._hasError=!0;for(var h=new TString,k=[],q=RMessage_fatal.caller;q&&!RArray.contains(k,q);)k.push(q),q=q.caller;for(var t=k.length,u=0;u<t;u++)q=k[u],0<u&&h.appendLine(),h.append("   "+(t-u)+": "+RMethod.name(q));k=new TString;k.appendLine(RContext.get("RMessage:fatal"));k.appendLine(RString.repeat("-",60));k.append(RClass.dump(a),": ");if(e)for(q=arguments,t=q.length,u=3;u<t;u++){var x=q[u];"function"==typeof x&&(x=RMethod.name(x));e=e.replace("{"+
(u-2)+"}",x)}k.appendLine(e);k.appendLine(RString.repeat("-",60));k.appendLine("Stack:");k.append(h);alert(k)}}function RMessage_error(a,b,e,f){if(!this._hasError)throw this._hasError=!0,Error(e);}function RMessage_warn(a,b,e){new TString;a=top.RControl.create(FAlertWindow);a.setText(b);a.show()}function RMessage_info(a,b,e){new TString;a=top.RControl.create(FInfoWindow);a.setText(b);a.show()}
function RMessage_confirm(a,b){var e=top.RControl.create(FConfirmWindow);e.setText(a);e.lsns.register(this,b);e.show()}function RMessage_onWindowClose(a){this.confirmResult=a}var RResource=new function(){this.uriIcon="/ars/icon/";this.uriImage="/ars/img/";this.iconPath=RResource_iconPath;this.iconUrlPath=RResource_iconUrlPath;this.imagePath=RResource_imagePath;return this};
function RResource_iconPath(a,b){a=RString.nvl(a,"n").replace(/\./g,"/")+"."+RString.nvl(b,"gif");return RBrowser.contentPath("/ars/icon/"+a)}function RResource_iconUrlPath(a,b){a=RString.nvl(a,"n").replace(/\./g,"/")+"."+RString.nvl(b,"gif");return RBrowser.contentPath("/ars/icon/"+a)}function RResource_imagePath(a,b){}var RService=new function(){this._services=new TDictionary;this.url=RService_url;this.parse=RService_parse;return this};
function RService_url(a){if(RString.startsWith(a,"http://"))return a;if(RString.startsWith(a,"#"))return a.substr(1);RString.startsWith(a,"/")||(a="/"+a);return a+".ws"}
function RService_parse(a){var b=null,e=this._services;if(a){b=e.get(a);if(null==b){var f=a.split("@");1==f.length?f[0]&&(b=new SServiceInfo,b.service=f[0],b.action=null,b.url=this.url(f[0])):2==f.length&&f[0]&&f[1]&&(b=new SServiceInfo,b.service=f[1],b.action=f[0],b.url=this.url(f[1])+"?action="+f[0])}if(null==b)throw new TError(this,"Unknown service format. (source={1})",a);e.set(a,b)}return b}
var RStyle=new function(){this._connected=!1;this._rules=new TMap;this.connect=RStyle_connect;this.has=RStyle_has;this.nvl=RStyle_nvl;this.style=RStyle_style;return this};function RStyle_connect(){if(!this._connected){for(var a=this._rules,b=document.styleSheets,e=b.length,f=0;f<e;f++){var h=b[f].cssRules;if(h)for(var k=h.length,q=0;q<k;q++){var t=h[q];a.set(t.selectorText,t)}}this._connected=!0}}
function RStyle_has(a){this._connected||this.connect();return a?this._rules.contains("."+a.toLowerCase()):!1}function RStyle_nvl(a,b){this.connect();var e=arguments,f=e.length;for(b=0;b<f;b++)if((a=e[b])&&this._rules.contains("."+a.toLowerCase()))return a;return null}function RStyle_style(a,b){return RClass.name(a)+"_"+b}
var RTypeArray=new function(){this._float4=this._float3=null;this._data={};this.float3=RTypeArray_float3;this.float4=RTypeArray_float4;this.createArray=RTypeArray_createArray;this.findTemp=RTypeArray_findTemp;return this};function RTypeArray_float3(){var a=this._float3;null==a&&(a=this._float3=new Float32Array(3));return a}function RTypeArray_float4(){var a=this._float4;null==a&&(a=this._float4=new Float32Array(4));return a}
function RTypeArray_createArray(a,b){switch(a){case EDataType.Boolean:case EDataType.Int8:return new Int8Array(b);case EDataType.Int16:return new Int16Array(b);case EDataType.Int32:return new Int32Array(b);case EDataType.Int64:return new Int64Array(b);case EDataType.Uint8:return new Uint8Array(b);case EDataType.Uint16:return new Uint16Array(b);case EDataType.Uint32:return new Uint32Array(b);case EDataType.Float:return new Float32Array(b);case EDataType.Double:return new Float64Array(b)}throw new TError("Create unknown type array. (type={1}, length={2})",
a,b);}function RTypeArray_findTemp(a,b){var e=this._data,f=e[a];null==f&&(f=e[a]={});e=f[b];null==e&&(e=f[b]=this.createArray(a,b));return e}function FTag(a){a=RClass.inherits(this,a,FObject);a._name="Tag";a._children=null;a._trimLeft=!1;a._trimRight=!1;a.onBegin=FTag_onBegin;a.onEnd=FTag_onEnd;a.name=FTag_name;a.set=FTag_set;a.push=FTag_push;a.parse=FTag_parse;a.toString=FTag_toString;a.innerDump=FTag_innerDump;a.dump=FTag_dump;return a}function FTag_onBegin(a){return EResult.Continue}
function FTag_onEnd(a){return EResult.Continue}function FTag_name(){return this._name}function FTag_set(a,b){throw new TError(this,"Unknown attribute name. (name={1}, value={2})",a,b);}function FTag_push(a){var b=this._children;null==b&&(b=this._children=new TObjects);b.push(a)}
function FTag_parse(a){var b=this.onBegin(a);if(b==EResult.Continue){var e=this._children;if(e)for(var f=e.count(),h=0;h<f;h++){var k=e.get(h),b=k.parse(a);if(b==EResult.Cancel)return b;a._trimLeft=k._trimLeft;a._trimRight=k._trimRight}return this.onEnd(a)}return b}function FTag_toString(){return null}
function FTag_innerDump(a,b,e){a.appendRepeat("   ",e);a.append(RClass.dump(b));var f=b.toString();RString.isEmpty(f)||a.append(" [",f,"]");if(b=b._children){a.append("\n");for(var f=b.count(),h=0;h<f;h++){var k=b.get(h);this.innerDump(a,k,e+1);h<f-1&&a.append("\n")}}}function FTag_dump(){var a=new TString;this.innerDump(a,this,0);return a.toString()}
function FTagContext(a){a=RClass.inherits(this,a,FObject,MInstance);a._trimLeft=!1;a._trimRight=!1;a._attributes=null;a._source=null;a.construct=FTagContext_construct;a.instanceAlloc=FTagContext_instanceAlloc;a.attributes=FTagContext_attributes;a.get=FTagContext_get;a.set=FTagContext_set;a.setBoolean=FTagContext_setBoolean;a.source=FTagContext_source;a.write=FTagContext_write;a.resetSource=FTagContext_resetSource;a.dispose=FTagContext_dispose;return a}
function FTagContext_construct(){this.__base.FObject.construct.call(this);this._attributes=new TAttributes;this._source=new TString}function FTagContext_instanceAlloc(a){this._attributes.clear()}function FTagContext_attributes(){return this._attributes}function FTagContext_get(a,b){return this._attributes.get(a,b)}function FTagContext_set(a,b){this._attributes.set(a,b)}function FTagContext_setBoolean(a,b){this._attributes.set(a,RBoolean.toString(b))}
function FTagContext_source(){return this._source.toString()}function FTagContext_write(a){RString.isEmpty(a)||this._source.append(a)}function FTagContext_resetSource(a){this._source.clear()}function FTagContext_dispose(){this._attributes.dispose();this._attributes=null;this._source.dispose();this._source=null;this.__base.FObject.dispose.call(this)}
function FTagDocument(a){a=RClass.inherits(this,a,FObject);a._space=null;a._root=null;a.space=FTagDocument_space;a.setSpace=FTagDocument_setSpace;a.create=FTagDocument_create;a.root=FTagDocument_root;a.loadNode=FTagDocument_loadNode;a.load=FTagDocument_load;a.parse=FTagDocument_parse;a.dump=FTagDocument_dump;return a}function FTagDocument_space(){return this._space}function FTagDocument_setSpace(a){this._space=a}
function FTagDocument_create(a){var b=this._space+"_",e=null,e=RString.startsWith(a,b)?a.substring(b.length):a;a=null;switch(e){case "source":a=RClass.create(FTag);break;case "write":a=RClass.create(FTagWrite);break;case "true":a=RClass.create(FTagTrue);break;case "false":a=RClass.create(FTagFalse);break;case "equals":a=RClass.create(FTagEquals);break;case "notEquals":a=RClass.create(FTagNotEquals);break;default:throw new TError(this,"Unknown tag type. (name={1})",e);}return a}
function FTagDocument_root(){return this._root}
function FTagDocument_loadNode(a,b){var e=this.create(b.nodeName);a?a.push(e):this._root=e;var f=b.attributes;if(f)for(var h=f.length,k=0;k<h;k++){var q=f[k];q.nodeName&&e.set(q.nodeName,RXml.formatText(q.value))}if(f=b.childNodes)for(h=f.length,k=0;k<h;k++)switch(q=f[k],q.nodeType){case ENodeType.Text:var t=RClass.create(FTagText);t.setText(q.nodeValue);e.push(t);break;case ENodeType.Data:t=RClass.create(FTagText);t.setText(q.data);e.push(t);break;case ENodeType.Node:this.loadNode(e,q)}}
function FTagDocument_load(a){a=("<source>"+a+"</source>").replace(new RegExp("<"+this._space+":","g"),"<"+this._space+"_");a=a.replace(new RegExp("</"+this._space+":","g"),"</"+this._space+"_");a=a.replace(RegExp(" & ","g")," &amp; ");a=a.replace(RegExp(" < ","g")," &lt; ");a=a.replace(RegExp(" > ","g")," &gt; ");a=RXml.makeString(a);this.loadNode(null,a.firstChild)}function FTagDocument_parse(a){a.resetSource();this._root.parse(a);return a.source()}
function FTagDocument_dump(){var a=new TString;a.appendLine(RClass.dump(this));a.appendLine(this.root().dump(a));return a.toString()}function FTagEquals(a){a=RClass.inherits(this,a,FTag);a._trimLeft=!0;a._source=null;a._value=null;a.onBegin=FTagEquals_onBegin;a.set=FTagEquals_set;a.toString=FTagEquals_toString;return a}
function FTagEquals_onBegin(a){var b=!1;a=a.get(this._source);for(var e=this._value.split("|"),f=e.length,h=0;h<f;h++)if(a==e[h]){b=!0;break}return b?EResult.Continue:EResult.Skip}function FTagEquals_set(a,b){switch(a){case "source":this._source=b;return;case "value":this._value=b;return}this.__base.FTag.set.call(this,a,b)}function FTagEquals_toString(){return"source="+this._source+", value="+this._value}
function FTagFalse(a){a=RClass.inherits(this,a,FTag);a._trimLeft=!0;a._source=null;a.onBegin=FTagFalse_onBegin;a.set=FTagFalse_set;a.toString=FTagFalse_toString;return a}function FTagFalse_onBegin(a){a=a.get(this._source);return RBoolean.parse(a)?EResult.Skip:EResult.Continue}function FTagFalse_set(a,b){switch(a){case "source":this._source=b;return}this.__base.FTag.set.call(this,a,b)}function FTagFalse_toString(){return"source="+this._source}
function FTagNotEquals(a){a=RClass.inherits(this,a,FTag);a._trimLeft=!0;a._source=null;a._value=null;a.onBegin=FTagNotEquals_onBegin;a.set=FTagNotEquals_set;a.toString=FTagNotEquals_toString;return a}function FTagNotEquals_onBegin(a){var b=!0;a=a.get(this._source);for(var e=this._value.split("|"),f=e.length,h=0;h<f;h++)if(a==e[h]){b=!1;break}return b?EResult.Continue:EResult.Skip}
function FTagNotEquals_set(a,b){switch(a){case "source":this._source=b;return;case "value":this._value=b;return}this.__base.FTag.set.call(this,a,b)}function FTagNotEquals_toString(){return"source="+this._source+", value="+this._value}function FTagText(a){a=RClass.inherits(this,a,FTag);a._text=null;a.onBegin=FTagText_onBegin;a.text=FTagText_text;a.setText=FTagText_setText;a.toString=FTagText_toString;return a}
function FTagText_onBegin(a){var b=this._text;a._trimLeft&&(RString.startsWith(b,"\r")&&(b=b.substring(1)),RString.startsWith(b,"\n")&&(b=b.substring(1)));a._trimRight&&(RString.endsWith(b,"\r")&&(b=b.substring(0,b.length-1)),RString.endsWith(b,"\n")&&(b=b.substring(0,b.length-1)));a.write(b);return EResult.Skip}function FTagText_text(){return this._text}function FTagText_setText(a){this._text=a}function FTagText_toString(){return"{"+this._text+"}"}
function FTagTrue(a){a=RClass.inherits(this,a,FTag);a._trimLeft=!0;a._source=null;a.onBegin=FTagTrue_onBegin;a.set=FTagTrue_set;a.toString=FTagTrue_toString;return a}function FTagTrue_onBegin(a){for(var b=!1,e=this._source.split("|"),f=e.length,h=0;h<f;h++){var k=a.get(e[h]);if(RBoolean.parse(k)){b=!0;break}}return b?EResult.Continue:EResult.Skip}function FTagTrue_set(a,b){switch(a){case "source":this._source=b;return}this.__base.FTag.set.call(this,a,b)}
function FTagTrue_toString(){return"source="+this._source}function FTagWrite(a){a=RClass.inherits(this,a,FTag);a._source=null;a.onBegin=FTagWrite_onBegin;a.set=FTagWrite_set;a.toString=FTagWrite_toString;return a}function FTagWrite_onBegin(a){var b=a.get(this._source);a.write(b);return EResult.Skip}function FTagWrite_set(a,b){switch(a){case "source":this._source=b;return}this.__base.FTag.set.call(this,a,b)}function FTagWrite_toString(){return"source="+this._source}
var EThreadStatus=new function(){this.Sleep=0;this.Active=1;this.Finish=2;return this};function SProcessEvent(){this.data=this.code=this.index=null;return this}function SXmlEvent(){this.callback=this.outputDocument=this.inputDocument=this.parameter=this.action=this.url=this.owner=null;this.process=SXmlEvent_process;this.dispose=SXmlEvent_dispose;return this}
function SXmlEvent_process(a){this.outputDocument=a.document;this.outputNode=a.root;this.owner?this.callback.call(this.owner,this):this.callback(this)}function SXmlEvent_dispose(){this.callback=this.outputDocument=this.inputDocument=this.parameter=this.action=this.url=this.owner=null}function FContent(a){a=RClass.inherits(this,a,FObject);a._name=null;a.name=FContent_name;return a}function FContent_name(){return this._name}
function FContentConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a.connections=null;a.onLoad=FContentConsole_onLoad;a.construct=FContentConsole_construct;a.alloc=FContentConsole_alloc;a.process=FContentConsole_process;a.send=FContentConsole_send;return a}function FContentConsole_construct(){this.connections=new TObjects}function FContentConsole_onLoad(){var a=this.event;a.document=this.document;a.process();this.document=this.event=null;this._statusFree=!0}
function FContentConsole_alloc(){for(var a=null,b=this.connections,e=b.count-1;0<=e;e--){var f=b.get(e);if(f._statusFree){a=f;break}}a||(a=RClass.create(FXmlConnection),b.push(a),a.onLoad=this.onLoad);a._statusFree=!1;return a}
function FContentConsole_process(a){var b=this.alloc();b.event=a;switch(a.code){case EXmlEvent.Send:b.send(a.url,a.document);break;case EXmlEvent.Receive:b.receive(a.url,a.document);break;case EXmlEvent.SyncSend:return b.syncSend(a.url,a.document);case EXmlEvent.SyncReceive:return b.syncReceive(a.url,a.document)}}function FContentConsole_send(a,b){var e=this.alloc(),f=e.syncSend(a,b);e._statusFree=!0;return f}
function FContentPipeline(a){a=RClass.inherits(this,a,FPipeline);a._scopeCd=EScope.Global;a.scopeCd=FContentPipeline_scopeCd;return a}function FContentPipeline_scopeCd(){return this._scopeCd}
function FDragConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._activeDragable=null;a._dragables=null;a.onMouseDown=FDragConsole_onMouseDown;a.onMouseMove=FDragConsole_onMouseMove;a.onMouseUp=FDragConsole_onMouseUp;a.construct=FDragConsole_construct;a.register=FDragConsole_register;a.unregister=FDragConsole_unregister;a.clear=FDragConsole_clear;return a}
function FDragConsole_onMouseDown(a){var b=a.source;b&&RClass.isClass(b,MDragable)&&(RWindow.setOptionSelect(!1),this._activeDragable=b,b.onDragStart(a))}function FDragConsole_onMouseMove(a){if(this._activeDragable)this._activeDragable.onDragMove(a)}function FDragConsole_onMouseUp(a){this._activeDragable&&(RWindow.setOptionSelect(!0),this._activeDragable.onDragStop(a),this._activeDragable=null)}
function FDragConsole_construct(){this.__base.FConsole.construct.call(this);this._dragables=new TObjects;RWindow.lsnsMouseDown.register(this,this.onMouseDown);RWindow.lsnsMouseMove.register(this,this.onMouseMove);RWindow.lsnsMouseUp.register(this,this.onMouseUp)}function FDragConsole_register(a){this._dragables.push(a)}function FDragConsole_unregister(a,b){this._dragables.remove(p)}function FDragConsole_clear(){this._dragables.clear()}
function FEnvironmentConsole(a){a=RClass.inherits(this,a,FConsole);a.scope=EScope.Local;a.environment=null;a.connect=FEnvironmentConsole_connect;a.build=FEnvironmentConsole_build;a.buildValue=FEnvironmentConsole_buildValue;a.xml=FEnvironmentConsole_xml;return a}function FEnvironmentConsole_connect(){var a=RHtml.get("xEnvironment");a&&(this.environment=RXml.makeNode(a))}
function FEnvironmentConsole_build(a){this.environment||this.connect();this.environment&&a.create("Environment").attributes().append(this.environment.attributes())}function FEnvironmentConsole_buildValue(){this.environment||this.connect();if(this.environment){var a=RHtml.get("_environment");a&&(a.value=this.environment.xml())}}function FEnvironmentConsole_xml(){this.environment||this.connect();return this.environment?this.environment.xml():null}
function FEvent(a){a=RClass.inherits(this,a,FObject);a._owner=null;a._callback=null;a._valid=!0;a.owner=FEvent_owner;a.setOwner=FEvent_setOwner;a.callback=FEvent_callback;a.setCallback=FEvent_setCallback;a.valid=FEvent_valid;a.setValid=FEvent_setValid;a.process=FEvent_process;return a}function FEvent_owner(){return this._owner}function FEvent_setOwner(a){this._owner=a}function FEvent_callback(){return this._callback}function FEvent_setCallback(a){this._callback=a}
function FEvent_valid(){return this._valid}function FEvent_setValid(a){this._valid=a}function FEvent_process(){if(this._valid){var a=this._owner;a?this._callback.call(a,this):this._callback(this)}}
function FEventConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._thread=null;a._interval=100;a._processEvents=null;a._events=null;a.onProcess=FEventConsole_onProcess;a.construct=FEventConsole_construct;a.register=FEventConsole_register;a.push=FEventConsole_push;a.clear=FEventConsole_clear;return a}
function FEventConsole_onProcess(){var a=this._events;if(!a.isEmpty()){var b=this._processEvents;b.assign(a);a.clear();a=b.count();if(0<a){for(var e=0;e<a;e++)b.get(e).process();b.clear()}}}
function FEventConsole_construct(){this.__base.FConsole.construct.call(this);this._processEvents=new TObjects;this._events=new TObjects;var a=this._thread=RClass.create(FThread);a.setInterval(this._interval);a.lsnsProcess.register(this,this.onProcess);RConsole.find(FThreadConsole).start(a);RLogger.debug(this,"Add event thread. (thread={1})",RClass.dump(a))}function FEventConsole_register(a,b){var e=RClass.create(FEvent);e.owner=a;e.callback=b;this._events.push(e)}
function FEventConsole_push(a){var b=this._events;b.contains(a)||b.push(a)}function FEventConsole_clear(){this._events.clear()}function FHttpConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._pool=null;a.onLoad=FHttpConsole_onLoad;a.construct=FHttpConsole_construct;a.alloc=FHttpConsole_alloc;a.send=FHttpConsole_send;return a}function FHttpConsole_construct(){this.__base.FConsole.construct.call(this);this._pool=RClass.create(FObjectPool)}
function FHttpConsole_onLoad(a){this._pool.free(a)}function FHttpConsole_alloc(){var a=this._pool;if(!a.hasFree()){var b=RClass.create(FHttpConnection);b._asynchronous=!0;this._pool.push(b)}b=a.alloc();b.lsnsLoad.clear();b.lsnsLoad.register(this,this.onLoad);return b}function FHttpConsole_send(a){var b=this.alloc();b.send(a);return b}function FIdleConsole(a){a=RClass.inherits(this,a,FConsole);a.scope=EScope.Page;a.register=FIdleConsole_register;return a}
function FIdleConsole_register(a,b){this.active=new TActive(a,b);this.active.interval=100;RConsole.find(FActiveConsole).push(this.active)}function FIdleConsole_construct(){}function FLoggerConsole(a){a=RClass.inherits(this,a,FConsole);a.scope=EScope.Page;a.iLogger=null;a.onKeyDown=FLoggerConsole_onKeyDown;a.construct=FLoggerConsole_construct;a.connect=FLoggerConsole_connect;a.disconnect=FLoggerConsole_disconnect;a.output=FLoggerConsole_output;return a}
function FLoggerConsole_onKeyDown(a){a.shiftKey&&a.ctrlKey&&EKey.L==a.keyCode&&this.connect()}function FLoggerConsole_construct(){this.base.FConsole.construct.call(this);RWindow.lsnsKeyDown.register(this,this.onKeyDown)}function FLoggerConsole_connect(){}function FLoggerConsole_disconnect(){this.iLogger=null}
function FLoggerConsole_output(a,b,e,f,h,k){this.iLogger&&(b=RClass.dump(b),f&&(b+=" ("+f+"ms)"),a=a+" ["+RString.rpad(b,36)+"] ",a=k?a+(RString.rpad(h,120)+" ["+k+"]"):a+h,this.iLogger.Output(a))}function FLoggerConsole_xml(){this.environment||this.connect();return this.environment?this.environment.xml():null}
function FMonitorConsole(a){a=RClass.inherits(this,a,FConsole);a.scope=EScope.Global;a.working=!1;a.interval=10;a.intervalId=null;a.monitors=new TList;a.hWindow=null;a.doInterval=FMonitorConsole_doInterval;a.push=FMonitorConsole_push;a.process=FMonitorConsole_process;a.processAll=FMonitorConsole_processAll;a.startup=FMonitorConsole_startup;a.wait=FMonitorConsole_wait;a.release=FMonitorConsole_release;return a}
function FMonitorConsole_push(a){this.startup();a.id=this.monitors.sync(a);a.name="T:"+RString.lpad(a.id,4,"0");a.status=EMonitor.Active}function FMonitorConsole_process(a){if(a)switch(a.status){case EMonitor.Active:a.process(this.interval);break;case EMonitor.Cancel:this.monitors.removeItem(a)}}function FMonitorConsole_processAll(){this.working=!0;for(var a=this.monitors,b=0;b<a.count;b++)this.process(a.get(b));this.working=!1}
function FMonitorConsole_doInterval(){var a=RGlobal.get(FMonitorConsole);a&&!a.working&&a.processAll()}function FMonitorConsole_startup(){this.hWindow||(this.hWindow=window,this.intervalId=this.hWindow.setInterval(this.doInterval,this.interval))}function FMonitorConsole_wait(a){}function FMonitorConsole_release(){this.hWindow&&this.intervalId&&this.hWindow.clearInterval(this.intervalId)}
function FMouseConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._activeCapture=null;a._captures=null;a.onMouseDown=FMouseConsole_onMouseDown;a.onMouseMove=FMouseConsole_onMouseMove;a.onMouseUp=FMouseConsole_onMouseUp;a.construct=FMouseConsole_construct;a.captureStart=FMouseConsole_captureStart;a.capture=FMouseConsole_capture;a.captureStop=FMouseConsole_captureStop;a.register=FMouseConsole_register;a.unregister=FMouseConsole_unregister;a.clear=FMouseConsole_clear;return a}
function FMouseConsole_onMouseDown(a){var b=RHtml.searchLinker(a.hSource,MMouseCapture);b&&b.testMouseCapture()&&(this._activeCapture=b,this.captureStart(a))}function FMouseConsole_onMouseMove(a){this._activeCapture&&this.capture(a)}function FMouseConsole_onMouseUp(a){this._activeCapture&&this.captureStop(a)}
function FMouseConsole_construct(){this.__base.FConsole.construct.call(this);this._captures=new TObjects;RWindow.lsnsMouseDown.register(this,this.onMouseDown);RWindow.lsnsMouseMove.register(this,this.onMouseMove);RWindow.lsnsMouseUp.register(this,this.onMouseUp)}function FMouseConsole_captureStart(a){var b=this._activeCapture;b&&(RWindow.setOptionSelect(!1),b.onMouseCaptureStart(a))}
function FMouseConsole_capture(a){var b=this._activeCapture;if(b)if(b.testMouseCapture())b.onMouseCapture(a);else this.captureStop(a)}function FMouseConsole_captureStop(a){var b=this._activeCapture;b&&(b.onMouseCaptureStop(a),this._activeCapture=null);RWindow.setOptionSelect(!0)}function FMouseConsole_register(a){this._captures.push(a)}function FMouseConsole_unregister(a){this._captures.remove(a)}function FMouseConsole_clear(){this._captures.clear()}
function FPipeline(a){a=RClass.inherits(this,a,FObject);a._name=null;a.name=FPipeline_name;return a}function FPipeline_name(){return this._name}function FProcess(a){a=RClass.inherits(this,a,FObject);a._name=null;a._source=null;a._worker=null;a._events=null;a.ohMessage=FProcess_ohMessage;a.onMessage=FProcess_onMessage;a.construct=FProcess_construct;a.name=FProcess_name;a.start=FProcess_start;a.process=FProcess_process;return a}function FProcess_ohMessage(){this.__linker.onMessage(this)}
function FProcess_onMessage(a){}function FProcess_name(){return this._name}function FProcess_construct(){this.__base.FObject.construct.call(this);this._events=new TObjects}function FProcess_start(a){if(this._worker)throw new TError(this,"Process is already start.");this._source=a;a=this._worker=new Worker(a);a.__linker=this;a.onmessage=this.ohMessage}
function FProcess_process(a){var b=this._events,e=b.count();b.push(a);b=new SProcessEvent;b.index=e;b.code=a.code();b.data=a.data();this._worker.postMessage(b)}function FProcessConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a.connections=null;a.onLoad=FProcessConsole_onLoad;a.construct=FProcessConsole_construct;a.alloc=FProcessConsole_alloc;a.process=FProcessConsole_process;a.send=FProcessConsole_send;return a}
function FProcessConsole_construct(){this.connections=new TObjects}function FProcessConsole_onLoad(){var a=this.event;a.document=this.document;a.process();this.document=this.event=null;this._statusFree=!0}function FProcessConsole_alloc(){for(var a=null,b=this.connections,e=b.count-1;0<=e;e--){var f=b.get(e);if(f._statusFree){a=f;break}}a||(a=RClass.create(FXmlConnection),b.push(a),a.onLoad=this.onLoad);a._statusFree=!1;return a}
function FProcessConsole_process(a){var b=this.alloc();b.event=a;switch(a.code){case EXmlEvent.Send:b.send(a.url,a.document);break;case EXmlEvent.Receive:b.receive(a.url,a.document);break;case EXmlEvent.SyncSend:return b.syncSend(a.url,a.document);case EXmlEvent.SyncReceive:return b.syncReceive(a.url,a.document)}}function FProcessConsole_send(a,b){var e=this.alloc(),f=e.syncSend(a,b);e._statusFree=!0;return f}
function FProcessEvent(a){a=RClass.inherits(this,a,FObject);a._code=null;a._data=null;a._listeners=null;a.code=FProcessEvent_code;a.setCode=FProcessEvent_setCode;a.data=FProcessEvent_data;a.setData=FProcessEvent_setData;a.register=FProcessEvent_register;return a}function FProcessEvent_name(){return this._name}function FProcessEvent_code(){return this._code}function FProcessEvent_setCode(a){this._code=a}function FProcessEvent_data(){return this._data}
function FProcessEvent_setData(a){this._data=a}function FProcessEvent_register(a,b){this._listeners||(this._listeners=new TListeners);this._listeners.register(a,b)}function FProcessor(a){a=RClass.inherits(this,a,FObject);a._name=null;a._source=null;a._worker=null;a._events=null;a.ohMessage=FProcessor_ohMessage;a.onMessage=FProcessor_onMessage;a.construct=FProcessor_construct;a.name=FProcessor_name;a.start=FProcessor_start;a.process=FProcessor_process;return a}
function FProcessor_ohMessage(){this.__linker.onMessage(this)}function FProcessor_onMessage(a){}function FProcessor_name(){return this._name}function FProcessor_construct(){this.__base.FObject.construct.call(this);this._events=new TObjects}function FProcessor_start(a){if(this._worker)throw new TError(this,"Process is already start.");this._source=a;a=this._worker=new Worker(a);a.__linker=this;a.onmessage=this.ohMessage}
function FProcessor_process(a){var b=this._events,e=b.count();b.push(a);b=new SProcessEvent;b.index=e;b.code=a.code();b.data=a.data();this._worker.postMessage(b)}
function FProcessServer(a){a=RClass.inherits(this,a,FObject);a._name=null;a._handle=null;a._processors=null;a.ohInterval=FProcessServer_ohInterval;a.onInterval=FProcessServer_onInterval;a.ohMessage=FProcessServer_ohMessage;a.onMessage=FProcessServer_onMessage;a.construct=FProcessServer_construct;a.name=FProcessServer_name;a.registerProcessor=FProcessServer_registerProcessor;a.unregisterProcessor=FProcessServer_unregisterProcessor;a.send=FProcessServer_send;a.process=FProcessServer_process;return a}
function FProcessServer_ohInterval(){FProcessServer.__linker.onInterval()}function FProcessServer_onInterval(){}function FProcessServer_ohMessage(a){FProcessServer.__linker.onMessage(a.data)}function FProcessServer_onMessage(a){console.log("messgae",this,a)}function FProcessServer_construct(){this.__base.FObject.construct.call(this);this._processors=new TDictionary}function FProcessServer_name(){return this._name}function FProcessServer_registerProcessor(a,b){this._processors.set(a,b)}
function FProcessServer_unregisterProcessor(a){this._processors.set(a,null)}function FProcessServer_send(a){postMessage(a)}function FProcessServer_process(){onmessage=this.ohMessage;FProcessServer.__linker=this}function FResource(a){a=RClass.inherits(this,a,FObject);a._guid=null;a._code=null;a._label=null;a.guid=FResource_guid;a.code=FResource_code;a.label=FResource_label;return a}function FResource_guid(){return this._guid}function FResource_code(){return this._code}
function FResource_label(){return this._label}function FResourceConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._resources=null;a.onLoad=FResourceConsole_onLoad;a.construct=FResourceConsole_construct;a.alloc=FResourceConsole_alloc;a.process=FResourceConsole_process;a.send=FResourceConsole_send;return a}function FResourceConsole_construct(){this.connections=new TObjects}
function FResourceConsole_onLoad(){var a=this.event;a.document=this.document;a.process();this.document=this.event=null;this._statusFree=!0}function FResourceConsole_alloc(){for(var a=null,b=this.connections,e=b.count-1;0<=e;e--){var f=b.get(e);if(f._statusFree){a=f;break}}a||(a=RClass.create(FXmlConnection),b.push(a),a.onLoad=this.onLoad);a._statusFree=!1;return a}
function FResourceConsole_process(a){var b=this.alloc();b.event=a;switch(a.code){case EXmlEvent.Send:b.send(a.url,a.document);break;case EXmlEvent.Receive:b.receive(a.url,a.document);break;case EXmlEvent.SyncSend:return b.syncSend(a.url,a.document);case EXmlEvent.SyncReceive:return b.syncReceive(a.url,a.document)}}function FResourceConsole_send(a,b){var e=this.alloc(),f=e.syncSend(a,b);e._statusFree=!0;return f}
function FResourceGroup(a){a=RClass.inherits(this,a,FObject);a._name=null;a.name=FResourceGroup_name;return a}function FResourceGroup_name(){return this._name}function FResourceType(a){a=RClass.inherits(this,a,FObject);a._name=null;a._pipeline=null;a._resources=null;a.construct=FResourceType_construct;a.name=FResourceType_name;a.resource=FResourceType_resource;a.resources=FResourceType_resources;return a}
function FResourceType_construct(){this.__base.construct.call(this);this._resources=new TDictionary}function FResourceType_name(){return this._name}function FResourceType_resource(a){return this._resources.get(a)}function FResourceType_resources(){return this._resources}function FStatistics(a){a=RClass.inherits(this,a,FObject);a._code=null;a.reset=FStatistics_reset;a.resetFrame=FStatistics_resetFrame;return a}function FStatistics_reset(){}function FStatistics_resetFrame(){}
function FStatisticsConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._statisticses=null;a.construct=FStatisticsConsole_construct;a.register=FStatisticsConsole_register;a.unregister=FStatisticsConsole_unregister;a.find=FStatisticsConsole_find;a.statisticses=FStatisticsConsole_statisticses;a.reset=FStatisticsConsole_reset;a.resetFrame=FStatisticsConsole_resetFrame;return a}function FStatisticsConsole_construct(){this._statisticses=new TDictionary}
function FStatisticsConsole_register(a,b){this._statisticses.set(a,b)}function FStatisticsConsole_unregister(a){return this._statisticses.remove(a)}function FStatisticsConsole_find(a){return this._statisticses.get(a)}function FStatisticsConsole_statisticses(){return this._statisticses}function FStatisticsConsole_reset(a){a=this._statisticses;for(var b=a.count()-1;0<=b;b--)a.getAt(b).reset()}
function FStatisticsConsole_resetFrame(a,b){for(var e=this._statisticses,f=e.count()-1;0<=f;f--)e.getAt(f).resetFrame()}function FThread(a){a=RClass.inherits(this,a,FObject,MListenerProcess);a._name=null;a._statusCd=EThreadStatus.Sleep;a._interval=100;a._delay=0;a.construct=FThread_construct;a.name=FThread_name;a.statusCd=FThread_statusCd;a.interval=FThread_interval;a.setInterval=FThread_setInterval;a.start=FThread_start;a.stop=FThread_stop;a.process=FThread_process;return a}
function FThread_construct(){this.__base.FObject.construct.call(this)}function FThread_name(){return this._name}function FThread_statusCd(){return this._statusCd}function FThread_interval(){return this._interval}function FThread_setInterval(a){this._interval=a}function FThread_start(){this._statusCd=EThreadStatus.Active}function FThread_stop(){this._statusCd=EThreadStatus.Finish}
function FThread_process(a){0>=this._delay?(this.processProcessListener(this),this._delay=this._interval):this._delay-=a}
function FThreadConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._active=!0;a._interval=20;a._threads=null;a._hWindow=null;a._hIntervalId=null;a.ohInterval=FThreadConsole_ohInterval;a.construct=FThreadConsole_construct;a.push=FThreadConsole_push;a.start=FThreadConsole_start;a.process=FThreadConsole_process;a.processAll=FThreadConsole_processAll;a.dispose=FThreadConsole_dispose;return a}function FThreadConsole_ohInterval(){RConsole.get(FThreadConsole).processAll()}
function FThreadConsole_push(a){this._threads.push(a)}function FThreadConsole_start(a){a.start();this._threads.push(a)}function FThreadConsole_construct(){this.__base.FConsole.construct.call(this);this._threads=new TObjects;this._hWindow=window;this._hIntervalId=this._hWindow.setInterval(this.ohInterval,this._interval)}
function FThreadConsole_process(a){if(a)switch(a.statusCd()){case EThreadStatus.Active:a.process(this._interval);break;case EThreadStatus.Finish:a.dispose(),this._threads.remove(a)}}function FThreadConsole_processAll(){if(this._active)for(var a=this._threads,b=a.count(),e=0;e<b;e++){var f=a.get(e);this.process(f)}}function FThreadConsole_dispose(){var a=this._hWindow;if(a){var b=this._hIntervalId;b&&(a.clearInterval(b),this._hIntervalId=null);this._hWindow=null}}
function FXmlConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a.connections=null;a.onLoad=FXmlConsole_onLoad;a.construct=FXmlConsole_construct;a.alloc=FXmlConsole_alloc;a.send=FXmlConsole_send;a.sendAsync=FXmlConsole_sendAsync;a.process=FXmlConsole_process;return a}function FXmlConsole_construct(){this.connections=new TObjects}function FXmlConsole_onLoad(a){debugger}
function FXmlConsole_alloc(){for(var a=null,b=this.connections,e=b.count-1;0<=e;e--){var f=b.get(e);if(f._statusFree){a=f;break}}a||(a=RClass.create(FXmlConnection),b.push(a),a.onLoad=this.onLoad);a._statusFree=!1;return a}function FXmlConsole_send(a,b){var e=this.alloc();e._asynchronous=!1;var f=e.send(a,b);e._statusFree=!0;return f}function FXmlConsole_sendAsync(a,b,e){var f=this.alloc();f._asynchronous=!0;f._parameters=e;f.send(a,b);return f}
function FXmlConsole_process(a){if(a.constructor!=SXmlEvent)throw new TError("Parameter type is invalid.");var b=this.alloc();b._asynchronous=!0;b.send(a.url,a.inputDocument);b.lsnsLoad.register(a,a.process);return b}var RApplication=new function(){this._workspaces=new TDictionary;this.initialize=RApplication_initialize;this.findWorkspace=RApplication_findWorkspace;this.release=RApplication_release;return this};
function RApplication_initialize(){RBrowser.construct();RWindow.connect(window);RKeyboard.construct()}function RApplication_findWorkspace(a){var b=RClass.name(a),e=this._workspaces,f=e.get(b);null==f&&(f=RClass.create(a),e.set(b,f));return f}function RApplication_release(){try{CollectGarbage()}catch(a){RLogger.error(a)}}
var RBrowser=new function(){this._deviceCd=EDevice.Unknown;this._softwareCd=ESoftware.Unknown;this._typeCd=EBrowser.Unknown;this._supportHtml5=!1;this._contentPath=this._hostPath="";this.onLog=RBrowser_onLog;this.construct=RBrowser_construct;this.supportHtml5=RBrowser_supportHtml5;this.hostPath=RBrowser_hostPath;this.setHostPath=RBrowser_setHostPath;this.contentPath=RBrowser_contentPath;this.setContentPath=RBrowser_setContentPath;this.isBrowser=RBrowser_isBrowser;return this};
function RBrowser_onLog(a,b){console.log(b)}
function RBrowser_construct(){var a=window.navigator.userAgent.toLowerCase();-1!=a.indexOf("android")&&(this._typeCd=EDevice.Mobile,this._softwareCd=ESoftware.Android);if(-1!=a.indexOf("chrome"))this._typeCd=EBrowser.Chrome;else if(-1!=a.indexOf("firefox"))this._typeCd=EBrowser.FireFox;else if(-1!=a.indexOf("msie")||-1!=a.indexOf("windows"))this._typeCd=EBrowser.Explorer;else if(-1!=a.indexOf("safari")||-1!=a.indexOf("applewebkit"))this._typeCd=EBrowser.Safari;else{alert("Unknown browser.\n"+a);return}this._typeCd==
EBrowser.Chrome&&RLogger.lsnsOutput.register(this,this.onLog);window.applicationCache&&(this._supportHtml5=!0);RLogger.info(this,"Parse browser agent. (type_cd={1})",REnum.decode(EBrowser,this._typeCd))}function RBrowser_supportHtml5(){return this._supportHtml5}function RBrowser_hostPath(a){return a?this._hostPath+a:this._hostPath}function RBrowser_setHostPath(a){this._hostPath=a}function RBrowser_contentPath(a){return a?this._contentPath+a:this._contentPath}
function RBrowser_setContentPath(a){this._contentPath=a}function RBrowser_isBrowser(a){return this._typeCd==a}
var RBuilder=new function(){this.create=RBuilder_create;this.createIcon=RBuilder_createIcon;this.createImage=RBuilder_createImage;this.createText=RBuilder_createText;this.createCheck=RBuilder_createCheck;this.createRadio=RBuilder_createRadio;this.createEdit=RBuilder_createEdit;this.createSpan=RBuilder_createSpan;this.createDiv=RBuilder_createDiv;this.createTable=RBuilder_createTable;this.createTableRow=RBuilder_createTableRow;this.createTableCell=RBuilder_createTableCell;this.createFragment=RBuilder_createFragment;
this.append=RBuilder_append;this.appendIcon=RBuilder_appendIcon;this.appendImage=RBuilder_appendImage;this.appendEmpty=RBuilder_appendEmpty;this.appendText=RBuilder_appendText;this.appendCheck=RBuilder_appendCheck;this.appendRadio=RBuilder_appendRadio;this.appendEdit=RBuilder_appendEdit;this.appendSpan=RBuilder_appendSpan;this.appendDiv=RBuilder_appendDiv;this.appendTable=RBuilder_appendTable;this.appendTableRow=RBuilder_appendTableRow;this.appendTableRowCell=RBuilder_appendTableRowCell;this.appendTableCell=
RBuilder_appendTableCell;return this};function RBuilder_create(a,b,e){var f=null,f=a.ownerDocument?a.ownerDocument:a.hDocument?a.hDocument:a;a=f.createElement(b);e&&(a.className=e);return a}function RBuilder_createIcon(a,b,e,f,h){a=this.create(a,"IMG",RString.nvl(b,"Tag_Icon"));a.align="absmiddle";e&&(a.src=RResource.iconPath(e));f&&(a.style.width=f+"px");h&&(a.style.height=h+"px");return a}
function RBuilder_createImage(a,b,e,f,h){a=this.create(a,"IMG",e);e&&(a.src=RResource.imagePath(e));f&&(a.style.width=f);h&&(a.style.height=h);return a}function RBuilder_createText(a,b,e){a=this.create(a,"SPAN",b);e&&(a.innerHTML=e);return a}function RBuilder_createCheck(a,b){var e=this.create(a,"INPUT",b);e.type="checkbox";return e}function RBuilder_createRadio(a,b){var e=this.create(a,"INPUT",b);e.type="radio";return e}
function RBuilder_createEdit(a,b){var e=this.create(a,"INPUT",b);e.type="text";return e}function RBuilder_createSpan(a,b){return this.create(a,"SPAN",b)}function RBuilder_createDiv(a,b){return this.create(a,"DIV",b)}function RBuilder_createTable(a,b,e,f,h){a=this.create(a,"TABLE",b);e&&(a.border=RInteger.nvl(e));a.cellSpacing=RInteger.nvl(f);a.cellPadding=RInteger.nvl(h);return a}function RBuilder_createTableRow(a,b){return this.create(a,"TR",b)}
function RBuilder_createTableCell(a,b){return this.create(a,"TD",b)}function RBuilder_createFragment(a){return a.createDocumentFragment()}function RBuilder_append(a,b,e){b=RBuilder.create(a.ownerDocument,b,e);a?a.appendChild(b):this.hDocument.body.appendChild(b);return b}function RBuilder_appendIcon(a,b,e,f,h){b=this.createIcon(a.ownerDocument,b,e,f,h);a.appendChild(b);return b}function RBuilder_appendImage(a,b,e,f,h){b=this.createImage(a.ownerDocument,b,e,f,h);a.appendChild(b);return b}
function RBuilder_appendEmpty(a,b,e){b=this.createIcon(a.ownerDocument,null,"n",b,e);a.appendChild(b);return b}function RBuilder_appendText(a,b,e){b=this.createText(a.ownerDocument,b,e);a.appendChild(b);return b}function RBuilder_appendCheck(a,b){var e=this.createCheck(a.ownerDocument,b);a.appendChild(e);return e}function RBuilder_appendRadio(a,b){var e=this.createRadio(a.ownerDocument,b);a.appendChild(e);return e}
function RBuilder_appendEdit(a,b){var e=this.createEdit(a.ownerDocument,b);a.appendChild(e);return e}function RBuilder_appendSpan(a,b){var e=this.createSpan(a.ownerDocument,b);a.appendChild(e);return e}function RBuilder_appendDiv(a,b){var e=this.createDiv(a.ownerDocument,b);a.appendChild(e);return e}function RBuilder_appendTable(a,b,e,f,h){b=this.createTable(a.ownerDocument,b,e,f,h);a?a.appendChild(b):this.hDocument.body.appendChild(b);return b}
function RBuilder_appendTableRow(a,b,e,f){var h=null,h=null==e?RBrowser.isBrowser(EBrowser.Explorer)?a.insertRow():a.insertRow(-1):a.insertRow(e);b&&(h.className=b);f&&(h.height=f);return h}function RBuilder_appendTableRowCell(a,b,e,f){a=this.appendTableRow(a,null,null,e);return this.appendTableCell(a,b,null,f)}function RBuilder_appendTableCell(a,b,e,f){var h=null;null==e?(h=this.create(a,"TD",b),a.appendChild(h)):h=a.insertCell(e);b&&(h.className=b);f&&(h.width=f);return h}
var RContext=new function(){this.optionGarbage=!0;this._location=null;this._contexts={};this.languageId=this.themeId=this.contextTag=this.contextPath=null;this.construct=RContext_construct;this.initialize=RContext_initialize;this.get=RContext_get;this.find=RContext_find;this.location=RContext_location;this.context=RContext_context;this.construct();return this};function RContext_construct(){this.optionGarbage=window.ActiveXObject?!0:!1}
function RContext_location(a){var b=this._location;if(null==b){var b=window.location,e=b.href,b=e.substring(0,e.indexOf(b.pathname));this.contextPath&&(b+=this.contextPath);this._location=b}a&&(b+=a);return b}function RContext_context(a){return null!=a?RString.endsWith(a,".wv")?this.contextPath+"/"+a:RString.startsWith(a,"#")?this.contextPath+this.contextTag+a.substr(1):this.contextPath+a:this.contextPath}
function RContext_initialize(a){for(var b in a){var e=a[b],f;for(f in e)this._contexts[b+":"+f]=new TContext(b,f,e[f])}}function RContext_get(a,b,e,f,h,k){var q=this._contexts[a];return q?RString.format(q.text,b,e,f,h,k):RLogger.fatal(this,null,"Can not find context (path={1})",a)}function RContext_find(a,b){var e=a+":"+b,f=this._contexts[e];return f?f.text:RLogger.fatal(this,null,"Can not find context (id={1})",e)}
var RValue=new function(){this.matrix=this.rectangle=this.vector3=this.double64=this.double16=this.double16=this.double4=this.double3=this.double2=this.double1=this.float16=this.float12=this.float9=this.float4=this.float3=this.float2=this.float1=null;this.construct=RValue_construct;this.construct();return this};
function RValue_construct(){RBrowser.supportHtml5()&&(this.float1=new Float32Array(1),this.float2=new Float32Array(2),this.float3=new Float32Array(3),this.float4=new Float32Array(4),this.float9=new Float32Array(9),this.float12=new Float32Array(12),this.float16=new Float32Array(16),this.double1=new Float64Array(1),this.double2=new Float64Array(2),this.double3=new Float64Array(3),this.double4=new Float64Array(4),this.double9=new Float64Array(9),this.double12=new Float64Array(12),this.double16=new Float64Array(16));
this.vector3=new SVector3;this.rectangle=new SRectangle;this.matrix=new SMatrix3d}
var RWindow=new function(){this._optionSelect=!0;this._mouseEvent=new SMouseEvent;this._keyEvent=new SKeyboardEvent;this._resizeEvent=new SResizeEvent;this._orientationEvent=new SEvent;this._hContainer=this._hDocument=this._hWindow=null;this.lsnsLoad=new TListeners;this.lsnsUnload=new TListeners;this.lsnsMouseDown=new TListeners;this.lsnsMouseUp=new TListeners;this.lsnsMouseOver=new TListeners;this.lsnsMouseMove=new TListeners;this.lsnsMouseWheel=new TListeners;this.lsnsKeyDown=new TListeners;this.lsnsKeyUp=
new TListeners;this.lsnsKeyPress=new TListeners;this.lsnsResize=new TListeners;this.lsnsOrientation=new TListeners;this.ohMouseDown=RWindow_ohMouseDown;this.ohMouseMove=RWindow_ohMouseMove;this.ohMouseUp=RWindow_ohMouseUp;this.ohKeyDown=RWindow_ohKeyDown;this.ohKeyUp=RWindow_ohKeyUp;this.ohKeyPress=RWindow_ohKeyPress;this.ohResize=RWindow_ohResize;this.ohSelect=RWindow_ohSelect;this.ohOrientation=RWindow_ohOrientation;this.connect=RWindow_connect;this.optionSelect=RWindow_optionSelect;this.setOptionSelect=
RWindow_setOptionSelect;this.setCaption=RWindow_setCaption;this.setStatus=RWindow_setStatus;this._builder=null;this._disableDeep=0;this.panels=new TMap;this.inSizing=this.inMoving=this.inDisable=!1;this.hShadow=this.hDisablePanel=null;this.onUnload=RWindow_onUnload;this.onResize=RWindow_onResize;this.createElement=RWindow_createElement;this.event=RWindow_event;this.source=RWindow_source;this.getElement=RWindow_getElement;this.getDisablePanel=RWindow_getDisablePanel;this.findElement=RWindow_findElement;
this.panel=RWindow_panel;this.screenPos=RWindow_screenPos;this.clientPos=RWindow_clientPos;this.offsetPos=RWindow_offsetPos;this.windowEnable=RWindow_windowEnable;this.windowDisable=RWindow_windowDisable;this.enable=RWindow_enable;this.disable=RWindow_disable;this.setEnable=RWindow_setEnable;this.showShadow=RWindow_showShadow;this.moveCenter=RWindow_moveCenter;this.appendControl=RWindow_appendControl;this.appendElement=RWindow_appendElement;this.appendContainer=RWindow_appendContainer;this.containerTop=
RWindow_containerTop;this.dispose=RWindow_dispose;return this};function RWindow_ohMouseDown(a){var b=RWindow;a||(a=b._hWindow.event);var e=b._mouseEvent;e.attachEvent(a);b.lsnsMouseDown.process(e)}function RWindow_ohMouseMove(a){var b=RWindow;a||(a=b._hWindow.event);var e=b._mouseEvent;e.attachEvent(a);b.lsnsMouseMove.process(e)}function RWindow_ohMouseUp(a){var b=RWindow;a||(a=b._hWindow.event);var e=b._mouseEvent;e.attachEvent(a);b.lsnsMouseUp.process(e)}
function RWindow_ohKeyDown(a){var b=RWindow;a||(a=b._hWindow.event);var e=b._keyEvent;e.attachEvent(a);b.lsnsKeyDown.process(e)}function RWindow_ohKeyUp(a){var b=RWindow;a||(a=b._hWindow.event);var e=b._keyEvent;e.attachEvent(a);b.lsnsKeyUp.process(e)}function RWindow_ohKeyPress(a){var b=RWindow;a||(a=b._hWindow.event);var e=b._keyEvent;e.attachEvent(a);b.lsnsKeyPress.process(e)}
function RWindow_ohResize(a){var b=RWindow;a||(a=b._hWindow.event);var e=b._resizeEvent;e.attachEvent(a);b.lsnsResize.process(e)}function RWindow_ohSelect(a){return RWindow._optionSelect}
function RWindow_ohOrientation(a){a=RWindow;var b=a._orientationEvent;if(180==window.orientation||0==window.orientation)b.orientationCd=EOrientation.Vertical;else if(90==window.orientation||-90==window.orientation)b.orientationCd=EOrientation.Horizontal;else throw new TError(a,"Unknown orientation mode.");a.lsnsOrientation.process(b)}
function RWindow_connect(a){a=this._hWindow=a;var b=this._hContainer=(this._hDocument=a.document).body;RBrowser.supportHtml5()?(b.addEventListener("mousedown",this.ohMouseDown,!0),b.addEventListener("mousemove",this.ohMouseMove,!0),b.addEventListener("mouseup",this.ohMouseUp,!0),b.addEventListener("keydown",this.ohKeyDown,!0),b.addEventListener("keyup",this.ohKeyUp,!0),b.addEventListener("keypress",this.ohKeyPress,!0),a.addEventListener("orientationchange",this.ohOrientation)):(b.onmousedown=this.ohMouseDown,
b.onmousemove=this.ohMouseMove,b.onmouseup=this.ohMouseUp,b.onkeydown=this.ohKeyDown,b.onkeyup=this.ohKeyUp,b.onkeypress=this.ohKeyPress);b.onselectstart=this.ohSelect}function RWindow_optionSelect(){return this._optionSelect}function RWindow_setOptionSelect(a){this._optionSelect=a;RBrowser.isBrowser(EBrowser.FireFox)&&(this._hContainer.style.MozUserSelect=a?"":"none")}function RWindow_setCaption(a){top.document.title=a}function RWindow_setStatus(a){window.status=RString.nvl(a)}
function RWindow_onUnload(){RMemory.release()}function RWindow_onResize(){var a=this.hDisablePanel;if(a&&"block"==a.style.display){var a=a.style,b=this.hDocument;a.pixelLeft=0;a.pixelTop=0;a.pixelWidth=b.all?this.hBody.scrollWidth:b.documentElement.scrollWidth;a.pixelHeight=b.all?this.hBody.scrollHeight:b.documentElement.scrollHeight}}
function RWindow_connect2(a){var b=this;b.hWindow=a;var e=b.hDocument=a.document,e=b.hBody=b.hContainer=e.body;b.processUnload=e.onunload;e.onunload=function(e){e||(e=a.event);b.lsnsUnload.process(e);b.onUnload()};e.onmouseover=function(e){e||(e=a.event);b.lsnsMouseOver.process(e)};e.onmousewheel=function(e){e||(e=a.event);b.lsnsMouseWheel.process(e)};e.onkeydown=function(e){e||(e=a.event);RLogger.debug(b,"Window key down. (key_code={1})",e.keyCode);var h=e.srcElement?e.srcElement:e.target,k=h.tagName;
if(EKeyCode.BackSpace==e.keyCode)if("INPUT"==k){if(h.readOnly||"checkbox"==h.type)return RKey.eventClear(e)}else if("TEXTAREA"==k){if(h.readOnly)return RKey.eventClear(e)}else return RKey.eventClear(e);b.__keyDownEvent.attach(e);b.lsnsKeyDown.process(b.__keyDownEvent);EKeyCode.Enter==e.keyCode&&"INPUT"==k&&REvent.process(h,e)&&RKey.eventClear(e)};e.onkeyup=function(e){e||(e=a.event);b.lsnsKeyUp.process(e)};e.onkeypress=function(e){e||(e=a.event);RLogger.debug(b,"Window key press. (key_code={1})",
e.keyCode);b.lsnsKeyPress.process(e)};e.onresize=function(e){e||(e=a.event);if(b.oldBodyWidth!=b.hBody.offsetWidth||b.oldBodyHeight!=b.hBody.offsetHeight)b.oldBodyWidth=b.hBody.offsetWidth,b.oldBodyHeight=b.hBody.offsetHeight,b.onResize(),b.lsnsResize.process(e)}}function RWindow_createElement(a){return this.hDocument.createElement(a)}function RWindow_event(){return this.hWindow.event}function RWindow_source(a){return a?a.ownerDocument.parentWindow.event.srcElement:this.hWindow.event.srcElement}
function RWindow_getElement(a){var b=this.hDocument.getElementById(a);b||RMessage.fatal(this,null,"Can't get html element. (name={0})",a);return b}
function RWindow_getDisablePanel(a){var b=this.hDisablePanel;b||(b=this.hDisablePanel=this.builder().newDiv(),b.style.backgroundColor="#CCCCCC",b.style.position="absolute",b.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=60)",this.hBody.appendChild(b),b.style.zIndex=8E3,b.style.display="none");var e=this.hImg;e||(e=this.hImg=this.builder().appendImage(b),e.src=top.RContext.context("/ats/00/rs/icon/ctl/RWindow_Loading.gif"),e.style.margin=document.body.offsetHeight/2,e.style.display=
"none");e.style.display=a?"none":"block";return b}function RWindow_findElement(a){return this.hDocument.getElementById(a)}function RWindow_panel(a){if(EPanel.Disable==a){a=this.hDisablePanel;if(!a){a=this.hDisablePanel=RBuilder.append(this.hBody,"DIV","RWindow_Disable");var b=RBuilder.append(a,"IMG");b.src=RRes.iconPath("#ctl.RWindow_Loading");b.style.margin=document.body.offsetHeight/2;a.style.zIndex=ELayer.Disable}return a}}
function RWindow_screenPos(a){var b=this.hWindow.event;return a?(a.x=b.screenX,a.y=b.screenY,a):new TPoint(b.screenX,b.screenY)}function RWindow_clientPos(a){var b=this.hWindow.event;return a?(a.x=b.clientX,a.y=b.clientY,a):new TPoint(b.clientX,b.clientY)}function RWindow_offsetPos(a){var b=this.hWindow.event;return a?(a.x=b.offsetX,a.y=b.offsetY,a):new TPoint(b.offsetX,b.offsetY)}function RWindow_windowDisable(){this.hWindow.document.body.disabled=!0}
function RWindow_windowEnable(){this.hWindow.document.body.disabled=!1}function RWindow_enable(){this._disableDeep--;0==this._disableDeep&&this.setEnable(!0)}function RWindow_disable(){0==this._disableDeep&&this.setEnable(!1);this._disableDeep++}
function RWindow_setEnable(a,b){var e=this.getDisablePanel(b).style;a?(this.windowEnable(),e.display="none"):(e=this.hDisablePanel.style,e.pixelLeft=0,e.pixelTop=0,e.pixelWidth=this.hDocument.all?this.hBody.scrollWidth:this.hDocument.documentElement.scrollWidth,e.pixelHeight=this.hDocument.all?this.hBody.scrollHeight:this.hDocument.documentElement.scrollHeight,e.display="block")}
function RWindow_showShadow(a,b){this.hShadow||(this.hShadow=RBuilder.append(this.hBody,"DIV","RWindow_Shadow"),this.hShadow.style.zIndex=ELayer.Shadow);var e=this.hShadow.style;0==a?e.display="none":(e.display="block",e.pixelLeft=b.left+3,e.pixelTop=b.top+3,e.pixelWidth=b.width(),e.pixelHeight=b.height())}
function RWindow_moveCenter(a){a&&(a.style.pixelLeft=Math.max(parseInt((this.hBody.offsetWidth-a.offsetWidth)/2),0),a.style.pixelTop=Math.max(parseInt((this.hBody.offsetHeight-a.offsetHeight)/2),0)+this.hBody.scrollTop)}function RWindow_appendControl(a){this.hBody.appendChild(a.hPanel)}function RWindow_appendElement(a){this.hBody.appendChild(a)}function RWindow_appendContainer(a){this.hContainer.appendChild(a)}
function RWindow_containerTop(a){var b=this.hContainer;a=RHtml.top(a)+a.offsetHeight;"auto"==b.currentStyle.overflow&&(a-=RHtml.top(b));return a-b.scrollTop}
function RWindow_dispose(){this.hBody.onload=null;this.hBody.onunload=null;this.hBody.onmousedown=null;this.hBody.onmouseup=null;this.hBody.onmousemove=null;this.hBody.onmouseover=null;this.hBody.onmousewheel=null;this.hBody.onkeydown=null;this.hBody.onkeyup=null;this.hBody.onkeypress=null;this.hBody.onresize=null;RMemory.freeHtml(this.hBody);this.panels.release();this.hShadow=this.hImg=this.hDisablePanel=this.hBody=this.hDocument=this.hWindow=this.panels=null}
var RXml=new function(){this.httpActiveX=!1;this.httpVendor=null;this.domActiveX=!1;this.domVendor=null;this.construct=RXml_construct;this.isNode=RXml_isNode;this.createConnection=RXml_createConnection;this.createDocument=RXml_createDocument;this.formatText=RXml_formatText;this.buildText=RXml_buildText;this.buildNode=RXml_buildNode;this.makeString=RXml_makeString;this.makeNode=RXml_makeNode;this.makeDocument=RXml_makeDocument;this.unpack=RXml_unpack;this.construct();return this};
function RXml_construct(){var a=window.document;if(window.ActiveXObject&&!window.XMLHttpRequest)for(var b=["MSXml2.XmlHTTP","Microsoft.XmlHTTP","MSXml.XmlHTTP","MSXml3.XmlHTTP"],e=b.length,f=0;f<e;f++){var h=b[f];try{new ActiveXObject(h);this.httpActiveX=!0;this.httpVendor=h;break}catch(k){m=k}}else if(window.XMLHttpRequest)try{this.httpActiveX=!1}catch(q){m=q}else alert("Unknown http vendor.");if(window.ActiveXObject||!window.DOMParser)for(b=["MSXml2.DOMDocument","Microsoft.XmlDOM","MSXml.DOMDocument",
"MSXml3.XmlDOM"],e=b.length,f=0;f<e;f++){h=b[f];try{new ActiveXObject(h);this.domActiveX=!0;this.domVendor=h;break}catch(t){m=t}}else if(window.DOMParser&&a&&a.implementation&&a.implementation.createDocument)try{document.implementation.createDocument("","",null),this.domActiveX=!1}catch(u){m=u}else alert("Unknown dom vendor.")}function RXml_isNode(a){return RClass.isName(a,"TNode")}
function RXml_createConnection(){var a=null;(a=this.httpActiveX?new ActiveXObject(this.httpVendor):new XMLHttpRequest)||alert("Create xml connection failure. (message="+m+")");return a}function RXml_createDocument(){var a=null;(a=this.domActiveX?new ActiveXObject(this.domVendor):document.implementation.createDocument("","",null))||alert("Create xml document failure. (message="+m+")");return a}function RXml_formatText(a){null!=a&&(a=a.replace(/\\n/g,"\n"));return a}
function RXml_buildText(a,b){if(null!=b){b=b.toString();for(var e=b.length,f=0;f<e;f++){var h=b.charAt(f);switch(h){case "<":a.append("&lt;");break;case ">":a.append("&gt;");break;case '"':a.append("&quot;");break;case "&":a.append("&amp;");break;case "\r":continue;case "\n":a.append("\\n");break;default:a.append(h)}}}return a}
function RXml_buildNode(a,b,e){var f=null,h=e.attributes;if(h){var k=h.length;if(0<k)for(var f=new TAttributes,q=0;q<k;q++){var t=h[q];t.nodeName&&f.set(t.nodeName,RXml.formatText(t.value))}}k=new TString;k.append(e.value);if(h=e.childNodes)for(t=h.length,q=0;q<t;q++){var u=h[q],x=u.nodeType;x==ENodeType.Text?k.append(u.nodeValue):x==ENodeType.Data&&k.append(u.data)}e=a.create(e.nodeName,f,RString.trim(k.toString()));b?b.push(e):a._root=e;if(h)for(b=h.length,q=0;q<b;q++)h[q].nodeType==ENodeType.Node&&
this.buildNode(a,e,h[q])}function RXml_makeString(a){var b=null;this.domActiveX?(b=new ActiveXObject(this.domVendor),b.async=!1,b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml");return b}function RXml_makeNode(a){if(a.documentElement){var b=new TXmlDocument;this.buildNode(b,null,a.documentElement);return b.root()}if("SCRIPT"==a.tagName){var e=a.textContent;e||(e=a.text);if(e)return b=new TXmlDocument,a=this.makeString(e),this.buildNode(b,null,a.documentElement),b.root()}return null}
function RXml_makeDocument(a){var b=new TXmlDocument;a.documentElement&&RXml.buildNode(b,null,a.documentElement);return b}function RXml_unpack(a,b){if(RString.isEmpty(a))return null;b||(b=new TNode);var e=new TAttributes;e.unpack(a);b.name=e.get("name");b.value=e.get("value");e.contains("attributes")&&b.attributes().unpack(e.get("attributes"));if(e.contains("nodes")){var f=new TStrings;f.unpack(e.get("nodes"));for(e=0;e<f.count;e++)this.unpack(f.get(e),b.create())}return b}
function MGraphicObject(a){a=RClass.inherits(this,a);a._graphicContext=null;a.graphicContext=MGraphicObject_graphicContext;a.linkGraphicContext=MGraphicObject_linkGraphicContext;a.dispose=MGraphicObject_dispose;return a}function MGraphicObject_graphicContext(){return this._graphicContext}
function MGraphicObject_linkGraphicContext(a){if(RClass.isClass(a,FGraphicContext))this._graphicContext=a;else if(RClass.isClass(a,MGraphicObject))this._graphicContext=a._graphicContext;else throw new TError(this,"Link graphic context failure. (context={1})",a);}function MGraphicObject_dispose(){this._graphicContext=null}function MGraphicRenderable(a){a=RClass.inherits(this,a,FObject);a.process=MGraphicRenderable_process;return a}function MGraphicRenderable_process(){}
function FFloatStream(a){a=RClass.inherits(this,a,FObject);a._length=0;a._memory=null;a._position=0;a.construct=FFloatStream_construct;a.length=FFloatStream_length;a.setLength=FFloatStream_setLength;a.memory=FFloatStream_memory;a.writeFloat4=FFloatStream_writeFloat4;a.writeColor4=FFloatStream_writeColor4;a.reset=FFloatStream_reset;a.clear=FFloatStream_clear;a.dispose=FFloatStream_dispose;return a}function FFloatStream_construct(){this.__base.FObject.construct.call(this)}
function FFloatStream_length(){return this._length}function FFloatStream_setLength(a){this._length=a;this._memory=new Float32Array(a)}function FFloatStream_memory(){return this._memory}function FFloatStream_writeFloat4(a,b,e,f){this._memory[this._position++]=a;this._memory[this._position++]=b;this._memory[this._position++]=e;this._memory[this._position++]=f}function FFloatStream_writeColor4(a){this.writeFloat4(a.red,a.green,a.blue,a.alpha)}function FFloatStream_reset(){this._position=0}
function FFloatStream_clear(){this._position=0}function FFloatStream_dispose(){this._memory=null;this.__base.FObject.dispose.call(this)}function FGraphicContext(a){a=RClass.inherits(this,a,FObject);a._hCanvas=null;a.construct=FGraphicContext_construct;a.linkCanvas=RMethod.virtual(a,"linkCanvas");a.dispose=FGraphicContext_dispose;return a}function FGraphicContext_construct(){this.__base.FObject.construct.call(this)}
function FGraphicContext_dispose(){this._hCanvas=null;this.__base.FObject.dispose.call(this)}function FG2dContext(a){a=RClass.inherits(this,a,FGraphicContext);a._native=null;a.construct=FG2dContext_construct;a.linkCanvas=FG2dContext_linkCanvas;a.drawLine=FG2dContext_drawLine;a.drawRecrangle=FG2dContext_drawRecrangle;a.drawText=FG2dContext_drawText;a.drawImage=FG2dContext_drawImage;a.fillRecrangle=FG2dContext_fillRecrangle;a.dispose=FG2dContext_dispose;return a}
function FG2dContext_construct(){this.__base.FGraphicContext.construct.call(this)}function FG2dContext_linkCanvas(a){this._hCanvas=a;this._native=a.getContext("2d")}function FG2dContext_drawLine(a,b,e,f){var h=this._native;h.moveTo(a,b);h.lineTo(e,f);h.stroke()}function FG2dContext_drawRecrangle(a,b,e,f){var h=this._native;h.moveTo(a,b);h.lineTo(e,b);h.lineTo(e,f);h.lineTo(a,f);h.lineTo(a,b);h.stroke()}function FG2dContext_drawText(a,b,e){this._native.fillText(e,a,b)}
function FG2dContext_drawImage(){}function FG2dContext_fillRecrangle(a,b,e,f){var h=this._native;h.beginPath();h.moveTo(a,b);h.lineTo(e,b);h.lineTo(e,f);h.lineTo(a,f);h.lineTo(a,b);h.closePath();h.fill()}function FG2dContext_dispose(){this._native=null;this.__base.FGraphicContext.dispose.call(this)}
var EG3dMaterialMap=new function(){this.AmbientColor=0;this.DiffuseColor=1;this.SpecularColor=2;this.ReflectColor=3;this.EmissiveColor=4;this.Count=8;return this},EG3dRegionParameter=new function(){this.Unknown=0;this.CameraPosition=1;this.CameraDirection=2;this.CameraViewMatrix=3;this.CameraProjectionMatrix=4;this.CameraViewProjectionMatrix=5;this.LightPosition=6;this.LightDirection=7;this.LightViewMatrix=8;this.LightProjectionMatrix=9;this.LightViewProjectionMatrix=10;this.LightInfo=11;return this},
EG3dTechniqueMode=new function(){this.Color="color";this.Ambient="ambient";this.DiffuseLevel="diffuse.level";this.DiffuseColor="diffuse.color";this.SpecularLevel="specular.level";this.SpecularColor="specular.color";this.Reflect="reflect";this.Emissive="emissive";this.Result="result";return this};
function MG3dRegion(a){a=RClass.inherits(this,a);a._changed=!1;a._spaceName=null;a._technique=null;a._techniquePass=null;a._camera=null;a._projection=null;a._directionalLight=null;a._lights=null;a._allRenderables=null;a._renderables=null;a._cameraPosition=null;a._cameraDirection=null;a._cameraViewMatrix=null;a._cameraProjectionMatrix=null;a._cameraViewProjectionMatrix=null;a._lightPosition=null;a._lightDirection=null;a._lightViewMatrix=null;a._lightProjectionMatrix=null;a._lightViewProjectionMatrix=
null;a._lightInfo=null;a._materialMap=null;a.construct=MG3dRegion_construct;a.isChanged=MG3dRegion_isChanged;a.spaceName=MG3dRegion_spaceName;a.technique=MG3dRegion_technique;a.setTechnique=MG3dRegion_setTechnique;a.techniquePass=MG3dRegion_techniquePass;a.setTechniquePass=MG3dRegion_setTechniquePass;a.camera=MG3dRegion_camera;a.directionalLight=MG3dRegion_directionalLight;a.lights=MG3dRegion_lights;a.materialMap=MG3dRegion_materialMap;a.allRenderables=MG3dRegion_allRenderables;a.renderables=MG3dRegion_renderables;
a.pushRenderable=MG3dRegion_pushRenderable;a.setup=MG3dRegion_setup;a.change=MG3dRegion_change;a.prepare=MG3dRegion_prepare;a.reset=MG3dRegion_reset;a.calculate=MG3dRegion_calculate;a.update=MG3dRegion_update;a.dispose=MG3dRegion_dispose;return a}
function MG3dRegion_construct(){this._lights=new TObjects;this._renderables=new TObjects;this._allRenderables=new TObjects;this._cameraPosition=new SPoint3;this._cameraDirection=new SVector3;this._cameraViewMatrix=new SMatrix3d;this._cameraProjectionMatrix=new SMatrix3d;this._cameraViewProjectionMatrix=new SMatrix3d;this._lightPosition=new SPoint3;this._lightDirection=new SVector3;this._lightViewMatrix=new SMatrix3d;this._lightProjectionMatrix=new SMatrix3d;this._lightViewProjectionMatrix=new SMatrix3d;
this._lightInfo=new SVector4}function MG3dRegion_isChanged(){return this._changed}function MG3dRegion_spaceName(){return this._spaceName}function MG3dRegion_technique(){return this._technique}function MG3dRegion_setTechnique(a){this._technique=a}function MG3dRegion_techniquePass(){return this._techniquePass}function MG3dRegion_setTechniquePass(a,b){this._techniquePass=a;this._spaceName=a.fullCode();this._finish=b}function MG3dRegion_camera(){return this._camera}
function MG3dRegion_directionalLight(){return this._directionalLight}function MG3dRegion_lights(){return this._lights}function MG3dRegion_materialMap(){return this._materialMap}function MG3dRegion_allRenderables(a){return this._allRenderables}function MG3dRegion_renderables(a){return this._renderables}function MG3dRegion_pushRenderable(a){this._renderables.push(a);this._allRenderables.push(a)}function MG3dRegion_setup(){}function MG3dRegion_change(){this._changed=!0}
function MG3dRegion_prepare(){this._changed=!1;var a=this._camera,b=a.projection();this._cameraPosition.assign(a.position());this._cameraDirection.assign(a.direction());this._cameraViewMatrix.assign(a.matrix());this._cameraProjectionMatrix.assign(b.matrix());this._cameraViewProjectionMatrix.assign(a.matrix());this._cameraViewProjectionMatrix.append(b.matrix());a=this._directionalLight.camera();a.position();b=a.projection();this._lightPosition.assign(a.position());this._lightDirection.assign(a.direction());
this._lightViewMatrix.assign(a.matrix());this._lightProjectionMatrix.assign(b.matrix());this._lightViewProjectionMatrix.assign(a.matrix());this._lightViewProjectionMatrix.append(b.matrix());this._lightInfo.set(0,0,b._znear,1/b.distance());this._allRenderables.clear()}function MG3dRegion_reset(){this._renderables.clear()}
function MG3dRegion_calculate(a){switch(a){case EG3dRegionParameter.CameraPosition:return this._cameraPosition;case EG3dRegionParameter.CameraDirection:return this._cameraDirection;case EG3dRegionParameter.CameraViewMatrix:return this._cameraViewMatrix;case EG3dRegionParameter.CameraProjectionMatrix:return this._cameraProjectionMatrix;case EG3dRegionParameter.CameraViewProjectionMatrix:return this._cameraViewProjectionMatrix;case EG3dRegionParameter.LightPosition:return this._lightPosition;case EG3dRegionParameter.LightDirection:return this._lightDirection;
case EG3dRegionParameter.LightViewMatrix:return this._lightViewMatrix;case EG3dRegionParameter.LightProjectionMatrix:return this._lightProjectionMatrix;case EG3dRegionParameter.LightViewProjectionMatrix:return this._lightViewProjectionMatrix;case EG3dRegionParameter.LightInfo:return this._lightInfo}throw new TError(this,"Unknown parameter type. (type_cd={1})",a);}function MG3dRegion_update(){for(var a=this._renderables,b=a.count(),e=0;e<b;e++)a.getAt(e).update(this)}
function MG3dRegion_dispose(){this._renderables=RObject.free(this._renderables);this._allRenderables=RObject.free(this._allRenderables)}
function MG3dRenderable(a){a=RClass.inherits(this,a,MGraphicRenderable);a._optionMerge=!1;a._currentMatrix=null;a._matrix=null;a._materialName=null;a._material=null;a._activeInfo=null;a._infos=null;a.construct=MG3dRenderable_construct;a.currentMatrix=MG3dRenderable_currentMatrix;a.matrix=MG3dRenderable_matrix;a.material=MG3dRenderable_material;a.activeEffect=MG3dRenderable_activeEffect;a.activeInfo=MG3dRenderable_activeInfo;a.effectFind=MG3dRenderable_effectFind;a.effectSet=MG3dRenderable_effectSet;
a.infos=MG3dRenderable_infos;a.selectInfo=MG3dRenderable_selectInfo;a.resetInfos=MG3dRenderable_resetInfos;a.testVisible=RMethod.virtual(a,"testVisible");a.update=MG3dRenderable_update;a.dispose=MG3dRenderable_dispose;return a}function MG3dRenderable_construct(){this._currentMatrix=new SMatrix3d;this._matrix=new SMatrix3d;this._material=RClass.create(FG3dMaterial)}function MG3dRenderable_currentMatrix(){return this._currentMatrix}function MG3dRenderable_matrix(){return this._matrix}
function MG3dRenderable_activeEffect(){var a=this._activeInfo;return a?a.effect:null}function MG3dRenderable_activeInfo(){return this._activeInfo}function MG3dRenderable_effectFind(a){var b=this._infos;return b&&(a=b.get(a))?a.effect:null}function MG3dRenderable_effectSet(a,b){var e=this.infos().get(a);e||(e=new SG3dRenderableInfo,es.set(a,e));e.effect=b}function MG3dRenderable_infos(){var a=this._infos;a||(a=this._infos=new TDictionary);return a}
function MG3dRenderable_selectInfo(a){var b=this.infos(),e=b.get(a);e||(e=new SG3dRenderableInfo,b.set(a,e));return this._activeInfo=e}function MG3dRenderable_resetInfos(){var a=this._infos;if(a)for(var b=a.count()-1;0<=b;b--)a.valueAt(b).reset()}function MG3dRenderable_material(){return this._material}function MG3dRenderable_update(a){}
function MG3dRenderable_dispose(){this._currentMatrix=RObject.dispose(this._currentMatrix);this._matrix=RObject.dispose(this._matrix);this._material=RObject.dispose(this._material);this._infos=RObject.dispose(this._infos)}
function SG3dEffectInfo(){this.supportInstance=this.optionNormalInvert=this.optionAlphaTest=this.blendTargetMode=this.blendSourceMode=this.optionBlendMode=this.optionDepthWrite=this.depthModeCd=this.optionDepthTest=this.cullModeCd=this.optionCullMode=this.fillModeCd=this.mergeCount=this.optionMerge=this.techniqueModeCode=this.techniqueCode=this.code=null;this.vertexCount=0;this.vertexSkeleton=this.vertexNormalFull=this.vertexNormal=this.vertexCoord=this.vertexColor=null;this.vertexBoneCount=0;this.fragmentHeight=
this.fragmentEmissive=this.fragmentRefract=this.fragmentReflect=this.fragmentLight=this.fragmentEnvironment=this.fragmentSpecularView=this.fragmentSpecularLevel=this.fragmentSpecularColor=this.fragmentDiffuseView=this.fragmentDiffuse=this.fragmentAmbient=this.fragmentBump=this.fragmentAlpha=null;this.attributes=new TArray;this.samplers=new TArray;this.attributeContains=SG3dEffectInfo_attributeContains;this.samplerContains=SG3dEffectInfo_samplerContains;this.reset=SG3dEffectInfo_reset;this.reset();
return this}function SG3dEffectInfo_attributeContains(a){return this.attributes.contains(a)}function SG3dEffectInfo_samplerContains(a){return this.samplers.contains(a)}
function SG3dEffectInfo_reset(){this.code=null;this.optionMerge=!1;this.mergeCount=0;this.fillModeCd=EG3dFillMode.Fill;this.optionCullMode=!0;this.cullModeCd=EG3dCullMode.Front;this.optionDepthTest=!0;this.depthModeCd=EG3dDepthMode.Less;this.optionDepthWrite=!0;this.optionBlendMode=!1;this.blendSourceMode=EG3dBlendMode.SourceAlpha;this.blendTargetMode=EG3dBlendMode.OneMinusSourceAlpha;this.supportInstance=this.optionNormalInvert=this.optionAlphaTest=!1;this.vertexCount=0;this.vertexSkeleton=this.vertexNormalFull=
this.vertexNormal=this.vertexCoord=this.vertexColor=!1;this.vertexBoneCount=0;this.fragmentHeight=this.fragmentEmissive=this.fragmentRefract=this.fragmentReflect=this.fragmentLight=this.fragmentEnvironment=this.fragmentSpecularView=this.fragmentSpecularLevel=this.fragmentSpecularColor=this.fragmentDiffuseView=this.fragmentDiffuse=this.fragmentAmbient=this.fragmentBump=this.fragmentAlpha=!1;this.attributes.clear();this.samplers.clear()}
function SG3dMaterialInfo(a){a||(a=this);a.effectCode="automatic";a.optionDepth=!1;a.optionDouble=null;a.optionNormalInvert=null;a.optionShadow=null;a.optionShadowSelf=null;a.optionAlpha=null;a.alphaBase=1;a.alphaRate=1;a.alphaLevel=1;a.alphaMerge=1;a.optionColor=null;a.colorMin=0;a.colorMax=1;a.colorRate=1;a.colorMerge=1;a.optionAmbient=null;a.ambientColor=new SColor4;a.ambientShadow=1;a.optionDiffuse=null;a.diffuseColor=new SColor4;a.diffuseShadow=1;a.optionDiffuseView=null;a.diffuseViewColor=new SColor4;
a.diffuseViewShadow=1;a.optionSpecular=null;a.specularColor=new SColor4;a.specularBase=1;a.specularLevel=1;a.specularAverage=1;a.specularShadow=1;a.specularInfo=null;a.optionSpecularView=null;a.specularViewColor=new SColor4;a.specularViewBase=1;a.specularViewRate=1;a.specularViewAverage=1;a.specularViewShadow=1;a.specularViewShadow=null;a.optionReflect=null;a.reflectColor=new SColor4;a.reflectMerge=1;a.reflectShadow=1;a.optionRefract=null;a.refractFrontColor=new SColor4;a.refractBackColor=new SColor4;
a.optionOpacity=null;a.opacityColor=new SColor4;a.opacityRate=1;a.opacityAlpha=1;a.opacityDepth=1;a.opacityTransmittance=1;a.optionEmissive=null;a.emissiveColor=new SColor4;a.assign=SG3dMaterialInfo_assign;a.calculate=SG3dMaterialInfo_calculate;a.reset=SG3dMaterialInfo_reset;a.reset();return a}
function SG3dMaterialInfo_assign(a){this.effectCode=a.effectCode;this.transformName=a.transformName;this.optionDepth=a.optionDepth;this.optionDouble=a.optionDouble;this.optionNormalInvert=a.optionNormalInvert;this.optionShadow=a.optionShadow;this.optionShadowSelf=a.optionShadowSelf;this.optionColor=a.optionColor;this.colorMin=a.colorMin;this.colorMax=a.colorMax;this.colorRate=a.colorRate;this.colorMerge=a.colorMerge;this.optionAlpha=a.optionAlpha;this.alphaBase=a.alphaBase;this.alphaRate=a.alphaRate;
this.alphaLevel=a.alphaLevel;this.alphaMerge=a.alphaMerge;this.optionAmbient=a.optionAmbient;this.ambientColor.assign(a.ambientColor);this.ambientShadow=a.ambientShadow;this.optionDiffuse=a.optionDiffuse;this.diffuseColor.assign(a.diffuseColor);this.diffuseShadow=a.diffuseShadow;this.optionDiffuseView=a.optionDiffuseView;this.diffuseViewColor.assign(a.diffuseViewColor);this.diffuseViewShadow=a.diffuseViewShadow;this.optionSpecular=a.optionSpecular;this.specularColor.assign(a.specularColor);this.specularBase=
a.specularBase;this.specularLevel=a.specularLevel;this.specularAverage=a.specularAverage;this.specularShadow=a.specularShadow;this.optionSpecularView=a.optionSpecularView;this.specularViewColor.assign(a.specularViewColor);this.specularViewBase=a.specularViewBase;this.specularViewRate=a.specularViewRate;this.specularViewAverage=a.specularViewAverage;this.specularViewShadow=a.specularViewShadow;this.optionReflect=a.optionReflect;this.reflectColor.assign(a.reflectColor);this.reflectMerge=RFloat.toRange(a.reflectMerge,
0,2);this.reflectShadow=a.reflectShadow;this.optionRefract=a.optionRefract;this.refractFrontColor.assign(a.refractFrontColor);this.refractFrontMerge=a.refractFrontMerge;this.refractFrontShadow=a.refractFrontShadow;this.refractBackColor.assign(a.refractBackColor);this.refractBackMerge=a.refractBackMerge;this.refractBackShadow=a.refractBackShadow;this.optionOpacity=a.optionOpacity;this.opacityColor.assign(a.opacityColor);this.opacityRate=a.opacityRate;this.opacityAlpha=a.optionAlpha;this.opacityDepth=
a.optionDepth;this.opacityTransmittance=a.optionTransmittance;this.optionEmissive=a.optionEmissive;this.emissiveColor.assign(a.emissiveColor)}
function SG3dMaterialInfo_calculate(a){this.effectCode=a.effectCode;this.transformName=a.transformName;this.optionDepth=a.optionDepth;this.optionDouble=a.optionDouble;this.optionNormalInvert=a.optionNormalInvert;this.optionShadow=a.optionShadow;this.optionShadowSelf=a.optionShadowSelf;this.optionColor=a.optionColor;this.colorMin=a.colorMin;this.colorMax=a.colorMax;this.colorRate=a.colorRate;this.colorMerge=a.colorMerge;this.optionAlpha=a.optionAlpha;this.alphaBase=a.alphaBase;this.alphaRate=a.alphaRate;
this.alphaLevel=a.alphaLevel;this.alphaMerge=a.alphaMerge;this.optionAmbient=a.optionAmbient;this.ambientColor.assignPower(a.ambientColor);this.ambientShadow=a.ambientShadow;this.optionDiffuse=a.optionDiffuse;this.diffuseColor.assignPower(a.diffuseColor);this.diffuseShadow=a.diffuseShadow;this.optionDiffuseView=a.optionDiffuseView;this.diffuseViewColor.assignPower(a.diffuseViewColor);this.diffuseViewShadow=a.diffuseViewShadow;this.optionSpecular=a.optionSpecular;this.specularColor.assignPower(a.specularColor);
this.specularBase=a.specularBase;this.specularLevel=a.specularLevel;this.specularAverage=a.specularAverage;this.specularShadow=a.specularShadow;this.optionSpecularView=a.optionSpecularView;this.specularViewColor.assignPower(a.specularViewColor);this.specularViewBase=a.specularViewBase;this.specularViewRate=a.specularViewRate;this.specularViewAverage=a.specularViewAverage;this.specularViewShadow=a.specularViewShadow;this.optionReflect=a.optionReflect;this.reflectColor.assignPower(a.reflectColor);this.reflectMerge=
RFloat.toRange(a.reflectMerge,0,2);this.reflectShadow=a.reflectShadow;this.optionRefract=a.optionRefract;this.refractFrontColor.assignPower(a.refractFrontColor);this.refractFrontMerge=a.refractFrontMerge;this.refractFrontShadow=a.refractFrontShadow;this.refractBackColor.assignPower(a.refractBackColor);this.refractBackMerge=a.refractBackMerge;this.refractBackShadow=a.refractBackShadow;this.optionOpacity=a.optionOpacity;this.opacityColor.assignPower(a.opacityColor);this.opacityRate=a.opacityRate;this.opacityAlpha=
a.optionAlpha;this.opacityDepth=a.optionDepth;this.opacityTransmittance=a.optionTransmittance;this.optionEmissive=a.optionEmissive;this.emissiveColor.assignPower(a.emissiveColor)}
function SG3dMaterialInfo_reset(){this.optionDepth=!0;this.optionNormalInvert=this.optionDouble=!1;this.optionColor=this.optionShadowSelf=this.optionShadow=!0;this.colorMin=0;this.colorMerge=this.colorRate=this.colorMax=1;this.optionAlpha=!1;this.alphaBase=.2;this.alphaMerge=this.alphaLevel=this.alphaRate=1;this.optionAmbient=!0;this.ambientColor.set(.5,.5,.5,1);this.ambientShadow=1;this.optionDiffuse=!0;this.diffuseColor.set(.5,.5,.5,1);this.diffuseShadow=1;this.optionDiffuseView=!0;this.diffuseViewColor.set(1,
1,1,1);this.diffuseViewShadow=1;this.optionSpecular=!0;this.specularColor.set(.5,.5,.5,1);this.specularBase=0;this.specularLevel=16;this.specularShadow=this.specularAverage=1;this.optionSpecularView=!0;this.specularViewColor.set(1,1,1,1);this.specularViewBase=0;this.specularViewRate=16;this.specularViewShadow=this.specularViewAverage=1;this.optionReflect=!0;this.reflectColor.set(1,1,1,1);this.reflectShadow=this.reflectMerge=1;this.optionRefract=!0;this.refractFrontColor.set(1,1,1,1);this.refractFrontShadow=
this.refractFrontMerge=1;this.refractBackColor.set(1,1,1,1);this.refractBackShadow=this.refractBackMerge=1;this.optionOpacity=!0;this.opacityColor.set(1,1,1,1);this.opacityTransmittance=this.opacityDepth=this.opacityAlpha=this.opacityRate=1;this.optionEmissive=!0;this.emissiveColor.set(1,1,1,1)}function SG3dRenderableInfo(){this.material=this.layout=this.effect=null;this.reset=SG3dRenderableInfo_reset;return this}
function SG3dRenderableInfo_reset(){this.effect=null;this.layout=RObject.dispose(this.layout)}function FG3dAnimation(a){a=RClass.inherits(this,a,FObject);a._baseTick=0;a._currentTick=0;a._lastTick=0;a._bones=null;a.construct=FG3dAnimation_construct;a.findBone=FG3dAnimation_findBone;a.process=FG3dAnimation_process;a.dispose=FG3dAnimation_dispose;return a}function FG3dAnimation_construct(){this.__base.FObject.construct.call(this);this._bones=new TObjects}
function FG3dAnimation_findBone(a){for(var b=this._bones,e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h.boneId()==a)return h}return null}function FG3dAnimation_process(){var a=RTimer.current();0==this._lastTick&&(this._lastTick=a);this._currentTick=(a-this._lastTick+this._baseTick)/1E3;for(var a=this._bones,b=a.count(),e=0;e<b;e++)a.get(e).update(this._currentTick);return!0}function FG3dAnimation_dispose(){this._bones.dispose();this._bones=null;this.__base.FObject.dispose.call(this)}
function FG3dBaseMaterial(a){a=RClass.inherits(this,a,FObject);a._name=null;a._visible=!0;a._info=null;a._reference=null;a.construct=FG3dBaseMaterial_construct;a.visible=FG3dBaseMaterial_visible;a.setVisible=FG3dBaseMaterial_setVisible;a.info=FG3dBaseMaterial_info;a.reference=FG3dBaseMaterial_reference;a.testVisible=FG3dBaseMaterial_testVisible;a.assignInfo=FG3dBaseMaterial_assignInfo;a.assign=FG3dBaseMaterial_assign;a.calculate=FG3dBaseMaterial_calculate;return a}
function FG3dBaseMaterial_construct(){this.__base.FObject.construct.call(this);this._info=new SG3dMaterialInfo}function FG3dBaseMaterial_visible(){return this._visible}function FG3dBaseMaterial_setVisible(a){this._visible=a}function FG3dBaseMaterial_info(){return this._info}function FG3dBaseMaterial_reference(){return this._reference}function FG3dBaseMaterial_testVisible(){var a=this._visible;a&&this._reference&&(a=this._reference.testVisible());return a}
function FG3dBaseMaterial_assignInfo(a){this._info.assign(a)}function FG3dBaseMaterial_assign(a){this._reference=a;this._info.assign(a.info())}function FG3dBaseMaterial_calculate(a){this._reference=a;this._info.calculate(a.info())}function FG3dBone(a){a=RClass.inherits(this,a,FObject);a._boneId=0;a._modeId=null;a.update=FG3dBone_update;return a}function FG3dBone_update(a){}
function FG3dCamera(a){a=RClass.inherits(this,a,FObject);a._matrix=null;a._position=null;a._target=null;a._direction=null;a._directionTarget=null;a._centerFront=.6;a._centerBack=1;a._focalNear=.1;a._focalFar=200;a._planes=null;a._frustum=null;a._viewport=null;a.__axisUp=null;a.__axisX=null;a.__axisY=null;a.__axisZ=null;a.construct=FG3dCamera_construct;a.matrix=FG3dCamera_matrix;a.position=FG3dCamera_position;a.setPosition=FG3dCamera_setPosition;a.direction=FG3dCamera_direction;a.setDirection=FG3dCamera_setDirection;
a.frustum=FG3dCamera_frustum;a.doWalk=FG3dCamera_doWalk;a.doStrafe=FG3dCamera_doStrafe;a.doFly=FG3dCamera_doFly;a.doPitch=FG3dCamera_doPitch;a.doYaw=FG3dCamera_doYaw;a.doRoll=FG3dCamera_doRoll;a.lookAt=FG3dCamera_lookAt;a.update=FG3dCamera_update;return a}
function FG3dCamera_construct(){this.__base.FObject.construct.call(this);this._matrix=new SMatrix3d;this._position=new SPoint3;this._target=new SPoint3;this._direction=new SVector3;this._directionTarget=new SVector3;this._planes=[];this._frustum=new SFrustum;this._viewport=RClass.create(FG3dViewport);this.__axisUp=new SVector3;this.__axisUp.set(0,1,0);this.__axisX=new SVector3;this.__axisY=new SVector3;this.__axisZ=new SVector3}function FG3dCamera_position(){return this._position}
function FG3dCamera_matrix(){return this._matrix}function FG3dCamera_setPosition(a,b,e){this._position.set(a,b,e)}function FG3dCamera_direction(){return this._direction}function FG3dCamera_setDirection(a,b,e){this._direction.set(a,b,e);this._directionTarget.set(a,b,e)}function FG3dCamera_frustum(){return this._frustum}function FG3dCamera_doWalk(a){this._position.x+=this._direction.x*a;this._position.z+=this._direction.z*a}
function FG3dCamera_doStrafe(a){this._position.x+=this.__axisY.x*a;this._position.z+=this.__axisY.z*a}function FG3dCamera_doFly(a){this._position.y+=a}function FG3dCamera_doPitch(a){throw new TFatal(this,"Unsupport.");}function FG3dCamera_doYaw(a){throw new TFatal(this,"Unsupport.");}function FG3dCamera_doRoll(a){throw new TFatal(this,"Unsupport.");}
function FG3dCamera_lookAt(a,b,e){var f=this._position,h=this._direction;this._target.set(a,b,e);h.set(a-f.x,b-f.y,e-f.z);h.normalize();this._directionTarget.assign(h)}
function FG3dCamera_update(){var a=this.__axisX,b=this.__axisY,e=this.__axisZ;e.assign(this._direction);e.normalize();this.__axisUp.cross2(a,e);a.normalize();e.cross2(b,a);b.normalize();var f=this._matrix.data();f[0]=a.x;f[1]=b.x;f[2]=e.x;f[3]=0;f[4]=a.y;f[5]=b.y;f[6]=e.y;f[7]=0;f[8]=a.z;f[9]=b.z;f[10]=e.z;f[11]=0;f[12]=-a.dotPoint3(this._position);f[13]=-b.dotPoint3(this._position);f[14]=-e.dotPoint3(this._position);f[15]=1}
function FG3dDirectionalLight(a){a=RClass.inherits(this,a,FG3dLight);a._camera=null;a._viewport=null;a._direction=null;a.construct=FG3dDirectionalLight_construct;a.camera=FG3dDirectionalLight_camera;a.projection=FG3dDirectionalLight_projection;a.viewport=FG3dDirectionalLight_viewport;a.direction=FG3dDirectionalLight_direction;return a}
function FG3dDirectionalLight_construct(){this.__base.FG3dLight.construct.call(this);this._direction=new SVector3;this._camera=RClass.create(FG3dPerspectiveCamera)}function FG3dDirectionalLight_camera(){return this._camera}function FG3dDirectionalLight_projection(){return this._projection}function FG3dDirectionalLight_viewport(){return this._viewport}function FG3dDirectionalLight_direction(){return this._direction}
function FG3dEffect(a){a=RClass.inherits(this,a,FG3dObject);a._code=null;a._stateFillCd=EG3dFillMode.Face;a._stateCullCd=EG3dCullMode.Front;a._stateDepth=!0;a._stateDepthCd=EG3dDepthMode.LessEqual;a._stateDepthWrite=!0;a._stateBlend=!0;a._stateBlendSourceCd=EG3dBlendMode.SourceAlpha;a._stateBlendTargetCd=EG3dBlendMode.OneMinusSourceAlpha;a._stateAlphaTest=!1;a._optionShadow=!1;a._optionLightMap=!1;a._optionFog=!1;a._program=null;a._vertexTemplate=null;a._fragmentTemplate=null;a.setup=RMethod.empty;
a.code=FG3dEffect_code;a.program=FG3dEffect_program;a.setParameter=FG3dEffect_setParameter;a.setSampler=FG3dEffect_setSampler;a.drawRenderable=FG3dEffect_drawRenderable;a.drawGroup=FG3dEffect_drawGroup;a.drawRegion=FG3dEffect_drawRegion;a.buildInfo=FG3dEffect_buildInfo;a.loadConfig=FG3dEffect_loadConfig;a.load=FG3dEffect_load;a.build=FG3dEffect_build;return a}function FG3dEffect_code(){return this._code}function FG3dEffect_program(){return this._program}
function FG3dEffect_setParameter(a,b,e){this._program.setParameter(a,b,e)}function FG3dEffect_setSampler(a,b){this._program.setSampler(a,b)}function FG3dEffect_buildInfo(a,b){}
function FG3dEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program;if(f.hasAttribute())for(var h=f.attributes(),k=h.count(),q=0;q<k;q++){var t=h.value(q);if(t._statusUsed){var u=r.findVertexBuffer(t._linker);if(!u)throw new TError("Can't find renderable vertex buffer. (linker={1})",t._linker);f.setAttribute(t._name,u,u._formatCd)}}f=r.indexBuffer();e.drawTriangles(f,0,f.count())}
function FG3dEffect_drawGroup(a,b,e,f){this._graphicContext.setProgram(this._program);for(var h=0;h<f;h++)this.drawRenderable(a,b.getAt(e+h))}function FG3dEffect_drawRegion(a,b,e){for(var f=a.renderables(),h=0;h<e;){for(var k=h,q=e,t=f.getAt(b+k)._materialReference,u=h;u<e;u++){var x=f.getAt(b+u)._materialReference;if(t!=x){q=u;break}h++}this.drawGroup(a,f,b+k,q-k)}}
function FG3dEffect_loadConfig(a){var b=this._graphicContext,e=this._program=b.createProgram();a=a.nodes();for(var b=a.count(),f=0;f<b;f++){var h=a.get(f);if(h.isName("State")){var k=h.get("name"),q=h.get("value");if("fill_mode"==k)this._stateFillCd=REnum.parse(EG3dFillMode,q);else if("cull_mode"==k)this._stateCullCd=REnum.parse(EG3dCullMode,q);else if("depth_mode"==k)this._stateDepth=!0,this._stateDepthCd=REnum.parse(EG3dDepthMode,q);else if("depth_write"==k)this._stateDepthWrite=RBoolean.parse(q);
else if("blend_mode"==k){if(this._stateBlend=RBoolean.parse(q))this._stateBlendSourceCd=REnum.parse(EG3dBlendMode,h.get("source")),this._stateBlendTargetCd=REnum.parse(EG3dBlendMode,h.get("target"))}else"alpha_test"==k&&(this._stateAlphaTest=RBoolean.parse(q))}else if(h.isName("Option"))k=h.get("name"),q=h.get("value"),"shadow"==k?this._optionShadow=RBoolean.parse(q):"lightmap"==k?this._optionLightMap=RBoolean.parse(q):"fog"==k&&(this._optionFog=RBoolean.parse(q));else if(h.isName("Parameter"))k=
RClass.create(FG3dProgramParameter),k.loadConfig(h),e.parameters().set(k.name(),k);else if(h.isName("Attribute"))k=RClass.create(FG3dProgramAttribute),k.loadConfig(h),e.attributes().set(k.name(),k);else if(h.isName("Sampler"))k=RClass.create(FG3dProgramSampler),k.loadConfig(h),e.samplers().set(k.name(),k);else if(h.isName("Source"))if(k=h.get("name"),"vertex"==k)this._vertexSource=h.value();else if("fragment"==k)this._fragmentSource=h.value();else throw new TError(this,"Unknown source type. (name={1})",
nt);else throw new TError(this,"Unknown config type. (name={1})",h.name());}(this._vertexTemplate=RClass.create(FG3dShaderTemplate)).load(this._vertexSource);(this._fragmentTemplate=RClass.create(FG3dShaderTemplate)).load(this._fragmentSource)}
function FG3dEffect_build(a){var b=this._program,e=b._parameters,f=e.count(),h=RInstance.get(FTagContext);this.buildInfo(h,a);a=this._vertexTemplate.parse(h);a=RString.formatLines(a);b.upload(EG3dShader.Vertex,a);h=this._fragmentTemplate.parse(h);for(a=0;a<f;a++){var k=e.value(a),q=k.name();(k=k.define())&&(h=h.replace(new RegExp(q,"g"),k))}e=RString.formatLines(h);b.upload(EG3dShader.Fragment,e);b.build();b.link()}
function FG3dEffect_load(){var a=RConsole.find(FG3dEffectConsole).loadConfig(this._code);this.loadConfig(a)}
function FG3dEffectConsole(a){a=RClass.inherits(this,a,FConsole);a._configs=null;a._registerEffects=null;a._templateEffects=null;a._effects=null;a._path="/ar3/shader/";a._effectInfo=null;a._tagContext=null;a.construct=FG3dEffectConsole_construct;a.path=FG3dEffectConsole_path;a.register=FG3dEffectConsole_register;a.unregister=FG3dEffectConsole_unregister;a.create=FG3dEffectConsole_create;a.buildEffectInfo=FG3dEffectConsole_buildEffectInfo;a.findTemplate=FG3dEffectConsole_findTemplate;a.find=FG3dEffectConsole_find;
a.loadConfig=FG3dEffectConsole_loadConfig;return a}function FG3dEffectConsole_construct(){this.__base.FConsole.construct.call(this);this._configs=new TDictionary;this._registerEffects=new TDictionary;this._templateEffects=new TDictionary;this._effects=new TDictionary;this._effectInfo=new SG3dEffectInfo;this._tagContext=RClass.create(FTagContext)}function FG3dEffectConsole_path(){return this._path}function FG3dEffectConsole_register(a,b){this._registerEffects.set(a,b)}
function FG3dEffectConsole_unregister(a){this._registerEffects.set(a,null)}function FG3dEffectConsole_create(a,b){var e=this._registerEffects.get(b);if(!e)throw new TError(this,"Unknown effect type name. (type={1})",e);e=RClass.create(e);e.linkGraphicContext(a);e.setup();return e}
function FG3dEffectConsole_buildEffectInfo(a,b,e,f){e=e.technique();b.techniqueModeCode=e.activeMode().code();b.optionMerge=f._optionMerge;b.optionMerge&&(b.mergeCount=f.mergeCount());e=f.material().info();b.optionNormalInvert=e.optionNormalInvert;b.optionAmbient=e.optionAmbient;b.optionDiffuse=e.optionDiffuse;b.optionSpecular=e.optionSpecular;b.optionReflect=e.optionReflect;b.optionRefract=e.optionRefract;b.vertexCount=f.vertexCount();var h=f.vertexBuffers();e=h.count();if(h.constructor==TDictionary)for(var k=
0;k<e;k++){var q=h.value(k);b.attributes.push(q.name())}else for(k=0;k<e;k++)q=h.get(k),b.attributes.push(q.name());if(h=f.textures())for(e=h.count(),k=0;k<e;k++)b.samplers.push(h.name(k));if(e=f.bones())e=e.count(),b.vertexBoneCount=e,a=a.capability().calculateBoneCount(b.vertexBoneCount,b.vertexCount),e>a&&(e=a),f._boneLimit=e,b.vertexBoneLimit=e}
function FG3dEffectConsole_findTemplate(a,b){var e=this._templateEffects,f=e.get(b);null==f&&(f=this.create(a,b),f.load(),RLogger.info(this,"Create effect template. (name={1}, instance={2})",b,f),e.set(b,f));return f}
function FG3dEffectConsole_find(a,b,e){var f=e.material().info().effectCode;RString.isEmpty(f)&&(f="automatic");var h=b.spaceName()+"."+f,k=this.findTemplate(a,h);if(k){this._effectInfo.reset();this.buildEffectInfo(a,this._effectInfo,b,e);k.buildInfo(this._tagContext,this._effectInfo);b=h+this._tagContext.code;e=this._effects;var q=e.get(b);null==q&&(q=this.create(a,h),q._flag=b,q.load(),q.build(this._effectInfo),RLogger.info(this,"Create effect. (name={1}, instance={2})",f,q));e.set(b,q)}return q}
function FG3dEffectConsole_loadConfig(a){var b=this._configs.get(a);if(b)return b;b=RBrowser.contentPath(this._path+a+".xml");RRuntime.isDebug()&&(b+="?"+RDate.format());b=RClass.create(FXmlConnection).send(b);this._configs.set(a,b);return b}function FG3dLight(a){return a=RClass.inherits(this,a,FObject)}function FG3dLightMaterial(a){return a=RClass.inherits(this,a,FG3dBaseMaterial)}
function FG3dMaterial(a){a=RClass.inherits(this,a,FG3dBaseMaterial);a._dirty=!0;a._textures=null;a.textures=FG3dMaterial_textures;a.update=FG3dMaterial_update;return a}function FG3dMaterial_textures(){return this._textures}function FG3dMaterial_update(){this._dirty=!0}
function FG3dMaterialMap(a){a=RClass.inherits(this,a,FObject,MGraphicObject);a._size=null;a._data=null;a._texture=null;a._stride=null;a._dirty=!1;a.construct=FG3dMaterialMap_construct;a.size=FG3dMaterialMap_size;a.data=FG3dMaterialMap_data;a.texture=FG3dMaterialMap_texture;a.setup=FG3dMaterialMap_setup;a.resize=FG3dMaterialMap_resize;a.setUint8=FG3dMaterialMap_setUint8;a.setUint16=FG3dMaterialMap_setUint16;a.setUint32=FG3dMaterialMap_setUint32;a.setFloat16=FG3dMaterialMap_setFloat16;a.setFloat32=
FG3dMaterialMap_setFloat32;a.update=FG3dMaterialMap_update;return a}function FG3dMaterialMap_construct(){this.__base.FObject.construct.call(this);this._size=new SSize2}function FG3dMaterialMap_size(){return this._size}function FG3dMaterialMap_data(){return this._data}function FG3dMaterialMap_texture(){return this._texture}
function FG3dMaterialMap_setup(a,b){var e=this._texture=this._graphicContext.createFlatTexture();this.resize(a,b);e.setFilter(EG3dSamplerFilter.Nearest,EG3dSamplerFilter.Nearest);e.uploadData(this._data,a,b)}function FG3dMaterialMap_resize(a,b){var e=this._size;2048<b?b=4096:1024<b?b=2048:512<b?b=1024:256<b?b=512:128<b?b=256:64<b?b=128:32<b?b=64:16<b&&(b=32);b<e.height&&(b=e.height);if(e.width!=a||e.height!=b)e.set(a,b),this._stride=4*a,this._data=new Uint8Array(4*a*b)}
function FG3dMaterialMap_setUint8(a,b,e,f,h,k){var q=this._data;a=this._stride*a+(b<<2);e.constructor==SColor4?(f=255*e.red,q[a]!=f&&(this._dirty=!0),q[a++]=f,f=255*e.green,q[a]!=f&&(this._dirty=!0),q[a++]=f,f=255*e.blue,q[a]!=f&&(this._dirty=!0),q[a++]=f,f=255*e.alpha,q[a]!=f&&(this._dirty=!0),q[a++]=f):(q[a++]=e,q[a++]=f,q[a++]=h,q[a++]=k)}
function FG3dMaterialMap_setUint16(a,b,e,f){var h=this._data;a=this._stride*a+(b<<2);h[a++]=e>>8&255;h[a++]=e&255;h[a++]=f>>8&255;h[a++]=f&255;this._dirty=!0}function FG3dMaterialMap_setUint32(a,b,e){var f=this._data;a=this._stride*a+(b<<2);f[a++]=e>>24&255;f[a++]=e>>16&255;f[a++]=e>>8&255;f[a++]=e&255;this._dirty=!0}
function FG3dMaterialMap_setFloat16(a,b,e,f){var h=this._data;a=this._stride*a+(b<<2);parseInt(256*e);h[a++]=parseInt(e)&255;h[a++]=parseInt(256*e)&255;h[a++]=parseInt(f)&255;h[a++]=parseInt(256*f)&255;this._dirty=!0}function FG3dMaterialMap_setFloat32(a,b,e){var f=this._data;a=this._stride*a+(b<<2);f[a++]=parseInt(.00390625*e)&255;f[a++]=parseInt(e)&255;f[a++]=parseInt(256*e)&255;f[a++]=parseInt(65536*e)&255;this._dirty=!0}
function FG3dMaterialMap_update(){if(this._dirty){var a=this._size;this._texture.uploadData(this._data,a.width,a.height);this._dirty=!1}}function FG3dMaterialTexture(a){a=RClass.inherits(this,a,FG3dMaterial);a._texture=null;a.construct=FG3dMaterialTexture_construct;return a}function FG3dMaterialTexture_construct(){}function FG3dObject(a){a=RClass.inherits(this,a,FObject,MGraphicObject);a.setup=FG3dObject_setup;a.dispose=FG3dObject_dispose;return a}function FG3dObject_setup(){}
function FG3dObject_dispose(){this.__base.MGraphicObject.dispose.call(this);this.__base.FObject.dispose.call(this)}function FG3dOrthoCamera(a){a=RClass.inherits(this,a,FG3dCamera);a._projection=null;a.construct=FG3dOrthoCamera_construct;a.projection=FG3dOrthoCamera_projection;a.updateFrustum=FG3dOrthoCamera_updateFrustum;a.updateFromCamera=FG3dOrthoCamera_updateFromCamera;a.updateFlatCamera=FG3dOrthoCamera_updateFlatCamera;return a}
function FG3dOrthoCamera_construct(){this.__base.FG3dCamera.construct.call(this);this._projection=RClass.create(FG3dOrthoProjection)}function FG3dOrthoCamera_projection(){return this._projection}function FG3dOrthoCamera_updateFrustum(){var a=this._projection,b=a._size,e=this._frustum;e.update(a._angle,b.width,b.height,a._znear,a._zfar,this._centerFront,this._centerBack,this._matrix);return e}
function FG3dOrthoCamera_updateFromCamera(a){a=a.updateFrustum();var b=this._direction;b.normalize();this._position.set(a.center.x-b.x*a.radius,a.center.y-b.y*a.radius,a.center.z-b.z*a.radius);this.lookAt(a.center.x,a.center.y,a.center.z);this.update();b=this._frustum;this._matrix.transform(b.coners,a.coners,8);b.updateCenter();this._projection.updateFrustum(b)}
function FG3dOrthoCamera_updateFlatCamera(a){var b=a.updateFlatFrustum(),e=RMath.DEGREE_RATE*this._projection.angle(),e=b.radius/Math.sin(.5*e),e=Math.max(e,a._projection._zfar);a=this._direction;a.normalize();this._position.set(b.center.x-a.x*e,b.center.y-a.y*e,b.center.z-a.z*e);this.lookAt(b.center.x,b.center.y,b.center.z);this.update();this._projection._znear=.3;this._projection._zfar=1.5*e;this._projection.update()}
function FG3dOrthoProjection(a){a=RClass.inherits(this,a,FG3dProjection);a._matrix=null;a.construct=FG3dOrthoProjection_construct;a.matrix=FG3dOrthoProjection_matrix;a.update=FG3dOrthoProjection_update;a.updateFrustum=FG3dOrthoProjection_updateFrustum;return a}function FG3dOrthoProjection_construct(){this.__base.FG3dProjection.construct.call(this);this._matrix=new SOrthoMatrix3d}function FG3dOrthoProjection_matrix(){return this._matrix}
function FG3dOrthoProjection_update(){var a=this._size;this._matrix.identity();var b=this._matrix.data();b[0]=2/a.width*8;b[4]=b[8]=b[12]=0;b[5]=2/a.height*8;b[1]=b[9]=b[13]=0;b[10]=1/(this._znear-this._zfar);b[2]=b[6]=b[14]=0;b[3]=b[7]=0;b[11]=this._znear/(this._znear-this._zfar);b[15]=1}function FG3dOrthoProjection_updateFrustum(a){this._znear=a.minZ;this._zfar=a.maxZ;this.update()}
function FG3dPerspectiveCamera(a){a=RClass.inherits(this,a,FG3dCamera);a._projection=null;a._centerFront=.4;a.construct=FG3dPerspectiveCamera_construct;a.projection=FG3dPerspectiveCamera_projection;a.updateFrustum=FG3dPerspectiveCamera_updateFrustum;a.updateFlatFrustum=FG3dPerspectiveCamera_updateFlatFrustum;a.updateFromCamera=FG3dPerspectiveCamera_updateFromCamera;a.updateFlatCamera=FG3dPerspectiveCamera_updateFlatCamera;return a}
function FG3dPerspectiveCamera_construct(){this.__base.FG3dCamera.construct.call(this);this._projection=RClass.create(FG3dPerspectiveProjection)}function FG3dPerspectiveCamera_projection(){return this._projection}function FG3dPerspectiveCamera_updateFrustum(){var a=this._projection,b=a._size,e=this._frustum;e.update(a._angle,b.width,b.height,a._znear,a._zfar,this._centerFront,this._centerBack,this._matrix);return e}
function FG3dPerspectiveCamera_updateFlatFrustum(){var a=this._projection,b=a._size,e=this._frustum;e.updateFlat(a._angle,b.width,b.height,a._znear,a._zfar,this._centerFront,this._centerBack,this._matrix);return e}
function FG3dPerspectiveCamera_updateFromCamera(a){var b=this._frustum,e=a.updateFrustum(),f=RMath.DEGREE_RATE*this._projection.angle(),f=e.radius/Math.sin(.5*f),f=Math.max(f,a._projection._zfar);a=this._direction;a.normalize();this._position.set(e.center.x-a.x*f,e.center.y-a.y*f,e.center.z-a.z*f);this.lookAt(e.center.x,e.center.y,e.center.z);this.update();this._matrix.transform(b.coners,e.coners,8);b.updateCenter();this._projection.updateFrustum(b)}
function FG3dPerspectiveCamera_updateFlatCamera(a){var b=a.updateFlatFrustum(),e=RMath.DEGREE_RATE*this._projection.angle(),e=b.radius/Math.sin(.5*e),e=Math.max(e,a._projection._zfar);a=this._direction;a.normalize();this._position.set(b.center.x-a.x*e*this._centerFront,b.center.y-a.y*e*this._centerFront,b.center.z-a.z*e*this._centerFront);this.lookAt(b.center.x,b.center.y,b.center.z);this.update();this._projection._znear=.1;this._projection._zfar=e;this._projection.update()}
function FG3dPerspectiveProjection(a){a=RClass.inherits(this,a,FG3dProjection);a._matrix=null;a.construct=FG3dPerspectiveProjection_construct;a.matrix=FG3dPerspectiveProjection_matrix;a.update=FG3dPerspectiveProjection_update;a.updateFrustum=FG3dPerspectiveProjection_updateFrustum;return a}function FG3dPerspectiveProjection_construct(){this.__base.FG3dProjection.construct.call(this);this._matrix=new SPerspectiveMatrix3d}function FG3dPerspectiveProjection_matrix(){return this._matrix}
function FG3dPerspectiveProjection_update(){var a=this._size;this._fieldOfView=RMath.DEGREE_RATE*this._angle;this._matrix.perspectiveFieldOfViewLH(this._fieldOfView,a.width/a.height,this._znear,this._zfar)}function FG3dPerspectiveProjection_updateFrustum(a){this._znear=a.minZ;this._zfar=a.maxZ;this.update()}function FG3dPointLight(a){return a=RClass.inherits(this,a,FG3dLight)}
function FG3dProjection(a){a=RClass.inherits(this,a,FObject);a._size=null;a._angle=60;a._fieldOfView=0;a._znear=.1;a._zfar=200;a._scale=0;a.construct=FG3dProjection_construct;a.size=FG3dProjection_size;a.angle=FG3dProjection_angle;a.znear=FG3dProjection_znear;a.zfar=FG3dProjection_zfar;a.distance=FG3dProjection_distance;return a}function FG3dProjection_construct(){this.__base.FObject.construct.call(this);this._size=new SSize2}function FG3dProjection_size(){return this._size}
function FG3dProjection_angle(){return this._angle}function FG3dProjection_znear(){return this._znear}function FG3dProjection_zfar(){return this._zfar}function FG3dProjection_distance(){return this._zfar-this._znear}function FG3dShaderTemplate(a){a=RClass.inherits(this,a,FTagDocument);a._space="shader";return a}function FG3dSpotLight(a){return a=RClass.inherits(this,a,FG3dLight)}
function FG3dTechnique(a){a=RClass.inherits(this,a,FG3dObject);a._code=null;a._activeMode=null;a._modes=null;a._passes=null;a.construct=FG3dTechnique_construct;a.code=FG3dTechnique_code;a.activeMode=FG3dTechnique_activeMode;a.modes=FG3dTechnique_modes;a.passes=FG3dTechnique_passes;a.registerMode=FG3dTechnique_registerMode;a.selectMode=FG3dTechnique_selectMode;a.updateRegion=RMethod.empty;a.clear=FG3dTechnique_clear;a.sortRenderables=FG3dTechnique_sortRenderables;a.drawRegion=FG3dTechnique_drawRegion;
a.present=FG3dTechnique_present;return a}function FG3dTechnique_construct(){this.__base.FG3dObject.construct.call(this);this._modes=new TObjects;this._passes=new TObjects}function FG3dTechnique_code(){return this._code}function FG3dTechnique_activeMode(){return this._activeMode}function FG3dTechnique_modes(){return this._modes}function FG3dTechnique_passes(){return this._passes}
function FG3dTechnique_registerMode(a){var b=RClass.create(FG3dTechniqueMode);b.setCode(a);this._modes.push(b);return this._activeMode=b}function FG3dTechnique_selectMode(a){}function FG3dTechnique_clear(a){var b=this._graphicContext;b.setRenderTarget(null);b.clear(a.red,a.green,a.blue,a.alpha,1)}function FG3dTechnique_sortRenderables(a,b){}
function FG3dTechnique_drawRegion(a){a.setTechnique(this);for(var b=this._passes,e=b.count(),f=0;f<e;f++){var h=b.get(f);a.setTechniquePass(h,f==e-1);h.drawRegion(a)}}function FG3dTechnique_present(a){this._graphicContext.present()}function FG3dTechniqueConsole(a){a=RClass.inherits(this,a,FConsole);a._techniques=null;a.construct=FG3dTechniqueConsole_construct;a.techniques=FG3dTechniqueConsole_techniques;a.find=FG3dTechniqueConsole_find;return a}
function FG3dTechniqueConsole_construct(){this.__base.FConsole.construct.call(this);this._techniques=new TDictionary}function FG3dTechniqueConsole_techniques(){return this._techniques}function FG3dTechniqueConsole_find(a,b){var e=RClass.name(b),f=this._techniques,h=f.get(e);if(!h){h=RClass.createByName(e);h.linkGraphicContext(a);h.setup();for(var k=h.passes(),q=k.count(),t=0;t<q;t++){var u=k.get(t);u.setFullCode(h.code()+"."+u.code())}f.set(e,h)}return h}
function FG3dTechniqueMode(a){a=RClass.inherits(this,a,FObject);a._code=null;a.code=FG3dTechniqueMode_code;a.setCode=FG3dTechniqueMode_setCode;return a}function FG3dTechniqueMode_code(){return this._code}function FG3dTechniqueMode_setCode(a){this._code=a}
function FG3dTechniquePass(a){a=RClass.inherits(this,a,FG3dObject);a._fullCode=null;a._code=null;a._index=null;a._finish=!1;a._materialMap=null;a.setup=FG3dTechniquePass_setup;a.fullCode=FG3dTechniquePass_fullCode;a.setFullCode=FG3dTechniquePass_setFullCode;a.code=FG3dTechniquePass_code;a.activeEffects=FG3dTechniquePass_activeEffects;a.sortRenderables=FG3dTechniquePass_sortRenderables;a.drawRegion=FG3dTechniquePass_drawRegion;return a}
function FG3dTechniquePass_setup(){var a=this._materialMap=RClass.create(FG3dMaterialMap);a.linkGraphicContext(this);a.setup(EG3dMaterialMap.Count,32)}function FG3dTechniquePass_fullCode(){return this._fullCode}function FG3dTechniquePass_setFullCode(a){this._fullCode=a}function FG3dTechniquePass_code(){return this._code}
function FG3dTechniquePass_sortRenderables(a,b){var e=a.material().info(),f=b.material().info();if(e.optionAlpha&&f.optionAlpha)return e=a.activeEffect(),f=b.activeEffect(),e==f&&(sm=a._materialReference,tm=b._materialReference,sm&&tm)?sm.hashCode()-tm.hashCode():e.hashCode()-f.hashCode();if(e.optionAlpha&&!f.optionAlpha)return 1;if(!e.optionAlpha&&f.optionAlpha)return-1;e=a.activeEffect();f=b.activeEffect();return e==f&&(sm=a._materialReference,tm=b._materialReference,sm&&tm)?sm.hashCode()-tm.hashCode():
e.hashCode()-f.hashCode()}function FG3dTechniquePass_activeEffects(a,b){for(var e=a.spaceName(),f=b.count()-1;0<=f;f--){var h=b.get(f),k=h.selectInfo(e);k.effect||(k.effect=RConsole.find(FG3dEffectConsole).find(this._graphicContext,a,h))}}
function FG3dTechniquePass_drawRegion(a){var b=a.renderables(),e=b.count();if(0!=e){a._statistics._frameDrawSort.begin();this.activeEffects(a,b);b.sort(this.sortRenderables);a._statistics._frameDrawSort.end();if(this._graphicContext.capability().optionMaterialMap){var f=this._materialMap;f.resize(EG3dMaterialMap.Count,e);for(var h=0;h<e;h++){var k=b.get(h);k._materialId=h;k=k.material().info();f.setUint8(h,EG3dMaterialMap.AmbientColor,k.ambientColor);f.setUint8(h,EG3dMaterialMap.DiffuseColor,k.diffuseColor);
f.setUint8(h,EG3dMaterialMap.SpecularColor,k.specularColor);f.setUint8(h,EG3dMaterialMap.ReflectColor,k.reflectColor);f.setUint8(h,EG3dMaterialMap.EmissiveColor,k.emissiveColor)}f.update();a._materialMap=f}for(f=0;f<e;){for(var k=f,q=e,t=b.getAt(k).activeEffect(),h=f;h<e;h++){var u=b.getAt(h).activeEffect();if(t!=u){q=h;break}f++}t.drawRegion(a,k,q-k)}}}function FG3dTrack(a){a=RClass.inherits(this,a,FObject);a._frames=null;a.construct=FG3dTrack_construct;a.calculate=FG3dTrack_calculate;return a}
function FG3dTrack_construct(){this.__base.FObject.construct.call(this)}function FG3dTrack_update(a){a=new SG3dFrameInfo;this._trackResource.calculateFrameInfo(a,tick);a.update();this._matrix.assign(this._trackResource.matrixInvert());this._matrix.append(a.matrix);return!0}
function FG3dTrack_calculate(a){var b=this._frames.count();if(0==b)return!1;0>a&&(a=-a);var e=this._frames.Get(index),f=null,f=index<b-1?this._frames.Get(index+1):this._frames.Get(0);info.tick=a;info.currentFrame=e;info.nextFrame=f;return!0}function FG3dViewport(a){a=RClass.inherits(this,a,FObject);a.left=0;a.top=0;a.width=0;a.height=0;a.set=FG3dViewport_set;return a}function FG3dViewport_set(a,b,e,f){this.left=a;this.top=b;this.width=e;this.height=f}
var REngine3d=new function(){this.contexts=new TObjects;this.createContext=REngine3d_createContext;return this};function REngine3d_createContext(a,b,e){a=RClass.create(a);e&&(a._optionAlpha=e.alpha,a._optionAntialias=e.antialias);a.linkCanvas(b);this.contexts.push(a);return a}
var EG3dAttribute=new function(){this.Position="position";this.Color="color";this.Coord="coord";this.Normal="normal";this.Binormal="binormal";this.Tangent="tangent";this.BoneIndex="bone_index";this.BoneWeight="bone_weight";return this},EG3dAttributeFormat=new function(){this.Unknown=0;this.Float1=1;this.Float2=2;this.Float3=3;this.Float4=4;this.Byte4=5;this.Byte4Normal=6;return this},EG3dBlendMode=new function(){this.None=0;this.SourceAlpha=1;this.OneMinusSourceAlpha=2;return this},EG3dCullMode=new function(){this.None=
0;this.Front=1;this.Back=2;this.Both=3;return this},EG3dDepthMode=new function(){this.None=0;this.Equal=1;this.NotEqual=2;this.Less=3;this.LessEqual=4;this.Greater=5;this.GreaterEqual=6;this.Always=7;return this},EG3dFillMode=new function(){this.Unknown=0;this.Point=1;this.Line=2;this.Face=3;return this},EG3dIndexStride=new function(){this.Unknown=0;this.Uint16=1;this.Uint32=2;return this},EG3dParameterFormat=new function(){this.Unknown=0;this.Float1=1;this.Float2=2;this.Float3=3;this.Float4=4;this.Float3x3=
5;this.Float4x3=6;this.Float4x4=7;return this},EG3dSampler=new function(){this.Diffuse="diffuse";this.Alpha="alpha";this.Normal="normal";this.SpecularColor="specular.color";this.SpecularLevel="specular.level";this.Light="light";this.Reflect="reflect";this.Refract="refract";this.Emissive="emissive";this.Height="height";this.Environment="environment";return this},EG3dSamplerFilter=new function(){this.Unknown=0;this.Nearest=1;this.Linear=2;this.Repeat=3;this.ClampToEdge=4;this.ClampToBorder=5;return this},
EG3dShader=new function(){this.Unknown=0;this.Vertex=1;this.Fragment=2;return this},EG3dTexture=new function(){this.Unknown=0;this.Flat2d=1;this.Flat3d=2;this.Cube=3;return this};
function SG3dContextCapability(){this.shaderVersion=this.version=this.vendor=null;this.optionShaderSource=this.optionIndex32=this.optionMaterialMap=this.optionLayout=this.optionInstance=this.optionDebug=!1;this.mergeCount=0;this.attributeCount=null;this.vertexCount=65536;this.samplerCompressRgba=this.samplerCompressRgb=this.samplerSize=this.samplerCount=this.varyingCount=this.fragmentConst=this.vertexConst=null;this.calculateBoneCount=SG3dContextCapability_calculateBoneCount;this.calculateInstanceCount=
SG3dContextCapability_calculateInstanceCount;return this}function SG3dContextCapability_calculateBoneCount(a,b){var e=0,e=a%8,e=0!=e?a+8-e:a,f=(this.vertexConst-16)/4;return e>f?f:e}function SG3dContextCapability_calculateInstanceCount(a,b){var e=(this.vertexConst-16)/(4*a+4),f=cl;0<b&&(f=Math.min(e,this.vertexCount/b));64<f&&(f=64);return f}function FG3dBuffer(a){a=RClass.inherits(this,a,FG3dObject);a._name=null;a.name=FG3dBuffer_name;a.isValid=RMethod.virtual(a,"isValid");return a}
function FG3dBuffer_name(){return this._name}
function FG3dContext(a){a=RClass.inherits(this,a,FGraphicContext);a._optionAlpha=!0;a._optionAntialias=!1;a._size=null;a._capability=null;a._statistics=null;a._fillModeCd=EG3dFillMode.Face;a._optionDepth=!1;a._optionCull=!1;a._depthModeCd=0;a._cullModeCd=0;a._statusBlend=!1;a._blendSourceCd=0;a._blendTargetCd=0;a._program=null;a.construct=FG3dContext_construct;a.linkCanvas=FG3dContext_linkCanvas;a.size=FG3dContext_size;a.capability=FG3dContext_capability;a.statistics=FG3dContext_statistics;a.createProgram=
RMethod.virtual(a,"createProgram");a.createVertexBuffer=RMethod.virtual(a,"createVertexBuffer");a.createIndexBuffer=RMethod.virtual(a,"createIndexBuffer");a.createFlatTexture=RMethod.virtual(a,"createFlatTexture");a.createCubeTexture=RMethod.virtual(a,"createCubeTexture");a.createRenderTarget=RMethod.virtual(a,"createRenderTarget");a.setViewport=RMethod.virtual(a,"setViewport");a.setFillMode=RMethod.virtual(a,"setFillMode");a.setDepthMode=RMethod.virtual(a,"setDepthMode");a.setCullingMode=RMethod.virtual(a,
"setCullingMode");a.setBlendFactors=RMethod.virtual(a,"setBlendFactors");a.setScissorRectangle=RMethod.virtual(a,"setScissorRectangle");a.setRenderTarget=RMethod.virtual(a,"setRenderTarget");a.setProgram=RMethod.virtual(a,"setProgram");a.bindVertexBuffer=RMethod.virtual(a,"bindVertexBuffer");a.bindTexture=RMethod.virtual(a,"bindTexture");a.prepare=FG3dContext_prepare;a.clear=RMethod.virtual(a,"clear");a.clearColor=RMethod.virtual(a,"clearColor");a.clearDepth=RMethod.virtual(a,"clearDepth");a.drawTriangles=
RMethod.virtual(a,"drawTriangles");a.present=RMethod.virtual(a,"present");a.dispose=FG3dContext_dispose;return a}function FG3dContext_construct(){this.__base.FGraphicContext.construct.call(this);this._size=new SSize2;this._statistics=RClass.create(FG3dStatistics);RConsole.find(FStatisticsConsole).register("graphic3d.context",this._statistics)}function FG3dContext_linkCanvas(a){this._size.set(a.width,a.height)}function FG3dContext_size(){return this._size}
function FG3dContext_capability(){return this._capability}function FG3dContext_statistics(){return this._statistics}function FG3dContext_prepare(){this._statistics.resetFrame()}function FG3dContext_dispose(){this._program=null;this.__base.FGraphicContext.dispose.call(this)}function FG3dCubeTexture(a){a=RClass.inherits(this,a,FG3dTexture);a.size=0;a.construct=FG3dTexture_construct;return a}function FG3dTexture_construct(){this.__base.FG3dTexture.construct();this._textureCd=EG3dTexture.Cube}
function FG3dFlatTexture(a){a=RClass.inherits(this,a,FG3dTexture);a.width=0;a.height=0;a.construct=FG3dFlatTexture_construct;a.uploadData=RMethod.virtual(a,"uploadData");a.upload=RMethod.virtual(a,"upload");return a}function FG3dFlatTexture_construct(){this.__base.FG3dTexture.construct();this._textureCd=EG3dTexture.Flat2d}function FG3dFragmentShader(a){return a=RClass.inherits(this,a,FG3dShader)}
function FG3dIndexBuffer(a){a=RClass.inherits(this,a,FG3dBuffer);a._strideCd=EG3dIndexStride.Uint16;a._count=0;a.strideCd=FG3dIndexBuffer_strideCd;a.count=FG3dIndexBuffer_count;a.upload=RMethod.virtual(a,"upload");return a}function FG3dIndexBuffer_strideCd(){return this._strideCd}function FG3dIndexBuffer_count(){return this._count}function FG3dLayout(a){a=RClass.inherits(this,a,FG3dObject);a._elemets=null;a.elemets=FG3dLayout_elemets;a.update=FG3dLayout_update;return a}
function FG3dLayout_elemets(){return this._elemets}function FG3dLayout_update(){}function FG3dLayoutElement(a){a=RClass.inherits(this,a,FObject);a._name=0;a._buffer=null;a.name=FG3dLayoutElement_name;return a}function FG3dLayoutElement_name(){return this._name}
function FG3dProgram(a){a=RClass.inherits(this,a,FG3dObject);a._attributes=null;a._parameters=null;a._samplers=null;a._vertexShader=null;a._fragmentShader=null;a.hasAttribute=FG3dProgram_hasAttribute;a.registerAttribute=FG3dProgram_registerAttribute;a.findAttribute=FG3dProgram_findAttribute;a.attributes=FG3dProgram_attributes;a.hasParameter=FG3dProgram_hasParameter;a.registerParameter=FG3dProgram_registerParameter;a.findParameter=FG3dProgram_findParameter;a.parameters=FG3dProgram_parameters;a.hasSampler=
FG3dProgram_hasSampler;a.registerSampler=FG3dProgram_registerSampler;a.findSampler=FG3dProgram_findSampler;a.samplers=FG3dProgram_samplers;a.vertexShader=RMethod.virtual(a,"vertexShader");a.fragmentShader=RMethod.virtual(a,"fragmentShader");a.setAttribute=FG3dProgram_setAttribute;a.setParameter=FG3dProgram_setParameter;a.setParameter4=FG3dProgram_setParameter4;a.setSampler=FG3dProgram_setSampler;a.upload=RMethod.virtual(a,"upload");return a}
function FG3dProgram_hasAttribute(){var a=this._attributes;return a?!a.isEmpty():!1}function FG3dProgram_registerAttribute(a){var b=RClass.create(FG3dProgramAttribute);b._name=a;this.attributes().set(a,b);return b}function FG3dProgram_findAttribute(a){return this._attributes?this._attributes.get(a):null}function FG3dProgram_attributes(){var a=this._attributes;null==a&&(a=this._attributes=new TDictionary);return a}
function FG3dProgram_hasParameter(){var a=this._parameters;return a?!a.isEmpty():!1}function FG3dProgram_registerParameter(a,b){var e=RClass.create(FG3dProgramParameter);e._name=a;e.formatCd=b;this.parameters().set(a,e);return e}function FG3dProgram_findParameter(a){return this._parameters?this._parameters.get(a):null}function FG3dProgram_parameters(){var a=this._parameters;null==a&&(a=this._parameters=new TDictionary);return a}
function FG3dProgram_hasSampler(){var a=this._samplers;return a?!a.isEmpty():!1}function FG3dProgram_registerSampler(a){var b=RClass.create(FG3dProgramSampler);b._name=a;this.samplers().set(a,b);return b}function FG3dProgram_findSampler(a){return this._samplers?this._samplers.get(a):null}function FG3dProgram_samplers(){var a=this._samplers;null==a&&(a=this._samplers=new TDictionary);return a}
function FG3dProgram_setAttribute(a,b,e){var f=this.findAttribute(a);if(null==f)throw new TError(this,"Bind invalid attribute. (name={1})",a);this._graphicContext.bindVertexBuffer(f._slot,b,0,e)}
function FG3dProgram_setParameter(a,b,e){var f=this.findParameter(a);if(null==f)throw new TError(this,"Bind invalid parameter. (name={1})",a);var h=null,h=b.constructor;if(h==Float32Array||h==SMatrix3d||h==SPerspectiveMatrix3d)h=b;else if(h==SColor4)h=RTypeArray.float4(),h[0]=b.red,h[1]=b.green,h[2]=b.blue,h[3]=b.alpha;else if(h==SPoint3||h==SVector3)h=RTypeArray.float3(),h[0]=b.x,h[1]=b.y,h[2]=b.z;else if(h==SPoint4||h==SVector4)h=RTypeArray.float4(),h[0]=b.x,h[1]=b.y,h[2]=b.z,h[3]=b.w;else throw new TError(this,
"Bind invalid parameter type. (name={1}, type={2})",a,h);this._graphicContext.bindConst(null,f._slot,f._formatCd,h,e)}function FG3dProgram_setParameter4(a,b,e,f,h){var k=RTypeArray.float4();k[0]=b;k[1]=e;k[2]=f;k[3]=h;this.setParameter(a,k,1)}function FG3dProgram_setSampler(a,b){var e=this.findSampler(a);if(null==e)throw new TError(this,"Bind invalid sampler. (name={1})",a);this._graphicContext.bindTexture(e._slot,e._index,b)}
function FG3dProgramAttribute(a){a=RClass.inherits(this,a,FObject);a._name=null;a._linker=null;a._statusUsed=!1;a._slot=-1;a._index=-1;a._formatCd=EG3dAttributeFormat.Unknown;a.name=FG3dProgramAttribute_name;a.linker=FG3dProgramAttribute_linker;a.loadConfig=FG3dProgramAttribute_loadConfig;return a}function FG3dProgramAttribute_name(){return this._name}function FG3dProgramAttribute_linker(){return this._linker}
function FG3dProgramAttribute_loadConfig(a){this._name=a.get("name");this._linker=a.get("linker");this._formatCd=REnum.encode(EG3dAttributeFormat,a.get("format"))}
function FG3dProgramParameter(a){a=RClass.inherits(this,a,FObject);a._name=null;a._linker=null;a._formatCd=EG3dParameterFormat.Unknown;a._define=null;a._statusUsed=!1;a._slot=null;a._size=0;a._buffer=null;a.name=FG3dProgramParameter_name;a.linker=FG3dProgramParameter_linker;a.define=FG3dProgramParameter_define;a.loadConfig=FG3dProgramParameter_loadConfig;return a}function FG3dProgramParameter_name(){return this._name}function FG3dProgramParameter_linker(){return this._linker}
function FG3dProgramParameter_define(){return this._define}function FG3dProgramParameter_loadConfig(a){this._name=a.get("name");this._linker=a.get("linker");this._formatCd=REnum.encode(EG3dParameterFormat,a.get("format"));this._define=a.get("define")}
function FG3dProgramSampler(a){a=RClass.inherits(this,a,FObject);a._name=null;a._linker=null;a._statusUsed=!1;a._formatCd=EG3dTexture.Flat2d;a._bind=!0;a._slot=-1;a._index=0;a._source=null;a.name=FG3dProgramSampler_name;a.linker=FG3dProgramSampler_linker;a.formatCd=FG3dProgramSampler_formatCd;a.loadConfig=FG3dProgramSampler_loadConfig;return a}function FG3dProgramSampler_name(){return this._name}function FG3dProgramSampler_linker(){return this._linker}
function FG3dProgramSampler_formatCd(){return this._formatCd}function FG3dProgramSampler_loadConfig(a){this._name=a.get("name");this._linker=a.get("linker");this._bind=RBoolean.parse(a.get("bind","Y"));this._formatCd=REnum.encode(EG3dTexture,a.get("format","Flat2d"))}
function FG3dRenderTarget(a){a=RClass.inherits(this,a,FG3dObject);a._size=null;a._color=null;a._textures=null;a.construct=FG3dRenderTarget_construct;a.size=FG3dRenderTarget_size;a.color=FG3dRenderTarget_color;a.textures=FG3dRenderTarget_textures;return a}function FG3dRenderTarget_construct(){this.__base.FG3dObject.construct();this._size=new SSize2;this._color=new SColor4;this._color.set(0,0,0,1)}function FG3dRenderTarget_size(){return this._size}
function FG3dRenderTarget_color(){return this._color}function FG3dRenderTarget_textures(){var a=this._textures;null==a&&(a=this._textures=new TObjects);return a}function FG3dShader(a){a=RClass.inherits(this,a,FG3dObject);a._source=null;a.source=FG3dShader_source;a.upload=RMethod.virtual(a,"upload");return a}function FG3dShader_source(){return this._source}
function FG3dStatistics(a){a=RClass.inherits(this,a,FStatistics);a._frameClearCount=0;a._frameFillModeCount=0;a._frameDepthModeCount=0;a._frameCullModeCount=0;a._frameBlendModeCount=0;a._frameProgramCount=0;a._frameConstCount=0;a._frameConstLength=0;a._frameBufferCount=0;a._frameTextureCount=0;a._frameTargetCount=0;a._frameDrawCount=0;a._frameTriangleCount=0;a._programTotal=0;a._layoutTotal=0;a._vertexBufferTotal=0;a._indexBufferTotal=0;a._flatTextureTotal=0;a._cubeTextureTotal=0;a._targetTotal=0;
a.reset=FG3dStatistics_reset;a.resetFrame=FG3dStatistics_resetFrame;return a}function FG3dStatistics_reset(){o._programTotal=0;o._layoutTotal=0;o._vertexBufferTotal=0;o._indexBufferTotal=0;o._flatTextureTotal=0;o._cubeTextureTotal=0;o._targetTotal=0}
function FG3dStatistics_resetFrame(){this._frameDrawCount=this._frameTriangleCount=this._frameTargetCount=this._frameTextureCount=this._frameBufferCount=this._frameConstLength=this._frameConstCount=this._frameProgramCount=this._frameBlendModeCount=this._frameCullModeCount=this._frameDepthModeCount=this._frameFillModeCount=this._frameClearCount=0}
function FG3dTexture(a){a=RClass.inherits(this,a,FG3dObject);a._textureCd=EG3dTexture.Unknown;a._filterMinCd=EG3dSamplerFilter.Linear;a._filterMagCd=EG3dSamplerFilter.Linear;a._wrapS=EG3dSamplerFilter.Unknown;a._wrapT=EG3dSamplerFilter.Unknown;a._statusLoad=!1;a.isValid=RMethod.virtual(a,"isValid");a.textureCd=FG3dTexture_textureCd;a.filterMinCd=FG3dTexture_filterMinCd;a.filterMagCd=FG3dTexture_filterMagCd;a.setFilter=FG3dTexture_setFilter;a.wrapS=FG3dTexture_wrapS;a.wrapT=FG3dTexture_wrapT;a.setWrap=
FG3dTexture_setWrap;return a}function FG3dTexture_textureCd(){return this._textureCd}function FG3dTexture_filterMinCd(){return this._filterMinCd}function FG3dTexture_filterMagCd(){return this._filterMagCd}function FG3dTexture_setFilter(a,b){this._filterMinCd=a;this._filterMagCd=b}function FG3dTexture_wrapS(){return this._wrapS}function FG3dTexture_wrapT(){return this._wrapT}function FG3dTexture_setWrap(a,b){this._wrapS=a;this._wrapT=b}
function FG3dVertexBuffer(a){a=RClass.inherits(this,a,FG3dBuffer);a._formatCd=EG3dAttributeFormat.Unknown;a._stride=0;a._count=0;a.formatCd=FG3dVertexBuffer_formatCd;a.stride=FG3dVertexBuffer_stride;a.count=FG3dVertexBuffer_count;a.upload=RMethod.virtual(a,"upload");return a}function FG3dVertexBuffer_formatCd(){return this._formatCd}function FG3dVertexBuffer_stride(){return this._stride}function FG3dVertexBuffer_count(){return this._count}
function FG3dVertexShader(a){return a=RClass.inherits(this,a,FG3dShader)}
function FG3dAutomaticEffect(a){a=RClass.inherits(this,a,FG3dEffect);a._optionMerge=!1;a._optionBlendMode=!0;a._supportInstance=!1;a._supportLayout=!1;a._supportMaterialMap=!1;a._supportVertexColor=!0;a._supportVertexCoord=!0;a._supportVertexNormal=!0;a._supportVertexNormalFull=!0;a._supportSkeleton=!1;a._supportAlpha=!0;a._supportAmbient=!0;a._supportDiffuse=!0;a._supportDiffuseView=!0;a._supportSpecularColor=!0;a._supportSpecularLevel=!0;a._supportSpecularView=!0;a._supportLight=!0;a._supportReflect=
!0;a._supportRefract=!0;a._supportEmissive=!0;a._supportHeight=!0;a._supportEnvironment=!0;a._dynamicSkeleton=!0;a.setup=FG3dAutomaticEffect_setup;a.buildInfo=FG3dAutomaticEffect_buildInfo;a.bindAttributes=FG3dAutomaticEffect_bindAttributes;a.bindSamplers=FG3dAutomaticEffect_bindSamplers;a.bindMaterial=FG3dAutomaticEffect_bindMaterial;a.drawRenderable=FG3dAutomaticEffect_drawRenderable;return a}
function FG3dAutomaticEffect_setup(){this._supportLayout=this._graphicContext.capability().optionLayout}
function FG3dAutomaticEffect_buildInfo(a,b){var e=this._graphicContext.capability(),f=new TString;f.append(b.techniqueModeCode);a.set("technique.mode",b.techniqueModeCode);if(this._optionMerge=b.optionMerge){var h=b.mergeCount;f.append("|OI"+h);a.setBoolean("option.instance",!0);a.set("instance.count",h)}e.optionMaterialMap&&(f.append("|OM"),a.setBoolean("option.material.map",!0),this._supportMaterialMap=!0);b.optionNormalInvert&&(f.append("|ON"),a.setBoolean("option.normal.invert",!0),this._supportNormalInvert=
!0);b.optionAmbient&&(f.append("|OA"),a.setBoolean("option.ambient",!0),this.optionAmbient=!0);b.optionDiffuse&&(f.append("|OD"),a.setBoolean("option.diffuse",!0),this.optionDiffuse=!0);b.optionSpecular&&(f.append("|OS"),a.setBoolean("option.specular",!0),this.optionSpecular=!0);b.optionReflect&&(f.append("|ORL"),a.setBoolean("option.reflect",!0),this.optionReflect=!0);b.optionRefract&&(f.append("|ORF"),a.setBoolean("option.refract",!0),this.optionRefract=!0);h=b.attributeContains(EG3dAttribute.Color);
if(this._dynamicVertexColor=this._supportVertexColor&&h)f.append("|AC"),a.setBoolean("vertex.attribute.color",!0);h=b.attributeContains(EG3dAttribute.Coord);if(this._dynamicVertexCoord=this._supportVertexCoord&&h)f.append("|AD"),a.setBoolean("vertex.attribute.coord",!0);h=b.attributeContains(EG3dAttribute.Normal);if(this._dynamicVertexNormal=this._supportVertexNormal&&h)f.append("|AN"),a.setBoolean("vertex.attribute.normal",!0);var k=b.attributeContains(EG3dAttribute.Binormal),q=b.attributeContains(EG3dAttribute.Tangent);
if(this._dynamicVertexNormalFull=this._supportVertexNormalFull&&h&&k&&q)f.append("|AF"),a.setBoolean("vertex.attribute.normal.full",!0);if(this._dynamicInstance=this._supportInstance&&e.optionInstance)f.append("|SI"),b&&a.setBoolean("support.instance",!0);if(this._dynamicSkeleton=this._supportSkeleton)f.append("|SS"),b&&a.setBoolean("support.skeleton",!0);h=b.samplerContains(EG3dSampler.Diffuse);(this._dynamicAlpha=this._supportAlpha)?(f.append("|RA"),b&&a.setBoolean("support.alpha",!0),this._optionBlendMode=
!0):this._optionBlendMode=!1;if(this._dynamicAmbient=this._supportAmbient)f.append("|TA"),b&&a.setBoolean("support.ambient",!0),h&&(f.append("|TAS"),b&&a.setBoolean("support.ambient.sampler",!0));b.samplerContains(EG3dSampler.Alpha)&&a.setBoolean("support.alpha.sampler",!0);h=b.samplerContains(EG3dSampler.Normal);this._dynamicDiffuse=this._supportDiffuse&&(this._dynamicVertexNormal||h);this._supportDiffuse&&(b&&a.setBoolean("support.diffuse",!0),h?(f.append("|TDD"),b&&(a.setBoolean("support.dump",
!0),a.setBoolean("support.diffuse.dump",!0))):this._dynamicVertexNormal&&(f.append("|TDN"),b&&a.setBoolean("support.diffuse.normal",!0)));this._dynamicDiffuseView=this._supportDiffuseView&&(this._dynamicVertexNormal||h);this._supportDiffuseView&&(b&&a.setBoolean("support.diffuse.view",!0),h?(f.append("|TDVD"),b&&(a.setBoolean("support.dump",!0),a.setBoolean("support.diffuse.view.dump",!0))):this._dynamicVertexNormal&&(f.append("|TDVN"),b&&a.setBoolean("support.diffuse.view.normal",!0)));h=b.samplerContains(EG3dSampler.SpecularColor);
k=b.samplerContains(EG3dSampler.SpecularLevel);this._dynamicSpecularColor=this._supportSpecularColor&&h;this._dynamicSpecularLevel=this._supportSpecularLevel&&k;(this._dynamicSpecularColor||this._dynamicSpecularLevel)&&this._dynamicVertexNormal&&(f.append("|TS"),b&&a.setBoolean("support.specular",!0),this._dynamicSpecularColor&&(f.append("|TSC"),b&&a.setBoolean("support.specular.color",!0)),this._dynamicSpecularLevel?(f.append("|TSL"),b&&a.setBoolean("support.specular.level",!0)):(f.append("|NSL"),
b&&a.setBoolean("support.specular.normal",!0)));(this._dynamicSpecularView=this._supportSpecularView)&&this._dynamicVertexNormal&&(f.append("|TSV"),b&&a.setBoolean("support.specular.view",!0),this._dynamicSpecularColor&&(f.append("|TSVC"),b&&a.setBoolean("support.specular.view.color",!0)),this._dynamicSpecularLevel?(f.append("|TSVL"),b&&a.setBoolean("support.specular.view.level",!0)):(f.append("|NSVL"),b&&a.setBoolean("support.specular.view.normal",!0)));h=b.samplerContains(EG3dSampler.Light);if(this._dynamicLight=
this._supportLight&&h)f.append("|TL"),b&&(a.setBoolean("support.sampler.light",!0),a.setBoolean("support.light",!0));h=b.samplerContains(EG3dSampler.Reflect);if(this._dynamicReflect=this._supportReflect&&h)f.append("|TRL"),b&&(a.setBoolean("support.sampler.light",!0),a.setBoolean("support.reflect",!0));h=b.samplerContains(EG3dSampler.Refract);if(this._dynamicRefract=this._supportRefract&&h)f.append("|TRF"),b&&(a.setBoolean("support.sampler.light",!0),a.setBoolean("support.refract",!0));h=b.samplerContains(EG3dSampler.Emissive);
if(this._dynamicEmissive=this._supportEmissive&&h)f.append("|TLE"),b&&(a.setBoolean("support.sampler.light",!0),a.setBoolean("support.emissive",!0));h=b.samplerContains(EG3dSampler.Height);if(this._dynamicHeight=this._supportHeight&&h)f.append("|TH"),b&&a.setBoolean("support.height",!0);h=b.samplerContains(EG3dSampler.Environment);if(this._dynamicEnvironment=this._supportEnvironment&&h)f.append("|TE"),b&&a.setBoolean("support.environment",!0);if(this._dynamicInstance=this._supportInstance)h=e.calculateInstanceCount(b.vertexBoneCount,
b.vertexCount),a.set("instance.count",h);this._dynamicSkeleton&&(e=e.calculateBoneCount(b.vertexBoneCount,b.vertexCount),f.append("|B"+e),a.set("bone.count",e),a.setBoolean("support.bone.weight.1",!0),a.setBoolean("support.bone.weight.2",!0),a.setBoolean("support.bone.weight.3",!0),a.setBoolean("support.bone.weight.4",!0));a.code=f.toString()}
function FG3dAutomaticEffect_bindAttributes(a){var b=this._program;if(b.hasAttribute())for(var e=b.attributes(),f=e.count(),h=0;h<f;h++){var k=e.value(h);if(k._statusUsed){var q=a.findVertexBuffer(k._linker);b.setAttribute(k._name,q,q._formatCd)}}}function FG3dAutomaticEffect_bindSamplers(a){var b=this._program;if(b.hasSampler())for(var e=b.samplers(),f=e.count(),h=0;h<f;h++){var k=e.value(h);if(k._bind&&k._statusUsed){var q=k.linker(),q=a.findTexture(q);b.setSampler(k.name(),q.texture())}}}
function FG3dAutomaticEffect_bindMaterial(a){var b=this._graphicContext;a=a.info();a.optionAlpha?b.setBlendFactors(this._stateBlend,this._stateBlendSourceCd,this._stateBlendTargetCd):b.setBlendFactors(!1);a.optionDouble?b.setCullingMode(!1):b.setCullingMode(this._stateDepth,this._stateCullCd)}
function FG3dAutomaticEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program,h=null;if(this._supportLayout){var k=b.activeInfo(),h=k.layout;h||(h=k.layout=e.createLayout(),h.bind(),this.bindAttributes(b),h.unbind());h.active()}else this.bindAttributes(b);this._supportMaterialMap&&f.setSampler("fs_material",a.materialMap().texture());this.bindSamplers(b);e.drawTriangles(b.indexBuffer());this._supportLayout&&h.deactive()}
function FG3dControlAutomaticEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="control.automatic";a.drawRenderable=FG3dControlAutomaticEffect_drawRenderable;return a}
function FG3dControlAutomaticEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program,h=b.material(),k=h.info();this.bindMaterial(h);f.setParameter("vc_model_matrix",b.currentMatrix());f.setParameter("vc_vp_matrix",a.calculate(EG3dRegionParameter.CameraViewProjectionMatrix));f.setParameter4("fc_alpha",k.alphaBase,k.alphaRate,k.alphaLevel,k.alphaMerge);f.setParameter("fc_ambient_color",k.ambientColor);this.bindAttributes(b);this.bindSamplers(b);e.drawTriangles(b.indexBuffer())}
function FG3dControlFrameEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="control.frame";a.drawRenderable=FG3dControlFrameEffect_drawRenderable;return a}
function FG3dControlFrameEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program,h=a.calculate(EG3dRegionParameter.CameraPosition),k=a.calculate(EG3dRegionParameter.LightDirection),q=b.material(),t=q.info();this.bindMaterial(q);f.setParameter("vc_model_matrix",b.currentMatrix());f.setParameter("vc_vp_matrix",a.calculate(EG3dRegionParameter.CameraViewProjectionMatrix));f.setParameter("vc_camera_position",h);f.setParameter("vc_light_direction",k);f.setParameter("fc_camera_position",h);
f.setParameter("fc_light_direction",k);f.setParameter("fc_color",t.ambientColor);f.setParameter4("fc_vertex_color",t.colorMin,t.colorMax,t.colorRate,t.colorMerge);f.setParameter4("fc_alpha",t.alphaBase,t.alphaRate,t.alphaLevel,t.alphaMerge);f.setParameter("fc_ambient_color",t.ambientColor);f.setParameter("fc_diffuse_color",t.diffuseColor);f.setParameter("fc_specular_color",t.specularColor);f.setParameter4("fc_specular",t.specularBase,t.specularLevel,t.specularAverage,t.specularShadow);f.setParameter("fc_specular_view_color",
t.specularViewColor);f.setParameter4("fc_specular_view",t.specularViewBase,t.specularViewRate,t.specularViewAverage,t.specularViewShadow);f.setParameter("fc_reflect_color",t.reflectColor);f.setParameter4("fc_reflect",0,0,1-t.reflectMerge,t.reflectMerge);f.setParameter("fc_emissive_color",t.emissiveColor);this.bindAttributes(b);this.bindSamplers(b);e.drawTriangles(b.indexBuffer())}function FG3dControlPass(a){a=RClass.inherits(this,a,FG3dTechniquePass);a._code="control";return a}
function FG3dControlTechnique(a){a=RClass.inherits(this,a,FG3dTechnique);a._code="control";a._passControl=null;a.setup=FG3dControlTechnique_setup;a.passControl=FG3dControlTechnique_passControl;a.drawRegion=FG3dControlTechnique_drawRegion;return a}function FG3dControlTechnique_setup(){this.__base.FG3dTechnique.setup.call(this);this.registerMode(EG3dTechniqueMode.Result);var a=this._passControl=RClass.create(FG3dControlPass);a.linkGraphicContext(this);a.setup();this._passes.push(a)}
function FG3dControlTechnique_passControl(){return this._passControl}function FG3dControlTechnique_drawRegion(a){a.renderables().isEmpty()||(this._graphicContext.clearDepth(1),this.__base.FG3dTechnique.drawRegion.call(this,a))}function FG3dGeneralColorAutomaticEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="general.color.automatic";a.drawRenderable=FG3dGeneralColorAutomaticEffect_drawRenderable;return a}
function FG3dGeneralColorAutomaticEffect_drawRenderable(a,b){var e=this._program,f=a.calculate(EG3dRegionParameter.CameraPosition),h=a.calculate(EG3dRegionParameter.LightDirection),k=b.material(),q=k.info();this.bindMaterial(k);e.setParameter("vc_model_matrix",b.currentMatrix());e.setParameter("vc_vp_matrix",a.calculate(EG3dRegionParameter.CameraViewProjectionMatrix));e.setParameter("vc_camera_position",f);e.setParameter("vc_light_direction",h);e.setParameter("fc_camera_position",f);e.setParameter("fc_light_direction",
h);this._supportMaterialMap?e.setParameter4("fc_material",.03125,b._materialId/512,0,0):(e.setParameter("fc_ambient_color",q.ambientColor),e.setParameter("fc_diffuse_color",q.diffuseColor),e.setParameter("fc_specular_color",q.specularColor),e.setParameter("fc_reflect_color",q.reflectColor),e.setParameter("fc_emissive_color",q.emissiveColor));e.setParameter4("fc_color",q.colorMin,q.colorMax,q.colorRate,q.colorMerge);q.optionAlpha?e.setParameter4("fc_alpha",q.alphaBase,q.alphaRate,0,0):e.setParameter4("fc_alpha",
0,1,0,0);e.setParameter4("fc_specular",q.specularBase,q.specularLevel,q.specularAverage,q.specularShadow);e.setParameter4("fc_reflect",0,0,1-q.reflectMerge,q.reflectMerge);this.__base.FG3dAutomaticEffect.drawRenderable.call(this,a,b)}function FG3dGeneralColorPass(a){a=RClass.inherits(this,a,FG3dTechniquePass);a._code="color";return a}
function FG3dGeneralColorSkeletonEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="general.color.skeleton";a._supportSkeleton=!0;a.drawRenderable=FG3dGeneralColorSkeletonEffect_drawRenderable;return a}
function FG3dGeneralColorSkeletonEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program,h=a.calculate(EG3dRegionParameter.CameraPosition),k=a.calculate(EG3dRegionParameter.LightDirection),q=b.material(),t=q.info();this.bindMaterial(q);f.setParameter("vc_model_matrix",b.currentMatrix());f.setParameter("vc_vp_matrix",a.calculate(EG3dRegionParameter.CameraViewProjectionMatrix));f.setParameter("vc_camera_position",h);f.setParameter("vc_light_direction",k);f.setParameter("fc_camera_position",
h);f.setParameter("fc_light_direction",k);f.setParameter("fc_color",t.ambientColor);f.setParameter4("fc_vertex_color",t.colorMin,t.colorMax,t.colorRate,t.colorMerge);f.setParameter4("fc_alpha",t.alphaBase,t.alphaRate,t.alphaLevel,t.alphaMerge);f.setParameter("fc_ambient_color",t.ambientColor);f.setParameter("fc_diffuse_color",t.diffuseColor);f.setParameter("fc_specular_color",t.specularColor);f.setParameter4("fc_specular",t.specularBase,t.specularLevel,t.specularAverage,t.specularShadow);f.setParameter("fc_specular_view_color",
t.specularViewColor);f.setParameter4("fc_specular_view",t.specularViewBase,t.specularViewRate,t.specularViewAverage,t.specularViewShadow);f.setParameter("fc_reflect_color",t.reflectColor);if(h=b.bones()){for(var k=b._boneLimit,t=RTypeArray.findTemp(EDataType.Float,16*k),u=0;u<k;u++)q=h.get(u).matrix(),q.writeData(t,16*u);f.setParameter("vc_bone_matrix",t)}this.bindAttributes(b);this.bindSamplers(b);e.drawTriangles(b.indexBuffer())}
function FG3dGeneralTechnique(a){a=RClass.inherits(this,a,FG3dTechnique);a._code="general";a._passColor=null;a.setup=FG3dGeneralTechnique_setup;a.passColor=FG3dGeneralTechnique_passColor;return a}
function FG3dGeneralTechnique_setup(){this.__base.FG3dTechnique.setup.call(this);this.registerMode(EG3dTechniqueMode.Ambient);this.registerMode(EG3dTechniqueMode.DiffuseLevel);this.registerMode(EG3dTechniqueMode.DiffuseColor);this.registerMode(EG3dTechniqueMode.SpecularLevel);this.registerMode(EG3dTechniqueMode.SpecularColor);this.registerMode(EG3dTechniqueMode.Result);var a=this._passColor=RClass.create(FG3dGeneralColorPass);a.linkGraphicContext(this);a.setup();this._passes.push(a)}
function FG3dGeneralTechnique_passColor(){return this._passColor}function FG3dSelectAutomaticEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="select.automatic";a.drawRenderable=FG3dSelectAutomaticEffect_drawRenderable;return a}
function FG3dSelectAutomaticEffect_drawRenderable(a,b,e){var f=this._graphicContext,h=f.size(),k=this._program,q=a._selectX,t=a._selectY,u=b.material(),x=u.info();this.bindMaterial(u);k.setParameter("vc_model_matrix",b.currentMatrix());k.setParameter("vc_vp_matrix",a.calculate(EG3dRegionParameter.CameraViewProjectionMatrix));k.setParameter4("vc_offset",h.width,h.height,1-q/h.width*2,t/h.height*2-1);a=e+1;k.setParameter4("fc_index",(a&255)/255,(a>>8&255)/255,(a>>16&255)/255,x.alphaBase);this.bindAttributes(b);
this.bindSamplers(b);f.drawTriangles(b.indexBuffer())}function FG3dSelectPass(a){a=RClass.inherits(this,a,FG3dTechniquePass);a._code="select";a._texture=null;a._renderTarget=null;a._position=null;a._data=null;a.construct=FG3dSelectPass_construct;a.setup=FG3dSelectPass_setup;a.textureDepth=FG3dSelectPass_texture;a.drawRegion=FG3dSelectPass_drawRegion;return a}
function FG3dSelectPass_construct(){this.__base.FG3dTechniquePass.construct.call(this);this._data=new Uint8Array(4);this._position=new SPoint2}
function FG3dSelectPass_setup(){this.__base.FG3dTechniquePass.setup.call(this);var a=this._graphicContext,b=this._texture=a.createFlatTexture();b.setFilter(EG3dSamplerFilter.Nearest,EG3dSamplerFilter.Nearest);b.setWrap(EG3dSamplerFilter.ClampToEdge,EG3dSamplerFilter.ClampToEdge);a=this._renderTarget=a.createRenderTarget();a.size().set(1,1);a.textures().push(b);a.build()}function FG3dSelectPass_texture(){return this._texture}
function FG3dSelectPass_drawRegion(a){var b=this._graphicContext,e=b._native;b.setRenderTarget(this._renderTarget);b.clear(0,0,0,0,1,1);var f=a.allRenderables();this.activeEffects(a,f);for(var h=f.count(),k=0;k<h;k++){var q=f.get(k),t=q.activeEffect();b.setProgram(t.program());var u=q.display();u?u._optionFace||t.drawRenderable(a,q,k):t.drawRenderable(a,q,k)}b.clearDepth(1);for(k=0;k<h;k++)q=f.get(k),t=q.activeEffect(),b.setProgram(t.program()),(u=q.display())&&u._optionFace&&t.drawRenderable(a,q,
k);e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,this._data);a=this._data[0]+(this._data[1]<<8)+(this._data[2]<<16);this._selectRenderable=null;0!=a&&(this._selectRenderable=f.get(a-1))}function FG3dSelectSkeletonEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="select.automatic";a.drawRenderable=FG3dSelectSkeletonEffect_drawRenderable;return a}
function FG3dSelectSkeletonEffect_drawRenderable(a,b,e){var f=this._graphicContext,h=f.size(),k=this._program,q=a._selectX,t=a._selectY,u=b.material(),x=u.info();this.bindMaterial(u);k.setParameter("vc_model_matrix",b.currentMatrix());k.setParameter("vc_vp_matrix",a.calculate(EG3dRegionParameter.CameraViewProjectionMatrix));k.setParameter4("vc_offset",h.width,h.height,1-q/h.width*2,t/h.height*2-1);a=e+1;k.setParameter4("fc_index",(a&255)/255,(a>>8&255)/255,(a>>16&255)/255,x.alphaBase);this.bindAttributes(b);
this.bindSamplers(b);f.drawTriangles(b.indexBuffer())}function FG3dSelectTechnique(a){a=RClass.inherits(this,a,FG3dTechnique);a._code="select";a._passSelect=null;a.setup=FG3dSelectTechnique_setup;a.passSelect=FG3dSelectTechnique_passSelect;a.test=FG3dSelectTechnique_test;return a}
function FG3dSelectTechnique_setup(){this.__base.FG3dTechnique.setup.call(this);this.registerMode(EG3dTechniqueMode.Result);var a=this._passSelect=RClass.create(FG3dSelectPass);a.linkGraphicContext(this);a.setup();this._passes.push(a)}function FG3dSelectTechnique_passSelect(){return this._passSelect}function FG3dSelectTechnique_test(a,b,e){a._selectX=b;a._selectY=e;a.setTechnique(this);this.drawRegion(a);return this._passSelect._selectRenderable}
function FG3dShadowColorAutomaticEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="shadow.color.automatic";a.drawRenderable=FG3dShadowColorAutomaticEffect_drawRenderable;return a}
function FG3dShadowColorAutomaticEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program,h=a.calculate(EG3dRegionParameter.CameraPosition),k=a.calculate(EG3dRegionParameter.CameraViewProjectionMatrix),q=a.calculate(EG3dRegionParameter.LightDirection),t=a.calculate(EG3dRegionParameter.LightViewMatrix),u=a.calculate(EG3dRegionParameter.LightViewProjectionMatrix),x=a.calculate(EG3dRegionParameter.LightInfo),z=a.techniquePass(),y=b.material();this.bindMaterial(y);f.setParameter("vc_light_depth",
x);f.setParameter("vc_model_matrix",b.currentMatrix());f.setParameter("vc_vp_matrix",k);f.setParameter("vc_camera_position",h);f.setParameter("vc_light_direction",q);f.setParameter("vc_light_view_matrix",t);f.setParameter("vc_light_vp_matrix",u);f.setParameter("fc_camera_position",h);f.setParameter("fc_light_direction",q);f.setParameter4("fc_light_depth",1/4096,0,-1/4096,x.w);h=y.info();f.setParameter("fc_color",h.ambientColor);f.setParameter4("fc_vertex_color",h.colorMin,h.colorMax,h.colorRate,h.colorMerge);
f.setParameter4("fc_alpha",h.alphaBase,h.alphaRate,h.alphaLevel,h.alphaMerge);f.setParameter("fc_ambient_color",h.ambientColor);f.setParameter("fc_diffuse_color",h.diffuseColor);f.setParameter("fc_specular_color",h.specularColor);f.setParameter4("fc_specular",h.specularBase,h.specularLevel,h.specularAverage,h.specularShadow);f.setParameter("fc_specular_view_color",h.specularViewColor);f.setParameter4("fc_specular_view",h.specularViewBase,h.specularViewRate,h.specularViewAverage,h.specularViewShadow);
f.setParameter("fc_reflect_color",h.reflectColor);this.bindAttributes(b);f.setSampler("fs_light_depth",z.textureDepth());this.bindSamplers(b);e.drawTriangles(b.indexBuffer())}function FG3dShadowColorPass(a){a=RClass.inherits(this,a,FG3dTechniquePass);a._code="color";a._textureDepth=null;a.textureDepth=FG3dShadowColorPass_textureDepth;a.setTextureDepth=FG3dShadowColorPass_setTextureDepth;a.drawRegion=FG3dShadowColorPass_drawRegion;return a}
function FG3dShadowColorPass_textureDepth(){return this._textureDepth}function FG3dShadowColorPass_setTextureDepth(a){this._textureDepth=a}function FG3dShadowColorPass_drawRegion(a){this._context.setRenderTarget(null);var b=a._backgroundColor;this._context.clear(b.red,b.green,b.blue,b.alpha,1);this.__base.FG3dTechniquePass.drawRegion.call(this,a)}
function FG3dShadowColorSkeletonEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="shadow.color.skeleton";a._supportSkeleton=!0;a.drawRenderable=FG3dShadowColorSkeletonEffect_drawRenderable;return a}
function FG3dShadowColorSkeletonEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program,h=a.matrixViewProjection(),k=a.cameraPosition(),q=a.lightDirection();if(f.hasAttribute())for(var t=f.attributes(),u=t.count(),x=0;x<u;x++){var z=t.value(x);if(z._statusUsed){var y=b.findVertexBuffer(z._linker);if(null==y)throw new TError("Can't find renderable vertex buffer. (linker={1})",z._linker);f.setAttribute(z._name,y,y._formatCd)}}if(f.hasSampler())for(t=f.samplers(),u=t.count(),x=0;x<u;x++)if(z=
t.value(x),z._statusUsed){var y=z.linker(),A=b.findTexture(y);if(null!=A)f.setSampler(z.name(),A.texture());else throw new TError("Can't find sampler. (linker={1})",y);}f.setParameter("vc_model_matrix",b.currentMatrix());f.setParameter("vc_vp_matrix",h);f.setParameter("vc_camera_position",k);f.setParameter("vc_light_direction",q);f.setParameter("fc_camera_position",k);f.setParameter("fc_light_direction",q);h=b.material();h=h.info();f.setParameter("fc_color",h.ambientColor);f.setParameter4("fc_vertex_color",
h.colorMin,h.colorMax,h.colorRate,h.colorMerge);f.setParameter4("fc_alpha",h.alphaBase,h.alphaRate,h.alphaLevel,h.alphaMerge);f.setParameter("fc_ambient_color",h.ambientColor);f.setParameter("fc_diffuse_color",h.diffuseColor);f.setParameter("fc_specular_color",h.specularColor);f.setParameter4("fc_specular",h.specularBase,h.specularLevel,h.specularAverage,h.specularShadow);f.setParameter("fc_specular_view_color",h.specularViewColor);f.setParameter4("fc_specular_view",h.specularViewBase,h.specularViewRate,
h.specularViewAverage,h.specularViewShadow);f.setParameter("fc_reflect_color",h.reflectColor);if(k=b.bones()){q=k.count();32<q&&(q=32);x=RTypeArray.findTemp(EDataType.Float,16*q);for(t=0;t<q;t++)h=k.get(t).matrix(),h.writeData(x,16*t);f.setParameter("vc_bone_matrix",x)}f=b.indexBuffer();e.drawTriangles(f,0,f._count)}
function FG3dShadowDepthAutomaticEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="shadow.depth.automatic";a.drawRenderable=FG3dShadowDepthAutomaticEffect_drawRenderable;return a}
function FG3dShadowDepthAutomaticEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program,h=a.calculate(EG3dRegionParameter.LightViewMatrix),k=a.calculate(EG3dRegionParameter.LightViewProjectionMatrix),q=a.calculate(EG3dRegionParameter.LightInfo);e.setBlendFactors(!1);f.setParameter("vc_camera",q);f.setParameter("vc_model_matrix",b.currentMatrix());f.setParameter("vc_view_matrix",h);f.setParameter("vc_vp_matrix",k);f.setParameter("fc_camera",q);f.setParameter4("fc_alpha",0,0,0,.1);this.bindAttributes(b);
this.bindSamplers(b);e.drawTriangles(b.indexBuffer())}function FG3dShadowDepthPass(a){a=RClass.inherits(this,a,FG3dTechniquePass);a._code="depth";a._renderTarget=null;a._textureDepth=null;a._renderTarget=null;a.setup=FG3dShadowDepthPass_setup;a.textureDepth=FG3dShadowDepthPass_textureDepth;a.drawRegion=FG3dShadowDepthPass_drawRegion;return a}
function FG3dShadowDepthPass_setup(){this.__base.FG3dTechniquePass.setup.call(this);var a=this._context,b=this._textureDepth=a.createFlatTexture();b.setFilter(EG3dSamplerFilter.Linear,EG3dSamplerFilter.Linear);b.setWrap(EG3dSamplerFilter.ClampToEdge,EG3dSamplerFilter.ClampToEdge);a=this._renderTarget=a.createRenderTarget();a.size().set(2048,2048);a.textures().push(b);a.build()}function FG3dShadowDepthPass_textureDepth(){return this._textureDepth}
function FG3dShadowDepthPass_drawRegion(a){var b=this._context;this._finish?(b.setRenderTarget(null),b=a._backgroundColor,this._context.clear(b.red,b.green,b.blue,b.alpha,1)):(b.setRenderTarget(this._renderTarget),b.clear(0,0,0,1,1,1));a._textureDepth=this._textureDepth;this.__base.FG3dTechniquePass.drawRegion.call(this,a)}
function FG3dShadowDepthSkeletonEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="shadow.depth.skeleton";a._supportSkeleton=!0;a.drawRenderable=FG3dShadowDepthSkeletonEffect_drawRenderable;return a}
function FG3dShadowDepthSkeletonEffect_drawRenderable(a,b){var e=this._graphicContext,f=this._program;f.setParameter("vc_model_matrix",r.currentMatrix());f.setParameter("vc_vp_matrix",prvp);f.setParameter("vc_camera_position",prcp);f.setParameter("vc_light_direction",prld);f.setParameter("fc_camera_position",prcp);f.setParameter("fc_light_direction",prld);var h=r.material(),h=h.info();f.setParameter("fc_color",h.ambientColor);f.setParameter4("fc_vertex_color",h.colorMin,h.colorMax,h.colorRate,h.colorMerge);
f.setParameter4("fc_alpha",h.alphaBase,h.alphaRate,h.alphaLevel,h.alphaMerge);f.setParameter("fc_ambient_color",h.ambientColor);f.setParameter("fc_diffuse_color",h.diffuseColor);f.setParameter("fc_specular_color",h.specularColor);f.setParameter4("fc_specular",h.specularBase,h.specularRate,h.specularAverage,h.specularShadow);f.setParameter("fc_specular_view_color",h.specularViewColor);f.setParameter4("fc_specular_view",h.specularViewBase,h.specularViewRate,h.specularViewAverage,h.specularViewShadow);
f.setParameter("fc_reflect_color",h.reflectColor);var k=b.bones();if(k){var q=k.count();32<q&&(q=32);for(var t=RTypeArray.findTemp(EDataType.Float,16*q),u=0;u<q;u++)h=k.get(u).matrix(),h.writeData(t,16*u);f.setParameter("vc_bone_matrix",t)}this.bindAttributes(b);this.bindSamplers(b);e.drawTriangles(b.indexBuffer())}
function FG3dShadowTechnique(a){a=RClass.inherits(this,a,FG3dTechnique);a._code="shadow";a._passDepth=null;a._passColor=null;a.setup=FG3dShadowTechnique_setup;a.passDepth=FG3dShadowTechnique_passDepth;a.passColor=FG3dShadowTechnique_passColor;a.updateRegion=FG3dShadowTechnique_updateRegion;return a}
function FG3dShadowTechnique_setup(){this.__base.FG3dTechnique.setup.call(this);var a=this._passes,b=this._passDepth=RClass.create(FG3dShadowDepthPass);b.linkGraphicContext(this);b.setup();a.push(b);var e=this._passColor=RClass.create(FG3dShadowColorPass);e.linkGraphicContext(this);e.setup();a.push(e);e.setTextureDepth(b.textureDepth())}function FG3dShadowTechnique_passDepth(){return this._passDepth}function FG3dShadowTechnique_passColor(){return this._passColor}
function FG3dShadowTechnique_updateRegion(a){this.__base.FG3dTechnique.updateRegion.call(this,a);var b=a.camera();a.directionalLight().camera().updateFlatCamera(b)}
function FWglContext(a){a=RClass.inherits(this,a,FG3dContext);a._native=null;a._nativeInstance=null;a._nativeLayout=null;a._nativeDebugShader=null;a._activeRenderTarget=null;a._activeTextureSlot=null;a._parameters=null;a._extensions=null;a._data9=null;a._data16=null;a.construct=FWglContext_construct;a.linkCanvas=FWglContext_linkCanvas;a.parameters=FWglContext_parameters;a.extensions=FWglContext_extensions;a.createProgram=FWglContext_createProgram;a.createLayout=FWglContext_createLayout;a.createVertexBuffer=
FWglContext_createVertexBuffer;a.createIndexBuffer=FWglContext_createIndexBuffer;a.createFlatTexture=FWglContext_createFlatTexture;a.createCubeTexture=FWglContext_createCubeTexture;a.createRenderTarget=FWglContext_createRenderTarget;a.setViewport=FWglContext_setViewport;a.setFillMode=FWglContext_setFillMode;a.setDepthMode=FWglContext_setDepthMode;a.setCullingMode=FWglContext_setCullingMode;a.setBlendFactors=FWglContext_setBlendFactors;a.setScissorRectangle=FWglContext_setScissorRectangle;a.setRenderTarget=
FWglContext_setRenderTarget;a.setProgram=FWglContext_setProgram;a.bindConst=FWglContext_bindConst;a.bindVertexBuffer=FWglContext_bindVertexBuffer;a.bindTexture=FWglContext_bindTexture;a.clear=FWglContext_clear;a.clearColor=FWglContext_clearColor;a.clearDepth=FWglContext_clearDepth;a.drawTriangles=FWglContext_drawTriangles;a.present=FWglContext_present;a.checkError=FWglContext_checkError;return a}
function FWglContext_construct(){this.__base.FG3dContext.construct.call(this);this._capability=new SG3dContextCapability;this._data9=new Float32Array(9);this._data16=new Float32Array(16)}
function FWglContext_linkCanvas(a){this.__base.FG3dContext.linkCanvas.call(this,a);this._hCanvas=a;if(a.getContext){var b={};b.alpha=this._optionAlpha;b.antialias=this._optionAntialias;var e=a.getContext("experimental-webgl",b);null==e&&(e=a.getContext("webgl",b));if(null==e)throw new TError("Current browser can't support WebGL technique.");this._native=e;this._contextAttributes=e.getContextAttributes()}b=this._native;this.setViewport(a.width,a.height);this.setDepthMode(!0,EG3dDepthMode.LessEqual);
this.setCullingMode(!0,EG3dCullMode.Front);a=this._capability;a.vendor=b.getParameter(b.VENDOR);a.version=b.getParameter(b.VERSION);a.shaderVersion=b.getParameter(b.SHADING_LANGUAGE_VERSION);a.attributeCount=b.getParameter(b.MAX_VERTEX_ATTRIBS);a.vertexConst=b.getParameter(b.MAX_VERTEX_UNIFORM_VECTORS);a.varyingCount=b.getParameter(b.MAX_VARYING_VECTORS);a.fragmentConst=b.getParameter(b.MAX_FRAGMENT_UNIFORM_VECTORS);a.samplerCount=b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS);a.samplerSize=b.getParameter(b.MAX_TEXTURE_SIZE);
if(e=this._nativeInstance=b.getExtension("ANGLE_instanced_arrays"))a.optionInstance=!0;a.mergeCount=parseInt((a.vertexConst-32)/4);if(e=this._nativeLayout=b.getExtension("OES_vertex_array_object"))a.optionLayout=!0;if(e=b.getExtension("OES_element_index_uint"))a.optionIndex32=!0;if(e=this._nativeSamplerS3tc=b.getExtension("WEBGL_compressed_texture_s3tc"))a.samplerCompressRgb=e.COMPRESSED_RGB_S3TC_DXT1_EXT,a.samplerCompressRgba=e.COMPRESSED_RGBA_S3TC_DXT5_EXT;var e=a.shader={},f=e.vertexPrecision=
{};f.floatLow=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.LOW_FLOAT);f.floatMedium=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_FLOAT);f.floatHigh=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_FLOAT);f.intLow=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.LOW_INT);f.intMedium=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.MEDIUM_INT);f.intHigh=b.getShaderPrecisionFormat(b.VERTEX_SHADER,b.HIGH_INT);e=e.fragmentPrecision={};e.floatLow=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.LOW_FLOAT);
e.floatMedium=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT);e.floatHigh=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT);e.intLow=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.LOW_INT);e.intMedium=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.MEDIUM_INT);e.intHigh=b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_INT);if(e=this._nativeDebugShader=b.getExtension("WEBGL_debug_shaders"))a.optionShaderSource=!0}
function FWglContext_parameters(){var a=this._parameters;if(a)return a;for(var b="ACTIVE_TEXTURE ALIASED_LINE_WIDTH_RANGE ALIASED_POINT_SIZE_RANGE ALPHA_BITS ARRAY_BUFFER_BINDING BLEND BLEND_COLOR BLEND_DST_ALPHA BLEND_DST_RGB BLEND_EQUATION_ALPHA BLEND_EQUATION_RGB BLEND_SRC_ALPHA BLEND_SRC_RGB BLUE_BITS COLOR_CLEAR_VALUE COLOR_WRITEMASK COMPRESSED_TEXTURE_FORMATS CULL_FACE CULL_FACE_MODE CURRENT_PROGRAM DEPTH_BITS DEPTH_CLEAR_VALUE DEPTH_FUNC DEPTH_RANGE DEPTH_TEST DEPTH_WRITEMASK DITHER ELEMENT_ARRAY_BUFFER_BINDING FRAMEBUFFER_BINDING FRONT_FACE GENERATE_MIPMAP_HINT GREEN_BITS IMPLEMENTATION_COLOR_READ_FORMAT IMPLEMENTATION_COLOR_READ_TYPE LINE_WIDTH MAX_COMBINED_TEXTURE_IMAGE_UNITS MAX_CUBE_MAP_TEXTURE_SIZE MAX_FRAGMENT_UNIFORM_VECTORS MAX_RENDERBUFFER_SIZE MAX_TEXTURE_IMAGE_UNITS MAX_TEXTURE_SIZE MAX_VARYING_VECTORS MAX_VERTEX_ATTRIBS MAX_VERTEX_TEXTURE_IMAGE_UNITS MAX_VERTEX_UNIFORM_VECTORS MAX_VIEWPORT_DIMS PACK_ALIGNMENT POLYGON_OFFSET_FACTOR POLYGON_OFFSET_FILL POLYGON_OFFSET_UNITS RED_BITS RENDERBUFFER_BINDING RENDERER SAMPLE_BUFFERS SAMPLE_COVERAGE_INVERT SAMPLE_COVERAGE_VALUE SAMPLES SCISSOR_BOX SCISSOR_TEST SHADING_LANGUAGE_VERSION STENCIL_BACK_FAIL STENCIL_BACK_FUNC STENCIL_BACK_PASS_DEPTH_FAIL STENCIL_BACK_PASS_DEPTH_PASS STENCIL_BACK_REF STENCIL_BACK_VALUE_MASK STENCIL_BACK_WRITEMASK STENCIL_BITS STENCIL_CLEAR_VALUE STENCIL_FAIL STENCIL_FUNC STENCIL_PASS_DEPTH_FAIL STENCIL_PASS_DEPTH_PASS STENCIL_REF STENCIL_TEST STENCIL_VALUE_MASK STENCIL_WRITEMASK SUBPIXEL_BITS TEXTURE_BINDING_2D TEXTURE_BINDING_CUBE_MAP UNPACK_ALIGNMENT UNPACK_COLORSPACE_CONVERSION_WEBGL UNPACK_FLIP_Y_WEBGL UNPACK_PREMULTIPLY_ALPHA_WEBGL VENDOR VERSION VIEWPORT".split(" "),
e=this._native,f=b.length,a={},h=0;h<f;h++){var k=b[h];a[k]=e.getParameter(e[k])}if(b=e.getExtension("WEBGL_debug_renderer_info"))a.UNMASKED_RENDERER_WEBGL=e.getParameter(b.UNMASKED_RENDERER_WEBGL),a.UNMASKED_VENDOR_WEBGL=e.getParameter(b.UNMASKED_VENDOR_WEBGL);return this._parameters=a}function FWglContext_extensions(){var a=this._extensions;if(!a)for(var a=this._extensions={},b=this._native,e=b.getSupportedExtensions(),f=e.length,h=0;h<f;h++){var k=e[h];a[k]=b.getExtension(k)}return a}
function FWglContext_createProgram(){var a=RClass.create(FWglProgram);a.linkGraphicContext(this);a.setup();this._statistics._programTotal++;return a}function FWglContext_createLayout(){if(!this._capability.optionLayout)throw new TError(this,"Unsupport layout.");var a=RClass.create(FWglLayout);a.linkGraphicContext(this);a.setup();this._statistics._layoutTotal++;return a}
function FWglContext_createVertexBuffer(){var a=RClass.create(FWglVertexBuffer);a.linkGraphicContext(this);a.setup();this._statistics._vertexBufferTotal++;return a}function FWglContext_createIndexBuffer(){var a=RClass.create(FWglIndexBuffer);a.linkGraphicContext(this);a.setup();this._statistics._indexBufferTotal++;return a}function FWglContext_createFlatTexture(){var a=RClass.create(FWglFlatTexture);a.linkGraphicContext(this);a.setup();this._statistics._flatTextureTotal++;return a}
function FWglContext_createCubeTexture(){var a=RClass.create(FWglCubeTexture);a.linkGraphicContext(this);a.setup();this._statistics._cubeTextureTotal++;return a}function FWglContext_createRenderTarget(){var a=RClass.create(FWglRenderTarget);a.linkGraphicContext(this);a.setup();this._statistics._targetTotal++;return a}function FWglContext_setViewport(a,b,e,f){this._size.set(e,f);this._native.viewport(a,b,e,f)}
function FWglContext_setFillMode(a){var b=this._native;if(this._fillModeCd!=a){this._statistics._frameFillModeCount++;switch(a){case EG3dFillMode.Point:b.polygonMode(b.FRONT_AND_BACK,b.POINT);break;case EG3dFillMode.Line:b.polygonMode(b.FRONT_AND_BACK,b.LINE);break;case EG3dFillMode.Face:b.polygonMode(b.FRONT,b.FILL);break;default:throw new TError("Invalid parameter. (fill_mode={1})",a);}this._fillModeCd=a;return!0}}
function FWglContext_setDepthMode(a,b){var e=this._native;if(this._optionDepth==a&&this._depthModeCd==b)return!0;this._statistics._frameDepthModeCount++;this._optionDepth!=a&&(a?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._optionDepth=a);if(a&&this._depthModeCd!=b){var f=RWglUtility.convertDepthMode(e,b);e.depthFunc(f);this._depthModeCd=b}return!0}
function FWglContext_setCullingMode(a,b){var e=this._native;if(this._optionCull==a&&this._cullModeCd==b)return!0;this._statistics._frameCullModeCount++;this._optionCull!=a&&(a?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._optionCull=a);if(a&&this._cullModeCd!=b){var f=RWglUtility.convertCullMode(e,b);e.cullFace(f);this._cullModeCd=b}return!0}
function FWglContext_setBlendFactors(a,b,e){var f=this._native;if(this._statusBlend==a&&this._blendSourceCd==b&&this._blendTargetCd==e)return!0;this._statistics._frameBlendModeCount++;this._statusBlend!=a&&(a?f.enable(f.BLEND):(f.disable(f.BLEND),this._blendTargetCd=this._blendSourceCd=0),this._statusBlend=a);if(a&&(this._blendSourceCd!=b||this._blendTargetCd!=e)){a=RWglUtility.convertBlendFactors(f,b);var h=RWglUtility.convertBlendFactors(f,e);f.blendFunc(a,h);this._blendSourceCd=b;this._blendTargetCd=
e}return!0}function FWglContext_setScissorRectangle(a,b,e,f){this._native.scissor(a,b,e,f)}
function FWglContext_setRenderTarget(a){var b=this._native;if(this._activeRenderTarget!=a){this._statistics._frameTargetCount++;var e=!0;if(null==a){b.bindFramebuffer(b.FRAMEBUFFER,null);e=this.checkError("glBindFramebuffer","Bind frame buffer. (frame_buffer={1})",null);if(!e)return e;b.viewport(0,0,this._size.width,this._size.height)}else{b.bindFramebuffer(b.FRAMEBUFFER,a._native);result=this.checkError("glBindFramebuffer","Bind frame buffer. (frame_buffer={1})",a._native);if(!e)return e;e=a.size();
b.viewport(0,0,e.width,e.height)}this._activeRenderTarget=a}}function FWglContext_setProgram(a){var b=this._native;if(this._program!=a)return this._statistics._frameProgramCount++,a?b.useProgram(a._native):b.useProgram(null),this._program=a,this.checkError("useProgram","Set program failure. (program={1}, program_native={2})",a,a._native)}
function FWglContext_bindConst(a,b,e,f,h){var k=this._native,q=!0;this._statistics._frameConstCount++;switch(e){case EG3dParameterFormat.Float1:k.uniform1fv(b,f);this._statistics._frameConstLength+=f.byteLength;q=this.checkError("uniform1fv","Bind const data failure. (shader_cd={1}, slot={2}, data={3}, count={4})",a,b,f,h);break;case EG3dParameterFormat.Float2:k.uniform2fv(b,f);this._statistics._frameConstLength+=f.byteLength;q=this.checkError("uniform2fv","Bind const data failure. (shader_cd={1}, slot={2}, data={3}, count={4})",
a,b,f,h);break;case EG3dParameterFormat.Float3:k.uniform3fv(b,f);this._statistics._frameConstLength+=f.byteLength;q=this.checkError("uniform3fv","Bind const data failure. (shader_cd={1}, slot={2}, data={3}, count={4})",a,b,f,h);break;case EG3dParameterFormat.Float4:k.uniform4fv(b,f);this._statistics._frameConstLength+=f.byteLength;q=this.checkError("uniform4fv","Bind const data failure. (shader_cd={1}, slot={2}, data={3}, count={4})",a,b,f,h);break;case EG3dParameterFormat.Float3x3:var t=this._data9;
t[0]=f[0];t[1]=f[4];t[2]=f[8];t[3]=f[1];t[4]=f[5];t[5]=f[9];t[6]=f[2];t[7]=f[6];t[8]=f[10];k.uniformMatrix3fv(b,k.FALSE,t);this._statistics._frameConstLength+=t.byteLength;q=this.checkError("uniformMatrix3fv","Bind const matrix3x3 failure. (shader_cd={1}, slot={2}, data={3}, count={4})",a,b,f,h);break;case EG3dParameterFormat.Float4x3:k.uniform4fv(b,k.FALSE,pd);this._statistics._frameConstLength+=t.byteLength;q=this.checkError("uniform4fv","Bind const matrix4x3 failure. (shader_cd={1}, slot={2}, data={3}, count={4})",
a,b,f,h);break;case EG3dParameterFormat.Float4x4:e=null;if(f.constructor==Float32Array)e=f;else if(f.writeData)e=this._data16,f.writeData(e,0);else throw new TError("Unknown data type.");k.uniformMatrix4fv(b,k.FALSE,e);this._statistics._frameConstLength+=e.byteLength;q=this.checkError("uniformMatrix4fv","Bind const matrix4x4 failure. (shader_cd=%d, slot=%d, pData=0x%08X, count=%d)",a,b,f,h)}return q}
function FWglContext_bindVertexBuffer(a,b,e,f){var h=this._native,k=!0;this._statistics._frameBufferCount++;k=null;null!=b&&(k=b._native);h.bindBuffer(h.ARRAY_BUFFER,k);k=this.checkError("bindBuffer","Bind buffer. (buffer_id=%d)",k);if(!k)return k;if(null!=b){if(h.enableVertexAttribArray(a),k=this.checkError("enableVertexAttribArray","Enable vertex attribute array. (slot=%d)",a),!k)return k}else return h.disableVertexAttribArray(a),k=this.checkError("disableVertexAttribArray","Disable vertex attribute array. (slot=%d)",
a);b=b._stride;switch(f){case EG3dAttributeFormat.Float1:h.vertexAttribPointer(a,1,h.FLOAT,!1,b,e);break;case EG3dAttributeFormat.Float2:h.vertexAttribPointer(a,2,h.FLOAT,!1,b,e);break;case EG3dAttributeFormat.Float3:h.vertexAttribPointer(a,3,h.FLOAT,!1,b,e);break;case EG3dAttributeFormat.Float4:h.vertexAttribPointer(a,4,h.FLOAT,!1,b,e);break;case EG3dAttributeFormat.Byte4:h.vertexAttribPointer(a,4,h.UNSIGNED_BYTE,!1,b,e);break;case EG3dAttributeFormat.Byte4Normal:h.vertexAttribPointer(a,4,h.UNSIGNED_BYTE,
!0,b,e);break;default:throw new TError(this,"Unknown vertex format. (format_cd=%d)",formatCd);}return k=this.checkError("glVertexAttribPointer","Bind vertex attribute pointer. (slot=%d, format_cd=%d)",a,f)}
function FWglContext_bindTexture(a,b,e){var f=this._native,h=!0;this._statistics._frameTextureCount++;if(null==e)return f.bindTexture(f.TEXTURE_2D,null),h=this.checkError("bindTexture","Bind texture clear failure. (slot=%d)",a);if(this._activeTextureSlot!=a&&(f.uniform1i(a,b),f.activeTexture(f.TEXTURE0+b),h=this.checkError("activeTexture","Active texture failure. (slot=%d, index=%d)",a,b),!h))return h;a=null;switch(e.textureCd()){case EG3dTexture.Flat2d:a=f.TEXTURE_2D;f.bindTexture(f.TEXTURE_2D,e._native);
h=this.checkError("glBindTexture","Bind flag texture failure. (texture_id=%d)",e._native);if(!h)return h;break;case EG3dTexture.Cube:a=f.TEXTURE_CUBE_MAP;f.bindTexture(f.TEXTURE_CUBE_MAP,e._native);h=this.checkError("glBindTexture","Bind cube texture failure. (texture_id=%d)",e._native);if(!h)return h;break;default:RLogger.fatal(this,null,"Unknown texture type.")}(b=RWglUtility.convertSamplerFilter(f,e.filterMinCd()))&&f.texParameteri(a,f.TEXTURE_MIN_FILTER,b);(b=RWglUtility.convertSamplerFilter(f,
e.filterMagCd()))&&f.texParameteri(a,f.TEXTURE_MAG_FILTER,b);RWglUtility.convertSamplerFilter(f,e.wrapS());RWglUtility.convertSamplerFilter(f,e.wrapT());return h}function FWglContext_clear(a,b,e,f,h){var k=this._native;k.clearColor(a,b,e,f);k.clearDepth(h);k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT);this._statistics._frameClearCount++}function FWglContext_clearColor(a,b,e,f){var h=this._native;h.clearColor(a,b,e,f);h.clear(h.COLOR_BUFFER_BIT);this._statistics._frameClearCount++}
function FWglContext_clearDepth(a){var b=this._native;b.clearDepth(a);b.clear(b.DEPTH_BUFFER_BIT);this._statistics._frameClearCount++}
function FWglContext_drawTriangles(a,b,e){var f=this._native,h=!0;null==b&&(b=0);null==e&&(e=a.count());f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a._native);h=this.checkError("bindBuffer","Bind element array buffer failure. (index=0x%08X, offset=%d, count=%d, buffer_id)",a,b,e,a._native);if(!h)return h;h=RWglUtility.convertIndexStride(f,a.strideCd());a._fillMode==EG3dFillMode.Line?f.drawElements(f.LINES,e,h,2*b):f.drawElements(f.TRIANGLES,e,h,2*b);this._statistics._frameTriangleCount+=e;this._statistics._frameDrawCount++;
h=this.checkError("drawElements","Draw triangles failure. (index=0x%08X, offset=%d, count=%d)",a,b,e);if(!h)return h;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,null);return h=this.checkError("bindBuffer","Bind element array buffer failure. (index=0x%08X, offset=%d, count=%d)",a,b,e)}function FWglContext_present(){}
function FWglContext_checkError(a,b,e){if(!this._capability.optionDebug||!RRuntime.isDebug())return!0;a=this._native;b=!1;for(var f=e=null;;){e=a.getError();if(e==a.NO_ERROR){b=!0;break}switch(e){case a.INVALID_OPERATION:f="Invalid operation.";break;case a.INVALID_ENUM:f="Invalid enum.";break;case a.INVALID_VALUE:f="Invalid value.";break;case a.INVALID_FRAMEBUFFER_OPERATION:f="Invalid paramebuffer opeartion.";break;case a.OUT_OF_MEMORY:f="Out of memory.";break;default:f="Unknown"}}b||RLogger.fatal(this,
null,"OpenGL check failure. (code={1}, description={2})",e,f);return b}function FWglCubeTexture(a){a=RClass.inherits(this,a,FG3dCubeTexture);a._native=null;a.setup=FWglCubeTexture_setup;a.isValid=FWglCubeTexture_isValid;a.makeMipmap=FWglCubeTexture_makeMipmap;a.upload=FWglCubeTexture_upload;a.dispose=FWglCubeTexture_dispose;return a}function FWglCubeTexture_setup(){var a=this._graphicContext._native;this.__base.FG3dCubeTexture.setup.call(this);this._native=a.createTexture()}
function FWglCubeTexture_isValid(){return this._graphicContext._native.isTexture(this._native)}function FWglCubeTexture_makeMipmap(){var a=this._graphicContext._native;a.bindTexture(a.TEXTURE_CUBE_MAP,this._native);a.generateMipmap(a.TEXTURE_CUBE_MAP)}
function FWglCubeTexture_upload(a,b,e,f,h,k){var q=this._graphicContext,t=q._native;t.bindTexture(t.TEXTURE_CUBE_MAP,this._native);t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,a.image());t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,b.image());t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,e.image());t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,f.image());t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,
0,t.RGB,t.RGB,t.UNSIGNED_BYTE,h.image());t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,k.image());this._statusLoad=q.checkError("texImage2D","Upload cube image failure.")}function FWglCubeTexture_dispose(){var a=this._graphicContext,b=this._native;b&&(a._native.deleteTexture(b),this._native=null);this.__base.FG3dCubeTexture.dispose.call(this)}
function FWglFlatTexture(a){a=RClass.inherits(this,a,FG3dFlatTexture);a._native=null;a.setup=FWglFlatTexture_setup;a.isValid=FWglFlatTexture_isValid;a.makeMipmap=FWglFlatTexture_makeMipmap;a.uploadData=FWglFlatTexture_uploadData;a.upload=FWglFlatTexture_upload;a.dispose=FWglFlatTexture_dispose;return a}function FWglFlatTexture_setup(){var a=this._graphicContext._native;this.__base.FG3dFlatTexture.setup.call(this);this._native=a.createTexture()}
function FWglFlatTexture_isValid(){return this._graphicContext._native.isTexture(this._native)}function FWglFlatTexture_makeMipmap(){var a=this._graphicContext._native;a.bindTexture(a.TEXTURE_2D,this._native);a.generateMipmap(a.TEXTURE_2D)}
function FWglFlatTexture_uploadData(a,b,e){var f=this._graphicContext,h=f._native,k=null;if(a.constructor==ArrayBuffer)k=new Uint8Array(a);else if(a.constructor==Uint8Array)k=a;else throw new TError("Invalid data format.");this.width=b;this.height=e;h.bindTexture(h.TEXTURE_2D,this._native);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,b,e,0,h.RGBA,h.UNSIGNED_BYTE,k);this._statusLoad=f.checkError("texImage2D","Upload data failure.")}
function FWglFlatTexture_upload(a){var b=this._graphicContext;b.capability();var e=b._native,f=null;if(a.constructor==Image)f=a;else if(RClass.isClass(a,FImage))f=a.image(),a.optionAlpha();else throw new TError("Invalid image format.");e.bindTexture(e.TEXTURE_2D,this._native);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,f);this._statusLoad=b.checkError("texImage2D","Upload image failure.")}
function FWglFlatTexture_dispose(){var a=this._graphicContext,b=this._native;b&&(a._native.deleteTexture(b),this._native=null);this.__base.FG3dFlatTexture.dispose.call(this)}function FWglFragmentShader(a){a=RClass.inherits(this,a,FG3dFragmentShader);a._native=null;a.setup=FWglFragmentShader_setup;a.targetSource=FWglFragmentShader_targetSource;a.upload=FWglFragmentShader_upload;a.dispose=FWglFragmentShader_dispose;return a}
function FWglFragmentShader_setup(){this.__base.FG3dFragmentShader.setup.call(this);var a=this._graphicContext._native;this._native=a.createShader(a.FRAGMENT_SHADER)}function FWglFragmentShader_targetSource(){var a=this._graphicContext;return a.capability().optionShaderSource?a._nativeDebugShader.getTranslatedShaderSource(this._native):this._source}
function FWglFragmentShader_upload(a){var b=this._graphicContext._native,e=this._native;b.shaderSource(e,a);b.compileShader(e);if(!b.getShaderParameter(e,b.COMPILE_STATUS)){var f=b.getShaderInfoLog(e);b.deleteShader(e);this._native=null;throw new TError(this,"Upload fragment shader source failure. (error={1})\n{2}",f,a);}this._source=a;return!0}
function FWglFragmentShader_dispose(){var a=this._graphicContext,b=this._native;b&&(a._native.deleteShader(b),this._native=null);this.__base.FG3dFragmentShader.dispose.call(this)}function FWglIndexBuffer(a){a=RClass.inherits(this,a,FG3dIndexBuffer);a._native=null;a.setup=FWglIndexBuffer_setup;a.isValid=FWglIndexBuffer_isValid;a.upload=FWglIndexBuffer_upload;a.dispose=FWglIndexBuffer_dispose;return a}
function FWglIndexBuffer_setup(){this.__base.FG3dIndexBuffer.setup.call(this);this._native=this._graphicContext._native.createBuffer()}function FWglIndexBuffer_isValid(){return this._graphicContext._native.isBuffer(this._native)}
function FWglIndexBuffer_upload(a,b){var e=this._graphicContext,f=e._native;this._count=b;var h=null;if(a.constructor==Array||a.constructor==ArrayBuffer)if(this._strideCd==EG3dIndexStride.Uint16)h=new Uint16Array(a);else if(this._strideCd==EG3dIndexStride.Uint32)h=new Uint32Array(a);else throw new TError(this,"Index stride is invalid.");else if(a.constructor==Uint16Array){if(this._strideCd!=EG3dIndexStride.Uint16)throw new TError(this,"Index stride16 is invalid.");h=a}else if(a.constructor==Uint32Array){if(this._strideCd!=
EG3dIndexStride.Uint32)throw new TError(this,"Index stride16 is invalid.");h=a}else throw new TError(this,"Upload index data type is invalid. (value={1})",a);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this._native);e.checkError("bindBuffer","Bind buffer failure.");f.bufferData(f.ELEMENT_ARRAY_BUFFER,h,f.STATIC_DRAW);e.checkError("bufferData","Upload buffer data. (count={1})",b)}
function FWglIndexBuffer_dispose(){var a=this._graphicContext,b=this._native;b&&(a._native.deleteBuffer(b),this._native=null);this.__base.FG3dIndexBuffer.dispose.call(this)}function FWglLayout(a){a=RClass.inherits(this,a,FG3dLayout);a._native=null;a.setup=FWglLayout_setup;a.bind=FWglLayout_bind;a.unbind=FWglLayout_unbind;a.active=FWglLayout_active;a.deactive=FWglLayout_deactive;a.dispose=FWglLayout_dispose;return a}
function FWglLayout_setup(){this.__base.FG3dLayout.setup.call(this);this._native=this._graphicContext._nativeLayout.createVertexArrayOES()}function FWglLayout_bind(){this._graphicContext._nativeLayout.bindVertexArrayOES(this._native)}function FWglLayout_unbind(){this._graphicContext._nativeLayout.bindVertexArrayOES(null)}function FWglLayout_active(){this._graphicContext._nativeLayout.bindVertexArrayOES(this._native)}
function FWglLayout_deactive(){this._graphicContext._nativeLayout.bindVertexArrayOES(null)}function FWglLayout_dispose(){var a=this._graphicContext,b=this._native;b&&(a._nativeLayout.deleteVertexArrayOES(b),this._native=null);this.__base.FG3dLayout.dispose.call(this)}
function FWglProgram(a){a=RClass.inherits(this,a,FG3dProgram);a._native=null;a.setup=FWglProgram_setup;a.vertexShader=FWglProgram_vertexShader;a.fragmentShader=FWglProgram_fragmentShader;a.upload=FWglProgram_upload;a.build=FWglProgram_build;a.link=FWglProgram_link;a.dispose=FWglProgram_dispose;return a}function FWglProgram_setup(){this._native=(g=this._graphicContext)._native.createProgram()}
function FWglProgram_vertexShader(){var a=this._vertexShader;a||(a=this._vertexShader=RClass.create(FWglVertexShader),a.linkGraphicContext(this),a.setup());return a}function FWglProgram_fragmentShader(){var a=this._fragmentShader;a||(a=this._fragmentShader=RClass.create(FWglFragmentShader),a.linkGraphicContext(this),a.setup());return a}
function FWglProgram_upload(a,b){if(a==EG3dShader.Vertex)this.vertexShader().upload(b);else if(a==EG3dShader.Fragment)this.fragmentShader().upload(b);else throw Error("Unknown type");}
function FWglProgram_build(){var a=this._graphicContext,b=a._native,e=this._native,f=this.vertexShader();b.attachShader(e,f._native);var h=a.checkError("attachShader","Attach shader failure. (program_id=%d, shader_id=%d)",e,f._native);if(!h)return h;f=this.fragmentShader();b.attachShader(e,f._native);h=a.checkError("attachShader","Attach shader failure. (program_id=%d, shader_id=%d)",e,f._native);if(!h)return h;if(this.hasAttribute())for(var f=this.attributes(),k=f.count(),q=0;q<k;q++)if(h=f.value(q).name(),
b.bindAttribLocation(e,q,h),h=a.checkError("bindAttribLocation","Bind attribute location. (program_id=%d, slot=%d, name=%s)",e,q,h),!h)return h}
function FWglProgram_link(){var a=this._graphicContext,b=a._native,e=!1,f=this._native;b.linkProgram(f);e=b.getProgramParameter(f,b.LINK_STATUS);if(!e)return a=b.getProgramInfoLog(f),RLogger.fatal(this,null,"Link program failure. (status={1}, reason={2})",e,a),b.deleteProgram(this._native),this._native=null,!1;b.validateProgram(f);(e=b.getProgramParameter(f,b.VALIDATE_STATUS))||b.getProgramInfoLog(f);b.finish();e=a.checkError("finish","Finish program link faliure. (program_id={1})",f);if(!e)return e;
if(this.hasParameter())for(var h=this._parameters.count(),k=0;k<h;k++){var q=this._parameters.value(k),t=b.getUniformLocation(f,q.name()),e=a.checkError("getUniformLocation","Find parameter slot. (program_id=%d, name=%s, slot=%d)",f,q.name(),t);if(!e)return e;q._slot=t;null!=t&&(q._statusUsed=!0)}if(this.hasAttribute())for(h=this._attributes.count(),k=0;k<h;k++){q=this._attributes.value(k);t=b.getAttribLocation(f,q.name());e=a.checkError("getAttribLocation","Find attribute slot. (program_id=%d, name=%s, slot=%d)",
f,q.name(),t);if(!e)return e;q._slot=t;-1!=t&&(q._statusUsed=!0)}if(this.hasSampler()){h=this._samplers.count();for(k=0;k<h;k++){q=this._samplers.value(k);t=b.getUniformLocation(f,q.name());e=a.checkError("getUniformLocation","Find sampler slot. (program_id=%d, name=%s, slot=%d)",f,q.name(),t);if(!e)return e;q._slot=t;null!=t&&(q._statusUsed=!0)}for(k=b=0;k<h;k++)q=this._samplers.value(k),q._statusUsed&&(q._index=b++)}return e}
function FWglProgram_dispose(){var a=this._graphicContext,b=this._native;b&&(a._native.deleteProgram(b),this._native=null);this.__base.FProgram3d.dispose.call(this)}function FWglRenderTarget(a){a=RClass.inherits(this,a,FG3dRenderTarget);a._optionDepth=!0;a._native=null;a._nativeDepth=null;a.setup=FWglRenderTarget_setup;a.build=FWglRenderTarget_build;a.dispose=FWglRenderTarget_dispose;return a}
function FWglRenderTarget_setup(){this.__base.FG3dRenderTarget.setup.call(this);var a=this._graphicContext;this._native=a._native.createFramebuffer();return a.checkError("createFramebuffer","Create frame buffer failure.")}
function FWglRenderTarget_build(){var a=this._size,b=this._graphicContext,e=b._native;e.bindFramebuffer(e.FRAMEBUFFER,this._native);var f=b.checkError("bindFramebuffer","Bind frame buffer failure.");if(!f)return f;if(this._optionDepth){var h=this._nativeDepth=e.createRenderbuffer(),f=b.checkError("createRenderbuffer","Create render buffer failure.");if(!f)return f;e.bindRenderbuffer(e.RENDERBUFFER,h);f=b.checkError("bindRenderbuffer","Bind render buffer failure.");if(!f)return f;e.renderbufferStorage(e.RENDERBUFFER,
e.DEPTH_COMPONENT16,a.width,a.height);f=b.checkError("renderbufferStorage","Set render buffer storage format failure.");if(!f)return f;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,h);f=b.checkError("framebufferRenderbuffer","Set depth buffer to frame buffer failure. (framebuffer=%d, depthbuffer=%d)",this._native,h);if(!f)return f}for(var h=this._textures,k=h.count(),q=0;q<k;q++){var t=h.get(q);e.bindTexture(e.TEXTURE_2D,t._native);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,
e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,a.width,a.height,0,e.RGBA,e.UNSIGNED_BYTE,null);f=b.checkError("texImage2D","Alloc texture storage. (texture_id, size=%dx%d)",t._native,this._size.width,this._size.height);if(!f)return f;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+q,e.TEXTURE_2D,t._native,0);f=b.checkError("framebufferTexture2D","Set color buffer into frame buffer failure. (framebuffer_id=%d, texture_id=%d)",this._native,
t._native);if(!f)return f}}function FWglRenderTarget_dispose(){var a=this._graphicContext,b=this._nativeDepth;b&&(a._native.deleteRenderbuffer(b),this._nativeDepth=null);if(b=this._native)a._native.deleteFramebuffer(b),this._native=null;this.__base.FG3dRenderTarget.dispose.call(this)}
function FWglVertexBuffer(a){a=RClass.inherits(this,a,FG3dVertexBuffer);a._native=null;a.setup=FWglVertexBuffer_setup;a.isValid=FWglVertexBuffer_isValid;a.upload=FWglVertexBuffer_upload;a.dispose=FWglVertexBuffer_dispose;return a}function FWglVertexBuffer_setup(){this.__base.FG3dVertexBuffer.setup.call(this);this._native=this._graphicContext._native.createBuffer()}function FWglVertexBuffer_isValid(){return this._graphicContext._native.isBuffer(this._native)}
function FWglVertexBuffer_upload(a,b,e){var f=this._graphicContext,h=f._native;this._stride=b;this._count=e;b=null;if(a.constructor==Array||a.constructor==ArrayBuffer)b=new Float32Array(a);else if(a.constructor==Uint8Array)b=a;else if(a.constructor==Float32Array)b=a;else throw new TError(this,"Upload vertex data type is invalid. (data={1})",a);h.bindBuffer(h.ARRAY_BUFFER,this._native);f.checkError("bindBuffer","Bindbuffer");h.bufferData(h.ARRAY_BUFFER,b,h.STATIC_DRAW);f.checkError("bufferData","bufferData")}
function FWglVertexBuffer_dispose(){var a=this._graphicContext,b=this._native;b&&(a._native.deleteBuffer(b),this._native=null);this.__base.FG3dVertexBuffer.dispose.call(this)}function FWglVertexShader(a){a=RClass.inherits(this,a,FG3dVertexShader);a._native=null;a.setup=FWglVertexShader_setup;a.targetSource=FWglVertexShader_targetSource;a.upload=FWglVertexShader_upload;a.dispose=FWglVertexShader_dispose;return a}
function FWglVertexShader_setup(){this.__base.FG3dVertexShader.setup.call(this);var a=this._graphicContext._native;this._native=a.createShader(a.VERTEX_SHADER)}function FWglVertexShader_targetSource(){var a=this._graphicContext;return a.capability().optionShaderSource?a._nativeDebugShader.getTranslatedShaderSource(this._native):this._source}
function FWglVertexShader_upload(a){var b=this._graphicContext._native,e=this._native;b.shaderSource(e,a);b.compileShader(e);if(!b.getShaderParameter(e,b.COMPILE_STATUS)){var f=b.getShaderInfoLog(e);b.deleteShader(e);this._native=null;throw new TError(this,"Upload vertex shader source failure. (error={1})\n{2}",f,a);}this._source=a;return!0}
function FWglVertexShader_dispose(){var a=this._graphicContext,b=this._native;b&&(a._native.deleteShader(b),this._native=null);this.__base.FG3dVertexShader.dispose.call(this)}
var RWglUtility=new function(){this.convertFillMode=RWglUtility_convertFillMode;this.convertCullMode=RWglUtility_convertCullMode;this.convertDepthMode=RWglUtility_convertDepthMode;this.convertBlendFactors=RWglUtility_convertBlendFactors;this.convertIndexStride=RWglUtility_convertIndexStride;this.convertSamplerFilter=RWglUtility_convertSamplerFilter;return this};
function RWglUtility_convertFillMode(a,b){switch(b){case EG3dFillMode.Point:return a.POINT;case EG3dFillMode.Line:return a.LINE;case EG3dFillMode.Face:return a.FILL}throw new TError(this,"Convert fill mode failure. (fill_cd={1})",b);}function RWglUtility_convertCullMode(a,b){switch(b){case EG3dCullMode.Front:return a.FRONT;case EG3dCullMode.Back:return a.BACK;case EG3dCullMode.Both:return a.FRONT_AND_BACK}throw new TError(this,"Convert cull mode failure. (cull_cd={1})",b);}
function RWglUtility_convertDepthMode(a,b){switch(b){case EG3dDepthMode.Equal:return a.EQUAL;case EG3dDepthMode.NotEqual:return a.NOTEQUAL;case EG3dDepthMode.Less:return a.LESS;case EG3dDepthMode.LessEqual:return a.LEQUAL;case EG3dDepthMode.Greater:return a.GREATER;case EG3dDepthMode.GreaterEqual:return a.GEQUAL;case EG3dDepthMode.Always:return a.ALWAYS}throw new TError(this,"Convert depth mode failure. (depth_cd={1})",b);}
function RWglUtility_convertBlendFactors(a,b){switch(b){case EG3dBlendMode.SourceAlpha:return a.SRC_ALPHA;case EG3dBlendMode.OneMinusSourceAlpha:return a.ONE_MINUS_SRC_ALPHA}throw new TError(this,"Convert blend factors failure. (blend_cd={1})",b);}function RWglUtility_convertIndexStride(a,b){switch(b){case EG3dIndexStride.Uint16:return a.UNSIGNED_SHORT;case EG3dIndexStride.Uint32:return a.UNSIGNED_INT}throw new TError(this,"Convert index stride failure. (stride_cd={1})",b);}
function RWglUtility_convertSamplerFilter(a,b){switch(b){case EG3dSamplerFilter.Unknown:return 0;case EG3dSamplerFilter.Nearest:return a.NEAREST;case EG3dSamplerFilter.Linear:return a.LINEAR;case EG3dSamplerFilter.Repeat:return a.REPEAT;case EG3dSamplerFilter.ClampToEdge:return a.CLAMP_TO_EDGE;case EG3dSamplerFilter.ClampToBorder:return a.CLAMP_TO_BORDER}throw new TError(this,"Convert sampler filter failure. (filter_cd={1})",b);}
function MListenerEnterFrame(a){a=RClass.inherits(this,a,MListener);a.addEnterFrameListener=MListenerEnterFrame_addEnterFrameListener;a.removeEnterFrameListener=MListenerEnterFrame_removeEnterFrameListener;a.processEnterFrameListener=MListenerEnterFrame_processEnterFrameListener;return a}function MListenerEnterFrame_addEnterFrameListener(a,b){return this.addListener(EEvent.EnterFrame,a,b)}function MListenerEnterFrame_removeEnterFrameListener(a,b){this.removeListener(EEvent.EnterFrame,a,b)}
function MListenerEnterFrame_processEnterFrameListener(a,b,e,f,h){this.processListener(EEvent.EnterFrame,a,b,e,f,h)}function MListenerLeaveFrame(a){a=RClass.inherits(this,a,MListener);a.addLeaveFrameListener=MListenerLeaveFrame_addLeaveFrameListener;a.removeLeaveFrameListener=MListenerLeaveFrame_removeLeaveFrameListener;a.processLeaveFrameListener=MListenerLeaveFrame_processLeaveFrameListener;return a}
function MListenerLeaveFrame_addLeaveFrameListener(a,b){return this.addListener(EEvent.LeaveFrame,a,b)}function MListenerLeaveFrame_removeLeaveFrameListener(a,b){this.removeListener(EEvent.LeaveFrame,a,b)}function MListenerLeaveFrame_processLeaveFrameListener(a,b,e,f,h){this.processListener(EEvent.LeaveFrame,a,b,e,f,h)}
function FDisplay(a){a=RClass.inherits(this,a,FObject,MGraphicObject);a._parent=null;a._currentMatrix=null;a._name=null;a._matrix=null;a._location=null;a._rotation=null;a._scale=null;a._visible=!0;a._renderables=null;a.construct=FDisplay_construct;a.parent=FDisplay_parent;a.setParent=FDisplay_setParent;a.isName=FDisplay_isName;a.name=FDisplay_name;a.setName=FDisplay_setName;a.currentMatrix=FDisplay_currentMatrix;a.matrix=FDisplay_matrix;a.location=FDisplay_location;a.rotation=FDisplay_rotation;a.scale=
FDisplay_scale;a.hasRenderable=FDisplay_hasRenderable;a.renderables=FDisplay_renderables;a.pushRenderable=FDisplay_pushRenderable;a.removeRenderable=FDisplay_removeRenderable;a.filterDisplays=FDisplay_filterDisplays;a.filterRenderables=FDisplay_filterRenderables;a.show=FDisplay_show;a.hide=FDisplay_hide;a.setVisible=FDisplay_setVisible;a.update=FDisplay_update;a.updateMatrix=FDisplay_updateMatrix;a.process=FDisplay_process;a.remove=FDisplay_remove;a.dispose=FDisplay_dispose;return a}
function FDisplay_construct(){this.__base.FObject.construct.call(this);this._currentMatrix=new SMatrix3d;this._matrix=new SMatrix3d;this._location=new SPoint3;this._rotation=new SVector3;this._scale=new SVector3;this._scale.set(1,1,1)}function FDisplay_parent(){return this._parent}function FDisplay_setParent(a){this._parent=a}function FDisplay_isName(a){return this._name==a}function FDisplay_name(){return this._name}function FDisplay_setName(a){this._name=a}
function FDisplay_currentMatrix(){return this._currentMatrix}function FDisplay_matrix(){return this._matrix}function FDisplay_location(){return this._location}function FDisplay_rotation(){return this._rotation}function FDisplay_scale(){return this._scale}function FDisplay_hasRenderable(){var a=this._renderables;return a?!a.isEmpty():!1}function FDisplay_renderables(){var a=this._renderables;a||(a=this._renderables=new TObjects);return a}
function FDisplay_pushRenderable(a){a._display=this;this.renderables().push(a)}function FDisplay_removeRenderable(a){var b=this._renderables;b&&b.remove(a)}function FDisplay_filterDisplays(a){this._visible&&a.push(this)}function FDisplay_filterRenderables(a){if(!this._visible)return!1;var b=this._renderables;if(b)for(var e=b.count(),f=0;f<e;f++)b.getAt(f).filterDrawables(a);return!0}function FDisplay_show(){this.setVisible(!0)}function FDisplay_hide(){this.setVisible(!1)}
function FDisplay_setVisible(a){this._visible=a}function FDisplay_update(){var a=this._matrix;a.set(this._location,this._rotation,this._scale);a.update()}function FDisplay_updateMatrix(){this._currentMatrix.assign(this._matrix);var a=this._parent;a&&this._currentMatrix.append(a._currentMatrix)}function FDisplay_process(a){this.updateMatrix();var b=this._renderables;if(b)for(var e=b.count(),f=0;f<e;f++)b.getAt(f).process(a)}
function FDisplay_remove(){var a=this._parent;a&&(a.removeDisplay(this),this._parent=null)}function FDisplay_dispose(){RObject.dispose(this._currentMatrix);RObject.dispose(this._matrix);RObject.dispose(this._position);RObject.dispose(this._direction);RObject.dispose(this._scale);RObject.dispose(this._renderables);this.__base.FObject.dispose.call(this)}
function FDisplayContainer(a){a=RClass.inherits(this,a,FDisplay);a._displays=null;a.hasDisplay=FDisplayContainer_hasDisplay;a.findDisplay=FDisplayContainer_findDisplay;a.searchDisplay=FDisplayContainer_searchDisplay;a.displays=FDisplayContainer_displays;a.pushDisplay=FDisplayContainer_pushDisplay;a.removeDisplay=FDisplayContainer_removeDisplay;a.filterDisplays=FDisplayContainer_filterDisplays;a.filterRenderables=FDisplayContainer_filterRenderables;a.process=FDisplayContainer_process;a.dispose=FDisplayContainer_dispose;
return a}function FDisplayContainer_hasDisplay(){var a=this._displays;return a?!a.isEmpty():!1}function FDisplayContainer_findDisplay(a){var b=this._displays;if(b)for(var e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h.isName(a))return h}return null}function FDisplayContainer_searchDisplay(a){var b=this._displays;if(b)for(var e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h.isName(a)||(h=h.searchDisplay(a)))return h}return null}
function FDisplayContainer_displays(){var a=this._displays;a||(a=this._displays=new TObjects);return a}function FDisplayContainer_pushDisplay(a){a._parent=this;this.displays().push(a)}function FDisplayContainer_removeDisplay(a){this.displays().remove(a);a._parent=null}function FDisplayContainer_filterDisplays(a){this.__base.FDisplay.filterDisplays.call(this,a);if(this._visible){var b=this._displays;if(b)for(var e=b.count(),f=0;f<e;f++)b.get(f).filterDisplays(a)}}
function FDisplayContainer_filterRenderables(a){this.__base.FDisplay.filterRenderables.call(this,a);if(!this._visible)return!1;var b=this._displays;if(b)for(var e=b.count(),f=0;f<e;f++)b.getAt(f).filterRenderables(a);return!0}function FDisplayContainer_process(a){this.__base.FDisplay.process.call(this,a);var b=this._displays;if(b)for(var e=b.count(),f=0;f<e;f++)b.get(f).process(a)}
function FDisplayContainer_dispose(){var a=this._displays;if(a){for(var b=a.count()-1;0<=b;b--)a.get(b).dispose();a.dispose();this._displays=null}this.__base.FDisplay.dispose.call(this)}
function FDisplayLayer(a){a=RClass.inherits(this,a,FDisplayContainer);a._statusActive=!1;a._technique=null;a._visibleRenderables=null;a.construct=FDisplayLayer_construct;a.technique=FDisplayLayer_technique;a.setTechnique=FDisplayLayer_setTechnique;a.selectTechnique=FDisplayLayer_selectTechnique;a.visibleRenderables=FDisplayLayer_visibleRenderables;a.filterRenderables=FDisplayLayer_filterRenderables;a.active=FDisplayLayer_active;a.deactive=FDisplayLayer_deactive;return a}
function FDisplayLayer_construct(){this.__base.FDisplayContainer.construct.call(this);this._visibleRenderables=new TObjects}function FDisplayLayer_technique(){return this._technique}function FDisplayLayer_setTechnique(a){this._technique=a}function FDisplayLayer_selectTechnique(a,b){this._technique=RConsole.find(FG3dTechniqueConsole).find(a,b)}function FDisplayLayer_visibleRenderables(){return this._visibleRenderables}
function FDisplayLayer_filterRenderables(a){this.__base.FDisplayContainer.filterRenderables.call(this,a);this._visibleRenderables.assign(a.renderables())}function FDisplayLayer_active(){this._statusActive=!0}function FDisplayLayer_deactive(){this._statusActive=!1}function FDisplayUiLayer(a){return a=RClass.inherits(this,a,FDisplayLayer)}
function FDrawable(a){a=RClass.inherits(this,a,FObject);a._visible=!0;a._drawables=null;a.testVisible=FDrawable_testVisible;a.visible=FDrawable_visible;a.setVisible=FDrawable_setVisible;a.hasDrawable=FDrawable_hasDrawable;a.drawables=FDrawable_drawables;a.pushDrawable=FDrawable_pushDrawable;a.removeDrawable=FDrawable_removeDrawable;a.filterDrawables=FDrawable_filterDrawables;a.process=FDrawable_process;return a}function FDrawable_testVisible(){return this._visible}
function FDrawable_visible(){return this._visible}function FDrawable_setVisible(a){this._visible=a}function FDrawable_hasDrawable(){var a=this._drawables;return a?!a.isEmpty():!1}function FDrawable_drawables(){var a=this._drawables;a||(a=this._drawables=new TObjects);return a}function FDrawable_pushDrawable(a){a._parent=this;a._drawable=this;this.drawables().push(a)}function FDrawable_removeDrawable(a){var b=this._drawables;b&&b.remove(a)}
function FDrawable_filterDrawables(a){if(!this.testVisible())return!1;a.pushRenderable(this);var b=this._drawables;if(b)for(var e=b.count(),f=0;f<e;f++){var h=b.getAt(f);h.testVisible()&&a.pushRenderable(h)}}function FDrawable_process(a){var b=this._drawables;if(b)for(var e=b.count()-1;0<=e;e--)b.getAt(e).process(a)}function FRegion(a){return a=RClass.inherits(this,a,FObject)}
function FStage(a){a=RClass.inherits(this,a,FObject,MListenerEnterFrame,MListenerLeaveFrame);a._statusActive=!1;a._layers=null;a.onProcess=FStage_onProcess;a.construct=FStage_construct;a.registerLayer=RStage_registerLayer;a.unregisterLayer=RStage_unregisterLayer;a.layers=FStage_layers;a.active=FStage_active;a.deactive=FStage_deactive;a.process=FStage_process;a.dispose=FStage_dispose;return a}function FStage_onProcess(){for(var a=this._layers,b=a.count(),e=0;e<b;e++)a.valueAt(e).process()}
function FStage_construct(){this.__base.FObject.construct.call(this);this._layers=new TDictionary}function RStage_registerLayer(a,b){this._layers.set(a,b)}function RStage_unregisterLayer(a){this._layers.set(a,null)}function FStage_layers(){return this._layers}function FStage_active(){this._statusActive=!0;for(var a=this._layers,b=a.count(),e=0;e<b;e++)a.value(e).active()}function FStage_deactive(){for(var a=this._layers,b=a.count(),e=0;e<b;e++)a.value(e).deactive();this._statusActive=!1}
function FStage_process(){this.processEnterFrameListener(this);this.onProcess();this.processLeaveFrameListener(this)}function FStage_dispose(){this._layers=RObject.dispose(this._layers);this.__base.MListenerEnterFrame.dispose.call(this);this.__base.MListenerLeaveFrame.dispose.call(this);this.__base.FObject.dispose.call(this)}
var RStage=new function(){this._active=!0;this._interval=25;this.lsnsLeaveFrame=this.lsnsEnterFrame=this._stages=null;this.onProcess=RStage_onProcess;this.construct=RStage_construct;this.register=RStage_register;this.active=RStage_active;this.deactive=RStage_deactive;this.process=RStage_process;this.start=RStage_start;this.construct();return this};function RStage_onProcess(){RStage.process()}function RStage_construct(){this.lsnsEnterFrame=new TListeners;this.lsnsLeaveFrame=new TListeners}
function RStage_register(a,b){var e=this._stages;null==e&&(e=this._stages=new TDictionary);e.set(a,b)}function RStage_active(){var a=this._stages;if(null!=a)for(var b=a.count(),e=0;e<b;e++)a.value(e).active()}function RStage_deactive(){var a=this._stages;if(null!=a)for(var b=a.count(),e=0;e<b;e++)a.value(e).deactive()}
function RStage_process(){if(this._active){this.lsnsEnterFrame.process(this);var a=this._stages;if(a)for(var b=a.count(),e=0;e<b;e++)a.valueAt(e).process();this.lsnsLeaveFrame.process(this);RTimer.update()}}function RStage_start(a){RE3dEngine.setup();this.active();this.process();null==a&&(a=this._interval);RTimer.setup();setInterval("RStage_onProcess()",parseInt(a))}function FE2dDrawable(a){return a=RClass.inherits(this,a,FDrawable)}
function FE3dCanvas(a){a=RClass.inherits(this,a,FObject,MListenerLoad,MMouseCapture);a._optionAlpha=!0;a._optionAntialias=!1;a._context=null;a._scaleRate=1;a._interval=1E3/60;a._hPanel=null;a._hCanvas=null;a.ohTouchStart=FE3dCanvas_ohTouchStart;a.ohTouchMove=FE3dCanvas_ohTouchMove;a.ohTouchStop=FE3dCanvas_ohTouchStop;a.onTouchStart=RMethod.empty;a.onTouchMove=RMethod.empty;a.onTouchStop=RMethod.empty;a.onResize=FE3dCanvas_onResize;a.construct=FE3dCanvas_construct;a.build=FE3dCanvas_build;a.setPanel=
FE3dCanvas_setPanel;a.dispose=FE3dCanvas_dispose;return a}function FE3dCanvas_ohTouchStart(a){this.__linker.onTouchStart(a)}function FE3dCanvas_ohTouchMove(a){this.__linker.onTouchMove(a)}function FE3dCanvas_ohTouchStop(a){this.__linker.onTouchStop(a)}function FE3dCanvas_onResize(a){var b=this._hPanel;a=b.offsetWidth*this._scaleRate;var b=b.offsetHeight*this._scaleRate,e=this._hCanvas;e.width=a;e.height=b;this._context.setViewport(0,0,a,b)}
function FE3dCanvas_construct(){this.__base.FObject.construct.call(this)}
function FE3dCanvas_build(a){a=this._hCanvas=RBuilder.create(a,"CANVAS");a.__linker=this;a.style.width="100%";a.style.height="100%";a.style.display="block";RMethod.isEmpty(this.onTouchStart)||a.addEventListener("touchstart",this.ohTouchStart,!1);RMethod.isEmpty(this.onTouchMove)||a.addEventListener("touchmove",this.ohTouchMove,!1);RMethod.isEmpty(this.onTouchStop)||a.addEventListener("touchend",this.ohTouchStop,!1);var b={};b.alpha=this._optionAlpha;b.antialias=this._optionAntialias;this._context=
REngine3d.createContext(FWglContext,a,b);RStage.lsnsEnterFrame.register(this,this.onEnterFrame);RStage.start(this._interval);RWindow.lsnsResize.register(this,this.onResize);RWindow.lsnsOrientation.register(this,this.onResize);RConsole.find(FMouseConsole).register(this)}function FE3dCanvas_setPanel(a){this._hPanel=a;a.appendChild(this._hCanvas);this.onResize()}
function FE3dCanvas_dispose(){var a=this._hCanvas;a&&(a.__linker=null,a.removeEventListener("touchstart",this.ohTouchStart),a.removeEventListener("touchmove",this.ohTouchMove),a.removeEventListener("touchend",this.ohTouchStop));this._context=RObject.dispose(this._context);this._hPanel=RHtml.free(this._hPanel);this._hCanvas=RHtml.free(this._hCanvas);this.__base.FObject.dispose.call(this)}
function FE3dDisplay(a){a=RClass.inherits(this,a,FDisplay);a._materials=null;a.construct=FE3dDisplay_construct;a.materials=FE3dDisplay_materials;a.dispose=FE3dDisplay_dispose;return a}function FE3dDisplay_construct(){this.__base.FDisplay.construct.call(this);this._materials=new TDictionary}function FE3dDisplay_materials(){return this._materials}function FE3dDisplay_dispose(){this._materials=RObject.free(this._materials);this.__base.FDisplay.dispose.call(this)}
function FE3dDrawable(a){return a=RClass.inherits(this,a,FDrawable)}function FE3dRegion(a){a=RClass.inherits(this,a,FRegion,MG3dRegion,MGraphicObject);a._backgroundColor=null;a.construct=FE3dRegion_construct;a.backgroundColor=FE3dRegion_backgroundColor;a.prepare=FE3dRegion_prepare;a.dispose=FE3dRegion_dispose;return a}
function FE3dRegion_construct(){this.__base.FRegion.construct.call(this);this.__base.MG3dRegion.construct.call(this);(this._backgroundColor=new SColor4).set(0,0,0,1);this._calculateCameraMatrix=new SMatrix3d}function FE3dRegion_backgroundColor(){return this._backgroundColor}function FE3dRegion_prepare(){this.__base.MG3dRegion.prepare.call(this);this._calculateCameraMatrix.attach(this._camera.matrix())&&(this._changed=!0)}
function FE3dRegion_dispose(){this.__base.FRegion.dispose.call(this);this.__base.MG3dRegion.dispose.call(this)}
function FE3dRenderable(a){a=RClass.inherits(this,a,FE3dDrawable,MG3dRenderable,MGraphicObject);a._display=null;a._calculateMatrix=null;a._vertexCount=0;a._vertexBuffers=null;a._indexBuffer=null;a._textures=null;a.construct=FE3dRenderable_construct;a.setup=RMethod.empty;a.testVisible=FE3dRenderable_testVisible;a.display=FE3dRenderable_display;a.setDisplay=FE3dRenderable_setDisplay;a.vertexCount=FE3dRenderable_vertexCount;a.findVertexBuffer=FE3dRenderable_findVertexBuffer;a.vertexBuffers=FE3dRenderable_vertexBuffers;
a.indexBuffer=FE3dRenderable_indexBuffer;a.findTexture=FE3dRenderable_findTexture;a.textures=FE3dRenderable_textures;a.bones=RMethod.empty;a.update=FE3dRenderable_update;a.remove=FE3dRenderable_remove;return a}function FE3dRenderable_construct(){this.__base.FE3dDrawable.construct.call(this);this.__base.MG3dRenderable.construct.call(this);this._calculateMatrix=new SMatrix3d;this._vertexBuffers=new TDictionary}
function FE3dRenderable_testVisible(){var a=this.__base.FE3dDrawable.testVisible.call(this);return a&&RRuntime.isDebug()&&!this.material().testVisible()?!1:a}function FE3dRenderable_display(){return this._display}function FE3dRenderable_setDisplay(a){this._display=a}function FE3dRenderable_vertexCount(){return this._vertexCount}function FE3dRenderable_findVertexBuffer(a){return this._vertexBuffers.get(a)}function FE3dRenderable_vertexBuffers(){return this._vertexBuffers}
function FE3dRenderable_indexBuffer(){return this._indexBuffer}function FE3dRenderable_findTexture(a){return this._textures.get(a)}function FE3dRenderable_textures(){return this._textures}function FE3dRenderable_update(a){var b=this._calculateMatrix;b.assign(this._matrix);var e=this._drawable;e&&b.append(e.currentMatrix());(e=this._display)&&b.append(e.currentMatrix());this._currentMatrix.attachData(b.data())&&a&&a.change()}
function FE3dRenderable_remove(){var a=this._display;a&&(a.removeRenderable(this),this._display=null)}
function FE3dSimpleStage(a){a=RClass.inherits(this,a,FE3dStage);a._optionKeyboard=!0;a._skyLayer=null;a._mapLayer=null;a._spriteLayer=null;a._faceLayer=null;a.onKeyDown=FE3dSimpleStage_onKeyDown;a.construct=FE3dSimpleStage_construct;a.skyLayer=FE3dSimpleStage_skyLayer;a.mapLayer=FE3dSimpleStage_mapLayer;a.spriteLayer=FE3dSimpleStage_spriteLayer;a.faceLayer=FE3dSimpleStage_faceLayer;a.active=FE3dSimpleStage_active;a.deactive=FE3dSimpleStage_deactive;return a}
function FE3dSimpleStage_onKeyDown(a){var b=this._camera;switch(a.keyCode){case EKeyCode.W:b.doWalk(.3);break;case EKeyCode.S:b.doWalk(-.3);break;case EKeyCode.A:b.doStrafe(.3);break;case EKeyCode.D:b.doStrafe(-.3);break;case EKeyCode.Q:b.doFly(.3);break;case EKeyCode.E:b.doFly(-.3)}b.update()}
function FE3dSimpleStage_construct(){this.__base.FE3dStage.construct.call(this);var a=this._skyLayer=RClass.create(FDisplayLayer);this.registerLayer("sky",a);a=this._mapLayer=RClass.create(FDisplayLayer);this.registerLayer("map",a);a=this._spriteLayer=RClass.create(FDisplayLayer);this.registerLayer("sprite",a);a=this._faceLayer=RClass.create(FDisplayLayer);this.registerLayer("face",a)}function FE3dSimpleStage_skyLayer(){return this._skyLayer}
function FE3dSimpleStage_mapLayer(){return this._mapLayer}function FE3dSimpleStage_spriteLayer(){return this._spriteLayer}function FE3dSimpleStage_faceLayer(){return this._faceLayer}function FE3dSimpleStage_active(){this.__base.FE3dStage.active.call(this);this._optionKeyboard&&RWindow.lsnsKeyDown.register(this,this.onKeyDown)}function FE3dSimpleStage_deactive(){this.__base.FE3dStage.deactive.call(this);this._optionKeyboard&&RWindow.lsnsKeyDown.unregister(this,this.onKeyDown)}
function FE3dSprite(a){a=RClass.inherits(this,a,FObject);a._context=null;a._visible=!0;a.linkContext=FE3dSprite_linkContext;a.testVisible=FE3dSprite_testVisible;return a}function FE3dSprite_linkContext(a){this._context=a}function FE3dSprite_testVisible(a){return this._visible}
function FE3dStage(a){a=RClass.inherits(this,a,FStage,MGraphicObject);a._statistics=null;a._camera=null;a._directionalLight=null;a._technique=null;a._region=null;a._allDisplays=null;a.onProcess=FE3dStage_onProcess;a.construct=FE3dStage_construct;a.createRegion=FE3dStage_createRegion;a.setup=FE3dStage_setup;a.statistics=FE3dStage_statistics;a.camera=FE3dStage_camera;a.projection=FE3dStage_projection;a.directionalLight=FE3dStage_directionalLight;a.technique=FE3dStage_technique;a.selectTechnique=FE3dStage_selectTechnique;
a.region=FE3dStage_region;a.filterDisplays=FE3dStage_filterDisplays;a.allDisplays=FE3dStage_allDisplays;return a}
function FE3dStage_onProcess(){var a=this._region,b=this._technique,e=b._graphicContext,f=a._statistics=this._statistics;f.resetFrame();f._frame.begin();f._frameProcess.begin();e.prepare();b.updateRegion(a);a.prepare();a.change();for(var e=this._layers,h=e.count(),k=0;k<h;k++){var q=e.valueAt(k);a.reset();q.process();q.filterRenderables(a);a.update()}RConsole.find(FE3dStageConsole).process(a);f._frameProcess.end();f._frameDraw.begin();if(a.isChanged()){b.clear(a.backgroundColor());for(k=0;k<h;k++){var q=
e.valueAt(k),t=q.technique();t||(t=b);a.reset();a.renderables().assign(q.visibleRenderables());t.drawRegion(a)}b.present(a)}f._frameDraw.end();f._frame.end()}
function FE3dStage_construct(){this.__base.FStage.construct.call(this);this._statistics=RClass.create(FE3dStageStatistics);RConsole.find(FStatisticsConsole).register("engine.stage",this._statistics);this._allDisplays=new TObjects;var a=this._camera=RClass.create(FE3dCamera);a.position().set(0,0,-100);a.lookAt(0,0,0);a.update();a._projection.update();var b=this._directionalLight=RClass.create(FG3dDirectionalLight);b.direction().set(0,-1,0);var e=this._region=this.createRegion();e._camera=a;e._directionalLight=
b}function FE3dStage_createRegion(){return RClass.create(FE3dRegion)}function FE3dStage_setup(){this.__base.FStage.construct.call(this);this._region.linkGraphicContext(this);this._region.setup()}function FE3dStage_statistics(){return this._statistics}function FE3dStage_camera(){return this._camera}function FE3dStage_projection(){return this._projection}function FE3dStage_directionalLight(){return this._directionalLight}function FE3dStage_technique(){return this._technique}
function FE3dStage_selectTechnique(a,b){this._technique=RConsole.find(FG3dTechniqueConsole).find(a,b)}function FE3dStage_region(){return this._region}function FE3dStage_filterDisplays(a){for(var b=this._layers,e=b.count(),f=0;f<e;f++)b.value(f).filterDisplays(a)}function FE3dStage_allDisplays(){var a=this._allDisplays;a.clear();this.filterDisplays(a);return a}
function FE3dStageConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._looper=null;a._renderables=null;a._thread=null;a._interval=50;a._limit=16;a.onProcess=FE3dStageConsole_onProcess;a.construct=FE3dStageConsole_construct;a.process=FE3dStageConsole_process;return a}function FE3dStageConsole_onProcess(){var a=this._looper;a.record();for(var b=this._limit-1;0<=b;b--){var e=a.next();e&&e.processDelay()}}
function FE3dStageConsole_construct(){this._looper=new TLooper;this._renderables=new TDictionary;var a=this._thread=RClass.create(FThread);a.setInterval(this._interval);a.addProcessListener(this,this.onProcess);RConsole.find(FThreadConsole).start(a)}function FE3dStageConsole_process(a){}
function FE3dStageStatistics(a){a=RClass.inherits(this,a,FStatistics);a._frame=null;a._frameProcess=null;a._frameDraw=null;a._frameDrawSort=null;a._frameDrawRenderable=null;a.construct=FE3dStageStatistics_construct;a.reset=FE3dStageStatistics_reset;a.resetFrame=FE3dStageStatistics_resetFrame;return a}
function FE3dStageStatistics_construct(){this.__base.FStatistics.construct.call(this);this._frame=new TSpeed;this._frameProcess=new TSpeed;this._frameDraw=new TSpeed;this._frameDrawSort=new TSpeed;this._frameDrawRenderable=new TSpeed}function FE3dStageStatistics_reset(){}function FE3dStageStatistics_resetFrame(){this._frame.reset();this._frameProcess.reset();this._frameDraw.reset();this._frameDrawSort.reset();this._frameDrawRenderable.reset()}
var RE3dEngine=new function(){this._setuped=!1;this.onSetup=RE3dEngine_onSetup;this.setup=RE3dEngine_setup;return this};
function RE3dEngine_onSetup(){var a=RConsole.find(FG3dEffectConsole);a.register("select.select.control",FG3dSelectAutomaticEffect);a.register("select.select.automatic",FG3dSelectAutomaticEffect);a.register("select.select.skeleton",FG3dSelectSkeletonEffect);a.register("select.select.skeleton.4",FG3dSelectSkeletonEffect);a.register("control.control.automatic",FG3dControlAutomaticEffect);a.register("general.color.control",FG3dControlAutomaticEffect);a.register("general.color.automatic",FE3dGeneralColorAutomaticEffect);
a.register("general.color.skeleton",FG3dGeneralColorSkeletonEffect);a.register("general.color.skeleton.4",FG3dGeneralColorSkeletonEffect);a.register("shadow.depth.automatic",FG3dShadowDepthAutomaticEffect);a.register("shadow.depth.skeleton",FG3dShadowDepthSkeletonEffect);a.register("shadow.color.automatic",FG3dShadowColorAutomaticEffect);a.register("shadow.color.skeleton",FG3dShadowColorSkeletonEffect)}function RE3dEngine_setup(){this._setuped||(this.onSetup(),this._setuped=!0)}
function SE3sCompressEvent(a,b,e){this.owner=a;this.process=b;this.data=e;return this}function SE3sMaterialInfo(){SG3dMaterialInfo.call(this);this.unserialize=SE3sMaterialInfo_unserialize;this.saveConfig=SE3sMaterialInfo_saveConfig;return this}
function SE3sMaterialInfo_unserialize(a){this.effectCode=a.readString();this.optionDepth=a.readBoolean();this.optionDouble=a.readBoolean();this.optionNormalInvert=a.readBoolean();this.optionShadow=a.readBoolean();this.optionShadowSelf=a.readBoolean();this.optionAlpha=a.readBoolean();this.alphaBase=a.readFloat();this.alphaRate=a.readFloat();this.optionColor=a.readBoolean();this.colorMin=a.readFloat();this.colorMax=a.readFloat();this.colorRate=a.readFloat();this.colorMerge=a.readFloat();this.optionAmbient=
a.readBoolean();this.ambientColor.unserialize(a);this.optionDiffuse=a.readBoolean();this.diffuseColor.unserialize(a);this.optionDiffuseView=a.readBoolean();this.diffuseViewColor.unserialize(a);this.optionSpecular=a.readBoolean();this.specularColor.unserialize(a);this.specularBase=a.readFloat();this.specularLevel=a.readFloat();this.optionSpecularView=a.readBoolean();this.specularViewColor.unserialize(a);this.specularViewBase=a.readFloat();this.specularViewLevel=a.readFloat();this.optionReflect=a.readBoolean();
this.reflectColor.unserialize(a);this.reflectMerge=a.readFloat();this.optionRefract=a.readBoolean();this.refractFrontColor.unserialize(a);this.refractBackColor.unserialize(a);this.optionOpacity=a.readBoolean();this.opacityColor.unserialize(a);this.opacityRate=a.readFloat();this.opacityAlpha=a.readFloat();this.opacityDepth=a.readFloat();this.opacityTransmittance=a.readFloat();this.optionEmissive=a.readBoolean();this.emissiveColor.unserialize(a)}
function SE3sMaterialInfo_saveConfig(a){a.set("effect_code",this.effectCode);a.setBoolean("option_double",this.optionDouble);a.setBoolean("option_alpha",this.optionAlpha);a.setBoolean("option_normal_invert",this.optionNormalInvert);a.setBoolean("option_shadow",this.optionShadow);a.setBoolean("option_shadow_self",this.optionShadowSelf);var b=a.create("Alpha");b.setBoolean("valid",this.optionAlpha);b.setFloat("base",this.alphaBase);b.setFloat("rate",this.alphaRate);b=a.create("Color");b.setBoolean("valid",
this.optionColor);b.setFloat("min",this.colorMin);b.setFloat("max",this.colorMax);b.setFloat("rate",this.colorRate);b.setFloat("merge",this.colorMerge);b=a.create("Ambient");b.setBoolean("valid",this.optionAmbient);this.ambientColor.savePower(b);b=a.create("Diffuse");b.setBoolean("valid",this.optionDiffuse);this.diffuseColor.savePower(b);b=a.create("DiffuseView");b.setBoolean("valid",this.optionDiffuseView);this.diffuseViewColor.savePower(b);b=a.create("Specular");b.setBoolean("valid",this.optionSpecular);
this.specularColor.savePower(b);b.setFloat("base",this.specularBase);b.setFloat("level",this.specularLevel);b=a.create("SpecularView");b.setBoolean("valid",this.optionSpecularView);this.specularViewColor.savePower(b);b.setFloat("base",this.specularViewBase);b.setFloat("level",this.specularViewLevel);b=a.create("Reflect");b.setBoolean("valid",this.optionReflect);this.reflectColor.savePower(b);b.setFloat("merge",this.reflectMerge);b=a.create("Refract");b.setBoolean("valid",this.optionRefract);this.refractFrontColor.savePower(b.create("Front"));
this.refractBackColor.savePower(b.create("Back"));b=a.create("Opacity");b.setBoolean("valid",this.optionOpacity);this.opacityColor.savePower(b);b.setFloat("rate",this.opacityRate);b.setFloat("alpha",this.opacityAlpha);b.setFloat("depth",this.opacityDepth);b.setFloat("transmittance",this.opacityTransmittance);b=a.create("Emissive");b.setBoolean("valid",this.optionEmissive);this.emissiveColor.savePower(b)}
function SE3sSceneShadow(){this.range=this.level=this.rate=this.base=null;this.unserialize=SE3sSceneShadow_unserialize;return this}function SE3sSceneShadow_unserialize(a){this.base=a.readFloat();this.rate=a.readFloat();this.level=a.readFloat();this.range=a.readFloat()}
function FE3sAnimation(a){a=RClass.inherits(this,a,FE3sObject);a._model=null;a._skeletonGuid=null;a._skeleton=null;a._frameCount=0;a._frameTick=0;a._frameSpan=0;a._tracks=null;a.skeletonGuid=FE3sAnimation_skeletonGuid;a.skeleton=FE3sAnimation_skeleton;a.tracks=FE3sAnimation_tracks;a.unserialize=FE3sAnimation_unserialize;return a}function FE3sAnimation_skeletonGuid(){return this._skeletonGuid}
function FE3sAnimation_skeleton(){var a=this._skeleton;if(!a){var b=this._skeletonGuid;b&&(a=this._skeleton=RConsole.find(FE3sModelConsole).findSkeleton(b))}return a}function FE3sAnimation_tracks(){return this._tracks}
function FE3sAnimation_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._skeletonGuid=a.readString();this._frameCount=a.readUint16();this._frameTick=a.readUint16();this._frameSpan=a.readUint32();var b=null,e=a.readUint16();if(0<e)for(var b=this._tracks=new TObjects,f=0;f<e;f++){var h=RClass.create(FE3sTrack);h.unserialize(a);b.push(h);if(q){var k=h.boneIndex(),k=q.findBone(k);k.setTrack(h)}}if(b&&this._skeletonGuid){for(var q=this.skeleton(),f=0;f<e;f++)h=b.get(f),k=q.findBone(h.boneIndex()),
k.setTrack(h);q.pushAnimation(this)}}function FE3sBone(a){a=RClass.inherits(this,a,FObject);a._index=null;a._track=null;a._bones=null;a.index=FE3sBone_index;a.track=FE3sBone_track;a.setTrack=FE3sBone_setTrack;a.bones=FE3sBone_bones;a.unserialize=FE3sBone_unserialize;return a}function FE3sBone_index(){return this._index}function FE3sBone_track(){return this._track}function FE3sBone_setTrack(a){this._track=a}function FE3sBone_bones(){return this._bones}
function FE3sBone_unserialize(a){this._index=a.readUint8();var b=a.readUint8();if(0<b)for(var e=this._bones=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sBone);h.unserialize(a);e.push(h)}}function FE3sBoneRefer(a){a=RClass.inherits(this,a,FObject);a._index=null;a._bone=null;a._track=null;a.index=FE3sBoneRefer_index;a.bone=FE3sBoneRefer_bone;a.setBone=FE3sBoneRefer_setBone;a.track=FE3sBoneRefer_track;a.setTrack=FE3sBoneRefer_setTrack;a.unserialize=FE3sBoneRefer_unserialize;return a}
function FE3sBoneRefer_index(){return this._index}function FE3sBoneRefer_bone(){return this._bone}function FE3sBoneRefer_setBone(a){this._bone=a}function FE3sBoneRefer_track(){return this._track}function FE3sBoneRefer_setTrack(a){this._track=a}function FE3sBoneRefer_unserialize(a){this._index=a.readUint8()}
function FE3sDisplay(a){a=RClass.inherits(this,a,FObject);a._template=null;a._typeName=null;a._modelGuid=null;a._meshGuid=null;a._matrix=null;a._activeMaterial=null;a._materials=null;a.construct=FE3sDisplay_construct;a.typeName=FE3sDisplay_typeName;a.modelGuid=FE3sDisplay_modelGuid;a.model=FE3sDisplay_model;a.meshGuid=FE3sDisplay_meshGuid;a.mesh=FE3sDisplay_mesh;a.matrix=FE3sDisplay_matrix;a.materials=FE3sDisplay_materials;a.unserialize=FE3sDisplay_unserialize;return a}
function FE3sDisplay_construct(){this.__base.FObject.construct.call(this);this._matrix=new SMatrix3d}function FE3sDisplay_typeName(){return this._typeName}function FE3sDisplay_modelGuid(){return this._modelGuid}function FE3sDisplay_model(){return RConsole.find(FE3sModelConsole).findModel(this._modelGuid)}function FE3sDisplay_meshGuid(){return this._meshGuid}function FE3sDisplay_mesh(){return RConsole.find(FE3sModelConsole).findMesh(this._meshGuid)}
function FE3sDisplay_matrix(){return this._matrix}function FE3sDisplay_materials(){return this._materials}function FE3sDisplay_unserialize(a){this._typeName=a.readString();this._modelGuid=a.readString();this._meshGuid=a.readString();this._matrix.unserialize(a);var b=a.readUint16();if(0<b)for(var e=this._materials=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sDisplayMaterial);h._template=this._template;h.unserialize(a);e.push(h);null==this._activeMaterial&&(this._activeMaterial=h)}}
function FE3sDisplayMaterial(a){a=RClass.inherits(this,a,FObject);a._groupGuid=null;a.groupGuid=FE3sDisplayMaterial_groupGuid;a.unserialize=FE3sDisplayMaterial_unserialize;return a}function FE3sDisplayMaterial_groupGuid(){return this._groupGuid}function FE3sDisplayMaterial_unserialize(a){this._groupGuid=a.readString();this._material=this._template._activeTheme.findMaterial(this._groupGuid)}
function FE3sFrame(a){a=RClass.inherits(this,a,FObject);a._tick=0;a._translation=null;a._quaternion=null;a._scale=null;a.construct=FE3sFrame_construct;a.tick=FE3sFrame_tick;a.translation=FE3sFrame_translation;a.quaternion=FE3sFrame_quaternion;a.scale=FE3sFrame_scale;a.unserialize=FE3sFrame_unserialize;return a}function FE3sFrame_construct(){this.__base.FObject.construct.call(this);this._translation=new SPoint3;this._quaternion=new SQuaternion;this._scale=new SVector3}
function FE3sFrame_tick(){return this._tick}function FE3sFrame_translation(){return this._translation}function FE3sFrame_quaternion(){return this._quaternion}function FE3sFrame_scale(){return this._scale}function FE3sFrame_unserialize(a){this._tick=a.readUint16();this._translation.unserialize(a);this._quaternion.unserialize(a);this._scale.unserialize(a)}
function FE3sMaterial(a){a=RClass.inherits(this,a,FE3sObject);a._groupGuid=null;a._info=null;a._textures=null;a.construct=FE3sMaterial_construct;a.groupGuid=FE3sMaterial_groupGuid;a.group=FE3sMaterial_group;a.effectCode=FE3sMaterial_effectCode;a.info=FE3sMaterial_info;a.textures=FE3sMaterial_textures;a.unserialize=FE3sMaterial_unserialize;a.saveConfig=FE3sMaterial_saveConfig;return a}function FE3sMaterial_construct(){this.__base.FE3sObject.construct.call(this);this._info=new SE3sMaterialInfo}
function FE3sMaterial_groupGuid(){return this._groupGuid}function FE3sMaterial_group(){return RConsole.find(FE3sMaterialConsole).findGroup(this._groupGuid)}function FE3sMaterial_effectCode(){return this._info.effectCode}function FE3sMaterial_info(){return this._info}function FE3sMaterial_textures(){return this._textures}
function FE3sMaterial_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._groupGuid=a.readString();this._info.unserialize(a);var b=a.readInt16();if(0<b)for(var e=this._textures=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sMaterialTexture);h.unserialize(a);e.push(h)}}
function FE3sMaterial_saveConfig(a){var b=this._info;a.set("guid",this._guid);a.set("code",this._code);a.set("label",this._label);a.set("option_alpha",b.optionAlpha);a.set("option_double",b.optionDouble);a.set("alpha_base",b.alphaBase);a.set("alpha_rate",b.alphaRate);a.set("ambient_color",b.ambientColor.toString());a.set("diffuse_color",b.diffuseColor.toString());a.set("specular_color",b.specularColor.toString());a.set("specular_base",b.specularBase);a.set("specular_level",b.specularLevel);a.set("reflect_color",
b.reflectColor.toString());a.set("reflect_merge",b.reflectMerge);a.set("emissive_color",b.emissiveColor.toString())}function FE3sMaterialConsole(a){a=RClass.inherits(this,a,FConsole);a._materialGroups=null;a._materials=null;a.construct=FE3sMaterialConsole_construct;a.findGroup=FE3sMaterialConsole_findGroup;a.find=FE3sMaterialConsole_find;a.unserializeGroup=FE3sMaterialConsole_unserializeGroup;a.unserialize=FE3sMaterialConsole_unserialize;return a}
function FE3sMaterialConsole_construct(){this.__base.FConsole.construct.call(this);this._materialGroups=new TDictionary;this._materials=new TDictionary}function FE3sMaterialConsole_findGroup(a){return this._materialGroups.get(a)}function FE3sMaterialConsole_find(a){return this._materials.get(a)}function FE3sMaterialConsole_unserializeGroup(a){var b=RClass.create(FE3sMaterialGroup);b.unserialize(a);this._materialGroups.set(b.guid(),b);return b}
function FE3sMaterialConsole_unserialize(a){var b=RClass.create(FE3sMaterial);b.unserialize(a);this._materials.set(b.guid(),b);return b}function FE3sMaterialGroup(a){return a=RClass.inherits(this,a,FE3sObject)}function FE3sMaterialTexture(a){a=RClass.inherits(this,a,FE3sObject);a._textureGuid=null;a._bitmapGuid=null;a.textureGuid=FE3sMaterialTexture_textureGuid;a.bitmapGuid=FE3sMaterialTexture_bitmapGuid;a.unserialize=FE3sMaterialTexture_unserialize;return a}
function FE3sMaterialTexture_textureGuid(){return this._textureGuid}function FE3sMaterialTexture_bitmapGuid(){return this._bitmapGuid}function FE3sMaterialTexture_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._textureGuid=a.readString();this._bitmapGuid=a.readString()}
function FE3sMesh(a){a=RClass.inherits(this,a,FE3sObject);a._outline=null;a._streams=null;a._tracks=null;a.construct=FE3sMesh_construct;a.outline=FE3sMesh_outline;a.streams=FE3sMesh_streams;a.tracks=FE3sMesh_tracks;a.unserialize=FE3sMesh_unserialize;return a}function FE3sMesh_construct(){this.__base.FE3sObject.construct.call(this);this._outline=new SOutline3}function FE3sMesh_outline(){return this._outline}function FE3sMesh_streams(){return this._streams}
function FE3sMesh_tracks(){return this._tracks}function FE3sMesh_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._outline.unserialize(a);var b=a.readInt8();if(0<b)for(var e=this._streams=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sStream);h.unserialize(a);e.push(h)}}
function FE3sModel(a){a=RClass.inherits(this,a,FE3sResource);a._dataCompress=!0;a._meshes=null;a._skeletons=null;a._animations=null;a.findMeshByCode=FE3sModel_findMeshByCode;a.meshes=FE3sModel_meshes;a.skeletons=FE3sModel_skeletons;a.animations=FE3sModel_animations;a.unserialize=FE3sModel_unserialize;return a}function FE3sModel_findMeshByCode(a){for(var b=this._meshes,e=b.count()-1;0<=e;e--){var f=b.getAt(e);if(f._code==a)return f}return null}function FE3sModel_meshes(){return this._meshes}
function FE3sModel_skeletons(){return this._skeletons}function FE3sModel_animations(){return this._animations}
function FE3sModel_unserialize(a){this.__base.FE3sResource.unserialize.call(this,a);var b=RConsole.find(FE3sModelConsole);b.models().set(this.guid(),this);var e=a.readInt16();if(0<e)for(var f=this._meshes=new TObjects,h=0;h<e;h++)f.push(b.unserialMesh(a));e=a.readInt16();if(0<e)for(f=this._skeletons=new TObjects,h=0;h<e;h++)f.push(b.unserialSkeleton(a));e=a.readInt16();if(0<e)for(f=this._animations=new TObjects,h=0;h<e;h++)f.push(b.unserialAnimation(this,a));RLogger.info(this,"Unserialize model success. (guid={1}, code={2})",
this._guid,this._code)}
function FE3sModelConsole(a){a=RClass.inherits(this,a,FConsole);a._models=null;a._meshs=null;a._skeletons=null;a._animations=null;a._dataUrl="/cloud.content.model.wv";a.construct=FE3sModelConsole_construct;a.findModel=FE3sModelConsole_findModel;a.models=FE3sModelConsole_models;a.findMesh=FE3sModelConsole_findMesh;a.meshs=FE3sModelConsole_meshs;a.findSkeleton=FE3sModelConsole_findSkeleton;a.skeletons=FE3sModelConsole_skeletons;a.findAnimation=FE3sModelConsole_findAnimation;a.animations=FE3sModelConsole_animations;
a.unserialMesh=FE3sModelConsole_unserialMesh;a.unserialSkeleton=FE3sModelConsole_unserialSkeleton;a.unserialAnimation=FE3sModelConsole_unserialAnimation;a.load=FE3sModelConsole_load;a.dispose=FE3sModelConsole_dispose;return a}function FE3sModelConsole_construct(){this.__base.FConsole.construct.call(this);this._models=new TDictionary;this._meshs=new TDictionary;this._skeletons=new TDictionary;this._animations=new TDictionary}function FE3sModelConsole_findModel(a){return this._models.get(a)}
function FE3sModelConsole_models(){return this._models}function FE3sModelConsole_findMesh(a){return this._meshs.get(a)}function FE3sModelConsole_meshs(){return this._meshs}function FE3sModelConsole_findSkeleton(a){return this._skeletons.get(a)}function FE3sModelConsole_skeletons(){return this._skeletons}function FE3sModelConsole_findAnimation(a){return this._animations.get(a)}function FE3sModelConsole_animations(){return this._animations}
function FE3sModelConsole_unserialMesh(a){var b=RClass.create(FE3sMesh);b.unserialize(a);this._meshs.set(b.guid(),b);return b}function FE3sModelConsole_unserialSkeleton(a){var b=RClass.create(FE3sSkeleton);b.unserialize(a);this._skeletons.set(b.guid(),b);return b}function FE3sModelConsole_unserialAnimation(a,b){var e=RClass.create(FE3sAnimation);e._model=a;e.unserialize(b);this._animations.set(e.guid(),e);return e}
function FE3sModelConsole_load(a){var b=this._models,e=b.get(a);if(!e){var f=RConsole.find(FE3sVendorConsole).find("model"),h=f.makeUrl(a),e=RClass.create(FE3sModel);e._guid=a;e.setVendor(f);e.load(h);b.set(a,e)}return e}function FE3sModelConsole_dispose(){this._materials=RObject.free(this._materials);this.__base.FConsole.dispose.call(this)}
function FE3sObject(a){a=RClass.inherits(this,a,FObject);a._guid=null;a._code=null;a._label=null;a.guid=FE3sObject_guid;a.code=FE3sObject_code;a.label=FE3sObject_label;a.setLabel=FE3sObject_setLabel;a.unserialize=FE3sObject_unserialize;a.saveConfig=FE3sObject_saveConfig;return a}function FE3sObject_guid(){return this._guid}function FE3sObject_code(){return this._code}function FE3sObject_label(){return this._label}function FE3sObject_setLabel(a){this._label=a}
function FE3sObject_unserialize(a){this._guid=a.readString();this._code=a.readString();this._label=a.readString()}function FE3sObject_saveConfig(a){a.set("guid",this._guid);a.set("code",this._code);a.set("label",this._label)}
function FE3sResource(a){a=RClass.inherits(this,a,FResource);a._dataLoad=!1;a._dataReady=!1;a._dataSize=0;a._dataCompress=!1;a._lsnsLoad=null;a._vendor=null;a.onComplete=FE3sResource_onComplete;a.onLoad=FE3sResource_onLoad;a.vendor=FE3sResource_vendor;a.setVendor=FE3sResource_setVendor;a.loadListener=FE3sResource_loadListener;a.testReady=FE3sResource_testReady;a.unserialize=FE3sResource_unserialize;a.saveConfig=FE3sResource_saveConfig;a.load=FE3sResource_load;a.dispose=FE3sResource_dispose;return a}
function FE3sResource_onComplete(a){var b=RClass.create(FDataView);b.setEndianCd(!0);a.constructor==Array?(a=new Uint8Array(a),b.link(a.buffer)):b.link(a.outputData());this.unserialize(b);b.dispose();this._dataReady=!0;this._lsnsLoad&&this._lsnsLoad.process()}function FE3sResource_onLoad(a){a=a.outputData();RConsole.find(FE3sVendorConsole).pushCompress(this,this.onComplete,new Uint8Array(a))}function FE3sResource_vendor(){return this._vendor}function FE3sResource_setVendor(a){this._vendor=a}
function FE3sResource_loadListener(){var a=this._lsnsLoad;null==a&&(a=this._lsnsLoad=new TListeners);return a}function FE3sResource_testReady(){return this._dataReady}function FE3sResource_unserialize(a){this._guid=a.readString();this._code=a.readString();this._label=a.readString()}function FE3sResource_saveConfig(a){a.set("guid",this._guid);a.set("code",this._code);a.set("label",this._label)}
function FE3sResource_load(a){a=RConsole.find(FHttpConsole).send(a);this._dataCompress?a.lsnsLoad.register(this,this.onLoad):a.lsnsLoad.register(this,this.onComplete);this._dataLoad=!0}function FE3sResource_dispose(){this._vendor=this._lsnsLoad=null;this.__base.FConsole.dispose.call(this)}
function FE3sScene(a){a=RClass.inherits(this,a,FE3sResource);a._themeGuid=null;a._themeCode=null;a._technique=null;a._region=null;a._textures=null;a._templates=null;a._layers=null;a.construct=FE3sScene_construct;a.technique=FE3sScene_technique;a.region=FE3sScene_region;a.layers=FE3sScene_layers;a.unserialize=FE3sScene_unserialize;a.saveConfig=FE3sScene_saveConfig;return a}
function FE3sScene_construct(){this.__base.FE3sResource.construct.call(this);this._technique=RClass.create(FE3sSceneTechnique);this._region=RClass.create(FE3sSceneRegion)}function FE3sScene_technique(){return this._technique}function FE3sScene_region(){return this._region}function FE3sScene_layers(){return this._layers}
function FE3sScene_unserialize(a){this.__base.FE3sResource.unserialize.call(this,a);this._themeGuid=a.readString();this._themeCode=a.readString();this._technique.unserialize(a);this._region.unserialize(a);var b=a.readInt16();if(0<b)for(var e=RConsole.find(FE3sTextureConsole),f=this._textures=new TDictionary,h=0;h<b;h++){var k=e.unserialize(a);f.set(k.guid(),k)}b=a.readInt16();if(0<b)for(e=RConsole.find(FE3sTemplateConsole),f=this._templates=new TDictionary,h=0;h<b;h++)k=e.unserialize(a),f.set(k.guid(),
k);b=a.readInt16();if(0<b)for(f=this._layers=new TDictionary,h=0;h<b;h++)e=RClass.create(FE3sSceneLayer),e.unserialize(a),f.set(e.code(),e)}function FE3sScene_saveConfig(a){this.__base.FE3sResource.saveConfig.call(this,a);a.setName("Scene");a.set("theme_guid",this._themeGuid);a.set("theme_code",this._themeCode);a=a.create("LayerCollection");for(var b=this._layers,e=b.count(),f=0;f<e;f++)b.value(f).saveConfig(a.create("Layer"))}
function FE3sSceneCamera(a){a=RClass.inherits(this,a,FE3sObject);a._typeName=null;a._centerFront=null;a._centerBack=null;a._position=null;a._direction=null;a._focalNear=null;a._focalFar=null;a._projection=null;a.construct=FE3sSceneCamera_construct;a.typeName=FE3sSceneCamera_typeName;a.position=FE3sSceneCamera_position;a.direction=FE3sSceneCamera_direction;a.projection=FE3sSceneCamera_projection;a.unserialize=FE3sSceneCamera_unserialize;return a}
function FE3sSceneCamera_construct(){this.__base.FE3sObject.construct.call(this);this._position=new SPoint3;this._direction=new SVector3;this._projection=RClass.create(FE3sSceneProjection)}function FE3sSceneCamera_typeName(){return this._typeName}function FE3sSceneCamera_position(){return this._position}function FE3sSceneCamera_direction(){return this._direction}function FE3sSceneCamera_projection(){return this._projection}
function FE3sSceneCamera_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._typeName=a.readString();this._position.unserialize(a);this._direction.unserialize(a);this._projection.unserialize(a)}function FE3sSceneConsole(a){a=RClass.inherits(this,a,FConsole);a._scenes=null;a._venderCode="scene";a._serviceUrl="/cloud.content.scene.ws";a._dataUrl="/cloud.content.scene.wv";a.construct=FE3sSceneConsole_construct;a.load=FE3sSceneConsole_load;a.update=FE3sSceneConsole_update;return a}
function FE3sSceneConsole_construct(){this.__base.FConsole.construct.call(this);this._scenes=new TDictionary}function FE3sSceneConsole_load(a){var b=this._scenes,e=b.get(a);if(null==e){var f=RConsole.find(FE3sVendorConsole).find(this._venderCode),h=f.makeUrl(a),e=RClass.create(FE3sScene);e.setVendor(f);e.load(h);b.set(a,e)}return e}function FE3sSceneConsole_update(a){var b=RBrowser.hostPath(this._serviceUrl+"?action=updateTheme&date="+RDate.format());RConsole.find(FXmlConsole).send(b,a)}
function FE3sSceneDisplay(a){a=RClass.inherits(this,a,FE3sObject);a._templateGuid=null;a._optionMergeVertex=null;a._optionMergeMaterial=null;a._matrix=null;a._movies=null;a._materials=null;a._renderables=null;a.construct=FE3sSceneDisplay_construct;a.templateGuid=FE3sSceneDisplay_templateGuid;a.matrix=FE3sSceneDisplay_matrix;a.movies=FE3sSceneDisplay_movies;a.materials=FE3sSceneDisplay_materials;a.renderables=FE3sSceneDisplay_renderables;a.unserialize=FE3sSceneDisplay_unserialize;a.saveConfig=FE3sSceneDisplay_saveConfig;
return a}function FE3sSceneDisplay_construct(){this.__base.FE3sObject.construct.call(this);this._matrix=new SMatrix3d}function FE3sSceneDisplay_templateGuid(){return this._templateGuid}function FE3sSceneDisplay_matrix(){return this._matrix}function FE3sSceneDisplay_movies(){return this._movies}function FE3sSceneDisplay_materials(){return this._materials}function FE3sSceneDisplay_renderables(){return this._renderables}
function FE3sSceneDisplay_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._templateGuid=a.readString();this._matrix.unserialize(a);var b=a.readUint16();if(0<b)for(var e=this._movies=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sSceneMovie);h.unserialize(a);e.push(h)}b=a.readUint16();if(0<b)for(e=this._materials=new TObjects,f=0;f<b;f++)h=RClass.create(FE3sSceneMaterial),h.unserialize(a),e.push(h);b=a.readUint16();if(0<b)for(e=this._renderables=new TObjects,f=0;f<b;f++)h=RClass.create(FE3sTemplateRenderable),
h.unserialize(a),e.push(h)}function FE3sSceneDisplay_saveConfig(a){this.__base.FE3sObject.saveConfig.call(this,a);this._matrix.saveConfig(a.create("Matrix"));a=a.create("MaterialCollection");var b=this._materials;if(b)for(var e=b.count(),f=0;f<e;f++)b.get(f).saveConfig(a.create("Material"))}function FE3sSceneLayer(a){a=RClass.inherits(this,a,FE3sObject);a._displays=null;a.displays=FE3sSceneLayer_displays;a.unserialize=FE3sSceneLayer_unserialize;a.saveConfig=FE3sSceneLayer_saveConfig;return a}
function FE3sSceneLayer_displays(){return this._displays}function FE3sSceneLayer_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);var b=a.readUint16();if(0<b)for(var e=this._displays=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sSceneDisplay);h.unserialize(a);e.push(h)}}
function FE3sSceneLayer_saveConfig(a){this.__base.FE3sObject.saveConfig.call(this,a);a=a.create("DisplayCollection");var b=this._displays;if(b)for(var e=b.count(),f=0;f<e;f++)b.get(f).saveConfig(a.create("Display"))}
function FE3sSceneLight(a){a=RClass.inherits(this,a,FE3sObject);a._typeName=null;a._optionTrack=null;a._shadow1=null;a._shadow2=null;a._shadow3=null;a._shadowAmbientMin=null;a._shadowAmbientMax=null;a._shadowAmbientThick=null;a._shadowAmbientRange=null;a._shadowMerge1Base=null;a._shadowMerge1Rate=null;a._shadowMerge2Base=null;a._shadowMerge2Rate=null;a._material=null;a._camera=null;a.construct=FE3sSceneLight_construct;a.typeName=FE3sSceneLight_typeName;a.material=FE3sSceneLight_material;a.camera=
FE3sSceneLight_camera;a.unserialize=FE3sSceneLight_unserialize;return a}function FE3sSceneLight_construct(){this.__base.FE3sObject.construct.call(this);this._shadow1=new SE3sSceneShadow;this._shadow2=new SE3sSceneShadow;this._shadow3=new SE3sSceneShadow;this._material=RClass.create(FE3sSceneMaterial);this._camera=RClass.create(FE3sSceneCamera)}function FE3sSceneLight_typeName(){return this._typeName}function FE3sSceneLight_material(){return this._material}
function FE3sSceneLight_camera(){return this._camera}function FE3sSceneLight_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._typeName=a.readString();this._material.unserialize(a);this._camera.unserialize(a)}function FE3sSceneMap(a){return a=RClass.inherits(this,a,FE3sSceneSpace)}
function FE3sSceneMaterial(a){a=RClass.inherits(this,a,FE3sObject);a._groupGuid=null;a._info=null;a._heightDepth=null;a._surfaceRate=null;a._surfaceReflect=null;a._surfaceBright=null;a._surfaceBrightLevel=null;a._surfaceCoarse=null;a._surfaceCoarseLevel=null;a._surfaceMerge=null;a._surfacePower=null;a.construct=FE3sSceneMaterial_construct;a.groupGuid=FE3sSceneMaterial_groupGuid;a.info=FE3sSceneMaterial_info;a.unserialize=FE3sSceneMaterial_unserialize;a.saveConfig=FE3sSceneMaterial_saveConfig;return a}
function FE3sSceneMaterial_construct(){this.__base.FE3sObject.construct.call(this);this._info=new SE3sMaterialInfo}function FE3sSceneMaterial_groupGuid(){return this._groupGuid}function FE3sSceneMaterial_info(){return this._info}function FE3sSceneMaterial_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._groupGuid=a.readString();this._info.unserialize(a);this._textureCount=a.readInt16()}
function FE3sSceneMaterial_saveConfig(a){this.__base.FE3sObject.saveConfig.call(this,a);a.set("group_guid",this._groupGuid);this._info.saveConfig(a)}function FE3sSceneMovie(a){a=RClass.inherits(this,a,FE3sObject);a._interval=null;a._rotation=null;a.construct=FE3sSceneMovie_construct;a.interval=FE3sSceneMovie_interval;a.rotation=FE3sSceneMovie_rotation;a.unserialize=FE3sSceneMovie_unserialize;return a}
function FE3sSceneMovie_construct(){this.__base.FE3sObject.construct.call(this);this._rotation=new SVector3}function FE3sSceneMovie_interval(){return this._interval}function FE3sSceneMovie_rotation(){return this._rotation}function FE3sSceneMovie_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._interval=a.readInt32();this._rotation.unserialize(a)}
function FE3sSceneProjection(a){a=RClass.inherits(this,a,FE3sObject);a._angle=null;a._znear=null;a._zfar=null;a.angle=FE3sSceneProjection_angle;a.znear=FE3sSceneProjection_znear;a.zfar=FE3sSceneProjection_zfar;a.unserialize=FE3sSceneProjection_unserialize;return a}function FE3sSceneProjection_angle(){return this._angle}function FE3sSceneProjection_znear(){return this._znear}function FE3sSceneProjection_zfar(){return this._zfar}
function FE3sSceneProjection_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._angle=a.readFloat();this._znear=a.readFloat();this._zfar=a.readFloat()}
function FE3sSceneRegion(a){a=RClass.inherits(this,a,FE3sObject);a._optionBackground=!0;a._backgroundColor=null;a._colorLevel=null;a._fogNear=null;a._fogFar=null;a._fogRate=null;a._fogAttenuation=null;a._fogColor=null;a._edgeRate=null;a._edgeLevel=null;a._edgeWidth=null;a._edgeColor=null;a._faceRange=null;a._faceLimit=null;a._faceRate=null;a._camera=null;a._light=null;a.construct=FE3sSceneRegion_construct;a.optionBackground=FE3sSceneRegion_optionBackground;a.setOptionBackground=FE3sSceneRegion_setOptionBackground;
a.backgroundColor=FE3sSceneRegion_backgroundColor;a.camera=FE3sSceneRegion_camera;a.light=FE3sSceneRegion_light;a.unserialize=FE3sSceneRegion_unserialize;return a}function FE3sSceneRegion_construct(){this.__base.FE3sObject.construct.call(this);this._backgroundColor=new SColor4;this._colorLevel=new SColor4;this._fogColor=new SColor4;this._edgeColor=new SColor4;this._camera=RClass.create(FE3sSceneCamera);this._light=RClass.create(FE3sSceneLight)}
function FE3sSceneRegion_optionBackground(){return this._optionBackground}function FE3sSceneRegion_setOptionBackground(a){this._optionBackground=a}function FE3sSceneRegion_backgroundColor(){return this._backgroundColor}function FE3sSceneRegion_camera(){return this._camera}function FE3sSceneRegion_light(){return this._light}
function FE3sSceneRegion_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._backgroundColor.unserialize(a);this._camera.unserialize(a);this._light.unserialize(a)}function FE3sSceneRenderable(a){a=RClass.inherits(this,a,FE3sObject);a.unserialize=FE3sSceneRenderable_unserialize;return a}function FE3sSceneRenderable_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a)}function FE3sSceneSky(a){return a=RClass.inherits(this,a,FE3sSceneSpace)}
function FE3sSceneSpace(a){a=RClass.inherits(this,a,FObject);a._name=null;a._type=null;a._displays=null;a.displays=FE3sSceneSpace_displays;a.unserialize=FE3sSceneSpace_unserialize;return a}function FE3sSceneSpace_displays(){return this._displays}function FE3sSceneSpace_unserialize(a){this._name=a.readString();this._type=a.readString();var b=a.readUint16();if(0<b)for(var e=this._displays=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sSceneDisplay);h.unserialize(a);e.push(h)}}
function FE3sSceneTechnique(a){a=RClass.inherits(this,a,FE3sObject);a._techniqueCode=null;a._passes=null;a.passes=FE3sSceneTechnique_passes;a.unserialize=FE3sSceneTechnique_unserialize;a.saveConfig=FE3sSceneTechnique_saveConfig;return a}function FE3sSceneTechnique_passes(){return this._passes}
function FE3sSceneTechnique_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);var b=a.readInt16();if(0<b)for(var e=this._passes=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sSceneTechniquePass);h.unserialize(a);e.push(h)}}function FE3sSceneTechnique_saveConfig(a){this.__base.FE3sObject.saveConfig.call(this,a);a.set("technique_code",this._techniqueCode)}
function FE3sSceneTechniquePass(a){a=RClass.inherits(this,a,FE3sObject);a._targetWidth=null;a._targetHeight=null;a.targetWidth=FE3sSceneTechniquePass_targetWidth;a.targetHeight=FE3sSceneTechniquePass_targetHeight;a.unserialize=FE3sSceneTechniquePass_unserialize;return a}function FE3sSceneTechniquePass_targetWidth(){return this._targetWidth}function FE3sSceneTechniquePass_targetHeight(){return this._targetHeight}
function FE3sSceneTechniquePass_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._targetWidth=a.readUint16();this._targetHeight=a.readUint16()}
function FE3sSkeleton(a){a=RClass.inherits(this,a,FE3sObject);a._bones=null;a._roots=null;a._skins=null;a._animations=null;a.findBone=FE3sSkeleton_findBone;a.bones=FE3sSkeleton_bones;a.roots=FE3sSkeleton_roots;a.skins=FE3sSkeleton_skins;a.animations=FE3sSkeleton_animations;a.pushAnimation=FE3sSkeleton_pushAnimation;a.innerFilter=FE3sSkeleton_innerFilter;a.unserialize=FE3sSkeleton_unserialize;return a}function FE3sSkeleton_findBone(a){return this._bones.get(a)}
function FE3sSkeleton_bones(){return this._bones}function FE3sSkeleton_roots(){return this._roots}function FE3sSkeleton_skins(){return this._skins}function FE3sSkeleton_animations(){return this._animations}function FE3sSkeleton_pushAnimation(a){var b=this._animations;b||(b=this._animations=new TObjects);b.push(a)}function FE3sSkeleton_innerFilter(a){this._bones.set(a.index(),a);if(a=a.bones())for(var b=a.count(),e=0;e<b;e++){var f=a.get(e);this.innerFilter(f)}}
function FE3sSkeleton_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);var b=a.readUint8();if(0<b){this._bones=new TDictionary;for(var e=this._roots=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sBone);h.unserialize(a);this.innerFilter(h);e.push(h)}}b=a.readUint8();if(0<b)for(e=this._skins=new TObjects,f=0;f<b;f++)h=RClass.create(FE3sSkeletonSkin),h.unserialize(a),e.push(h)}
function FE3sSkeletonSkin(a){a=RClass.inherits(this,a,FE3sObject);a._meshGuid=null;a._streams=null;a._boneRefers=null;a.meshGuid=FE3sSkeletonSkin_meshGuid;a.find=FE3sSkeletonSkin_find;a.streams=FE3sSkeletonSkin_streams;a.boneRefers=FE3sSkeletonSkin_boneRefers;a.unserialize=FE3sSkeletonSkin_unserialize;return a}function FE3sSkeletonSkin_meshGuid(){return this._meshGuid}function FE3sSkeletonSkin_find(a){return this._streams.get(a)}function FE3sSkeletonSkin_streams(){return this._streams}
function FE3sSkeletonSkin_boneRefers(){return this._boneRefers}function FE3sSkeletonSkin_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._meshGuid=a.readString();var b=a.readUint8();if(0<b)for(var e=this._streams=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sStream);h.unserialize(a);e.push(h)}b=a.readUint8();if(0<b)for(e=this._boneRefers=new TObjects,f=0;f<b;f++)h=RClass.create(FE3sBoneRefer),h.unserialize(a),e.push(h)}
function FE3sStream(a){a=RClass.inherits(this,a,FObject);a._code=null;a._elementDataCd=0;a._elementCount=0;a._elementNormalize=!1;a._dataStride=0;a._dataCount=0;a._dataLength=0;a._data=null;a._formatCd=EG3dAttributeFormat.Unknown;a.name=FE3sStream_name;a.formatCd=FE3sStream_formatCd;a.unserialize=FE3sStream_unserialize;a.dispose=FE3sStream_dispose;return a}function FE3sStream_name(){return this._name}function FE3sStream_formatCd(){return this._formatCd}
function FE3sStream_unserialize(a){this._code=a.readString();this._elementDataCd=a.readUint8();this._elementCount=a.readUint8();this._elementNormalize=a.readBoolean();var b=this._dataStride=a.readUint8(),e=this._dataCount=a.readInt32(),b=this._dataLength=b*e,e=this._data=new ArrayBuffer(b);a.readBytes(e,0,b)}function FE3sStream_dispose(){this.__base.FObject.dispose.call(this)}
function FE3sTemplate(a){a=RClass.inherits(this,a,FE3sResource);a._materialGroups=null;a._themes=null;a._displays=null;a._activeTheme=null;a.materialGroups=FE3sTemplate_materialGroups;a.themes=FE3sTemplate_themes;a.displays=FE3sTemplate_displays;a.unserialize=FE3sTemplate_unserialize;return a}function FE3sTemplate_materialGroups(){return this._materialGroups}function FE3sTemplate_themes(){return this._themes}function FE3sTemplate_displays(){return this._displays}
function FE3sTemplate_unserialize(a){this.__base.FE3sResource.unserialize.call(this,a);var b=RConsole.find(FE3sMaterialConsole),e=a.readUint16();if(0<e)for(var f=this._materialGroups=new TDictionary,h=0;h<e;h++){var k=b.unserializeGroup(a);f.set(k.guid(),k)}e=a.readUint16();if(0<e)for(f=this._themes=new TObjects,h=0;h<e;h++)b=RClass.create(FE3sTemplateTheme),b.unserialize(a),f.push(b),null==this._activeTheme&&(this._activeTheme=b);e=a.readUint16();if(0<e)for(f=this._displays=new TObjects,h=0;h<e;h++)b=
RClass.create(FE3sDisplay),b._template=this,b.unserialize(a),f.push(b)}function FE3sTemplateConsole(a){a=RClass.inherits(this,a,FConsole);a._templates=null;a._serviceUrl="/cloud.content.template.ws";a._dataUrl="/cloud.content.template.wv";a.construct=FE3sTemplateConsole_construct;a.unserialize=FE3sTemplateConsole_unserialize;a.loadByGuid=FE3sTemplateConsole_loadByGuid;a.loadByCode=FE3sTemplateConsole_loadByCode;a.update=FE3sTemplateConsole_update;return a}
function FE3sTemplateConsole_construct(){this.__base.FConsole.construct.call(this);this._templates=new TDictionary}function FE3sTemplateConsole_unserialize(a){var b=RClass.create(FE3sTemplate);b._dataReady=!0;b.unserialize(a);this._templates.set(b.guid(),b);return b}
function FE3sTemplateConsole_loadByGuid(a){var b=this._templates,e=b.get(a);if(null==e){var f=RConsole.find(FE3sVendorConsole).find("template"),h=f.makeUrl(a,""),e=RClass.create(FE3sTemplate);e.setVendor(f);e.load(h);b.set(a,e)}return e}function FE3sTemplateConsole_loadByCode(a){var b=this._templates,e=b.get(a);if(null==e){var f=RConsole.find(FE3sVendorConsole).find("template").makeUrl("",a),e=RClass.create(FE3sTemplate);e.load(f);b.set(a,e)}return e}
function FE3sTemplateConsole_update(a){var b=RBrowser.hostPath(this._serviceUrl+"?action=update");RConsole.find(FXmlConsole).send(b,a)}function FE3sTemplateTheme(a){a=RClass.inherits(this,a,FE3sObject);a._materials=null;a.findMaterial=FE3sTemplateTheme_findMaterial;a.materials=FE3sTemplateTheme_materials;a.unserialize=FE3sTemplateTheme_unserialize;return a}function FE3sTemplateTheme_findMaterial(a){return this._materials.get(a)}function FE3sTemplateTheme_materials(){return this._materials}
function FE3sTemplateTheme_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);var b=a.readUint16();if(0<b)for(var e=RConsole.find(FE3sMaterialConsole),f=this._materials=new TDictionary,h=0;h<b;h++){var k=e.unserialize(a);f.set(k.groupGuid(),k)}}
function FE3sTexture(a){a=RClass.inherits(this,a,FE3sResource);a._bitmaps=null;a._bitmapPacks=null;a.construct=FE3sTexture_construct;a.bitmaps=FE3sTexture_bitmaps;a.bitmapPacks=FE3sTexture_bitmapPacks;a.unserialize=FE3sTexture_unserialize;a.dispose=FE3sTexture_dispose;return a}function FE3sTexture_construct(){this.__base.FE3sResource.construct.call(this)}function FE3sTexture_bitmaps(){return this._bitmaps}function FE3sTexture_bitmapPacks(){return this._bitmapPacks}
function FE3sTexture_unserialize(a){this.__base.FE3sResource.unserialize.call(this,a);var b=a.readInt16();if(0<b)for(var e=this._bitmaps=new TDictionary,f=0;f<b;f++){var h=RClass.create(FE3sTextureBitmap);h.unserialize(a);e.set(h.code(),h)}b=a.readInt16();if(0<b)for(e=this._bitmapPacks=new TDictionary,f=0;f<b;f++)h=RClass.create(FE3sTextureBitmapPack),h._texture=this,h.unserialize(a),e.set(h.code(),h)}
function FE3sTexture_dispose(){this._bitmaps=RObject.free(this._bitmaps);this._bitmapPacks=RObject.free(this._bitmapPacks);this.__base.FE3sResource.dispose.call(this)}function FE3sTextureBitmap(a){a=RClass.inherits(this,a,FE3sObject);a._packCode=null;a.packCode=FE3sTextureBitmap_packCode;a.unserialize=FE3sTextureBitmap_unserialize;return a}function FE3sTextureBitmap_packCode(){return this._packCode}
function FE3sTextureBitmap_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._packCode=a.readString()}
function FE3sTextureBitmapPack(a){a=RClass.inherits(this,a,FE3sObject);a._optionCompress=null;a._size=null;a._data=null;a._typeName=null;a._formatName=null;a.construct=FE3sTextureBitmapPack_construct;a.optionCompress=FE3sTextureBitmapPack_optionCompress;a.size=FE3sTextureBitmapPack_size;a.data=FE3sTextureBitmapPack_data;a.unserialize=FE3sTextureBitmapPack_unserialize;a.dispose=FE3sTextureBitmapPack_dispose;return a}
function FE3sTextureBitmapPack_construct(){this.__base.FE3sObject.construct.call(this);this._size=new SSize2}function FE3sTextureBitmapPack_optionCompress(){return this._optionCompress}function FE3sTextureBitmapPack_size(){return this._size}function FE3sTextureBitmapPack_data(){return this._data}
function FE3sTextureBitmapPack_unserialize(a){this.__base.FE3sObject.unserialize.call(this,a);this._typeName=a.readString();this._formatName=a.readString();this._size.width=a.readUint16();this._size.height=a.readUint16();if("flat"==this._typeName)var b=a.readInt32();else if("cube"==this._typeName){this._data=[];for(var e=0;6>e;e++){var b=a.readInt32(),f=this._data[e]=new ArrayBuffer(b);a.readBytes(f,0,b)}}else throw new TError(this,"Unserial texture failure ");}
function FE3sTextureBitmapPack_dispose(){this._data=null;this.__base.FE3sObject.dispose.call(this)}function FE3sTextureConsole(a){a=RClass.inherits(this,a,FConsole);a._textures=null;a.construct=FE3sTextureConsole_construct;a.unserialize=FE3sTextureConsole_unserialize;a.load=FE3sTextureConsole_load;a.loadBitmap=FE3sTextureConsole_loadBitmap;a.dispose=FE3sModelConsole_dispose;return a}function FE3sTextureConsole_construct(){this.__base.FConsole.construct.call(this);this._textures=new TDictionary}
function FE3sTextureConsole_unserialize(a){var b=RClass.create(FE3sTexture);b._dataReady=!0;b.unserialize(a);this._textures.set(b.guid(),b);return b}function FE3sTextureConsole_load(a){var b=this._textures,e=b.get(a);if(e)return e;var f=RConsole.find(FE3sVendorConsole).find("texture"),h=f.makeUrl(a),e=RClass.create(FE3sTexture);e.setVendor(f);e.load(h);b.set(a,e);return e}
function FE3sTextureConsole_loadBitmap(a,b,e){a=RConsole.find(FE3sVendorConsole).find("texture.bitmap").makeUrl(a,b,e);b=this._image=RClass.create(FImage);b.loadUrl(a);return b}function FE3sTextureConsole_dispose(){this._textures=RObject.free(this._textures);this.__base.FConsole.dispose.call(this)}function FE3sTheme(a){a=RClass.inherits(this,a,FE3sResource);a._materials=null;a.materials=FE3sTheme_materials;a.find=FE3sTheme_find;a.unserialize=FE3sTheme_unserialize;return a}
function FE3sTheme_materials(){return this._materials}function FE3sTheme_find(a){var b=this._materials;return b?b.get(a):null}function FE3sTheme_unserialize(a){var b=a.readInt32();if(0<b)for(var e=this._materials=new TDictionary,f=0;f<b;f++){var h=RClass.create(FE3sMaterial);h.unserialize(a);e.set(h.code(),h)}}
function FE3sThemeConsole(a){a=RClass.inherits(this,a,FConsole);a._path="/assets/theme/";a._activeTheme=null;a._themes=null;a.construct=FE3sThemeConsole_construct;a.activeTheme=FE3sThemeConsole_activeTheme;a.find=FE3sThemeConsole_find;a.select=FE3sThemeConsole_select;return a}function FE3sThemeConsole_construct(){this.__base.FConsole.construct.call(this);this._themes=new TDictionary}function FE3sThemeConsole_activeTheme(){return this._activeTheme}
function FE3sThemeConsole_find(a){var b=this._activeTheme;if(null==b)throw new TError("Active theme is empty.");return b.find(a)}function FE3sThemeConsole_select(a){var b=this._themes.get(a);if(null==b){var e=RBrowser.contentPath(this._path+a+".ser"),b=RClass.create(FE3sTheme);b.load(e);this._themes.set(a,b)}return this._activeTheme=b}
function FE3sTrack(a){a=RClass.inherits(this,a,FObject);a._meshCode=null;a._boneIndex=0;a._frameTick=0;a._matrix=null;a._matrixInvert=null;a._frameCount=null;a._frames=null;a.construct=FE3sTrack_construct;a.boneIndex=FE3sTrack_boneIndex;a.frameTick=FE3sTrack_frameTick;a.matrix=FE3sTrack_matrix;a.matrixInvert=FE3sTrack_matrixInvert;a.frames=FE3sTrack_frames;a.calculate=FE3sTrack_calculate;a.unserialize=FE3sTrack_unserialize;return a}
function FE3sTrack_construct(){this.__base.FObject.construct.call(this);this._matrix=new SMatrix3d;this._matrixInvert=new SMatrix3d}function FE3sTrack_boneIndex(){return this._boneIndex}function FE3sTrack_frameTick(){return this._frameTick}function FE3sTrack_matrix(){return this._matrix}function FE3sTrack_matrixInvert(){return this._matrixInvert}function FE3sTrack_frames(){return this._frames}
function FE3sTrack_calculate(a,b){var e=this._frameCount;if(0==e)return!1;0>b&&(b=-b);var f=this._frameTick,h=parseInt(b/f)%e,k=this.frames(),q=k.get(h),t=null,t=h<e-1?k.get(h+1):k.get(0);a.tick=b;a.rate=b%f/f;a.currentFrame=q;a.nextFrame=t;return!0}
function FE3sTrack_unserialize(a){this._meshCode=a.readString();this._boneIndex=a.readUint8();this._frameTick=a.readUint16();this._matrix.unserialize(a);this._matrixInvert.assign(this._matrix);this._matrixInvert.invert();var b=a.readInt16();if(0<b){this._frameCount=b;for(var e=this._frames=new TObjects,f=0;f<b;f++){var h=RClass.create(FE3sFrame);h.unserialize(a);e.push(h)}}}
function FE3sVendor(a){a=RClass.inherits(this,a,FObject);a._optionFlag=!0;a._contentUrl=null;a.optionFlag=FE3sVendor_optionFlag;a.setOptionFlag=FE3sVendor_setOptionFlag;a.contentUrl=FE3sVendor_contentUrl;a.setContentUrl=FE3sVendor_setContentUrl;a.makeUrl=FE3sVendor_makeUrl;return a}function FE3sVendor_optionFlag(a){return this._optionFlag}function FE3sVendor_setOptionFlag(a){this._optionFlag=a}function FE3sVendor_contentUrl(a){return this._contentUrl}
function FE3sVendor_setContentUrl(a){this._contentUrl=a}function FE3sVendor_makeUrl(){for(var a=this._contentUrl,b=arguments,e=b.length,f=0;f<e;f++)a=a.replace("{"+(f+1)+"}",b[f]);RRuntime.isDebug()&&(a+="&date="+RDate.format());return a}
function FE3sVendorConsole(a){a=RClass.inherits(this,a,FConsole);a._activeEvent=null;a._events=null;a._setuped=!1;a._vendors=null;a._thread=null;a._interval=100;a.onProcess=FE3sVendorConsole_onProcess;a.onComplete=FE3sVendorConsole_onComplete;a.construct=FE3sVendorConsole_construct;a.pushCompress=FE3sVendorConsole_pushCompress;a.createVendor=FE3sVendorConsole_createVendor;a.register=FE3sVendorConsole_register;a.find=FE3sVendorConsole_find;a.setup=FE3sVendorConsole_setup;return a}
function FE3sVendorConsole_onProcess(){var a=this._events;this._activeEvent||a.isEmpty()||(a=this._activeEvent=a.erase(0),LZMA.decompress(a.data,this.onComplete,null),a.data=null)}function FE3sVendorConsole_onComplete(a){var b=RConsole.find(FE3sVendorConsole),e=b._activeEvent;e.process.call(e.owner,a);e.owner=null;e.process=null;b._activeEvent=null}
function FE3sVendorConsole_construct(){this.__base.FConsole.construct.call(this);this._events=new TObjects;this._vendors=new TDictionary;var a=this._thread=RClass.create(FThread);a.setInterval(this._interval);a.addProcessListener(this,this.onProcess);RConsole.find(FThreadConsole).start(a)}function FE3sVendorConsole_pushCompress(a,b,e){this._events.push(new SE3sCompressEvent(a,b,e))}
function FE3sVendorConsole_createVendor(a,b){var e=RClass.create(FE3sVendor);e.setOptionFlag(a);e.setContentUrl(b);return e}function FE3sVendorConsole_register(a,b){this._vendors.set(a,b)}function FE3sVendorConsole_find(a){this._setuped||this.setup("net");return this._vendors.get(a)}
function FE3sVendorConsole_setup(a){if("net"==a)this._vendors.set("texture.bitmap",this.createVendor(!0,RBrowser.hostPath("/cloud.content.texture.bitmap.wv?guid={1}&code={2}"))),this._vendors.set("texture",this.createVendor(!0,RBrowser.hostPath("/cloud.content.texture.wv?guid={1}"))),this._vendors.set("model",this.createVendor(!0,RBrowser.hostPath("/cloud.content.model.wv?guid={1}"))),this._vendors.set("template",this.createVendor(!0,RBrowser.hostPath("/cloud.content.template.wv?guid={1}&code={2}"))),
this._vendors.set("scene",this.createVendor(!0,RBrowser.hostPath("/cloud.content.scene.wv?code={1}")));else if("local"==a)this._vendors.set("texture.bitmap",this.createVendor(!1,RBrowser.contentPath("/ar3/texture/{1}/{2}.{3}"))),this._vendors.set("texture",this.createVendor(!1,RBrowser.contentPath("/ar3/texture/{1}.bin"))),this._vendors.set("model",this.createVendor(!1,RBrowser.contentPath("/ar3/model/{1}.bin"))),this._vendors.set("template",this.createVendor(!1,RBrowser.contentPath("/ar3/template/{1}.bin"))),
this._vendors.set("scene",this.createVendor(!1,RBrowser.contentPath("/ar3/scene/{1}.bin")));else throw new TError(this,"Unknown setup code. (code={1})",a);this._setuped=!0}function SE3rPlayInfo(a){a||(a=this);a.tick=0;a.playRate=1;a.currentFrame=null;a.nextFrame=null;a.rate=1;a.alpha=1;a.translation=new SPoint3;a.quaternion=new SQuaternion;a.scale=new SVector3;a.matrix=new SMatrix3d;a.update=SE3rPlayInfo_update;return a}
function SE3rPlayInfo_update(){var a=this.currentFrame;if(null==a)return!1;var b=this.nextFrame;if(null==b)return!1;var e=this.matrix,f=a.translation(),h=a.quaternion(),a=a.scale(),k=this.rate;0<k&&1>k?(this.translation.slerp(f,b.translation(),k),this.quaternion.slerp(h,b.quaternion(),k),this.scale.slerp(a,b.scale(),k),e.build(this.translation,this.quaternion,this.scale)):e.build(f,h,a);return!0}
function FE3rAnimation(a){a=RClass.inherits(this,a,FObject);a._baseTick=0;a._currentTick=0;a._lastTick=0;a._playRate=1;a._tracks=null;a._resource=null;a._playInfo=null;a.construct=FE3rAnimation_construct;a.findTrack=FE3rAnimation_findTrack;a.tracks=FE3rAnimation_tracks;a.resource=FE3rAnimation_resource;a.loadResource=FE3rAnimation_loadResource;a.record=FE3rAnimation_record;a.process=RMethod.virtual(a,"process");a.dispose=FE3rAnimation_dispose;return a}
function FE3rAnimation_construct(){this.__base.FObject.construct.call(this);this._tracks=new TObjects;this._playInfo=new SE3rPlayInfo}function FE3rAnimation_findTrack(a){for(var b=this._tracks,e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h.boneIndex()==a)return h}return null}function FE3rAnimation_tracks(){return this._tracks}function FE3rAnimation_resource(){return this._resource}
function FE3rAnimation_loadResource(a){this._resource=a;a=a.tracks();for(var b=a.count(),e=0;e<b;e++){var f=a.get(e),h=RClass.create(FE3rTrack);h._animation=this;h.loadResource(f);this._tracks.push(h)}}function FE3rAnimation_record(){var a=RTimer.current();0==this._lastTick&&(this._lastTick=a);this._currentTick=(a-this._lastTick+this._baseTick)*this._playRate*3}function FE3rAnimation_dispose(){this._resource=this._tracks=null;this.__base.FObject.dispose.call(this)}
function FE3rBitmapConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._bitmaps=null;a._dataUrl="/cloud.content.texture.bitmap.wv";a.construct=FE3rBitmapConsole_construct;a.bitmaps=FE3rBitmapConsole_bitmaps;a.load=FE3rBitmapConsole_load;return a}function FE3rBitmapConsole_construct(){this.__base.FConsole.construct.call(this);this._bitmaps=new TDictionary}function FE3rBitmapConsole_bitmaps(){return this._bitmaps}
function FE3rBitmapConsole_load(a,b,e){var f=this._bitmaps.get(b);if(f)return f;var h=RBrowser.hostPath(this._dataUrl+"?code="+b);RLogger.info(this,"Load texture from bitmap. (url={1})",h);f="environment"==RString.toLower(e)?RClass.create(FE3rTextureCube):RClass.create(FE3rTexture);f._name=b;f.linkGraphicContext(a);f.load(h);this._bitmaps.set(b,f);return f}
function FE3rBone(a){a=RClass.inherits(this,a,FObject);a._matrix=null;a._boneResource=null;a._trackResource=null;a.construct=FE3rBone_construct;a.matrix=FE3rBone_matrix;a.trackResource=FE3rBone_trackResource;a.loadResource=FE3rBone_loadResource;a.update=FE3rBone_update;a.dispose=FE3rBone_dispose;return a}function FE3rBone_construct(){this.__base.FObject.construct.call(this);this._matrix=new SMatrix3d}function FE3rBone_matrix(){return this._matrix}
function FE3rBone_trackResource(){return this._trackResource}function FE3rBone_loadResource(a){this._boneResource=a;this._trackResource=a.track()}function FE3rBone_update(a,b){var e=this._trackResource;e.calculate(a,b);a.update();var f=this._matrix;f.assign(e.matrixInvert());f.append(a.matrix)}function FE3rBone_dispose(){this._trackResource=this._boneResource=null;this.__base.FG3dBone.dispose.call(this)}
function FE3rDynamicMesh(a){a=RClass.inherits(this,a,FE3dRenderable);a._optionMerge=!0;a._vertexPosition=0;a._vertexTotal=0;a._indexPosition=0;a._indexTotal=0;a._mergeRenderables=null;a.construct=FE3rDynamicMesh_construct;a.mergeCount=FE3rDynamicMesh_mergeCount;a.mergeRenderables=FE3rDynamicMesh_mergeRenderables;a.syncVertexBuffer=FE3rDynamicMesh_syncVertexBuffer;a.mergeRenderable=FE3rDynamicMesh_mergeRenderable;a.mergeVertexBuffer=FE3rDynamicMesh_mergeVertexBuffer;a.mergeIndexBuffer=FE3rDynamicMesh_mergeIndexBuffer;
a.build=FE3rDynamicMesh_build;return a}function FE3rDynamicMesh_construct(){this.__base.FE3dRenderable.construct.call(this);this._mergeRenderables=new TObjects}function FE3rDynamicMesh_mergeCount(){return this._mergeRenderables.count()}function FE3rDynamicMesh_mergeRenderables(){return this._mergeRenderables}
function FE3rDynamicMesh_syncVertexBuffer(a){var b=a._resource._code,e=this._vertexBuffers.get(b);if(!e){var f=this._vertexTotal,e=this._graphicContext.createVertexBuffer();e._name=b;e._formatCd=a._formatCd;e._stride=a._stride;switch(a._formatCd){case EG3dAttributeFormat.Float2:e._data=new Float32Array(2*f);break;case EG3dAttributeFormat.Float3:e._data=new Float32Array(3*f);break;case EG3dAttributeFormat.Byte4:case EG3dAttributeFormat.Byte4Normal:e._data=new Uint8Array(4*f);break;default:throw new TError("Unknown code");
}this._vertexBuffers.set(b,e)}return e}function FE3rDynamicMesh_mergeRenderable(a){var b=this._graphicContext.capability(),e=a.vertexCount(),f=a.indexBuffer().count(),h=b.mergeCount;if(this._mergeRenderables.count()>=h)return!1;h=this._vertexTotal+e;if(b.optionIndex32){if(h>RInteger.MAX_UINT32)return!1}else if(h>RInteger.MAX_UINT16)return!1;this._vertexTotal+=e;this._indexTotal+=f;this._mergeRenderables.push(a);return!0}
function FE3rDynamicMesh_mergeVertexBuffer(a,b,e,f){a=this._vertexPosition;e=e._data;var h=f._dataCount;switch(b){case "position":b=new Float32Array(f._data);RFloat.copy(e,3*a,b,0,3*h);break;case "coord":b=new Float32Array(f._data);RFloat.copy(e,2*a,b,0,2*h);break;case "color":case "normal":case "binormal":case "tangent":case "bone_index":case "bone_weight":b=new Uint8Array(f._data);RByte.copy(e,4*a,b,0,4*h);break;default:throw new TError("Unknown code");}}
function FE3rDynamicMesh_mergeIndexBuffer(a){var b=this._vertexPosition,e=this._indexPosition,f=this._indexBuffer._data,h=new Uint16Array(a._data);a=3*a._dataCount;for(var k=0;k<a;k++)f[e++]=b+h[k]}
function FE3rDynamicMesh_build(){var a=this._graphicContext,b=a.capability(),e=this._vertexTotal,f=this._indexTotal,h=this._mergeRenderables,k=h.count(),q=h.first();this._material=q._material;this._textures=q._textures;var t=this._instanceVertexBuffer=this._graphicContext.createVertexBuffer();t._name="instance";t._stride=4;t._formatCd=EG3dAttributeFormat.Float1;q=t._data=new Float32Array(e);this._vertexBuffers.set(t._name,t);t=this._indexBuffer=a.createIndexBuffer();b.optionIndex32?(t._strideCd=EG3dIndexStride.Uint32,
t._data=new Uint32Array(f)):(t._strideCd=EG3dIndexStride.Uint16,t._data=new Uint16Array(f));t._count=f;for(a=0;a<k;a++){for(var u=h.getAt(a),b=u.vertexCount(),x=u.vertexBuffers(),z=x.count(),y=0;y<z;y++){var t=x.valueAt(y),A=t._resource,E=A._code,t=this.syncVertexBuffer(t);this.mergeVertexBuffer(u,E,t,A)}RFloat.fill(q,this._vertexPosition,b,a);t=u.indexBuffer();u=t.count();this.mergeIndexBuffer(t._resource);this._vertexPosition+=b;this._indexPosition+=u}x=this._vertexBuffers;z=x.count();for(y=0;y<
z;y++)t=x.valueAt(y),t.upload(t._data,t._stride,e),t._data=null;this._indexBuffer.upload(this._indexBuffer._data,f);this._indexBuffer._data=null}
function FE3rDynamicModel(a){a=RClass.inherits(this,a,FE3rObject);a._renderables=null;a._meshes=null;a._updateDate=0;a.construct=FE3rDynamicModel_construct;a.createMesh=FE3rDynamicModel_createMesh;a.renderables=FE3rDynamicModel_renderables;a.meshes=FE3rDynamicModel_meshes;a.pushRenderable=FE3rDynamicModel_pushRenderable;a.build=FE3rDynamicModel_build;a.update=FE3rDynamicModel_update;return a}
function FE3rDynamicModel_construct(){this.__base.FE3rObject.construct.call(this);this._renderables=new TObjects;this._meshes=new TObjects}function FE3rDynamicModel_createMesh(){var a=RClass.create(FE3rDynamicMesh);a.linkGraphicContext(this);this._meshes.push(a);return a}function FE3rDynamicModel_renderables(){return this._renderables}function FE3rDynamicModel_meshes(){return this._meshes}function FE3rDynamicModel_pushRenderable(a){this._renderables.push(a)}
function FE3rDynamicModel_build(){var a=this._renderables,b=this._meshes,e=a.count();if(0<e)for(var f=this.createMesh(),h=0;h<e;h++){var k=a.getAt(h);if(!f.mergeRenderable(k)&&(f=this.createMesh(),!f.mergeRenderable(k)))throw new TError(this,"Merge renderable failure.");}a=b.count();for(h=0;h<a;h++)b.getAt(h).build()}function FE3rDynamicModel_update(a){this._updateDate=RTimer.current()}
function FE3rInstanceMesh(a){a=RClass.inherits(this,a,FE3rMesh);a._merges=null;a.construct=FE3rInstanceMesh_construct;a.mergeRenderable=FE3rInstanceMesh_mergeRenderable;a.build=FE3rInstanceMesh_build;return a}function FE3rInstanceMesh_construct(){this.__base.FE3rMesh.construct.call(this);this._merges=new TObjects}function FE3rInstanceMesh_mergeRenderable(a){this._merges.push(a)}function FE3rInstanceMesh_build(){}
function FE3rMaterial(a){a=RClass.inherits(this,a,FG3dObject);a._vertexBuffers=null;a._indexBuffer=null;a._material=null;a.construct=FE3rMaterial_construct;a.findVertexBuffer=FE3rMaterial_findVertexBuffer;a.indexBuffer=FE3rMaterial_indexBuffer;a.loadResource=FE3rMaterial_loadResource;return a}function FE3rMaterial_construct(){this.__base.FG3dObject.construct.call(this);this._vertexBuffers=new TObjects}
function FE3rMaterial_findVertexBuffer(a){for(var b=this._vertexBuffers,e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h.name()==a)return h}return null}function FE3rMaterial_indexBuffer(){return this._indexBuffer}
function FE3rMaterial_loadResource(a){for(var b=this._context,e=a.vertexBuffers(),f=e.count(),h=0;h<f;h++){var k=e.get(h),q=context.createVertexBuffer();q._name=k.name();q._formatCd=k.formatCd();q.upload(new Float32Array(k._data),k._stride,k._vertexCount);this._vertexBuffers.push(q)}h=a.indexBuffer();(this._indexBuffer=b.createIndexBuffer()).upload(h.data(),h.count());h=a.materialCode();a=(this._material=RConsole.find(FE3sThemeConsole).find(h)).textures();b=a.count();for(h=0;h<b;h++)a.get(h)}
function FE3rMesh(a){a=RClass.inherits(this,a,FE3rObject);a._ready=!1;a._resource=null;a._vertexCount=0;a._vertexBuffers=null;a._indexBuffer=null;a._resourceMaterial=null;a._material=null;a._skins=null;a._boneIds=null;a._textures=null;a.construct=FE3rMesh_construct;a.testReady=FE3rMesh_testReady;a.guid=FE3rMesh_guid;a.vertexCount=FE3rMesh_vertexCount;a.findVertexBuffer=FE3rMesh_findVertexBuffer;a.vertexBuffers=FE3rMesh_vertexBuffers;a.indexBuffer=FE3rMesh_indexBuffer;a.material=FE3rMesh_material;
a.skins=FE3rMesh_skins;a.pushSkin=FE3rMesh_pushSkin;a.findTexture=FE3rMesh_findTexture;a.textures=FE3rMesh_textures;a.boneIds=FE3rMesh_boneIds;a.resource=FE3rMesh_resource;a.loadResource=FE3rMesh_loadResource;return a}function FE3rMesh_construct(){this.__base.FE3rObject.construct.call(this);this._vertexBuffers=new TObjects}
function FE3rMesh_testReady(){if(!this._ready){var a=this._textures;if(null!=a)for(var b=a.count(),e=0;e<b;e++)if(!a.value(e).testReady())return!1;this._ready=!0}return this._ready}function FE3rMesh_guid(){return this._resource.guid()}function FE3rMesh_vertexCount(){return this._vertexCount}function FE3rMesh_findVertexBuffer(a){for(var b=this._vertexBuffers,e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h.name()==a)return h}return null}function FE3rMesh_vertexBuffers(){return this._vertexBuffers}
function FE3rMesh_indexBuffer(){return this._indexBuffer}function FE3rMesh_material(){return this._material}function FE3rMesh_skins(){return this._skins}function FE3rMesh_pushSkin(a){var b=this._skins;b||(b=this._skins=new TObjects);b.push(a)}function FE3rMesh_findTexture(a){return this._textures.get(a)}function FE3rMesh_textures(){return this._textures}function FE3rMesh_boneIds(a){return this._boneIds}function FE3rMesh_resource(){return this._resource}
function FE3rMesh_loadResource(a){var b=this._graphicContext;this._resource=a;a=a.streams();for(var e=a.count(),f=0;f<e;f++){var h=a.get(f),k=h._code;if("index16"==k||"index32"==k){var q=this._indexBuffer=b.createIndexBuffer();q._resource=h;q.upload(h._data,3*h._dataCount)}else{q=b.createVertexBuffer();q._name=k;q._resource=h;this._vertexCount=h._dataCount;var t=null;switch(k){case "position":t=new Float32Array(h._data);q._formatCd=EG3dAttributeFormat.Float3;break;case "coord":t=new Float32Array(h._data);
q._formatCd=EG3dAttributeFormat.Float2;break;case "color":t=new Uint8Array(h._data);q._formatCd=EG3dAttributeFormat.Byte4Normal;break;case "normal":case "binormal":case "tangent":t=new Uint8Array(h._data);q._formatCd=EG3dAttributeFormat.Byte4Normal;break;default:throw new TError("Unknown code");}q.upload(t,h._dataStride,h._dataCount);this._vertexBuffers.push(q)}}}function FE3rMeshAnimation(a){a=RClass.inherits(this,a,FE3rAnimation);a.process=FE3rMeshAnimation_process;return a}
function FE3rMeshAnimation_process(a){var b=a._resource,e=this._playInfo;b.calculate(e,this._currentTick);e.update();a=a._matrix;a.assign(b.matrixInvert());a.append(e.matrix)}
function FE3rModel(a){a=RClass.inherits(this,a,FE3rObject);a._name=null;a._resource=null;a._meshes=null;a._skeletons=null;a._dataReady=!1;a.name=FE3rModel_name;a.setName=FE3rModel_setName;a.findMeshByGuid=FE3rModel_findMeshByGuid;a.geometrys=FE3rModel_geometrys;a.resource=FE3rModel_resource;a.resource=FE3rModel_resource;a.setResource=FE3rModel_setResource;a.testReady=FE3rModel_testReady;a.loadResource=FE3rModel_loadResource;a.loadSkeletonResource=FE3rModel_loadSkeletonResource;a.processLoad=FE3rModel_processLoad;
a.dispose=FE3rModel_dispose;return a}function FE3rModel_name(){return this._name}function FE3rModel_setName(a){this._name=a}function FE3rModel_findMeshByGuid(a){for(var b=this._meshes,e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h._guid==a)return h}return null}function FE3rModel_geometrys(){return this._meshes}function FE3rModel_resource(){return this._resource}function FE3rModel_setResource(a){this._resource=a}function FE3rModel_testReady(){return this._dataReady}
function FE3rModel_loadSkeletonResource(a){var b=RConsole.find(FE3rModelConsole);if(a=a.skins())for(var e=a.count(),f=0;f<e;f++){var h=a.get(f),k=RClass.create(FE3rSkin);k.linkGraphicContext(this);k.loadResource(h);b.findMesh(h.meshGuid()).pushSkin(k)}}
function FE3rModel_loadResource(a){var b=RConsole.find(FE3rModelConsole),e=a.meshes();if(e)for(var f=this._meshes=new TObjects,h=e.count(),k=0;k<h;k++){var q=e.get(k),t=RClass.create(FE3rMesh);t.linkGraphicContext(this);t.loadResource(q);f.push(t);b.meshs().set(t.guid(),t)}if(a=a.skeletons())for(h=a.count(),k=0;k<h;k++)b=a.get(k),this.loadSkeletonResource(b);this._dataReady=!0}
function FE3rModel_processLoad(){if(this._dataReady)return!0;if(!this._resource.testReady())return!1;this.loadResource(this._resource);return!0}function FE3rModel_dispose(){this._ready=!1;this._resource=null;this._meshes=RObject.dispose(this._meshes);this._skeletons=RObject.dispose(this._skeletons);this.__base.FObject.dispose.call(this)}
function FE3rModelConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._loadModels=null;a._models=null;a._meshs=null;a._dynamicMeshs=null;a._thread=null;a._interval=200;a.onProcess=FE3rModelConsole_onProcess;a.construct=FE3rModelConsole_construct;a.findModel=FE3rModelConsole_findModel;a.models=FE3rModelConsole_models;a.findMesh=FE3rModelConsole_findMesh;a.meshs=FE3rModelConsole_meshs;a.load=FE3rModelConsole_load;a.merge=FE3rModelConsole_merge;return a}
function FE3rModelConsole_onProcess(){var a=this._loadModels;for(a.record();a.next();)a.current().processLoad()&&a.removeCurrent()}function FE3rModelConsole_construct(){this.__base.FConsole.construct.call(this);this._loadModels=new TLooper;this._models=new TDictionary;this._meshs=new TDictionary;this._dynamicMeshs=new TDictionary;var a=this._thread=RClass.create(FThread);a.setInterval(this._interval);a.addProcessListener(this,this.onProcess);RConsole.find(FThreadConsole).start(a)}
function FE3rModelConsole_findModel(a){return this._models.get(a)}function FE3rModelConsole_models(){return this._models}function FE3rModelConsole_findMesh(a){return this._meshs.get(a)}function FE3rModelConsole_meshs(){return this._meshs}
function FE3rModelConsole_load(a,b){if(null==a)throw new TError("Graphics context is empty");if(RString.isEmpty(b))throw new TError("Model name is empty");var e=this._models.get(b);if(e)return e;var f=RConsole.find(FE3sModelConsole).load(b),e=RClass.create(FE3rModel);e.linkGraphicContext(a);e.setName(b);e.setResource(f);this._models.set(b,e);f.testReady()?e.loadResource(f):this._loadModels.push(e);return e}
function FE3rModelConsole_merge(a,b,e,f){a="merge";for(var h=b.renderables(),k=0;k<f;k++){var q=h.getAt(e+k);a+="|"+q.hashCode()}var t=this._dynamicMeshs.get(a);if(!t){t=RClass.create(FE3rDynamicModel);for(k=0;k<f;k++)q=h.getAt(e+k),t.pushRenderable(q);t.linkGraphicContext(b);t.build();this._dynamicMeshs.set(a,t)}t.update();return t}function FE3rObject(a){return a=RClass.inherits(this,a,FObject,MGraphicObject)}
function FE3rPipeline(a){a=RClass.inherits(this,a,FObject);a._vertexBuffers=null;a._indexBuffer=null;a.construct=FE3rPipeline_construct;a.findVertexBuffer=FE3rPipeline_findVertexBuffer;a.loadResource=FE3rPipeline_loadResource;return a}function FE3rPipeline_construct(){this.__base.FRenderable.construct.call(this);this._vertexBuffers=new TObjects}function FE3rPipeline_findVertexBuffer(a){for(var b=this._vertexBuffers,e=b.count(),f=0;f<e;f++){var h=b.get(f);if(h.name()==a)return h}return null}
function FE3rPipeline_loadResource(a){for(var b=this._context,e=a.vertexBuffers(),f=e.count(),h=0;h<f;h++){var k=e.get(h),q=context.createVertexBuffer();q._name=k.name();q.upload(new Float32Array(k._data),k._stride,k._vertexCount);this._vertexBuffers.push(q)}a=a.indexBuffer();(this._indexBuffer=b.createIndexBuffer()).upload(a.data(),a.count())}
function FE3rSkeleton(a){a=RClass.inherits(this,a,FE3rObject);a._resource=null;a._bones=null;a._skins=null;a.resource=FE3rSkeleton_resource;a.bones=FE3rSkeleton_bones;a.skins=FE3rSkeleton_skins;a.loadResource=FE3rSkeleton_loadResource;return a}function FE3rSkeleton_resource(){return this._resource}function FE3rSkeleton_bones(){return this._bones}function FE3rSkeleton_skins(){return this._skins}
function FE3rSkeleton_loadResource(a){this._resource=a;a=a._bones;var b=a.count();if(0<b)for(var e=this._bones=new TObjects,f=0;f<b;f++){var h=a.value(f),k=RClass.create(FE3rBone);k.loadResource(h);e.push(k)}}function FE3rSkeletonAnimation(a){a=RClass.inherits(this,a,FE3rAnimation);a.process=FE3rSkeletonAnimation_process;return a}function FE3rSkeletonAnimation_process(a){var b=this._currentTick;a=a.bones();for(var e=a.count(),f=0;f<e;f++)a.get(f).update(this._playInfo,b)}
function FE3rSkin(a){a=RClass.inherits(this,a,FE3rObject);a._resource=null;a._streams=null;a.resource=FE3rSkin_resource;a.streams=FE3rSkin_streams;a.loadResource=FE3rSkin_loadResource;return a}function FE3rSkin_resource(){return this._resource}function FE3rSkin_streams(){return this._streams}
function FE3rSkin_loadResource(a){this._resource=a;if(a=a.streams())for(var b=this._streams=new TObjects,e=a.count(),f=0;f<e;f++){var h=RClass.create(FE3rStream);h.linkGraphicContext(this);h.loadResource(a.get(f));b.push(h)}}function FE3rStream(a){a=RClass.inherits(this,a,FE3rObject);a._buffer=null;a._resource=null;a.resource=FE3rStream_resource;a.buffer=FE3rStream_buffer;a.loadResource=FE3rStream_loadResource;return a}function FE3rStream_resource(){return this._resource}
function FE3rStream_buffer(){return this._buffer}function FE3rStream_loadResource(a){var b=a._code;this._resource=a;this._vertexCount=a._dataCount;var e=this._buffer=this._graphicContext.createVertexBuffer();e._name=b;e._resource=a;switch(b){case "bone_index":e._formatCd=EG3dAttributeFormat.Byte4;break;case "bone_weight":e._formatCd=EG3dAttributeFormat.Byte4Normal;break;default:throw new TError("Unknown code");}e.upload(a._data,a._dataStride,a._dataCount)}
function FE3rTexture(a){a=RClass.inherits(this,a,FObject,MGraphicObject);a._resource=null;a._bitmaps=null;a._bitmapPacks=null;a._ready=!1;a._dataReady=!1;a.construct=FE3rTexture_construct;a.resource=FE3rTexture_resource;a.setResource=FE3rTexture_setResource;a.bitmaps=FE3rTexture_bitmaps;a.testReady=FE3rTexture_testReady;a.loadBitmap=FE3rTexture_loadBitmap;a.loadResource=FE3rTexture_loadResource;a.load=FE3rTexture_load;a.processLoad=FE3rTexture_processLoad;a.dispose=FE3rTexture_dispose;return a}
function FE3rTexture_construct(){this.__base.FObject.construct.call(this);this._bitmaps=new TDictionary}function FE3rTexture_resource(){return this._resource}function FE3rTexture_setResource(a){this._resource=a}function FE3rTexture_bitmaps(){return this._bitmaps}function FE3rTexture_testReady(){return this._ready}function FE3rTexture_loadBitmap(a){var b=this._bitmaps,e=b.get(a);e||(e=RClass.create(FE3rTextureBitmap),b.set(a,e));return e}
function FE3rTexture_loadResource(a){if(a=a.bitmapPacks()){this._bitmapPacks=new TDictionary;for(var b=a.count(),e=0;e<b;e++){var f=a.valueAt(e),h=null;if("flat"==f._typeName)h=RClass.create(FE3rTextureBitmapFlatPack);else if("cube"==f._typeName)h=RClass.create(FE3rTextureBitmapCubePack);else throw new TError(this,"Load resource failure.");h.linkGraphicContext(this);h.loadResource(f);this._bitmapPacks.set(f.code(),h)}}this._dataReady=!0}
function FE3rTexture_load(){for(var a=this._resource.bitmaps(),b=a.count()-1;0<=b;b--){var e=a.valueAt(b),f=this.loadBitmap(e.guid()),e=this._bitmapPacks.get(e.packCode());if(!e)throw new TError("Link pack is not eists.");f.load(e)}this._ready=!0}
function FE3rTexture_processLoad(){if(this._dataReady){for(var a=this._bitmapPacks,b=a.count()-1;0<=b;b--)if(!a.valueAt(b).testReady())return!1;this.load()}else{if(!this._resource.testReady())return!1;this.loadResource(this._resource)}return this._ready}function FE3rTexture_dispose(){this._ready=!1;this._resource=null;this._bitmaps=RObject.dispose(this._bitmaps);this.__base.FObject.dispose.call(this)}
function FE3rTextureBitmap(a){a=RClass.inherits(this,a,FObject,MGraphicObject);a._ready=!1;a._bitmapPack=null;a.construct=FE3rTextureBitmap_construct;a.texture=FE3rTextureBitmap_texture;a.testReady=FE3rTextureBitmap_testReady;a.load=FE3rTextureBitmap_load;a.dispose=FE3rTextureBitmap_dispose;return a}function FE3rTextureBitmap_construct(){this.__base.FObject.construct.call(this)}function FE3rTextureBitmap_texture(){return this._bitmapPack.texture()}
function FE3rTextureBitmap_testReady(){return this._ready}function FE3rTextureBitmap_load(a){this._bitmapPack=a;this._ready=!0}function FE3rTextureBitmap_dispose(){this._context=null;this._ready=!1;this._bitmapPack=null;this.__base.FObject.dispose.call(this)}
function FE3rTextureBitmapCubePack(a){a=RClass.inherits(this,a,FE3rTextureBitmapPack);a._resource=null;a._images=null;a.onLoad=FE3rTextureBitmapCubePack_onLoad;a.construct=FE3rTextureBitmapCubePack_construct;a.loadResource=FE3rTextureBitmapCubePack_loadResource;a.dispose=FE3rTextureBitmapCubePack_dispose;return a}
function FE3rTextureBitmapCubePack_onLoad(a){var b=this._graphicContext;a=this._images;for(var e=0;6>e;e++)if(!a[e].testReady())return;(this._texture=b.createCubeTexture()).upload(a[0],a[1],a[2],a[3],a[4],a[5]);for(e=0;6>e;e++)b=a[e],window.URL.revokeObjectURL(b.url()),a[e]=RObject.dispose(b);this._images=RObject.dispose(this._images);this._dataReady=!0}function FE3rTextureBitmapCubePack_construct(){this.__base.FE3rTextureBitmapPack.construct.call(this)}
function FE3rTextureBitmapCubePack_loadResource(a){this._resource=a;var b=a.data();a=a._formatName;this._images=new TObjects;for(var e=0;6>e;e++){var f=new Blob([b[e]],{type:"image/"+a}),f=window.URL.createObjectURL(f),h=this._images[e]=RClass.create(FImage);h.setOptionAlpha(!1);h.loadUrl(f);h.addLoadListener(this,this.onLoad)}}function FE3rTextureBitmapCubePack_dispose(){this._images=RObject.dispose(this._images);this.__base.FE3rTextureBitmapPack.dispose.call(this)}
function FE3rTextureBitmapFlatPack(a){a=RClass.inherits(this,a,FE3rTextureBitmapPack);a._resource=null;a._image=null;a.onLoad=FE3rTextureBitmapFlatPack_onLoad;a.construct=FE3rTextureBitmapFlatPack_construct;a.loadResource=FE3rTextureBitmapFlatPack_loadResource;a.dispose=FE3rTextureBitmapFlatPack_dispose;return a}
function FE3rTextureBitmapFlatPack_onLoad(a){a=this._texture=this._graphicContext.createFlatTexture();a.upload(this._image);a.makeMipmap();this._image=RObject.dispose(this._image);this._dataReady=!0}function FE3rTextureBitmapFlatPack_construct(){this.__base.FE3rTextureBitmapPack.construct.call(this)}
function FE3rTextureBitmapFlatPack_loadResource(a){this._resource=a;var b=a._texture,e=a.code();(this._image=RConsole.find(FE3sTextureConsole).loadBitmap(b._guid,e,a._formatName)).addLoadListener(this,this.onLoad)}function FE3rTextureBitmapFlatPack_dispose(){this._image=RObject.dispose(this._image);this.__base.FE3rTextureBitmapPack.dispose.call(this)}
function FE3rTextureBitmapPack(a){a=RClass.inherits(this,a,FObject,MGraphicObject);a._resource=null;a._image=null;a._texture=null;a._ready=!1;a._dataReady=!1;a.onLoad=RMethod.virtual(a,"onLoad");a.construct=FE3rTextureBitmapPack_construct;a.texture=FE3rTextureBitmapPack_texture;a.testReady=FE3rTextureBitmapPack_testReady;a.loadResource=RMethod.virtual(a,"loadResource");a.dispose=FE3rTextureBitmapPack_dispose;return a}
function FE3rTextureBitmapPack_construct(){this.__base.FObject.construct.call(this)}function FE3rTextureBitmapPack_texture(){return this._texture}function FE3rTextureBitmapPack_testReady(){this._dataReady&&(this._ready=this._texture.isValid());return this._ready}function FE3rTextureBitmapPack_dispose(){this._dataReady=this._ready=!1;this.__base.FObject.dispose.call(this)}
function FE3rTextureConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._loadTextures=null;a._bitmaps=null;a._textures=null;a._thread=null;a._interval=200;a.onProcess=FE3rTextureConsole_onProcess;a.construct=FE3rTextureConsole_construct;a.bitmaps=FE3rTextureConsole_bitmaps;a.textures=FE3rTextureConsole_textures;a.load=FE3rTextureConsole_load;a.loadBitmap=FE3rTextureConsole_loadBitmap;return a}
function FE3rTextureConsole_onProcess(){var a=this._loadTextures;for(a.record();a.next();)a.current().processLoad()&&a.removeCurrent()}function FE3rTextureConsole_construct(){this.__base.FConsole.construct.call(this);this._loadTextures=new TLooper;this._bitmaps=new TDictionary;this._textures=new TDictionary;var a=this._thread=RClass.create(FThread);a.setInterval(this._interval);a.addProcessListener(this,this.onProcess);RConsole.find(FThreadConsole).start(a)}
function FE3rTextureConsole_bitmaps(){return this._bitmaps}function FE3rTextureConsole_textures(){return this._textures}function FE3rTextureConsole_load(a,b){var e=this._textures,f=e.get(b);if(f)return f;var h=RConsole.find(FE3sTextureConsole).load(b),f=RClass.create(FE3rTexture);f.linkGraphicContext(a);f.setResource(h);e.set(b,f);this._loadTextures.push(f);return f}function FE3rTextureConsole_loadBitmap(a,b,e){var f=this._bitmaps.get(e);return f?f:this.load(a,b).loadBitmap(e)}
function FE3rTrack(a){a=RClass.inherits(this,a,FObject);a._matrix=null;a._resource=null;a.construct=FE3rTrack_construct;a.matrix=FE3rTrack_matrix;a.resource=FE3rTrack_resource;a.loadResource=FE3rTrack_loadResource;a.dispose=FE3rTrack_dispose;return a}function FE3rTrack_construct(){this.__base.FObject.construct.call(this);this._matrix=new SMatrix3d}function FE3rTrack_matrix(){return this._matrix}function FE3rTrack_resource(){return this._resource}
function FE3rTrack_loadResource(a){this._resource=a;var b=a.frames();null!=b&&(this._frameCount=b.count());this._frameTick=a.frameTick()}function FE3rTrack_dispose(){this._resource=null;this.__base.FG3dTrack.dispose.call(this)}
function FE3dGeneralColorAutomaticEffect(a){a=RClass.inherits(this,a,FG3dAutomaticEffect);a._code="general.color.automatic";a.buildMaterial=FE3dGeneralColorAutomaticEffect_buildMaterial;a.drawRenderable=FE3dGeneralColorAutomaticEffect_drawRenderable;a.drawGroup=FE3dGeneralColorAutomaticEffect_drawGroup;return a}
function FE3dGeneralColorAutomaticEffect_buildMaterial(a,b){var e=b.material(),f=a.material;f||(f=a.material=RClass.create(FFloatStream),f.setLength(40),e._dirty=!0);if(e._dirty){var h=e.info();f.reset();f.writeFloat4(h.colorMin,h.colorMax,h.colorRate,h.colorMerge);h.optionAlpha?f.writeFloat4(h.alphaBase,h.alphaRate,0,0):f.writeFloat4(h.alphaBase,1,0,0);f.writeColor4(h.ambientColor);f.writeColor4(h.diffuseColor);f.writeColor4(h.specularColor);f.writeFloat4(h.specularBase,h.specularLevel,h.specularAverage,
h.specularShadow);f.writeColor4(h.reflectColor);f.writeFloat4(0,0,1-h.reflectMerge,h.reflectMerge);f.writeColor4(h.emissiveColor);e._dirty=!1}}
function FE3dGeneralColorAutomaticEffect_drawRenderable(a,b){var e=this._program,f=a.calculate(EG3dRegionParameter.CameraPosition),h=a.calculate(EG3dRegionParameter.LightDirection),k=b.material();k.info();this.bindMaterial(k);if(b._optionMerge){for(var q=b.mergeRenderables(),t=q.count(),u=RTypeArray.findTemp(EDataType.Float,16*t),x=0;x<t;x++)k=q.getAt(x),k.currentMatrix().writeData(u,16*x);e.setParameter("vc_model_matrix",u)}else e.setParameter("vc_model_matrix",b.currentMatrix());e.setParameter("vc_vp_matrix",
a.calculate(EG3dRegionParameter.CameraViewProjectionMatrix));e.setParameter("vc_camera_position",f);e.setParameter("vc_light_direction",h);e.setParameter("fc_camera_position",f);e.setParameter("fc_light_direction",h);this._supportMaterialMap?(x=b._materialId,e.setParameter4("fc_material",.03125,x/512,0,0)):(f=b.activeInfo(),this.buildMaterial(f,b),e.setParameter("fc_materials",f.material.memory()));this.__base.FG3dAutomaticEffect.drawRenderable.call(this,a,b)}
function FE3dGeneralColorAutomaticEffect_drawGroup(a,b,e,f){if(1<f){var h=RConsole.find(FE3rModelConsole).merge(this,a,e,f);if(h){b=null;e=this._graphicContext;h=h.meshes();f=h.count();for(var k=a.spaceName(),q=0;q<f;q++){var t=h.getAt(q),u=t.selectInfo(k);b=u.effect;b||(b=u.effect=RConsole.find(FG3dEffectConsole).find(e,a,t))}return b.drawGroup(a,h,0,f)}}this.__base.FG3dAutomaticEffect.drawGroup.call(this,a,b,e,f)}
var EE3dScene=new function(){this.Scene="scene";this.Layer="layer";this.Display="display";this.Material="material";this.Renderable="renderable";return this};function FE3dBoundBox(a){a=RClass.inherits(this,a,FE3dRenderable);a._outline=null;a._rate=.2;a._vertexPositionBuffer=null;a._vertexColorBuffer=null;a.construct=FE3dBoundBox_construct;a.outline=FE3dBoundBox_outline;a.setup=FE3dBoundBox_setup;a.upload=FE3dBoundBox_upload;return a}
function FE3dBoundBox_construct(){this.__base.FE3dRenderable.construct.call(this);this._outline=new SOutline3}function FE3dBoundBox_outline(){return this._outline}
function FE3dBoundBox_setup(){var a=this._graphicContext,b=this._vertexPositionBuffer=a.createVertexBuffer();b._name="position";b._formatCd=EG3dAttributeFormat.Float3;this._vertexBuffers.set(b._name,b);for(var e=new Uint8Array(128),b=127;0<=b;b--)e[b]=255;b=this._vertexColorBuffer=a.createVertexBuffer();b._name="color";b._formatCd=EG3dAttributeFormat.Byte4Normal;b.upload(e,4,32);this._vertexBuffers.set(b._name,b);this._vertexCount=32;a=this._indexBuffer=a.createIndexBuffer();a._fillMode=EG3dFillMode.Line;
a._lineWidth=1;a.upload([0,1,0,4,0,12,3,2,3,5,3,13,8,6,8,9,8,14,11,7,11,10,11,15,20,16,20,21,20,24,23,17,23,22,23,25,28,18,28,26,28,29,31,19,31,27,31,30],48);this.update();a=this.material().info();a.effectCode="control";a.ambientColor.set(1,1,1,1)}
function FE3dBoundBox_upload(){var a=this._outline,b=a.max,e=b.x,f=b.y,b=b.z,h=a.min,a=h.x,k=h.y,h=h.z,q=this._rate,t=(e-a)*q,u=(f-k)*q,q=(b-h)*q;this._vertexPositionBuffer.upload([a,f,h,a+t,f,h,e-t,f,h,e,f,h,a,f-u,h,e,f-u,h,a,k+u,h,e,k+u,h,a,k,h,a+t,k,h,e-t,k,h,e,k,h,a,f,h+q,e,f,h+q,a,k,h+q,e,k,h+q,a,f,b-q,e,f,b-q,a,k,b-q,e,k,b-q,a,f,b,a+t,f,b,e-t,f,b,e,f,b,a,f-u,b,e,f-u,b,a,k+u,b,e,k+u,b,a,k,b,a+t,k,b,e-t,k,b,e,k,b],12,32)}
function FE3dCamera(a){a=RClass.inherits(this,a,FG3dPerspectiveCamera);a._rotation=null;a._rotationMatrix=null;a._quaternion=null;a._quaternionX=null;a._quaternionY=null;a._quaternionZ=null;a.construct=FE3dCamera_construct;a.rotation=FE3dCamera_rotation;a.doPitch=FE3dCamera_doPitch;a.doYaw=FE3dCamera_doYaw;a.doRoll=FE3dCamera_doRoll;a.update=FE3dCamera_update;return a}
function FE3dCamera_construct(){this.__base.FG3dPerspectiveCamera.construct.call(this);this._rotation=new SVector3;this._rotationMatrix=new SMatrix3x3;this._quaternion=new SQuaternion;this._quaternionX=new SQuaternion;this._quaternionY=new SQuaternion;this._quaternionZ=new SQuaternion}function FE3dCamera_rotation(){return this._rotation}function FE3dCamera_doPitch(a){this._rotation.x+=a}function FE3dCamera_doYaw(a){this._rotation.y+=a}function FE3dCamera_doRoll(a){this._rotation.z+=a}
function FE3dCamera_update(){var a=this._rotation;this._quaternionX.fromAxisAngle(RMath.vectorAxisX,a.x);this._quaternionY.fromAxisAngle(RMath.vectorAxisY,a.y);this._quaternionZ.fromAxisAngle(RMath.vectorAxisZ,a.z);var b=this._quaternion.identity();b.mul(this._quaternionX);b.mul(this._quaternionY);b.mul(this._quaternionZ);a=this._rotationMatrix;a.build(b);b=this._direction;a.transformPoint3(this._directionTarget,b);b.normalize();this.__base.FG3dPerspectiveCamera.update.call(this)}
function FE3dCube(a){a=RClass.inherits(this,a,FE3dRenderable);a.vertexPositionBuffer=null;a.vertexColorBuffer=null;a.indexBuffer=null;a.setup=FE3dCube_setup;return a}
function FE3dCube_setup(a){this.vertexPositionBuffer=a.createVertexBuffer();this.vertexPositionBuffer.upload([-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,1,1,1,-1,1,-1,-1,1],12,8);this.vertexColorBuffer=a.createVertexBuffer();this.vertexColorBuffer.upload([0,1,0,1,1,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,1,0,1,1,1,0,1,1,0,0,1,1],16,8);this.indexBuffer=context.createIndexBuffer();this.indexBuffer.upload([0,1,2,0,2,3,1,5,6,1,6,2,5,4,7,5,7,6,4,0,3,4,3,7,0,4,5,0,5,1,3,2,6,3,6,7],36);a=this.material().info();a.effectCode=
"control";a.ambientColor.set(1,1,1,1)}function FE3dDimensional(a){a=RClass.inherits(this,a,FE3dRenderable);a._cellSize=null;a._size=null;a._lineColor=null;a._lineCenterColor=null;a._vertexPositionBuffer=null;a._vertexColorBuffer=null;a.construct=FE3dDimensional_construct;a.setup=FE3dDimensional_setup;return a}function FE3dDimensional_construct(){this.__base.FE3dRenderable.construct.call(this);this._cellSize=new SSize2;this._cellSize.set(1,1);this._size=new SSize2;this._size.set(16,16)}
function FE3dDimensional_setup(){for(var a=this._graphicContext,b=this._cellSize.width,e=this._cellSize.height,f=this._size.width,h=f/2,k=this._size.height,q=k/2,t=2*(f+2+(k+2)),u=0,x=0,z=new Float32Array(3*t),y=0,A=new Uint8Array(4*t),E=0,B=new Uint16Array(t),D=0;D<=k;D++){var C=1;0==D-q&&(C=0);z[u++]=b*-h*C;z[u++]=0;z[u++]=e*(D-q);z[u++]=b*h*C;z[u++]=0;z[u++]=e*(D-q);for(C=0;8>C;C++)A[y++]=255;B[E++]=x++;B[E++]=x++}z[u++]=b*-h;z[u++]=0;z[u++]=0;z[u++]=b*h;z[u++]=0;for(C=z[u++]=0;2>C;C++)A[y++]=
255,A[y++]=0,A[y++]=0,A[y++]=255;B[E++]=x++;B[E++]=x++;for(k=0;k<=f;k++){C=1;0==k-h&&(C=0);z[u++]=b*(k-h);z[u++]=0;z[u++]=e*-q*C;z[u++]=b*(k-h);z[u++]=0;z[u++]=e*q*C;for(C=0;8>C;C++)A[y++]=255;B[E++]=x++;B[E++]=x++}z[u++]=0;z[u++]=0;z[u++]=e*-q;z[u++]=0;z[u++]=0;z[u++]=e*q;for(C=0;2>C;C++)A[y++]=255,A[y++]=0,A[y++]=0,A[y++]=255;B[E++]=x++;B[E++]=x++;this._vertexCount=t;b=this._vertexPositionBuffer=a.createVertexBuffer();b._name="position";b._formatCd=EG3dAttributeFormat.Float3;b.upload(z,12,t);this._vertexBuffers.set(b._name,
b);b=this._vertexColorBuffer=a.createVertexBuffer();b._name="color";b._formatCd=EG3dAttributeFormat.Byte4Normal;b.upload(A,4,t);this._vertexBuffers.set(b._name,b);a=this._indexBuffer=a.createIndexBuffer();a._fillMode=EG3dFillMode.Line;a.upload(B,t);t=this.material().info();t.effectCode="control";t.ambientColor.set(1,1,1,1)}
function FE3dMeshRenderable(a){a=RClass.inherits(this,a,FE3dRenderable);a._renderable=null;a._activeSkin=null;a._activeTrack=null;a._bones=null;a.renderable=FE3dMeshRenderable_renderable;a.vertexCount=FE3dMeshRenderable_vertexCount;a.indexBuffer=FE3dMeshRenderable_indexBuffer;a.findTexture=FE3dMeshRenderable_findTexture;a.textures=FE3dMeshRenderable_textures;a.bones=FE3dMeshRenderable_bones;a.process=FE3dMeshRenderable_process;a.processDelay=FE3dMeshRenderable_processDelay;a.update=FE3dMeshRenderable_update;
a.dispose=FE3dMeshRenderable_dispose;return a}function FE3dMeshRenderable_renderable(){return this._renderable}function FE3dMeshRenderable_vertexCount(){return this._renderable.vertexCount()}function FE3dMeshRenderable_indexBuffer(){return this._renderable.indexBuffer()}function FE3dMeshRenderable_findTexture(a){return this._textures.get(a)}function FE3dMeshRenderable_textures(){return this._textures}function FE3dMeshRenderable_bones(a){return this._bones}
function FE3dMeshRenderable_process(a){this.__base.FE3dRenderable.process.call(a);if((a=this._activeTrack)&&this._display._optionPlay){var b=a._animation;b&&b.process(a)}}function FE3dMeshRenderable_processDelay(){}function FE3dMeshRenderable_update(a){var b=this._display,e=this._matrix,f=this._activeTrack,h=this._calculateMatrix;f?(h.assign(f.matrix()),h.append(e)):h.assign(e);b&&(b=this._display.currentMatrix(),h.append(b));this._currentMatrix.attachData(h.data())&&a.change()}
function FE3dMeshRenderable_dispose(){var a=this._modelMatrix;a&&(a.dispose(),this._modelMatrix=null);if(a=this._vertexBuffers)a.dispose(),this._vertexBuffers=null;this.__base.FE3dRenderable.dispose.call(this)}
function FE3dModel(a){a=RClass.inherits(this,a,FDisplay3d);a._dataReady=!1;a._renderables=null;a._animation=null;a._geometrys=null;a._renderable=null;a.testReady=FE3dModel_testReady;a.loadRenderable=FE3dModel_loadRenderable;a.processLoad=FE3dModel_processLoad;a.process=FE3dModel_process;return a}function FE3dModel_testReady(){return this._dataReady}
function FE3dModel_loadRenderable(a){var b=this._context;a.resource();if(a=a.geometrys())if(b=a.count(),0<b)for(var e=this._geometrys=new TObjects,f=this.renderables(),h=0;h<b;h++){var k=a.get(h),q=RClass.create(FModelRenderable3d);q._display=this;q.load(k);e.push(q);f.push(q)}this._dataReady=!0}function FE3dModel_processLoad(){if(this._dataReady)return!0;if(!this._renderable.testReady())return!1;this.loadRenderable(this._renderable);return!0}
function FE3dModel_process(){this.__base.FDisplay3d.process.call(this);this._animation&&this._animation.process();return!0}function FE3dModelConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._loadModels=null;a._models=null;a._thread=null;a._interval=100;a.onProcess=FE3dModelConsole_onProcess;a.construct=FE3dModelConsole_construct;a.models=FE3dModelConsole_models;a.alloc=FE3dModelConsole_alloc;a.free=FE3dModelConsole_free;return a}
function FE3dModelConsole_onProcess(){var a=this._loadModels;for(a.record();a.next();)a.current().processLoad()&&a.removeCurrent()}function FE3dModelConsole_construct(){this._loadModels=new TLooper;this._models=new TDictionary;var a=this._thread=RClass.create(FThread);a.setInterval(this._interval);a.addProcessListener(this,this.onProcess);RConsole.find(FThreadConsole).start(a)}function FE3dModelConsole_models(){return this._models}
function FE3dModelConsole_alloc(a,b){var e=this._models.get(b);if(e&&!e.isEmpty())return e.pop();var e=RConsole.find(FE3rModelConsole).load(a,b),f=RClass.create(FModel3d);f._context=a;f._name=b;f._modelName=b;f._renderable=e;this._loadModels.push(f);return f}function FE3dModelConsole_free(a){a.remove();var b=a._modelName,e=this._models.get(b);null==e&&(e=new TObjects,this._models.set(b,e));e.push(a)}
function FE3dModelRenderable(a){a=RClass.inherits(this,a,FG3dRenderable);a._ready=!1;a._renderable=null;a._bones=null;a._materialResource=null;a.construct=FE3dModelRenderable_construct;a.testVisible=FE3dModelRenderable_testVisible;a.vertexCount=FE3dModelRenderable_vertexCount;a.findVertexBuffer=FE3dModelRenderable_findVertexBuffer;a.vertexBuffers=FE3dModelRenderable_vertexBuffers;a.indexBuffer=FE3dModelRenderable_indexBuffer;a.findTexture=FE3dModelRenderable_findTexture;a.textures=FE3dModelRenderable_textures;
a.bones=FE3dModelRenderable_bones;a.load=FE3dModelRenderable_load;a.build=FE3dModelRenderable_build;a.update=FE3dModelRenderable_update;return a}function FE3dModelRenderable_construct(){this.__base.FG3dRenderable.construct.call(this)}function FE3dModelRenderable_testVisible(a){a=this._ready;if(!a){var b=this._renderable;b&&(a=this._ready=b.testReady())}return a}function FE3dModelRenderable_vertexCount(){return this._renderable.vertexCount()}
function FE3dModelRenderable_findVertexBuffer(a){return this._renderable.findVertexBuffer(a)}function FE3dModelRenderable_vertexBuffers(){return this._renderable.vertexBuffers()}function FE3dModelRenderable_indexBuffer(){return this._renderable.indexBuffer()}function FE3dModelRenderable_findTexture(a){return this._renderable.findTexture(a)}function FE3dModelRenderable_textures(){return this._renderable.textures()}function FE3dModelRenderable_bones(a){return this._bones}
function FE3dModelRenderable_load(a){var b=this._material,e=this._materialResource=a.material();e&&b.assignInfo(e.info());this._effectCode=b.info().effectCode;this._renderable=a}function FE3dModelRenderable_build(a){var b=this._renderable.boneIds();if(b)for(var e=this._bones=new TObjects,f=b.length(),h=0;h<f;h++){var k=b.get(h),q=a.findBone(k);if(null==q)throw new TError("Bone is not exists. (bone_id={1})",k);e.push(q)}}
function FE3dModelRenderable_update(a){a=this._display.matrix();this._matrix.assign(a)}function FE3dPolygon(a){return a=RClass.inherits(this,a,FE3dRenderable)}function FE3dRectangle(a){a=RClass.inherits(this,a,FE3dRenderable);a._vertexPositionBuffer=null;a._vertexColorBuffer=null;a._indexBuffer=null;a.setup=FE3dRectangle_setup;return a}
function FE3dRectangle_setup(a){this._vertexPositionBuffer=a.createVertexBuffer();this._vertexPositionBuffer.upload([-1,1,0,1,1,0,1,-1,0,-1,-1,0],12,4);this._vertexColorBuffer=a.createVertexBuffer();this._vertexColorBuffer.upload([0,1,0,1,1,0,0,1,1,0,0,1,0,0,0,1],16,4);this._indexBuffer=context.createIndexBuffer();this._indexBuffer.upload([0,1,2,0,2,3],6)}
function FE3dScene(a){a=RClass.inherits(this,a,FE3dStage,MListenerLoad);a._dataReady=!1;a._resource=null;a._dirty=!1;a.onProcess=FE3dScene_onProcess;a.construct=FE3dScene_construct;a.createRegion=FE3dScene_createRegion;a.resource=FE3dScene_resource;a.loadTechniqueResource=FE3dScene_loadTechniqueResource;a.loadRegionResource=FE3dScene_loadRegionResource;a.loadDisplayResource=FE3dScene_loadDisplayResource;a.loadLayerResource=FE3dScene_loadLayerResource;a.loadResource=FE3dScene_loadResource;a.dirty=
FE3dScene_dirty;a.processLoad=FE3dScene_processLoad;a.active=FE3dScene_active;a.deactive=FE3dScene_deactive;return a}function FE3dScene_onProcess(){this.__base.FE3dStage.onProcess.call(this);if(this._dirty){for(var a=this._region.allRenderables(),b=a.count()-1;0<=b;b--)a.getAt(b).resetInfos();this._dirty=!1}}function FE3dScene_construct(){this.__base.FE3dStage.construct.call(this)}function FE3dScene_createRegion(){return RClass.create(FE3dSceneRegion)}
function FE3dScene_resource(a){return this._resource}function FE3dScene_loadTechniqueResource(a){this._technique._resource=a}
function FE3dScene_loadRegionResource(a){this._region.loadResource(a);var b=a.camera(),e=b.projection(),f=this._camera;f._resource=b;var h=f._projection;f.position().assign(b.position());f.setDirection(b.direction().x,b.direction().y,b.direction().z);f.update();h.size().assign(this._graphicContext.size());h._angle=e.angle();h._znear=e.znear();h._zfar=e.zfar();h.update();e=a.light();a=e.camera();b=a.projection();f=this._directionalLight;f._resource=e;e=f._camera;f=e._projection;e.position().set(1,
1,-1);e.lookAt(0,0,0);e.position().assign(a.position());e.update();f.size().set(1024,1024);f._angle=60;f._znear=b.znear();f._zfar=b.zfar();f.update()}function FE3dScene_loadDisplayResource(a,b){var e=RConsole.find(FE3dSceneConsole).factory().create(EE3dScene.Display);e.linkGraphicContext(this);e.loadSceneResource(b);RConsole.find(FE3dTemplateConsole).loadByGuid(e,b.templateGuid());a.pushDisplay(e)}
function FE3dScene_loadLayerResource(a){var b=RConsole.find(FE3dSceneConsole).factory().create(EE3dScene.Layer);b.loadResource(a);var e=a.displays();if(e)for(var f=e.count(),h=0;h<f;h++){var k=e.get(h);this.loadDisplayResource(b,k)}this.registerLayer(a.code(),b)}function FE3dScene_loadResource(a){this.loadTechniqueResource(a.technique());this.loadRegionResource(a.region());a=a.layers();for(var b=a.count(),e=0;e<b;e++){var f=a.value(e);this.loadLayerResource(f)}}
function FE3dScene_dirty(){this._dirty=!0}function FE3dScene_processLoad(){if(this._dataReady)return!0;if(!this._resource.testReady())return!1;this.loadResource(this._resource);this.processLoadListener(this);return!0}function FE3dScene_active(){this.__base.FE3dStage.active.call(this)}function FE3dScene_deactive(){this.__base.FE3dStage.deactive.call(this)}
function FE3dSceneCanvas(a){a=RClass.inherits(this,a,FE3dCanvas);a._activeScene=null;a._captureStatus=!1;a._capturePosition=null;a._captureCameraPosition=null;a._captureCameraRotation=null;a._actionFullScreen=!1;a._actionPlay=!1;a._actionMovie=!1;a._actionUp=!1;a._actionDown=!1;a._actionForward=!1;a._actionBack=!1;a._cameraMoveRate=.4;a._cameraKeyRotation=.03;a._cameraMouseRotation=.005;a.onEnterFrame=FE3dSceneCanvas_onEnterFrame;a.onMouseCaptureStart=FE3dSceneCanvas_onMouseCaptureStart;a.onMouseCapture=
FE3dSceneCanvas_onMouseCapture;a.onMouseCaptureStop=FE3dSceneCanvas_onMouseCaptureStop;a.onTouchStart=FE3dSceneCanvas_onTouchStart;a.onTouchMove=FE3dSceneCanvas_onTouchMove;a.onTouchStop=FE3dSceneCanvas_onTouchStop;a.onSceneLoad=FE3dSceneCanvas_onSceneLoad;a.onResize=FE3dSceneCanvas_onResize;a.construct=FE3dSceneCanvas_construct;a.load=FE3dSceneCanvas_load;a.switchPlay=FE3dSceneCanvas_switchPlay;a.switchMovie=FE3dSceneCanvas_switchMovie;a.doAction=FE3dSceneCanvas_doAction;a.dispose=FE3dSceneCanvas_dispose;
return a}
function FE3dSceneCanvas_onEnterFrame(){var a=this._activeScene;if(a){var b=a.camera(),e=this._cameraMoveRate,f=this._cameraKeyRotation,h=RKeyboard.isPress(EKeyCode.W),k=RKeyboard.isPress(EKeyCode.S);(h&&!k||this._actionForward)&&b.doWalk(e);(!h&&k||this._actionBack)&&b.doWalk(-e);h=RKeyboard.isPress(EKeyCode.A);k=RKeyboard.isPress(EKeyCode.D);h&&!k&&b.doYaw(f);!h&&k&&b.doYaw(-f);h=RKeyboard.isPress(EKeyCode.Q);k=RKeyboard.isPress(EKeyCode.E);(h&&!k||this._actionUp)&&b.doFly(e);(!h&&k||this._actionDown)&&b.doFly(-e);
e=RKeyboard.isPress(EKeyCode.Z);h=RKeyboard.isPress(EKeyCode.X);e&&!h&&b.doPitch(f);!e&&h&&b.doPitch(-f);b.update();if(this._optionRotation){f=this._rotation;a=a.layers();b=a.count();for(e=0;e<b;e++)h=a.value(e).matrix(),h.setRotation(0,f.y,0),h.update();f.y+=.01}}}
function FE3dSceneCanvas_onMouseCaptureStart(a){var b=this._activeScene;if(b){var e=this._activeScene.region();RConsole.find(FG3dTechniqueConsole).find(this._context,FG3dSelectTechnique).test(e,a.offsetX,a.offsetY);this._capturePosition.set(a.clientX,a.clientY);this._captureCameraRotation.assign(b.camera()._rotation)}}
function FE3dSceneCanvas_onMouseCapture(a){if(this._activeScene){var b=a.clientX-this._capturePosition.x;a=a.clientY-this._capturePosition.y;var e=this._activeScene.camera().rotation(),f=this._captureCameraRotation;e.x=f.x+a*this._cameraMouseRotation;e.y=f.y+b*this._cameraMouseRotation}}function FE3dSceneCanvas_onMouseCaptureStop(a){}
function FE3dSceneCanvas_onTouchStart(a){var b=this._activeScene;if(b){this._activeScene.region();var e=a.touches;1==e.length&&(a.preventDefault(),a=e[0],this._captureStatus=!0,this._capturePosition.set(a.clientX,a.clientY),this._captureCameraPosition.assign(b.camera().position()),this._captureCameraRotation.assign(b.camera().rotation()))}}
function FE3dSceneCanvas_onTouchMove(a){if(this._captureStatus){var b=a.touches;if(1==b.length){a.preventDefault();a=b[0];var b=this._activeScene.camera().rotation(),e=a.clientX-this._capturePosition.x;b.x=this._captureCameraRotation.x+-(a.clientY-this._capturePosition.y)*this._cameraMouseRotation;b.y=this._captureCameraRotation.y+-e*this._cameraMouseRotation}}}function FE3dSceneCanvas_onTouchStop(a){this._captureStatus=!1}
function FE3dSceneCanvas_onSceneLoad(a){a=this._activeScene;var b=this._context.size(),e=a.camera().projection();e.size().set(b.width,b.height);e.update();this.processLoadListener(this,a)}function FE3dSceneCanvas_onResize(a){this.__base.FE3dCanvas.onResize.call(this,a);a=this._context.size();var b=this._activeScene;b&&(b=b.camera().projection(),b.size().set(a.width,a.height),b.update())}
function FE3dSceneCanvas_construct(){this.__base.FE3dCanvas.construct.call(this);this._rotation=new SVector3;this._capturePosition=new SPoint2;this._captureCameraPosition=new SPoint3;this._captureCameraRotation=new SVector3}
function FE3dSceneCanvas_load(a){var b=this._context,e=RConsole.find(FE3dSceneConsole);null!=this._activeScene&&e.free(this._activeScene);a=e.alloc(this._context,a);a.addLoadListener(this,this.onSceneLoad);a.selectTechnique(b,FG3dGeneralTechnique);this._stage=this._activeScene=a;RStage.register("stage3d",a)}function FE3dSceneCanvas_switchPlay(a){for(var b=this._activeScene.allDisplays(),e=b.count(),f=0;f<e;f++){var h=b.get(f);h._movies&&(h._optionPlay=a)}this._actionPlay=a}
function FE3dSceneCanvas_switchMovie(a){for(var b=this._activeScene.allDisplays(),e=b.count(),f=0;f<e;f++){var h=b.get(f);h._movies&&(h._optionMovie=a)}this._actionMovie=a}
function FE3dSceneCanvas_doAction(a,b,e){if(this._activeScene)switch(a.preventDefault(),this._actionBack=this._actionForward=this._actionDown=this._actionUp=!1,b){case "fullscreen":a=this._actionFullScreen=!this._actionFullScreen;RHtml.fullscreen(this._hPanel,a);break;case "play":this.switchMovie(!this._actionMovie);this.switchPlay(this._actionMovie);break;case "up":this._actionUp=e;break;case "down":this._actionDown=e;break;case "forward":this._actionForward=e;break;case "back":this._actionBack=
e}}function FE3dSceneCanvas_dispose(){var a=this._rotation;a&&(a.dispose(),this._rotation=null);this.__base.FE3dCanvas.dispose.call(this)}function FE3dSceneConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._factory=null;a._loadScenes=null;a._scenes=null;a._thread=null;a._interval=100;a.onProcess=FE3dSceneConsole_onProcess;a.construct=FE3dSceneConsole_construct;a.factory=FE3dSceneConsole_factory;a.scenes=FE3dSceneConsole_scenes;a.alloc=FE3dSceneConsole_alloc;return a}
function FE3dSceneConsole_onProcess(){var a=this._loadScenes;for(a.record();a.next();)a.current().processLoad()&&a.removeCurrent()}
function FE3dSceneConsole_construct(){this._loadScenes=new TLooper;this._scenes=new TDictionary;var a=this._factory=RClass.create(FClassFactory);a.register(EE3dScene.Scene,FE3dScene);a.register(EE3dScene.Layer,FE3dSceneLayer);a.register(EE3dScene.Display,FE3dSceneDisplay);a.register(EE3dScene.Material,FE3dSceneMaterial);a.register(EE3dScene.Renderable,FE3dSceneDisplayRenderable);a=this._thread=RClass.create(FThread);a.setInterval(this._interval);a.addProcessListener(this,this.onProcess);RConsole.find(FThreadConsole).start(a)}
function FE3dSceneConsole_factory(){return this._factory}function FE3dSceneConsole_scenes(){return this._scenes}function FE3dSceneConsole_alloc(a,b){var e=RConsole.find(FE3sSceneConsole).load(b),f=RClass.create(FE3dScene);f.linkGraphicContext(a);f._name=b;f._resource=e;f.setup();e.testReady()?f.load(e):this._loadScenes.push(f);return f}
function FE3dSceneDisplay(a){a=RClass.inherits(this,a,FE3dTemplate);a._dataReady=!1;a._optionPlay=!1;a._optionMovie=!1;a._movieMatrix=null;a._resourceScene=null;a._materials=null;a._movies=null;a.construct=FE3dSceneDisplay_construct;a.resourceScene=FE3dSceneDisplay_resourceScene;a.loadSceneResource=FE3dSceneDisplay_loadSceneResource;a.loadResource=FE3dSceneDisplay_loadResource;a.updateMatrix=FE3dSceneDisplay_updateMatrix;return a}
function FE3dSceneDisplay_construct(){this.__base.FE3dTemplate.construct.call(this);this._movieMatrix=new SMatrix3d}function FE3dSceneDisplay_resourceScene(){return this._resourceScene}
function FE3dSceneDisplay_loadSceneResource(a){var b=RConsole.find(FE3dSceneConsole).factory();this._resourceScene=a;this._matrix.assign(a.matrix());var e=a.materials();if(e)for(var f=e.count(),h=this._materials=new TDictionary,k=0;k<f;k++){var q=e.get(k),t=b.create(EE3dScene.Material);t._display=this;t.loadSceneResource(q);h.set(q.groupGuid(),t)}if(e=a.movies())for(f=e.count(),h=this._movies=new TObjects,k=0;k<f;k++)q=e.get(k),t=RClass.create(FE3dSceneDisplayMovie),t.loadResource(q),h.push(t)}
function FE3dSceneDisplay_loadResource(a){var b=RConsole.find(FE3dSceneConsole).factory(),e=this._materials;a=a.displays();var f=a.count();if(0<f)for(var h=0;h<f;h++){var k=a.get(h),q=b.create(EE3dScene.Renderable);q._display=this;q.linkGraphicContext(this);q.loadResource(k);this._meshRenderables.push(q);this.pushRenderable(q);k=k.materials().first();k=e.get(k.groupGuid());q.loadMaterial(k)}}
function FE3dSceneDisplay_updateMatrix(a){a=this._currentMatrix.identity();var b=this._movies;if(b){if(this._optionMovie)for(var e=b.count(),f=0;f<e;f++)b.get(f).process(this._movieMatrix);a.append(this._movieMatrix)}a.append(this._matrix);(a=this._parent)&&this._currentMatrix.append(a._currentMatrix)}
function FE3dSceneDisplayMovie(a){a=RClass.inherits(this,a,FObject);a._resource=null;a._interval=null;a._firstTick=0;a._lastTick=0;a._matrix=new SMatrix3d;a.loadResource=FE3dSceneDisplayMovie_loadResource;a.process=FE3dSceneDisplayMovie_process;return a}function FE3dSceneDisplayMovie_loadResource(a){this._resource=a;this._interval=a._interval;this._matrix.setRotation(a._rotation.x,a._rotation.y*Math.PI/180,a._rotation.z);this._matrix.update()}
function FE3dSceneDisplayMovie_process(a){0==this._firstTick&&(this._firstTick=RTimer.current());0==this._lastTick&&(this._lastTick=RTimer.current());var b=RTimer.current();b-this._lastTick>this._interval&&("rotation"==this._resource.code()&&a.append(this._matrix),this._lastTick=b)}
function FE3dSceneDisplayRenderable(a){a=RClass.inherits(this,a,FE3dTemplateRenderable);a._materialReference=null;a.materialReference=FE3dSceneDisplayRenderable_materialReference;a.loadMaterial=FE3dSceneDisplayRenderable_loadMaterial;a.reloadResource=FE3dSceneDisplayRenderable_reloadResource;return a}function FE3dSceneDisplayRenderable_materialReference(a){return this._materialReference}function FE3dSceneDisplayRenderable_loadMaterial(a){this._materialReference=a;this._material.calculate(a)}
function FE3dSceneDisplayRenderable_reloadResource(){var a=this._material;a.calculate(this._materialReference);a.update()}function FE3dSceneLayer(a){a=RClass.inherits(this,a,FDisplayLayer);a._resource=null;a.resource=FE3dSceneLayer_resource;a.loadResource=FE3dSceneLayer_loadResource;return a}function FE3dSceneLayer_resource(){return this._resource}function FE3dSceneLayer_loadResource(a){this._resource=a}
function FE3dSceneMaterial(a){a=RClass.inherits(this,a,FG3dMaterial);a._display=null;a._resource=null;a.groupGuid=FE3dSceneMaterial_groupGuid;a.resource=FE3dSceneMaterial_resource;a.loadSceneResource=FE3dSceneMaterial_loadSceneResource;a.reload=FE3dSceneMaterial_reload;return a}function FE3dSceneMaterial_groupGuid(a){return this._resource.groupGuid()}function FE3dSceneMaterial_resource(a){return this._resource}
function FE3dSceneMaterial_loadSceneResource(a){this._resource=a;this._info.assign(a.info())}function FE3dSceneMaterial_reload(a){this._info.assign(this._resource.info())}function FE3dSceneRegion(a){a=RClass.inherits(this,a,FE3dRegion);a._resource=null;a.construct=FE3dSceneRegion_construct;a.resource=FE3dSceneRegion_resource;a.loadResource=FE3dSceneRegion_loadResource;a.reloadResource=FE3dSceneRegion_reloadResource;a.dispose=FE3dSceneRegion_dispose;return a}
function FE3dSceneRegion_construct(){this.__base.FE3dRegion.construct.call(this)}function FE3dSceneRegion_resource(){return this._resource}function FE3dSceneRegion_loadResource(a){this._resource=a;this.reloadResource()}function FE3dSceneRegion_reloadResource(){var a=this._resource;a.optionBackground()?(this._backgroundColor.assignPower(a.backgroundColor()),this._backgroundColor.alpha=1):this._backgroundColor.set(0,0,0,0)}
function FE3dSceneRegion_dispose(){this._resource=null;this.__base.FE3dRegion.dispose.call(this)}
function FE3dTemplate(a){a=RClass.inherits(this,a,FE3dDisplay,MGraphicObject,MListenerLoad);a._dataReady=!1;a._ready=!1;a._resource=null;a._meshRenderables=null;a._skeletons=null;a._animations=null;a._resource=null;a.construct=FE3dTemplate_construct;a.testReady=FE3dTemplate_testReady;a.findMeshByCode=FE3dTemplate_findMeshByCode;a.meshRenderables=FE3dTemplate_meshRenderables;a.skeletons=FE3dTemplate_skeletons;a.pushSkeleton=FE3dTemplate_pushSkeleton;a.findAnimation=FE3dTemplate_findAnimation;a.animations=
FE3dTemplate_animations;a.pushAnimation=FE3dTemplate_pushAnimation;a.resource=FE3dTemplate_resource;a.setResource=FE3dTemplate_setResource;a.loadSkeletons=FE3dTemplate_loadSkeletons;a.linkAnimation=FE3dTemplate_linkAnimation;a.loadAnimations=FE3dTemplate_loadAnimations;a.loadResource=FE3dTemplate_loadResource;a.reloadResource=FE3dTemplate_reloadResource;a.processLoad=FE3dTemplate_processLoad;a.process=FE3dTemplate_process;a.dispose=FE3dTemplate_dispose;return a}
function FE3dTemplate_construct(){this.__base.FE3dDisplay.construct.call(this);this._meshRenderables=new TObjects}function FE3dTemplate_testReady(){return this._dataReady}function FE3dTemplate_findMeshByCode(a){for(var b=this._meshRenderables,e=b.count()-1;0<=e;e--){var f=b.getAt(e);if(f._renderable._resource._code==a)return f}return null}function FE3dTemplate_meshRenderables(){return this._meshRenderables}function FE3dTemplate_skeletons(){return this._skeletons}
function FE3dTemplate_pushSkeleton(a){var b=this._skeletons;b||(b=this._skeletons=new TDictionary);this._activeSkeleton||(this._activeSkeleton=a);b.set(a._resource.guid(),a)}function FE3dTemplate_findAnimation(a){var b=this._animations;return b?b.get(a):null}function FE3dTemplate_animations(){return this._animations}function FE3dTemplate_pushAnimation(a){var b=this._animations;b||(b=this._animations=new TDictionary);var e=a.resource();b.set(e.guid(),a)}
function FE3dTemplate_resource(a){return this._resource}function FE3dTemplate_setResource(a){this._resource=a}function FE3dTemplate_loadSkeletons(a){var b=a.count();if(0<b){this.skeletons();for(var e=0;e<b;e++){var f=a.get(e),h=RClass.create(FE3rSkeleton);h.loadResource(f);this.pushSkeleton(h)}}}function FE3dTemplate_linkAnimation(a){a=a.tracks();for(var b=a.count(),e=0;e<b;e++){var f=a.get(e),h=f._resource._meshCode;h&&(this.findMeshByCode(h)._activeTrack=f)}}
function FE3dTemplate_loadAnimations(a){var b=a.count();if(0<b)for(var e=0;e<b;e++){var f=a.get(e),h=this.findAnimation(f.guid());h||(h=f.skeleton()?RClass.create(FE3rSkeletonAnimation):RClass.create(FE3rMeshAnimation),h.loadResource(f),this.pushAnimation(h))}}
function FE3dTemplate_loadResource(a){a=a.displays();var b=a.count();if(0<b)for(var e=0;e<b;e++){var f=a.get(e),h=RClass.create(FE3dTemplateRenderable);h._display=this;h.linkGraphicContext(this);h.loadResource(f);this._meshRenderables.push(h);this.pushRenderable(h)}}function FE3dTemplate_reloadResource(){var a=this._meshRenderables;if(a)for(var b=a.count(),e=0;e<b;e++)a.get(e).reloadResource()}
function FE3dTemplate_processLoad(){if(this._ready)return!0;if(!this._dataReady){if(!this._resource.testReady())return!1;this.loadResource(this._resource);this._dataReady=!0}var a=this._meshRenderables;if(a){for(var b=a.count(),e=0;e<b;e++)if(!a.get(e).testReady())return!1;for(e=0;e<b;e++)a.get(e).load()}if(a=this._animations)for(b=a.count(),e=0;e<b;e++){var f=a.value(e);null==f.resource().skeleton()&&this.linkAnimation(f)}this._ready=!0;this.processLoadListener(this);return this._ready}
function FE3dTemplate_process(){var a=this._animations;if(a)for(var b=a.count(),e=0;e<b;e++)a.value(e).record();this.__base.FE3dDisplay.process.call(this);var f=this._activeSkeleton;if(f&&a)for(b=a.count(),e=0;e<b;e++)a.value(e).process(f)}function FE3dTemplate_dispose(){this._meshRenderables=RObject.dispose(this._meshRenderables);this.__base.FE3dDisplay.dispose.call(this)}
function FE3dTemplateCanvas(a){a=RClass.inherits(this,a,FE3dCanvas);a._activeTemplate=null;a._capturePosition=null;a._captureRotation=null;a.onEnterFrame=FDsSceneCanvas_onEnterFrame;a.onMouseCaptureStart=FE3dTemplateCanvas_onMouseCaptureStart;a.onMouseCapture=FE3dTemplateCanvas_onMouseCapture;a.onMouseCaptureStop=FE3dTemplateCanvas_onMouseCaptureStop;a.onResize=FE3dTemplateCanvas_onResize;a.onTemplateLoad=FE3dTemplateCanvas_onTemplateLoad;a.construct=FE3dTemplateCanvas_construct;a.build=FE3dTemplateCanvas_build;
a.load=FE3dTemplateCanvas_load;a.setPanel=FE3dTemplateCanvas_setPanel;a.dispose=FE3dTemplateCanvas_dispose;return a}
function FE3dTemplateCanvas_onEnterFrame(){var a=this._activeTemplate;if(a){var b=a.camera(),e=.05,f=RKeyboard.isPress(EKeyCode.W),h=RKeyboard.isPress(EKeyCode.S);f&&!h&&b.doWalk(.5);!f&&h&&b.doWalk(-.5);f=RKeyboard.isPress(EKeyCode.A);h=RKeyboard.isPress(EKeyCode.D);f&&!h&&b.doYaw(e);!f&&h&&b.doYaw(-e);f=RKeyboard.isPress(EKeyCode.Q);h=RKeyboard.isPress(EKeyCode.E);f&&!h&&b.doFly(.5);!f&&h&&b.doFly(-.5);h=RKeyboard.isPress(EKeyCode.Z);f=RKeyboard.isPress(EKeyCode.X);h&&!f&&b.doPitch(e);!h&&f&&b.doPitch(-e);
b.update();if(this._optionRotation){e=this._rotation;a=a.layers();b=a.count();for(f=0;f<b;f++)h=a.value(f).matrix(),h.setRotation(0,e.y,0),h.update();e.y+=.01}}}function FE3dTemplateCanvas_onMouseCaptureStart(a){var b=this._activeTemplate;if(b){var e=this._activeTemplate.region();RConsole.find(FG3dTechniqueConsole).find(this._context,FG3dSelectTechnique).test(e,a.offsetX,a.offsetY);this._capturePosition.set(a.clientX,a.clientY);this._captureRotation.assign(b.camera()._rotation)}}
function FE3dTemplateCanvas_onMouseCapture(a){if(this._activeTemplate){var b=a.clientX-this._capturePosition.x;a=a.clientY-this._capturePosition.y;var e=this._activeTemplate.camera().rotation(),f=this._captureRotation;e.x=f.x+.003*a;e.y=f.y+.003*b}}function FE3dTemplateCanvas_onMouseCaptureStop(a){}function FE3dTemplateCanvas_onResize(){var a=this._hPanel,b=a.offsetWidth,a=a.offsetHeight,e=this._hCanvas;e.width=b;e.height=a;this._context.setViewport(0,0,b,a)}
function FE3dTemplateCanvas_onTemplateLoad(a){a=this._activeTemplate;var b=this._context.size(),e=a.camera().projection();e.size().set(b.width,b.height);e.update();this.processLoadListener(this,a)}function FE3dTemplateCanvas_construct(){this.__base.FObject.construct.call(this);this._rotation=new SVector3;this._capturePosition=new SPoint2;this._captureRotation=new SVector3}
function FE3dTemplateCanvas_build(a){a=this._hCanvas=RBuilder.create(a,"CANVAS");a.__linker=this;this._context=REngine3d.createContext(FWglContext,a);RStage.lsnsEnterFrame.register(this,this.onEnterFrame);RStage.start(1E3/60);RWindow.lsnsResize.register(this,this.onResize);RConsole.find(FMouseConsole).register(this)}
function FE3dTemplateCanvas_load(a){var b=this._context,e=RConsole.find(FE3dSceneConsole);null!=this._activeTemplate&&e.free(this._activeTemplate);a=e.alloc(this._context,a);a.addLoadListener(this,this.onTemplateLoad);a.selectTechnique(b,FG3dGeneralTechnique);this._stage=this._activeTemplate=a;RStage.register("stage3d",a)}function FE3dTemplateCanvas_setPanel(a){this._hPanel=a;a.appendChild(this._hCanvas);this.onResize()}
function FE3dTemplateCanvas_dispose(){var a=this._rotation;a&&(a.dispose(),this._rotation=null);this.__base.FObject.dispose.call(this)}
function FE3dTemplateConsole(a){a=RClass.inherits(this,a,FConsole);a._scopeCd=EScope.Local;a._loadTemplates=null;a._templates=null;a._thread=null;a._interval=200;a.onProcess=FE3dTemplateConsole_onProcess;a.construct=FE3dTemplateConsole_construct;a.allocByGuid=FE3dTemplateConsole_allocByGuid;a.allocByCode=FE3dTemplateConsole_allocByCode;a.loadByGuid=FE3dTemplateConsole_loadByGuid;a.loadByCode=FE3dTemplateConsole_loadByCode;a.free=FE3dTemplateConsole_free;return a}
function FE3dTemplateConsole_onProcess(){var a=this._loadTemplates;for(a.record();a.next();)a.current().processLoad()&&a.removeCurrent()}function FE3dTemplateConsole_construct(){this._loadTemplates=new TLooper;this._templates=new TDictionary;var a=this._thread=RClass.create(FThread);a.setInterval(this._interval);a.addProcessListener(this,this.onProcess);RConsole.find(FThreadConsole).start(a)}
function FE3dTemplateConsole_allocByGuid(a,b){var e=this._templates.get(b);if(e&&!e.isEmpty())return e.pop();var e=RConsole.find(FE3sTemplateConsole).loadByGuid(b),f=RClass.create(FE3dTemplate);f.linkGraphicContext(a);f.setName(b);f._resourceGuid=b;f.setResource(e);this._loadTemplates.push(f);return f}
function FE3dTemplateConsole_allocByCode(a,b){var e=this._templates.get(b);if(e&&!e.isEmpty())return e.pop();var e=RConsole.find(FE3sTemplateConsole).loadByCode(b),f=RClass.create(FE3dTemplate);f.linkGraphicContext(a);f.setName(b);f._resourceGuid=b;f.setResource(e);this._loadTemplates.push(f);return f}function FE3dTemplateConsole_loadByGuid(a,b){var e=RConsole.find(FE3sTemplateConsole).loadByGuid(b);a._resourceGuid=b;a.setName(b);a.setResource(e);this._loadTemplates.push(a);return a}
function FE3dTemplateConsole_loadByCode(a,b){var e=RConsole.find(FE3sTemplateConsole).loadByCode(g,b);a._resourceGuid=g;a.setName(c);a.setResource(e);this._loadTemplates.push(a);return a}function FE3dTemplateConsole_free(a){a.remove();var b=a._resourceGuid,e=this._templates.get(b);e||(e=new TObjects,this._templates.set(b,e));e.push(a)}
function FE3dTemplateRenderable(a){a=RClass.inherits(this,a,FE3dMeshRenderable);a._ready=!1;a._resource=null;a._model=null;a._materialCode=null;a._materialResource=null;a.construct=FE3dTemplateRenderable_construct;a.testReady=FE3dTemplateRenderable_testReady;a.testVisible=FE3dTemplateRenderable_testVisible;a.resource=FE3dTemplateRenderable_resource;a.loadResource=FE3dTemplateRenderable_loadResource;a.reloadResource=FE3dTemplateRenderable_reloadResource;a.load=FE3dTemplateRenderable_load;a.dispose=
FE3dTemplateRenderable_dispose;return a}function FE3dTemplateRenderable_construct(){this.__base.FE3dMeshRenderable.construct.call(this)}function FE3dTemplateRenderable_testReady(){if(!this._model.testReady())return!1;var a=this._textures;if(a)for(var b=a.count(),e=0;e<b;e++)if(!a.value(e).testReady())return!1;return!0}function FE3dTemplateRenderable_testVisible(a){return this._visible&&this._ready}function FE3dTemplateRenderable_resource(a){return this._resource}
function FE3dTemplateRenderable_loadResource(a){this._resource=a;this._matrix.assign(a.matrix());this._model=RConsole.find(FE3rModelConsole).load(this._graphicContext,a.modelGuid());a=this._materialResource=a._activeMaterial._material;this._effectCode=a.info().effectCode;this._material.calculate(a);if(a=a.textures())for(var b=RConsole.find(FE3rTextureConsole),e=this._textures=new TDictionary,f=a.count(),h=0;h<f;h++){var k=a.get(h),q=b.loadBitmap(this._graphicContext,k.textureGuid(),k.bitmapGuid());
e.set(k.code(),q)}}function FE3dTemplateRenderable_reloadResource(){var a=this._material;a.calculate(this._materialResource);a.update()}
function FE3dTemplateRenderable_load(){var a=this._display,b=this._resource,e=b.model(),f=e.skeletons();f&&a.loadSkeletons(f);(f=e.animations())&&a.loadAnimations(f);b.mesh();for(var e=this._renderable=RConsole.find(FE3rModelConsole).findMesh(b.meshGuid()),h=e._vertexBuffers,b=h.count(),f=0;f<b;f++){var k=h.get(f);this._vertexBuffers.set(k._name,k)}if(e=e.skins()){a=a._activeSkeleton;h=this._activeSkin=e.first();e=h.streams();b=e.count();for(f=0;f<b;f++)k=e.get(f).buffer(),this._vertexBuffers.set(k._name,
k);k=h.resource().boneRefers();b=k.count();if(0<b)for(e=this._bones=new TObjects,f=0;f<b;f++){h=k.get(f);h=a.bones().get(h.index());if(null==h)throw new TError(this,"Bone is not exist.");e.push(h)}}this._ready=!0}function FE3dTemplateRenderable_dispose(){this.__base.FE3dMeshRenderable.dispose.call(this)};
